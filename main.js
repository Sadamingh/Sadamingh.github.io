!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){this.scene=a,this.gl=a.gl,this.subrenderables=[],this.keepBuffer=!1,this.parse=this._parse.bind(this),this.onLoad=this._onLoad.bind(this),this.mats=a.matlib.createProvider(b),this.texs=a.texlib.createProvider(b),this._state=j,this._loadables=[],this._loadPromise=null,this.node=new g}var e=a("lib/net"),f=a("lib/awd"),g=a("nanogl-node"),h=a("config"),i=a("when"),j=1,k=2,l=3;d.prototype={getLoadables:function(){var a;if(this._state===j){var b=h.asset_url(this.getAwdUrl());a=e.loadBytes(b).then(this.parse),this._loadables.push(a);for(var c=this.texs.getLoadables(),d=0;d<c.length;d++)this._loadables.push(c[d]);this._state=k,this._loadPromise=i.all(this._loadables),this._loadPromise.then(this.onLoad)}return this._loadables},getAwdUrl:function(){return null},getMaterial:function(a){return this.mats.getMaterial(a)},_parse:function(a){this.loader=new f(a),this.loader.keepBuffer=this.keepBuffer,this.loader.load(this,this.node),this.meshes=this.loader.getMeshes(),this._postParse()},_postParse:function(){},_onLoad:function(){this._state=l},preRender:function(a){},render:function(a,b){if(this._state===l){for(var c=0;c<this.subrenderables.length;c++)this.subrenderables[c].render(a,b);for(var d=this.meshes,c=0;c<d.length;c++)d[c].render(this.scene,a,b)}},renderPass:function(a,b,c){if(this._state===l){for(var d=0;d<this.subrenderables.length;d++)this.subrenderables[d].renderPass(a,b,c);for(var e=this.meshes,d=0;d<e.length;d++)e[d].renderPass(a,b,c)}},renderDepth:function(a,b,c){if(this._state===l){for(var d=0;d<this.subrenderables.length;d++)this.subrenderables[d].renderDepth(a,b,c);for(var e=this.meshes,d=0;d<e.length;d++)e[d].renderDepth(a,b,void 0,c)}},renderProgram:function(a,b,c){for(var d=this.meshes,e=0;e<d.length;e++)d[e].renderProgram(a,b,c)}},b.exports=d},{config:17,"lib/awd":27,"lib/net":51,"nanogl-node":214,when:280}],2:[function(a,b,c){function d(a){this.ext=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");var b=this;this.parse=function(a){return b._parse(a)}}function e(a){var b=new Int32Array(a,0,s);if(b[t]!==h)throw new Error("Invalid magic number in DDS header");if(!b[z]&j)throw new Error("Unsupported format, must contain a FourCC code");var c,d,e=b[A];switch(e){case k:c=8,d="dxt1";break;case l:c=16,d="dxt3";break;case m:c=16,d="dxt5";break;case o:d="rgba32f";break;case n:var f=new Uint32Array(a.slice(128,148));d=f[0];var C=f[1];f[2],f[3],f[4];if(C!==q||d!==r)throw new Error("Unsupported DX10 texture format "+d);d="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+g(e))}var D=b[v],E=1;D&i&&(E=Math.max(1,b[y]));var F=!1,G=b[B];G&p&&(F=!0);var H,I=b[x],J=b[w],K=b[u]+4,L=I,M=J,N=[];if(e===n&&(K+=20),F)for(var O=0;O<6;O++){var P=[];N[O]=P;I=L,J=M;for(var Q=0;Q<E;Q++)H=Math.max(4,I)/4*Math.max(4,J)/4*c,P.push(new Uint8Array(a,K,H)),K+=H,I=Math.floor(I/2),J=Math.floor(J/2)}else{var P=[];N[0]=P;for(var Q=0;Q<E;Q++)H=Math.max(4,I)/4*Math.max(4,J)/4*c,P.push(new Uint8Array(a,K,H)),K+=H,I=Math.max(1,Math.floor(I/2)),J=Math.max(1,Math.floor(J/2))}return{width:L,height:M,surfaces:N,format:this._getFormat(d),flags:D,cubemap:F}}function f(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function g(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)}var h=542327876,i=131072,j=4,k=f("DXT1"),l=f("DXT3"),m=f("DXT5"),n=f("DX10"),o=116,p=512,q=3,r=2,s=31,t=0,u=1,v=2,w=3,x=4,y=7,z=20,A=21,B=28;d.prototype={isSupported:function(){return!!this.ext},_getFormat:function(a){switch(a){case"dxt1":return this.ext.COMPRESSED_RGB_S3TC_DXT1_EXT;case"dxt3":return this.ext.COMPRESSED_RGBA_S3TC_DXT3_EXT;case"dxt5":return this.ext.COMPRESSED_RGBA_S3TC_DXT5_EXT;default:throw new Error("unsupported format "+a)}},_parse:e},b.exports=d},{}],3:[function(a,b,c){function d(){}var e=a("when");d.prototype={parse:function(a){var b=e.defer(),c=new Blob([a],{type:"image/jpeg"}),d=URL.createObjectURL(c),f=new Image;return f.onload=function(){URL.revokeObjectURL(d),b.resolve(f)},f.onerror=function(){URL.revokeObjectURL(d),b.reject()},f.src=d,b.promise}},b.exports=d},{when:280}],4:[function(a,b,c){function d(a){for(var b=0;b<12;b++)if(a[b]!==f[b])return!1;return!0}function e(a){this.ext=a.getExtension("WEBGL_compressed_texture_etc1")||a.getExtension("WEBKIT_WEBGL_compressed_texture_etc1");var b=this;this.parse=function(a){return b._parse(a)}}var f=new Uint8Array([171,75,84,88,32,49,49,187,13,10,26,10]);e.prototype={isSupported:function(){return!!this.ext},_parse:function(a){var b=new Uint8Array(a,0,12);if(!d(b))throw new Error("[KTXParser] Bad Magic");var a=new DataView(a),c=67305985===a.getUint32(12,!0),e=16;a.getUint32(e,c);e+=4;a.getUint32(e,c);e+=4;a.getUint32(e,c);e+=4;var f=a.getUint32(e,c);e+=4;a.getUint32(e,c);e+=4;var g=a.getUint32(e,c);e+=4;var h=a.getUint32(e,c);e+=4;a.getUint32(e,c);e+=4;var i=a.getUint32(e,c);e+=4;var j=a.getUint32(e,c);e+=4;var k=a.getUint32(e,c);e+=4;var l=a.getUint32(e,c);if(e+=4,f!==this.ext.COMPRESSED_RGB_ETC1_WEBGL)throw new Error("KTX unsupported internal format "+f+". Must be COMPRESSED_RGB_ETC1_WEBGL");e+=l;for(var m=k>0?k:1,n=i>0?i:1,o=j>0?j:1,p=[],q=0;q<o;q++)p.push([]);for(var r=0;r<m;r++){var s=a.getUint32(e,c);e+=4;for(var t=s&-4,u=0;u<n;u++)for(var q=0;q<o;q++){var v=new Uint8Array(a.buffer,e,t);e+=t,p[q].push(v)}}return{width:g,height:h,surfaces:p,format:f,cubemap:!1}},_getFormat:function(a){switch(a){case RGB_PVRTC_4BPPV1_Format:return this.ext.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case RGB_PVRTC_2BPPV1_Format:return this.ext.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case RGBA_PVRTC_4BPPV1_Format:return this.ext.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case RGBA_PVRTC_2BPPV1_Format:return this.ext.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;default:throw new Error("[PVRLoader] Unknown pixel format")}},_extract:function(a){for(var b=[],c=this._getFormat(a.format),d=({width:a.width,height:a.height,surfaces:b,format:c,cubemap:a.isCubemap},a.buffer),e=a.dataPtr,f=a.bpp,g=a.numSurfaces,h=0,i=0,j=0,k=0,l=0,m=0,n=0;n<g;n++)b.push([]);2===f?(j=8,k=4):(j=4,k=4),i=j*k*f/8;for(var o=0;o<a.numMipmaps;){var p=a.width>>o,q=a.height>>o;l=p/j,m=q/k,l<2&&(l=2),m<2&&(m=2),h=l*m*i;for(var n=0;n<g;n++){var r=new Uint8Array(d,e,h);b[n].push(r),e+=h}o++}}},b.exports=e},{}],5:[function(a,b,c){function d(a){var b=a.gl;this.scene=a,this.gl=b,this.materials={},this.matlist=[]}var e=a("./materials-provider");a("nanogl-pbr/depthpass"),a("nanogl-pbr/lib/input");d.OPAQUE=1,d.BLENDED=2,d.prototype={dispose:function(){this.gl=null,this.scene=null,this.materials=null,this.matlist=null},createProvider:function(a){var b=new e(this,a);return b},update:function(a){this.time+=a,this.uTime.set(this.time)},registerMaterial:function(a,b){void 0===this.materials[b]&&(this.materials[b]=a,this.matlist.push(a))},createBaseMaterial:function(){var a=makeMaterial(this.gl);return a._precision="highp",a.setIBL(this.scene.env.ibl),a.setLightSetup(this.scene.lights.setup),a.perVertexIrrad.disable(),a},getMaterial:function(a){var b=this.materials[a];return void 0===b&&(b=this.defaultMaterial),b},setOpaque:function(a){a._mask=d.OPAQUE,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0)},setGlass:function(a,b,c,e){a._mask=d.BLENDED,a.config.enableCullface(),a.config.enableDepthTest(),a.config.depthMask(!1),a.config.enableBlend(),a.config.blendFunc(this.gl.ONE,this.gl.CONSTANT_COLOR),a.config.blendColor(b,c,e,1)},compileAll:function(){this.matlist.forEach(function(a){a.compile(),a.prg.use()})}},b.exports=d},{"./materials-provider":6,"nanogl-pbr/depthpass":215,"nanogl-pbr/lib/input":231}],6:[function(a,b,c){function d(a,b){this.uid=b,this.lib=a,this.matlist=[],this.materials={}}d.prototype={registerMaterial:function(a,b){void 0===this.materials[b]&&(this.materials[b]=a,this.matlist.push(a),this.lib.registerMaterial(a,this.uid+"/"+b))},getMaterial:function(a){return this.materials[a]||this.lib.getMaterial(a)},dispose:function(){}},b.exports=d},{}],7:[function(a,b,c){function d(a){this.ext=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");var b=this;this.parse=function(a){return b._parse(a)}}function e(a){var b,c,d=a.header,e=d[12],f=d[2],k=d[6],l=d[7],m=(d[9],d[10]),n=d[11];switch(f){case 0:b=2,c=h;break;case 1:b=2,c=j;break;case 2:b=4,c=g;break;case 3:b=4,c=i;break;default:throw new Error("pvrtc - unsupported PVR format "+f)}return a.dataPtr=52+e,a.bpp=b,a.format=c,a.width=l,a.height=k,a.numSurfaces=m,a.numMipmaps=n,a.isCubemap=6===m,a}function f(a){var b,c=a.header,d=c[0],e=c[1],f=c[2],k=c[3],l=c[4],m=(c[5],c[6]),n=(c[7],c[8],c[9],c[10]),o=(c[11],c[12]),p=255,q=24,r=25,s=l&p,t=n>0;if(s===r)b=t?i:g,m=4;else{if(s!==q)throw new Error("pvrtc - unknown format "+s);b=t?j:h,m=2}return a.dataPtr=d,a.bpp=m,a.format=b,a.width=f,a.height=e,a.numSurfaces=o,a.numMipmaps=k+1,a.isCubemap=6===o,a}var g=2100,h=2101,i=2102,j=2103;d.prototype={isSupported:function(){return!!this.ext},_parse:function(a){var b,c=13,d=new Uint32Array(a,0,c),g={buffer:a,header:d};if(55727696===d[0])b=e(g);else{if(559044176!==d[11])throw new Error("[PVRLoader] Unknown PVR format");b=f(g)}return this._extract(b)},_getFormat:function(a){switch(a){case g:return this.ext.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case h:return this.ext.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case i:return this.ext.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case j:return this.ext.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;default:throw new Error("[PVRLoader] Unknown pixel format")}},_extract:function(a){for(var b=[],c=this._getFormat(a.format),d={width:a.width,height:a.height,surfaces:b,format:c,cubemap:a.isCubemap},e=a.buffer,f=a.dataPtr,g=a.bpp,h=a.numSurfaces,i=0,j=0,k=0,l=0,m=0,n=0,o=0;o<h;o++)b.push([]);2===g?(k=8,l=4):(k=4,l=4),j=k*l*g/8;for(var p=0;p<a.numMipmaps;){var q=a.width>>p,r=a.height>>p;m=q/k,n=r/l,m<2&&(m=2),n<2&&(n=2),i=m*n*j;for(var o=0;o<h;o++){var s=new Uint8Array(e,f,i);b[o].push(s),f+=i}p++}return d}},b.exports=d},{}],8:[function(a,b,c){function d(a,b,c){return 9728|+a|+b<<8|+(b&&c)<<1}function e(a,b){this._uid=f++,this.gl=a,this.id=this.gl.createTexture(),this.width=0,this.height=0,this.format=b||a.RGB,this.type=a.UNSIGNED_BYTE,a.bindTexture(g,this.id),this.setFilter(!0),this.clamp()}var f=0,g=34067;e.prototype={fromImages:function(a){var b=this.gl,c=this.format,d=this.type;this.width=a[0].width,this.height=a[0].height,b.bindTexture(g,this.id),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X,0,c,c,d,a[0]),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_Y,0,c,c,d,a[1]),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_Z,0,c,c,d,a[2]),b.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_X,0,c,c,d,a[3]),b.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,c,c,d,a[4]),b.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,c,c,d,a[5])},bind:function(a){var b=this.gl;void 0!==a&&b.activeTexture(b.TEXTURE0+(0|a)),b.bindTexture(g,this.id)},dispose:function(){this.gl.deleteTexture(this.id),this.id=null,this.gl=null},setFilter:function(a,b,c){var e=this.gl,f=d(!!a,!!b,!!c);e.texParameteri(g,e.TEXTURE_MAG_FILTER,d(!!a,!1,!1)),e.texParameteri(g,e.TEXTURE_MIN_FILTER,f)},repeat:function(){this.wrap(this.gl.REPEAT)},clamp:function(){this.wrap(this.gl.CLAMP_TO_EDGE)},mirror:function(){this.wrap(this.gl.MIRRORED_REPEAT)},wrap:function(a){var b=this.gl;b.texParameteri(g,b.TEXTURE_WRAP_S,a),b.texParameteri(g,b.TEXTURE_WRAP_T,a)}},b.exports=e},{}],9:[function(a,b,c){function d(a){this.loader=a,this.gl=a.gl,this.codec=null,this.url=null,this.baseUrl=null,this._bbc=!0,this._genMips=!1}function e(a){var b=k.defer();return k.all(a).then(b.resolve),b}function f(a,b,c){d.call(this,a),this.tex=new i(this.gl,c),this.baseUrl=Array.isArray(b)?b:[b],this.lodPromises=new Array(b.length),this.states=[];for(var e=0;e<b.length;e++)this.states[e]=m;this.pendingUpload=null,this.upload=this._upload.bind(this)}function g(a,b,c){d.call(this,a),this.tex=new l(this.gl,c),this.baseUrl=b,this.upload=this._upload.bind(this),this.parse=this._parse.bind(this)}function h(a,b){switch(b){case 0:return a.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return a.TEXTURE_CUBE_MAP_POSITIVE_Y;case 2:return a.TEXTURE_CUBE_MAP_POSITIVE_Z;case 3:return a.TEXTURE_CUBE_MAP_NEGATIVE_X;case 4:return a.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 5:return a.TEXTURE_CUBE_MAP_NEGATIVE_Z;default:throw new Error("surface overflow")}}var i=a("nanogl/texture"),j=a("lib/net"),k=a("when"),l=a("./texture-cube");d.prototype={nobbc:function(a){return this._bbc=!1,this},genMipmap:function(){return this._genMips=!0,this},setFilter:function(a,b,c){return b&&this.genMipmap(),this.tex.setFilter(a,b,c),this},repeat:function(){return this.tex.repeat(),this},clamp:function(){return this.tex.clamp(),this},aniso:function(a){return this.loader.setAniso(this.tex,a),this},load:function(){},prepare:function(){this.codec=this.loader.getCodec(this._bbc),this.resolveUrl()},resolveUrl:function(){this.url=this.baseUrl},uploadBcc:function(a,b){void 0===b&&(b=0);var c=this.tex,d=this.gl;c.bind();var e=a.surfaces[0],f=a.format,g=a.width,h=a.height;c.width=g,c.height=h;for(var i=0;i<e.length;i++){var j=e[i];d.compressedTexImage2D(d.TEXTURE_2D,i+b,f,g,h,0,j),g=Math.max(1,g>>1),h=Math.max(1,h>>1)}return c},uploadCubeBcc:function(a){var b=this.tex,c=this.gl;b.bind();for(var d=0;d<a.surfaces.length;d++){var e=a.surfaces[d],f=a.format,g=a.width,i=a.height;b.width=g,b.height=i;for(var j=0;j<e.length;j++){var k=e[j];c.compressedTexImage2D(h(c,d),j,f,g,i,0,k),g=Math.max(1,g>>1),i=Math.max(1,i>>1)}}return b},uploadStd:function(a){var b=this.tex,c=this.gl;return b.bind(),b.fromImage(a),this._genMips&&c.generateMipmap(c.TEXTURE_2D),b}};var m=1,n=2,o=4;f.prototype=Object.create(d.prototype),f.prototype.constructor=f,f.prototype.resolveUrl=function(){this.url=this.loader.resolveTexUrls(this.baseUrl,this.codec)},f.prototype.load=function(){return this.loadLevel(0)},f.prototype.loadLevel=function(a){if(this.prepare(),a>this.url.length-1)return null;for(var b=[],c=0;c<=a;c++)b.push(this._loadLodData(c));return this.pendingUpload&&this.pendingUpload.reject(),this.pendingUpload=e(b),this.pendingUpload.promise.then(this.upload)},f.prototype._loadLodData=function(a){var b=this.states;if(b[a]!==m)return this.lodPromises[a];var c=j.loadBytes(this.url[a]).then(this.codec.parser.parse);return this.lodPromises[a]=c,b[a]=n,c.then(function(){b[a]=o}),c},f.prototype._upload=function(a){var b=a.length-1;if(this.codec.compressed)for(var c=0;c<a.length;c++)this.uploadBcc(a[c],b-c);else this.uploadStd(a[b])},g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.resolveUrl=function(a){this.url=this.loader.resolveCubeUrl(this.baseUrl,this.codec)},g.prototype.load=function(){return this.prepare(),k.map(this.url,j.loadBytes).then(this.parse).then(this.upload)},g.prototype._parse=function(a){return k.map(a,this.codec.parser.parse)},g.prototype._upload=function(a){this.codec.compressed?this.uploadCubeBcc(a[0]):(this.tex.fromImages(a),this._genMips&&gl.generateMipmap(gl.TEXTURE_CUBE))},b.exports={TexDef:f,CubeDef:g}},{"./texture-cube":8,"lib/net":51,"nanogl/texture":254,when:280}],10:[function(a,b,c){function d(a,b,c){this.parser=a,this.ext=c,this.compressed=b,this.transformPath=function(a){return a+c}}function e(a){var b=a.gl;this.gl=b,this._lib={},this._list=[],this.resolveUrl=this._resolveUrl.bind(this),this.bbc=!0,this.maxCubeSize=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),this.extAniso=b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||b.getExtension("EXT_texture_filter_anisotropic"),this.maxAniso=this.extAniso?b.getParameter(this.extAniso.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this.DDSCodec=new d(new h(b),!0,".dds"),this.PVRCodec=new d(new i(b),!0,".pvr"),this.KTXCodec=new d(new j(b),!0,".ktx"),this.JPGCodec=new d(new k(b),!1,""),this.texDefs=[]}function f(a){return[a+"/negx.jpg",a+"/negy.jpg",a+"/negz.jpg",a+"/posx.jpg",a+"/posy.jpg",a+"/posz.jpg"]}var g=a("config"),h=a("./dds-parser"),i=a("./pvr-parser"),j=a("./ktx-parser"),k=a("./jpeg-parser"),l=a("./textures-provider"),m=a("./texture-def");e.prototype={createProvider:function(a){return void 0===a&&(a=""),new l(this,a)},get:function(a){var b=this._lib[a];if(void 0===b)throw new Error('texture "'+a+'" not found.');return b},setAniso:function(a,b){var c=this.gl;b=Math.min(this.maxAniso,b),b>0&&c.texParameterf(c.TEXTURE_2D,this.extAniso.TEXTURE_MAX_ANISOTROPY_EXT,b)},_resolveUrl:function(a){return g.asset_url(a)},resolveTexUrls:function(a,b){return a.map(this.resolveUrl).map(b.transformPath)},resolveCubeUrl:function(a,b){var a=g.asset_url(a);return b.compressed?[b.transformPath(a+"/tex")]:f(a)},makeTex:function(a,b){var c=new m.TexDef(this,a,b);return this.texDefs.push(c),c},makeCube:function(a,b,c){a+="/"+this.getCubeSize(b);var d=new m.CubeDef(this,a,c);return this.texDefs.push(d),d},getLoadables:function(){for(var a=[],b=0;b<this.texDefs.length;b++){var c=this.texDefs[b].load(this);a.push(c)}return a},getCodec:function(a){return void 0===a&&(a=!0),a=a&&this.bbc,this.DDSCodec.parser.isSupported()&&a?this.DDSCodec:this.PVRCodec.parser.isSupported()&&a?this.PVRCodec:this.KTXCodec.parser.isSupported()&&a?this.KTXCodec:this.JPGCodec},getCubeSize:function(a){for(;a>this.maxCubeSize;)a>>=1;return a}},b.exports=e},{"./dds-parser":2,"./jpeg-parser":3,"./ktx-parser":4,"./pvr-parser":7,"./texture-def":9,"./textures-provider":11,config:17}],11:[function(a,b,c){function d(a,b){this.name=b,this.lib=a,this._defs=[],this._lib={},this._list=[],this._dlib={}}d.prototype={register:function(a,b){void 0===this._lib[b]&&(this._dlib[b]=a,this._lib[b]=a.tex,this._defs.push(a),this._list.push(a),this.lib._lib[this.name+"/"+b]=a.tex)},get:function(a){var b=this._lib[a];if(void 0===b)throw new Error('texture "'+a+'" not found.');return b},getDef:function(a){var b=this._dlib[a];if(void 0===b)throw new Error('texture def"'+a+'" not found.');return b},makeTex:function(a,b,c){var d=this._dlib[a];return void 0===d&&(d=this.lib.makeTex(b,c),this.register(d,a)),d},makeCube:function(a,b,c,d){var e=this._dlib[a];return void 0===e&&(e=this.lib.makeCube(b,c,d),this.register(e,a)),e},getLoadables:function(){return this._defs.map(function(a){return a.load()})},getGhostLoadables:function(a){void 0===a&&(a=1);for(var b=[],c=0;c<this._list.length;c++)if(this._list[c].loadLevel){var d=this._list[c].loadLevel(a);d&&b.push(d)}return b},dispose:function(){}},b.exports=d},{}],12:[function(a,b,c){function d(a){this.scene=a;var b=new h;this.ac=b,this.masterGain=b.createGain(),this.masterGain.gain.value=1,this.masterReverb=new e(b,{seconds:.3,decay:0}),this.masterReverb.connect(this.masterGain),this.masterGain.connect(b.destination),this.audioBufferMusic();var c=this;document.addEventListener("visibilitychange",function(){c.masterGain.gain.value=document.hidden?0:1})}var e=a("./reverb"),f=(a("lib/math"),a("lib/net")),g=a("when"),h=window.AudioContext||window.webkitAudioContext;d.prototype={connectModule:function(a){a.connect(this.masterGain),a.connect(this.masterReverb.output)},preRender:function(){},audioBufferMusic:function(){var a=this.ac,b=this.masterGain;f.loadBytes("assets/sounds/soundtrack.mp3").then(function(b){var c=g.defer();return a.decodeAudioData(b,function(a){c.resolve(a)}),c.promise}).then(function(c){var d=a.createBufferSource();d.buffer=c;var e=a.createGain();e.connect(b),e.gain.value=.8,d.connect(e),d.loop=!0,d.start();var f=function(){try{d.start()}catch(a){}document.removeEventListener("touchstart",f)};document.addEventListener("touchstart",f)})},audioMediaMusic:function(){var a=this.ac,b=document.getElementById("soundtrack");b.muted=!1,b.autoplay=!0,b.volume=.8;var c=b.play();c&&c.then(null,function(){var a=function(){b.play(),document.removeEventListener("click",a)};document.addEventListener("click",a)}),this.source=a.createMediaElementSource(b),this.source.connect(this.masterGain)}},b.exports=d},{"./reverb":13,"lib/math":49,"lib/net":51,when:280}],13:[function(a,b,c){function d(a,b){this.input=this.output=a.createConvolver(),this._context=a;var c=this.meta.params;b=b||{},this._seconds=b.seconds||c.seconds.defaultValue,this._decay=b.decay||c.decay.defaultValue,this._reverse=b.reverse||c.reverse.defaultValue,this._buildImpulse()}d.prototype=Object.create(null,{connect:{value:function(a){this.output.connect(a.input?a.input:a)}},disconnect:{value:function(){this.output.disconnect()}},_buildImpulse:{value:function(){var a,b,c=this._context.sampleRate,d=c*this.seconds,e=this.decay,f=this._context.createBuffer(2,d,c),g=f.getChannelData(0),h=f.getChannelData(1);for(b=0;b<d;b++)a=b,g[b]=(2*Math.random()-1)*Math.pow(1-a/d,e),h[b]=(2*Math.random()-1)*Math.pow(1-a/d,e);this.input.buffer=f}},meta:{value:{name:"SimpleReverb",params:{seconds:{min:1,max:50,defaultValue:3,type:"float"},decay:{min:0,max:100,defaultValue:2,type:"float"},reverse:{min:0,max:1,defaultValue:0,type:"bool"}}}},seconds:{enumerable:!0,get:function(){return this._seconds},set:function(a){this._seconds=a,this._buildImpulse()}},decay:{enumerable:!0,get:function(){return this._decay},set:function(a){this._decay=a,this._buildImpulse()}},reverse:{enumerable:!0,get:function(){return this._reverse},set:function(a){this._reverse=a,this._buildImpulse()}}}),b.exports=d},{}],14:[function(a,b,c){function d(a){this.scene=a,this._current=null}d.prototype={setControler:function(a){this._current&&this._current.stop(),this._current=a,a.start(this.scene.camera)},preRender:function(){this._current&&this._current.update(this.scene.dt)}},b.exports=d},{}],15:[function(a,b,c){function d(a,b,c){c[0]=2*a.clientX/(b.width/window.devicePixelRatio)-1,c[1]=-(2*a.clientY/(b.height/window.devicePixelRatio)-1)}function e(a){this.el=a,this.mouse=k.fromValues(0,0,1),this.cam=null,this.orbitRadius=-1,this.mode=-1,this.onMouseMove=this._onMouseMove.bind(this)}function f(){}function g(){this.initialX=k.create(),this.initialR=l.create(),this.initialP=k.create(),this.startMouse=k.create(),this.focus=k.create()}function h(){this.initialX=k.create(),this.initialY=l.create(),this.initialP=k.create(),this.startMouse=k.create(),this.focus=k.create()}function i(){this.initialZ=k.create(),this.initialP=k.create(),this.startMouse=k.create(),this.focus=k.create()}var j=a("gl-matrix"),k=j.vec3,l=j.quat,m=j.mat4,n=l.create(),o=l.create(),p=l.create(),q=k.create(),r=k.create(),s=(m.create(),m.create()),t=0,u=1,v=2,w=4;e.prototype={start:function(a){this.cam=a,this.el.addEventListener("mousemove",this.onMouseMove),this.mode=-1,this.setMode(t)},stop:function(a){this.cam=null,this.el.removeEventListener("mousemove",this.onMouseMove)},update:function(a){},setMode:function(a){if(this.mode!==a){switch(this.mode=a,a){case t:this.action=new f;break;case u:this.action=new g;break;case v:this.action=new h;break;case w:this.action=new i}this.unproject(q),this.action.start(this.cam,q,this.mouse)}},unproject:function(a){this.cam.updateMatrix(),m.invert(s,this.cam.lens._proj),k.transformMat4(q,this.mouse,s),k.scale(q,q,this.orbitRadius/q[2]),k.transformMat4(a,q,this.cam._matrix)},_onMouseMove:function(a){var b=this._getModeForEvt(a);this.setMode(b),d(a,this.el,this.mouse),this.action.update(this.mouse)},_getModeForEvt:function(a){return 2!==a.which?t:a.altKey?a.ctrlKey?w:u:v}},f.prototype={start:function(){},update:function(){}},g.prototype={start:function(a,b,c){this.cam=a,k.copy(this.initialX,this.cam._matrix),k.copy(this.startMouse,c),l.copy(this.initialR,a.rotation),k.subtract(this.initialP,a.position,b),k.copy(this.focus,b)},update:function(a){k.subtract(q,a,this.startMouse),l.setAxisAngle(p,this.initialX,5*q[1]),l.rotateY(o,n,5*-q[0]),l.multiply(o,o,p),l.multiply(this.cam.rotation,o,this.initialR),k.transformQuat(q,this.initialP,o),k.add(this.cam.position,this.focus,q),this.cam.invalidate()}},h.prototype={start:function(a,b,c){this.cam=a,k.copy(this.initialX,this.cam._matrix),k.copy(this.initialP,this.cam.position),this.initialY[0]=this.cam._matrix[4],this.initialY[1]=this.cam._matrix[5],this.initialY[2]=this.cam._matrix[6],k.copy(this.startMouse,c),k.copy(this.focus,b)},update:function(a){k.subtract(q,a,this.startMouse),k.scale(r,this.initialX,.5*-q[0]),k.scaleAndAdd(r,r,this.initialY,.5*-q[1]),k.add(this.cam.position,this.initialP,r),this.cam.invalidate()}},i.prototype={start:function(a,b,c){this.cam=a,k.copy(this.initialP,this.cam.position),k.subtract(this.initialZ,this.cam.position,b),k.copy(this.startMouse,c),k.copy(this.focus,b)},update:function(a){k.subtract(q,a,this.startMouse),k.scale(q,this.initialZ,5*q[1]),k.add(this.cam.position,this.initialP,q),this.cam.invalidate()}},b.exports=e},{"gl-matrix":192}],16:[function(a,b,c){function d(a){this.scene=a,this.cam=null,this.tgt=i.create(),this.mparalax=h.create()}var e=a("lib/mouse"),f=a("gl-matrix"),g=(f.mat4,f.mat3),h=f.vec2,i=f.vec3,j=f.quat,k=j.create(),l=j.create(),m=i.create(),n=h.create(),o=i.fromValues(0,1,0),p=i.fromValues(0,0,1),q=g.create(),r=g.create(),s=new Float32Array(q.buffer,0,3),t=new Float32Array(q.buffer,12,3),u=new Float32Array(q.buffer,24,3);d.prototype={start:function(a){this.cam=a},stop:function(a){this.cam=null},update:function(a){var b=e.coords;h.scale(n,b,.03),h.sub(n,n,this.mparalax),h.scaleAndAdd(this.mparalax,this.mparalax,n,this.scene.dt/.5),this.scene.mods.getCameraPosition(this.cam.position,this.tgt),this.rotatePos(this.cam.position,this.tgt,this.mparalax),this.cam.lookAt(this.tgt),this.cam.invalidate()},rotatePos:function(a,b,c){var d=c[0],e=-c[1];i.sub(u,a,b);var f=i.length(u);i.cross(s,o,u),i.cross(t,u,s),i.normalize(s,s),i.normalize(t,t),i.normalize(u,u),j.rotateX(l,k,e),j.rotateY(l,l,d),g.fromQuat(r,l),g.multiply(q,q,r),p[2]=f,i.transformMat3(m,p,q),i.add(a,b,m)}},b.exports=d},{"gl-matrix":192,"lib/mouse":50}],17:[function(a,b,c){var d="./assets";b.exports={asset_url:function(a){return d+"/"+a},setBaseDir:function(a){void 0!==a&&(d=a)}}},{}],18:[function(a,b,c){b.exports={SECTION_SEP:2}},{}],19:[function(a,b,c){function d(){this.cfg=(new e).enableCullface(!1).enableDepthTest(!1),this.fbo=null}var e=a("nanogl-state/config");d.prototype={debug:function(a){this.fbo=a},render:function(a){if(null!==this.fbo){var b=a.quad,c=a.programs.debugFbo;c.use(),this.fbo.attachment.isDepthTexture&&this.fbo.attachment.isDepthTexture()?(this.fbo.attachment.buffer.setFilter(!1,!1,!1),this.fbo.attachment.buffer.clamp(),c.tTex(this.fbo.attachment.buffer)):c.tTex(this.fbo.color),b.attribPointer(c),a.glstate.push(this.cfg),a.glstate.apply(),b.render(),a.glstate.pop()}}},b.exports=new d},{"nanogl-state/config":244}],20:[function(a,b,c){function d(){return f}if(window.dat)b.exports=new dat.GUI;else{var e=function(){},f={onChange:e,name:e},g={addFolder:function(){return g},add:d,addColor:d};b.exports=g}},{}],21:[function(a,b,c){function d(){for(var a=0;a<t.__controllers.length;a++)t.__controllers[a].__onChange=null,t.remove(t.__controllers[a]);for(var a=0;a<t.__folders.length;a++)t.remove(t.__folders[a]);t.__controllers=[],t.__folders=[]}function e(){d(),u&&g(),v&&h()}function f(a){v=u.materials[a],e()}function g(){var a={};for(var b in u.materials)a[b]=b;t.add(w,"material",a).onChange(f)}function h(){var a=v;k(a,"albedo"),k(a,"specular"),k(a,"fresnel"),l(a,"gloss",!0),m(a,"clearcoat",!0),m(a,"cavityStr",!0),j(a,"perVertexIrrad"),j(a,"conserveEnergy")}function i(a){u=a,e()}function j(a,b){var c=a[b];if(void 0!==c){var d={v:c._val};t.add(d,"v").name(b).onChange(function(a){c.set(a)})}}function k(a,b){var c=a[b];void 0!==c&&c instanceof s.Uniform&&n(b,c)}function l(a,b,c){var d=a[b];void 0!==d&&d instanceof s.Uniform&&q(b,d,c)}function m(a,b,c){var d=a[b];void 0!==d&&d instanceof s.Uniform&&o(b,d,c)}function n(a,b){var c={};c[a]=[255*b._value[0],255*b._value[1],255*b._value[2]],t.addColor(c,a).onChange(function(a){b.set(a[0]/255,a[1]/255,a[2]/255)})}function o(a,b,c){var d={};d[a+".x"]=b._value[0],d[a+".y"]=b._value[1];var e=function(c){b.set(d[a+".x"],d[a+".y"])};p(d,a+".x",c).onChange(e),p(d,a+".y",c).onChange(e)}function p(a,b,c){var d;return d=c?t.add(a,b,0,1):t.add(a,b)}function q(a,b,c){var d={};d[a]=b._value[0];var e;e=c?t.add(d,a,0,1):t.add(d,a),e.onChange(function(a){b.set(a)})}var r=a("./gui"),s=a("nanogl-pbr/lib/input"),t=r.addFolder("materials"),u=null,v=null,w={material:null};b.exports={registerMaterials:i}},{"./gui":20,"nanogl-pbr/lib/input":231}],22:[function(a,b,c){function d(){if(null===o){var a=n*n;o=new Uint8Array(a);for(var b=0;a>b;b++)o[b]=128*(Math.random()+Math.random())}return o}function e(a){this.scene=a;var b=a.gl;this._noiseTex=new f(b,b.LUMINANCE),this._noiseTex.fromData(n,n,d()),this.config=this.scene.glstate.config().enableDepthTest(!1).depthMask(!1)}var f=a("nanogl/texture"),g=a("gl-matrix"),h=(a("consts"),a("lib/color")),i=g.mat4,j=g.vec3,k=i.create(),l=j.create(),m=[16225943,15378817,15187321,7778714,8764105,8359870,16225943].map(h.MakeFromHex),n=128,o=null;e.prototype={render:function(){var a=this.scene.programs.background;a.use();var b=this.scene.model._position;b===Math.round(b)?this.renderPlain(b):this.renderTransition(b)},renderTransition:function(a){var b=m[Math.floor(a)],c=m[Math.ceil(a)],d=a-Math.floor(a);j.lerp(l,b,c,d),this.renderColor(l)},renderPlain:function(a){var b=m[a];this.renderColor(b)},renderColor:function(a){var b=this.scene.programs.background,c=this.scene.quad,d=1.2,e=this.scene.renderer.width/n,f=this.scene.renderer.height/n;c.attribPointer(b),b.uMVP(k),b.uColor(a),b.tNoise(this._noiseTex),b.uScreenRatio(e/d,f/d),this.config.apply(),c.render()}},b.exports=e},{consts:18,"gl-matrix":192,"lib/color":32,"nanogl/texture":254}],23:[function(a,b,c){function d(a,b,c,d,j){var m=a.gl;this.lowquality=g.param("gshadow_low"),this.enabled=!0,this.size=d||128,this.blurSamples=j||9,this.spread=1,this.scene=a,this.gl=m,this.quad=new l(this.gl,-.5,-.5,1,1),this.width=b||1,this.height=c||1,this.depth=.2,this.opacity=1,this.node=new f,this.camera=h.makeOrthoCamera(),this.camera.rotateX(Math.PI/2),this.camera.lens.setBound(-this.width/2,this.width/2,-this.height/2,this.height/2),this.camera.lens.near=0,this.camera.lens.far=this.depth,this.fbo=k.create(m,{depth:!0,format:m.RED}),this.fbo.resize(this.size,this.size),this.hasDepth=this.fbo.attachment.isDepthTexture(),this.getDepthTex().clamp(),this.getDepthTex().setFilter(!0,!1,!1),this.node.add(this.camera),this._defaultPrg=null,this.defaultCfg=a.glstate.config().colorMask(!this.hasDepth,!this.hasDepth,!this.hasDepth,!this.hasDepth).depthMask(!0).enableDepthTest(),this.renderCfg=a.glstate.config().enableBlend(!0).blendFunc(m.ZERO,m.SRC_COLOR).depthMask(!1).enableDepthTest(),this.blurCfg=a.glstate.config().enableCullface(!1).depthMask(!1).enableDepthTest(!1),this.renderPrg=new i(m,e(["\nprecision lowp float;\n#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\nuniform vec2 uSize;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n  vec2 p = aPosition * uSize;\n  gl_Position = uMVP * vec4( p.x, 0.0, p.y, 1.0 );\n\n  vTexCoord = aTexCoord;\n}\n"]),e(["precision lowp float;\n#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D tShadow;\nuniform vec2 uOpacity;\n\nvoid main(void){\n  \n  // gl_FragColor = texture2D( tGradient, vec2( vTexCoord.y, 0.0) );\n  float lum = uOpacity.x + texture2D( tShadow, vTexCoord ).r * uOpacity.y;\n  lum = pow( lum, .4 );\n\n  gl_FragColor = vec4( vec3( lum ), 1.0 );\n\n}\n"])),this.blurPrg=new i(m,e(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord = aTexCoord;\n\n}\n"]),e(["precision highp float;\n#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D tInput;\nuniform float uSpread;\nuniform vec3 uKernel[NUM_SAMPLES];\n\nvoid main(void){\n\n  float shadow = 0.0;\n\n  for(int i=0; i<NUM_SAMPLES; ++i)\n  {\n    vec3 kernel = uKernel[i].xyz;\n    shadow += texture2D( tInput, vTexCoord + kernel.xy * uSpread ).x * kernel.z;\n  }\n\n  gl_FragColor = vec4( shadow, vec3(0.0) );\n  \n\n}\n"]),"#define NUM_SAMPLES "+this.blurSamples),
this.blurKernelA=new Float32Array(3*this.blurSamples),this.blurKernelB=new Float32Array(3*this.blurSamples),this.computeKernel(this.blurKernelA,!0,1/this.size),this.computeKernel(this.blurKernelB,!1,1/this.size),this.blurA_fbo=this.makeBlurFbo(),this.blurB_fbo=this.makeBlurFbo()}var e=a("glslify"),f=a("nanogl-node"),g=a("lib/quality"),h=a("nanogl-camera"),i=a("nanogl/program"),j=(a("nanogl-state/config"),a("nanogl/fbo")),k=a("nanogl-depth-texture/fbo"),l=a("nanogl-primitives-2d/rect"),m=(a("dev/fbo-debug"),e(["precision lowp float;\n#define GLSLIFY 1\n\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\n#ifdef D_RGB \n  varying vec2 fragZW;\n#endif\n\n  \nvoid main( void ){\n\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n\n  #ifdef D_RGB\n    fragZW = gl_Position.zw;\n  #endif\n}\n"])),n=e(["precision lowp float;\n#define GLSLIFY 1\n\n#ifdef D_RGB\n  varying vec2 fragZW;\n#endif\n\nvoid main(void){\n\n  \n  #ifdef D_RGB\n    gl_FragColor.x   = ( fragZW.x / fragZW.y ) * 0.5 + 0.5;\n    gl_FragColor.yzw = vec3(0.0);\n  #else\n    gl_FragColor = vec4( 0.0 );\n  #endif\n\n}\n"]);d.prototype={prepare:function(){if(this.enabled){var a=this.gl;this.camera.lens.far=this.depth,this.camera.updateViewProjectionMatrix(1,1),this.fbo.bind(),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)}},process:function(){if(this.enabled){var a=this.blurPrg,b=this.gl;b.clearColor(0,0,0,0),this.blurCfg.apply(),a.use(),a.uSpread(this.spread);var c=this.scene.quad;c.attribPointer(a),this.getDepthTex().bind(),this.getDepthTex().clamp(),this.blurA_fbo.bind(),b.clear(b.COLOR_BUFFER_BIT),a.tInput(this.getDepthTex()),a.uKernel(this.blurKernelA),c.render(),this.blurB_fbo.bind(),b.clear(b.COLOR_BUFFER_BIT),a.tInput(this.blurA_fbo.color),a.uKernel(this.blurKernelB),c.render()}},getDefaultDepthPass:function(){return null===this._defaultPrg&&(this._defaultPrg=this.makeCustomDepthPass()),this._defaultPrg},makeCustomDepthPass:function(a,b){a=a||m,b=b||n;var c=this.hasDepth?"":"#define D_RGB 1",d=new i(this.gl,a,b,c);return d},getDepthTex:function(){return this.hasDepth?this.fbo.attachment.buffer:this.fbo.color},getBlurredTex:function(){return this.blurB_fbo.color},render:function(){if(this.enabled){var a=this.scene;this.renderPrg.use(),this.renderPrg.uMVP(a.camera.getMVP(this.node._wmatrix)),this.renderPrg.uSize(this.width,this.height),this.renderPrg.uOpacity(1-this.opacity,this.opacity),this.renderPrg.tShadow(this.getBlurredTex()),this.quad.attribPointer(this.renderPrg),this.renderCfg.apply(),this.quad.render()}},makeBlurFbo:function(){var a=this.gl,b=new j(a,{format:a.RED});return b.resize(this.size,this.size),b.color.bind(),b.color.clamp(),b.color.setFilter(!0,!1,!1),b},computeKernel:function(a,b,c){for(var d=b?0:1,e=b?1:0,f=Math.sqrt(Math.PI),g=0,h=0;h<this.blurSamples;++h){var i=3*h,j=h-Math.round((this.blurSamples-1)/2),k=4*j/this.blurSamples;k=Math.exp(-k*k/2)/f,g+=k,a[i+d]=j*c,a[i+e]=0,a[i+2]=k}for(h=0;h<this.blurSamples;++h)a[3*h+2]/=g}},b.exports=d},{"dev/fbo-debug":19,glslify:205,"lib/quality":53,"nanogl-camera":207,"nanogl-depth-texture/fbo":210,"nanogl-node":214,"nanogl-primitives-2d/rect":242,"nanogl-state/config":244,"nanogl/fbo":251,"nanogl/program":253}],24:[function(a,b,c){function d(a){e.call(this),this.gl=a,this.geom=null,this.name="",this.materials=[],this.animator=null}var e=(a("nanogl-state/config"),a("nanogl-node"));a("gl-matrix").mat4.create();d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setAnimator=function(a){var b=this.geom.subgeoms,c=this.materials.length;this.animator=a;for(var d=0;d<b.length;d++){var e=(b[d],this.materials[Math.min(c-1,d)]);null===e.skinSetup&&e.setSkinSetup(a.createSkinSetup())}},d.prototype.preRender=function(a){},d.prototype.prepareSkin=function(){for(var a=this.geom.subgeoms,b=this.materials.length,c=0;c<a.length;c++){var d=this.materials[Math.min(b-1,c)];this.geom.skinned&&(d.skinNumWeight.set("SKIN"+this.geom.skinNumWeight),d.depthPass&&d.depthPass.skinNumWeight.set("SKIN"+this.geom.skinNumWeight))}},d.prototype.render=function(a,b,c){for(var d=this.geom.subgeoms,e=this.materials.length,f=a.glstate,g=0;g<d.length;g++){var h=d[g],i=this.materials[Math.min(e-1,g)];0!==(i._mask&b)&&(this.geom.skinned&&i.skinNumWeight.set("SKIN"+this.geom.skinNumWeight),i.prepare(this,a.camera),h.setup(i.prg),f.push(i.config),this.cfg&&f.push(this.cfg),c&&f.push(c),f.apply(),h.render(),f.pop(),this.cfg&&f.pop(),c&&f.pop())}},d.prototype.renderDepth=function(a,b,c,d){for(var e=this.geom.subgeoms,f=this.materials.length,g=this.gl.state,h=0;h<e.length;h++){var i=e[h],j=this.materials[Math.min(f-1,h)];0!==(j._mask&b)&&(j=j.depthPass,void 0===j&&(j=d),this.geom.skinned&&j.skinNumWeight.set("SKIN"+this.geom.skinNumWeight),j.prepare(this,a),i.setup(j.prg),j.config&&g.push(j.config),this.cfg&&g.push(this.cfg),c&&g.push(c),stats.drawCall(),g.apply(),i.render(),j.config&&g.pop(),this.cfg&&g.pop(),c&&g.pop())}},d.prototype.renderPass=function(a,b,c){for(var d=this.geom.subgeoms,e=this.materials.length,f=0;f<d.length;f++){var g=d[f],h=this.materials[Math.min(e-1,f)];0!==(h._mask&b)&&(c.prepare(this,a),g.setup(c.prg),this.gl.state.apply(),stats.drawCall(),g.render())}},d.prototype.renderProgram=function(a,b,c){var d=this.geom.subgeoms,e=this.materials.length;c=c||-1,b.uMVP(a.getMVP(this._wmatrix));for(var f=0;f<d.length;f++){var g=d[f],h=this.materials[Math.min(e-1,f)];0!==(h._mask&c)&&(g.setup(b),g.render())}},b.exports=d},{"gl-matrix":192,"nanogl-node":214,"nanogl-state/config":244}],25:[function(a,b,c){var d=a("nanogl-node"),e=a("./utils").setupObj3D;b.exports=function(){return function(a,b,c,f){var g=(f.gl,new d);return e(g,a,b,f),g}}},{"./utils":30,"nanogl-node":214}],26:[function(a,b,c){var d=a("lib/geometry"),e=a("nanogl/arraybuffer"),f=a("nanogl/indexbuffer"),g=a("awdlib/lib/awdlib_readonly"),h=g.consts,i=function(a){switch(a){case h.POSITION:return"aPosition";case h.UVS:return"aTexCoord";case h.NORMAL:return"aNormal";case h.TANGENT:return"aTangent";case h.JOIN_IDX:return"join_index";case h.JOIN_WGT:return"join_weight";case h.SUVS:return"aTexCoord1";case h.COLOR:return"aColor";case h.BINORMAL:return"aBitangent"}throw new Error("unknown stream type")};b.exports=function(){function a(a,b){var c=0;switch(a.ftype){case h.UINT8:c=b.UNSIGNED_BYTE;break;case h.UINT16:c=b.UNSIGNED_SHORT;break;case h.UINT32:c=b.UNSIGNED_INT;break;default:throw new Error("AWD : unsupported index buffer type "+a.ftype)}var d=new f(b,c);return d.data(a.data),d}function b(a,b){if(7!==a.ftype)throw new Error("AWD : vertex buffer type not f32");var c=new e(b);c.data(a.data);for(var d=a.attributes,f=0;f<d.length;f++){var g=d[f];c.attrib(i(g.type),g.len,b.FLOAT)}return c}return function(c,e,f,g){var h=g.gl,i=e.keepBuffer,j=new d(h);j.name=c.name;for(var k=c.subGeoms,l=0;l<k.length;l++){var m=k[l],n=new d.SubGeom(h);j.subgeoms.push(n);var o=m.props;n.bounds.fromMinMax([o.get(10),o.get(11),o.get(12)],[o.get(13),o.get(14),o.get(15)]);for(var p=m.buffers,q=0;q<p.length;q++){var r=p[q];r.isIndex?(n.ibuffer=a(r,h),i&&(n.indices=r.data)):(n.buffers.push(b(r,h)),i&&n.vertices.push(r.data))}}return j}}},{"awdlib/lib/awdlib_readonly":170,"lib/geometry":35,"nanogl/arraybuffer":249,"nanogl/indexbuffer":252}],27:[function(a,b,c){function d(){g={handleGeometry:a("./geometry")(),handleMesh:a("./mesh")(),handleContainer:a("./container")(),handleMaterial:a("./material")()}}function e(a,b){var c=awdLib_pil.extInfos;if(b==c.URI)switch(a){case c.INTERLEAVED_GEOM:return g.handleGeometry}else switch(a){case h.MESH:return g.handleMesh;case h.CONTAINER:return g.handleContainer;case h.MATERIAL:return g.handleMaterial}return null}function f(a){this.buffer=a,this.basedir="./",this.awd=null,this.keepBuffer=!1;var b={};b.resolve=function(a){return a&&b[a.id]?b[a.id]:null},this._lib=b,this._lib.lights=[],this._lib.meshes=[],this._byName={},this._objects=[]}awdLib=a("awdlib/lib/awdlib_readonly"),awdLib_pil=a("awdlib/lib/awdlib_pil_readonly"),awdLib_std=a("awdlib/lib/awdlib_std_readonly");var g,h=awdLib.consts,i=awdLib_pil.InterleavedGeometry,j=i.prototype.subGeomFactory;i.prototype.subGeomFactory=function(){var a=j.call(this);return a.props.expected[10]=7,a.props.expected[11]=7,a.props.expected[12]=7,a.props.expected[13]=7,a.props.expected[14]=7,a.props.expected[15]=7,a},f.prototype={load:function(a,b){awdLib_pil.extInfos;this.awd=new awdLib.awd,this.awd.addExtension(awdLib_pil.ext.getExtension()),this.awd.addExtension(awdLib_std.ext.getExtension()),this.awd.parse(this.buffer);var c=this.awd._elements;this.container=b,b.gl=a.gl,this._lib.keepBuffer=this.keepBuffer;for(var d=0;d<c.length;d++){var f=c[d],g=e(f.type,f.nsUri);if(g){var h=g(f,this._lib,b,a);this._lib[f.id]=h,this._byName[f.name]=h,this._objects.push(h)}}},getObjectByName:function(a){return this._byName[a]},getObjects:function(){return this._objects},getMeshes:function(){return this._lib.meshes}},d(),b.exports=f},{"./container":25,"./geometry":26,"./material":28,"./mesh":29,"awdlib/lib/awdlib_pil_readonly":169,"awdlib/lib/awdlib_readonly":170,"awdlib/lib/awdlib_std_readonly":171}],28:[function(a,b,c){a("./utils").hexToRGB;b.exports=function(a){return function(a,b,c,d){var e=(a.fileData,a.name);a.uri;return d.getMaterial(e)}}},{"./utils":30}],29:[function(a,b,c){var d=a("./utils").setupObj3D,e=a("entities/mesh");b.exports=function(a){return function(a,b,c,f){var g=f.gl,h=new e(g),i=b.resolve(a.geometry);d(h,a,b,f),h.geom=i;for(var j=a.materials,k=0;k<j.length;++k){var l=j[k],m=b.resolve(l);h.materials.push(m)}return b.meshes.push(h),h}}},{"./utils":30,"entities/mesh":24}],30:[function(a,b,c){b.exports={hexToRGB:function(a){return[(a>>>16&255)/255,(a>>>8&255)/255,(a>>>0&255)/255]},setupObj3D:function(a,b,c,d){if(a.setMatrix(b.matrix.data),a.name=b.name,b.parent){var e=c.resolve(b.parent);e.add(a)}else d.node.add(a)}}},{}],31:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};window.Device=function(){function a(){this._handleOrientation=f(this._handleOrientation,this),this._handleResize=f(this._handleResize,this),this.onDOMloaded=f(this.onDOMloaded,this),this.previousDevice=window.device,window.device={},this._doc_element=null,this._user_agent=window.navigator.userAgent.toLowerCase()}return a.prototype.osx=function(){return this._find("mac os x")},a.prototype.ios=function(){return this.iphone()||this.ipod()||this.ipad()},a.prototype.iphone=function(){return this._find("iphone")},a.prototype.ipod=function(){return this._find("ipod")},a.prototype.ipad=function(){return this._find("ipad")},a.prototype.android=function(){return this._find("android")},a.prototype.chrome=function(){return this._find("chrome")&&!this.edge()},a.prototype.firefox=function(){return this._find("firefox")},a.prototype.ie=function(){return null!==new RegExp("trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(this._user_agent)||null!==new RegExp("msie").exec(this._user_agent)},a.prototype.ie12=function(){return this._find("msie 12.0")},a.prototype.ie11=function(){return this._find("msie 11.0")},a.prototype.ie10=function(){return this._find("msie 10.0")},a.prototype.ie9=function(){return this._find("msie 9.0")},a.prototype.ie8=function(){return this._find("msie 8.0")},a.prototype.ie7=function(){return this._find("msie 7.0")},a.prototype.ie6=function(){return this._find("msie 6.0")},a.prototype.safari=function(){return this._find("safari")},a.prototype.androidPhone=function(){return this.android()&&this._find("mobile")},a.prototype.androidTablet=function(){return window.innerWidth>768,this.android()&&!this._find("mobile")},a.prototype.blackberry=function(){return this._find("blackberry")||this._find("bb10")||this._find("rim")},a.prototype.blackberryPhone=function(){return this.blackberry()&&!this._find("tablet")},a.prototype.blackberryTablet=function(){return this.blackberry()&&this._find("tablet")},a.prototype.windows=function(){return this._find("windows")},a.prototype.windowsPhone=function(){return this.windows()&&this._find("phone")},a.prototype.windowsTablet=function(){return this.windows()&&this._find("touch")&&!this.windowsPhone()},a.prototype.fxos=function(){return(this._find("(mobile;")||this._find("(tablet;"))&&this._find("; rv:")},a.prototype.fxosPhone=function(){return this.fxos()&&this._find("mobile")},a.prototype.fxosTablet=function(){return this.fxos()&&this._find("tablet")},a.prototype.meego=function(){return this._find("meego")},a.prototype.edge=function(){return this._find("edge")},a.prototype.cordova=function(){return window.cordova&&"file:"===location.protocol},a.prototype.nodeWebkit=function(){return"object"==typeof window.process},a.prototype.mobile=function(){return this.androidPhone()||this.iphone()||this.ipod()||this.windowsPhone()||this.blackberryPhone()||this.fxosPhone()||this.meego()},a.prototype.tablet=function(){return this.ipad()||this.androidTablet()||this.blackberryTablet()||this.windowsTablet()||this.fxosTablet()},a.prototype.desktop=function(){return!this.tablet()&&!this.mobile()},a.prototype.nexus5=function(){return this._find("nexus 5")},a.prototype.portrait=function(){return window.innerHeight/window.innerWidth>1},a.prototype.landscape=function(){return window.innerHeight/window.innerWidth<1},a.prototype.noConflict=function(){return window.device=this.previousDevice,this},a.prototype.browserVersion=function(){var a,b,c,d;return d=navigator.userAgent,c=void 0,b=d.match(/(edge(?=\/))\/?\s*(\d+)/i)||[],b.length?{name:b[1],version:b[2]}:(a=d.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(a[1])?(c=/\brv[ :]+(\d+)/g.exec(d)||[],{name:"IE ",version:c[1]||""}):"Chrome"===a[1]&&(c=d.match(/\bOPR\/(\d+)/),null!==c)?{name:"Opera",version:c[1]}:(a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(c=d.match(/version\/(\d+)/i))&&a.splice(1,1,c[1]),{name:a[0],version:a[1]}))},a.prototype._find=function(a){return this._user_agent.indexOf(a)!==-1},a.prototype._hasClass=function(a){var b;return b=new RegExp(a,"i"),this._doc_element.className.match(b)},a.prototype._addClass=function(a){if(!this._hasClass(a))return this._doc_element.className+=" "+a},a.prototype._removeClass=function(a){if(this._hasClass(a))return this._doc_element.className=this._doc_element.className.replace(a,"")},a.prototype.onDOMloaded=function(){return this._doc_element=window.document.body,this.ios()?this.ipad()?this._addClass("ios ipad tablet"):this.iphone()?this._addClass("ios iphone mobile"):this.ipod()&&this._addClass("ios ipod mobile"):this.android()?this.desktop()?this._addClass("android desktop error-android-resolution"):this.androidTablet()?this._addClass("android tablet"):this._addClass("android mobile"):this.blackberry()?this.blackberryTablet()?this._addClass("blackberry tablet"):this._addClass("blackberry mobile"):this.windows()?this.windowsTablet()?this._addClass("windows tablet"):this.windowsPhone()?this._addClass("windows mobile"):this.windows()&&this._addClass("windows desktop"):this.fxos()?this.fxosTablet()?this._addClass("fxos tablet"):this._addClass("fxos mobile"):this.meego()?this._addClass("meego mobile"):this.nodeWebkit()?this._addClass("node-webkit"):this.osx()?this._addClass("osx desktop"):this._addClass("desktop"),this.desktop()&&this._addClass("desktop"),this.cordova()&&this._addClass("cordova"),this.chrome()&&this._addClass("chrome"),this.edge()&&this._addClass("msedge"),this.firefox()&&this._addClass("firefox"),this.ie()&&(this._addClass("ie"),this.ie6()?this._addClass("ie6"):this.ie7()?this._addClass("ie7"):this.ie8()?this._addClass("ie8"):this.ie9()?this._addClass("ie9"):this.ie10()?this._addClass("ie10"):this._addClass("ie11")),this._supports_orientation="onorientationchange"in window,this._orientation_event=(this._supports_orientation,"orientationchange"),window.addEventListener?window.addEventListener("resize",this._handleResize,!1):document.attachEvent("resize",this._handleResize),this._handleResize()},a.prototype.orientationCallback=null,a.prototype._handleResize=function(){var a;a="portrait",this.landscape()?(this._removeClass("portrait"),this._addClass("landscape"),a="landscape"):(this._removeClass("landscape"),this._addClass("portrait")),"function"==typeof this.orientationCallback&&this.orientationCallback(a)},a.prototype._handleOrientation=function(a){var b;b="portrait",this.landscape()?(this._removeClass("portrait"),this._addClass("landscape"),b="landscape"):(this._removeClass("landscape"),this._addClass("portrait")),"function"==typeof this.orientationCallback&&this.orientationCallback(b)},a}(),d=function(){function a(){}var b,c;return c=null,a.get=function(){return null!=c?c:c=new b},b=function(){function a(){this.onChangeOrientation=f(this.onChangeOrientation,this),this.device=new window.Device,this.browserVersion=this.device.browserVersion(),this.isOSX=this.device.osx(),this.isIpad=this.device.ios()&&this.device.ipad(),this.isIphone=this.device.ios()&&(this.device.iphone()||this.device.ipod),this.isIos=this.device.ios(),this.isAndroidTablet=this.device.android()&&this.device.androidTablet(),this.device.android()&&!this.device.androidTablet()&&(this.isAndroidPhone=!0),this.isAndroid=this.device.android(),this.isTablet=this.device.tablet(),this.isMobile=this.device.mobile(),this.isDesktop=this.device.desktop(),this.isNexus5=this.device.nexus5(),this.isWindow=this.device.windows(),this.isWindowsPhone=this.device.windowsPhone(),this.isWindowsTablet=this.device.windowsTablet(),this.isChrome=this.device.chrome(),this.isFirefox=this.device.firefox(),this.isMSEdge=this.device.edge(),this.isIE=this.device.ie(),this.isIE6=this.device.ie6(),this.isIE7=this.device.ie7(),this.isIE8=this.device.ie8(),this.isIE9=this.device.ie9(),this.isIE10=this.device.ie10(),this.isIE11=this.device.ie11(),this.isIE12=this.device.ie12(),this.isIEDesktop=this.device.ie()&&!this.device.windowsPhone()&&!this.device.windowsTablet(),this.isltIE10=this.device.ie9()||this.device.ie8()||this.device.ie7()||this.device.ie6(),this.islteIE10=this.device.ie10()||this.device.ie9()||this.device.ie8()||this.device.ie7()||this.device.ie6(),this.isltIE9=this.device.ie8()||this.device.ie7()||this.device.ie6(),this.islteIE9=this.device.ie9()||this.device.ie8()||this.device.ie7()||this.device.ie6(),this.isSafari=!this.device.chrome()&&this.device.safari(),this.isLandscape=this.device.landscape(),this.isPortrait=this.device.portrait(),this.isGalaxyTab10inches=this.device.android()&&e("(min-device-width: 1280px) and (max-device-width: 1281px) and (orientation: landscape), (min-device-width: 800px) and (max-device-width: 801px) and (orientation: portrait)"),this.isGalaxyTab7inches=this.device.android()&&e("(min-device-width: 1024px) and (max-device-width: 1025px) and (orientation: landscape), (min-device-width: 600px) and (max-device-width: 601px) and (orientation: portrait)"),this.isGalaxyTab=this.isGalaxyTab7inches||this.isGalaxyTab10inches,this.isAndroid&&this.isGalaxyTab&&this.forceGalaxyTab()}return a.prototype.forceGalaxyTab=function(){return this.device.desktop=function(){return!0},this.device.tablet=function(){return!1},this.device.mobile=function(){return!1},this.isDesktop=this.device.desktop(),this.isTablet=this.device.tablet(),this.isMobile=this.device.mobile()},a.prototype.bindEvents=function(){return this.device.onDOMloaded()},a.prototype.onChangeOrientation=function(a){if(null==a&&(a=null),null!=a)return this.device.orientationCallback=a},a}(),a}(),e=function(a){var b,c,d;if(null!=window.matchMedia)switch(b="(min-device-width: 1024px)",d="(min-device-width: 768px) and (max-device-width: 1023px)",c="(min-device-width: 320px) and (max-device-width: 767px)",a){case"mobile":return window.matchMedia(c).matches;case"tablet":return window.matchMedia(d).matches;case"desktop":return window.matchMedia(b).matches;default:return window.matchMedia(a).matches}},window.BrowserDetect=d.get(),window.BrowserDetect.bindEvents(),b.exports=window.BrowserDetect},{}],32:[function(a,b,c){function d(a,b){return b[0]=(a>>16&255)/255,b[1]=(a>>8&255)/255,b[2]=(255&a)/255,b}function e(a){return Math.round(255*a[0])<<16|Math.round(255*a[1])<<8|Math.round(255*a[2])}function f(a){return d(a,new Float32Array(3))}function g(a,b){d(b,h),a.set(h[0],h[1],h[2])}var h=new Float32Array(3);b.exports={HexToVec:d,VecToHex:e,MakeFromHex:f,HexInput:g}},{}],33:[function(a,b,c){b.exports={linear:function(a){return a},easeInQuad:function(a){return a*a},easeOutQuad:function(a){return a*(2-a)},easeInOutQuad:function(a){return a<.5?2*a*a:-1+(4-2*a)*a},easeInCubic:function(a){return a*a*a},easeOutCubic:function(a){return--a*a*a+1},easeInOutCubic:function(a){return a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},easeInQuart:function(a){return a*a*a*a},easeOutQuart:function(a){return 1- --a*a*a*a},easeInOutQuart:function(a){return a<.5?8*a*a*a*a:1-8*--a*a*a*a},easeInQuint:function(a){return a*a*a*a*a},easeOutQuint:function(a){return 1+--a*a*a*a*a},easeInOutQuint:function(a){return a<.5?16*a*a*a*a*a:1+16*--a*a*a*a*a},easeInExpo:function(a){return Math.pow(2,10*(a-1))},easeOutExpo:function(a){return-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){return a*=2,a<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)}}},{}],34:[function(a,b,c){function d(a){this.scene=a;var b=a.gl;this.gl=b,this.envTex=new k(this.gl,this.gl.RGBA),this.envTex.setFilter(!1),this.envHi=new k(this.gl,this.gl.RGBA),this.envBg=new k(this.gl,this.gl.RGB),this.ibl=new e(this.envTex,this.envHi,this.envBg),this._gui()}var e=a("./ibl"),f=a("./net"),g=a("../dev/gui"),h=a("gl-matrix"),i=a("nanogl-pbr/ibl"),j=a("nanogl-texture-loader"),k=a("nanogl/texture"),l=(a("when"),h.vec2),m=l.create(),n=["studio003","MtWashington","Helipad","WoodenDoor"];d.prototype={dispose:function(){this.envTex.dispose(),this.envHi.dispose(),this.envBg.dispose(),this.envTex=null,this.envHi=null,this.envBg=null,this.ibl=null,this.scene=null},getLoadables:function(){return this.load("./assets/envs/"+n[0])},load:function(a){var b=this.ibl;return[j.load(this.envTex,a+"/env.png"),f.loadBytes(a+"/sh.bin").then(function(a){b.sh=i.convert(new Float32Array(a,0,27),1)})]},preRender:function(a){l.sub(m,this.rrotations,this.rotations);var b=Math.min(1,15*a);l.scaleAndAdd(this.rotations,this.rotations,m,b)},_gui:function(){for(var a=this,b=g.addFolder("envs"),c=0;c<n.length;c++)!function(b){var c=n[b];a[c]=function(){this.load("./assets/envs/"+c)}}(c),b.add(this,n[c]);var d=g.addFolder("ibl"),e={iblexpo:0,expo:1,gamma:1},f=this.ibl._expoInput,h=null,i=null,j=null;d.add(e,"iblexpo",{none:0,uniform:1,constant:2}).onChange(function(a){"0"===a?(f.detach(),h=null):"1"===a?(h=f.attachUniform("uIblTM"),h.set(e.expo,e.gamma)):"2"===a&&(h=null,f.attachConstant([e.expo,e.gamma]))}),i=d.add(e,"expo",0,8).onChange(function(a){h&&h.set(e.expo,e.gamma)}),j=d.add(e,"gamma",0,4).onChange(function(a){h&&h.set(e.expo,e.gamma)})}},b.exports=d},{"../dev/gui":20,"./ibl":37,"./net":51,"gl-matrix":192,"nanogl-pbr/ibl":225,"nanogl-texture-loader":247,"nanogl/texture":254,when:280}],35:[function(a,b,c){function d(a){this.gl=a,this.name="",this.subgeoms=[]}function e(a){this._vaoMap={},this.gl=a,this.buffers=[],this.ibuffer=null,this.indices=null,this.vertices=[],this.bounds=new g,this.vao=new f(this.gl),this.cprg=null}var f=(a("nanogl/arraybuffer"),a("nanogl/indexbuffer"),a("nanogl-vao")),g=a("nanogl-pbr/lib/bounds");d.prototype={},d.SubGeom=e,e.prototype={getVao:function(a){var b,c=a._cuid;return void 0===this._vaoMap[c]&&(b=this._vaoMap[c]=new f(this.gl),b.setup(a,this.buffers,this.ibuffer)),this._vaoMap[c]},setup:function(a){this.currentVao=this.getVao(a),this.currentVao.bind()},render:function(){this.ibuffer.drawTriangles(),this.currentVao.unbind()}},b.exports=d},{"nanogl-pbr/lib/bounds":226,"nanogl-vao":248,"nanogl/arraybuffer":249,"nanogl/indexbuffer":252}],36:[function(a,b,c){b.exports=function(a,b){var c,d;return void 0===b&&(b=""),d=new RegExp("&?"+a+"=([^&]+)","g"),c=d.exec(location.search),c?c[1].replace(/%20|\+/g," "):b}},{}],37:[function(a,b,c){function d(a,b,c){e.call(this,a),this.envHi=b,this.envBg=c}var e=a("nanogl-pbr/ibl");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setupProgram=function(a){e.prototype.setupProgram.call(this,a);a.tEnvHi&&a.tEnvHi(this.envHi)},b.exports=d},{"nanogl-pbr/ibl":225}],38:[function(a,b,c){var d=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(d=!0),b.exports=function(){return d}},{}],39:[function(a,b,c){function d(){this._datas={},this._dataList=[],this._setup=null;var a;this.preLightsChunk=new e,this.postLightsChunk=new f,this.shadowChunk=new g(this),this.shadowFilter=new n("shadowFilter",["PCFNONE","PCF4x1","PCF4x4","PCF2x2"]),this.iblShadowing=new o("iblShadowing",!1),a=new j,this._datas[l.TYPE_DIR]=a,this._dataList.push(a),a=new i,this._datas[l.TYPE_SPOT]=a,this._dataList.push(a),a=new k,this._datas[l.TYPE_POINT]=a,this._dataList.push(a)}function e(){m.call(this,!0,!1)}function f(){m.call(this,!0,!1)}function g(a){m.call(this,!0,!0),this.lightModel=a,this.shadowCount=0,this.genCount=0,this._matrices=new Float32Array(16*y),this._texelBiasVector=new Float32Array(4*y),this._shadowmapSizes=new Float32Array(2*y),this._umatrices=null,this._utexelBiasVector=null,this._ushadowmapSizes=null}function h(){m.call(this,!0,!0),this.type=0,this.lights=[],this.shadowIndices=[],this.preCodeTemplate=null}function i(){h.call(this),this.type=l.TYPE_SPOT,this._directions=null,this._colors=null,this._positions=null,this._spot=null,this._falloff=null,this.preCodeTemplate=q}function j(){h.call(this),this.type=l.TYPE_DIR,this._directions=null,this._colors=null,this.preCodeTemplate=p}function k(){h.call(this),this.type=l.TYPE_POINT,this._colors=null,this._positions=null,this._falloff=null,this.preCodeTemplate=r}var l=a("nanogl-pbr/lib/lights/light"),m=a("nanogl-pbr/lib/chunk"),n=a("nanogl-pbr/lib/enum"),o=a("nanogl-pbr/lib/flag"),p=a("./templates/directional-lights-pre"),q=a("./templates/spot-lights-pre"),r=a("./templates/point-lights-pre"),s=a("./templates/directional-light"),t=a("./templates/spot-light"),u=a("./templates/point-light"),v=a("./templates/shadow-maps-pre"),w=a("./templates/pre-light-setup"),x=a("./templates/post-light-setup");d.prototype={add:function(a){var b=this._datas[a._type];b.addLight(a)},remove:function(a){var b=this._datas[a._type];b.removeLight(a)},update:function(){this.shadowChunk.shadowCount=0;for(var a=0;a<this._dataList.length;a++)this._dataList[a].update(this);this.shadowChunk.check()},getChunks:function(){var a=[];a.push(this.iblShadowing.createProxy()),a.push(this.shadowFilter.createProxy()),a.push(this.shadowChunk.createProxy()),a.push(this.preLightsChunk.createProxy());for(var b=0;b<this._dataList.length;b++)a.push(this._dataList[b].createProxy());return a.push(this.postLightsChunk.createProxy()),a}},e.prototype=Object.create(m.prototype),e.prototype.constructor=e,e.prototype.genCode=function(a){code=w(this),a.add("lightsf",code)},e.prototype.getHash=function(){return"0"},f.prototype=Object.create(m.prototype),f.prototype.constructor=f,f.prototype.genCode=function(a){code=x(this),a.add("lightsf",code)},f.prototype.getHash=function(){return"0"};var y=4;g.prototype=Object.create(m.prototype),g.prototype.constructor=g;var z=Math.PI/4;g.prototype.genCode=function(a){this.shadowCount>0&&a.add("pf",v(this))},g.prototype.addLight=function(a){var b=this.shadowCount;this.shadowCount++,this._matrices.set(a.getShadowProjection(this.lightModel._setup.bounds),16*b),this._texelBiasVector.set(a.getTexelBiasVector(),4*b);var c=a._shadowmapSize;if(this._shadowmapSizes[2*b+0]=c,this._shadowmapSizes[2*b+1]=1/c,0===b){var d=a.hasDepthShadowmap();this.lightModel._setup.depthFormat.set(d?"D_DEPTH":"D_RGB")}return b},g.prototype.getHash=function(){return this.shadowCount},g.prototype.check=function(){this.genCount!==this.shadowCount&&(this.genCount=this.shadowCount,this._umatrices=new Float32Array(this._matrices.buffer,0,16*this.shadowCount),this._utexelBiasVector=new Float32Array(this._texelBiasVector.buffer,0,4*this.shadowCount),this._ushadowmapSizes=new Float32Array(this._shadowmapSizes.buffer,0,2*this.shadowCount),this.invalidate()),this._invalid=!0},g.prototype.setup=function(a){this.shadowCount>0&&(a.uShadowMatrices(this._umatrices),a.uShadowTexelBiasVector(this._utexelBiasVector),a.uShadowMapSize(this._ushadowmapSizes),void 0!==a.uShadowKernelRotation&&a.uShadowKernelRotation(.5*Math.cos(z),.5*Math.sin(z)),this._invalid=!1)},h.prototype=Object.create(m.prototype),h.prototype.constructor=h,h.prototype.addLight=function(a){this.lights.indexOf(a)===-1&&(this.lights.push(a),this.shadowIndices.push(-1),this.invalidate())},h.prototype.removeLight=function(a){var b=this.lights.indexOf(a);b>-1&&(this.lights.splice(b,1),this.shadowIndices.splice(b,1),this.invalidate())},h.prototype.genCode=function(a){var b=this.preCodeTemplate({count:this.lights.length});a.add("pf",b),b="";for(var c=0;c<this.lights.length;c++)b+=this.genCodePerLights(this.lights[c],c,this.shadowIndices[c]);a.add("lightsf",b)},h.prototype.genCodePerLights=function(a,b,c){},h.prototype.getHash=function(){for(var a=this.type+""+this.lights.length,b=0;b<this.lights.length;b++)this.lights[b]._castShadows&&(a+=b);return a},h.prototype.setup=function(a){for(var b=0;b<this.shadowIndices.length;b++){var c=this.shadowIndices[b];if(c>-1){var d=this.lights[b].getShadowmap();a["tShadowMap"+c](d)}}},i.prototype=Object.create(h.prototype),i.prototype.constructor=i,i.prototype.genCodePerLights=function(a,b,c){var d={index:b,shadowIndex:c};return t(d)},i.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a),this._positions=new Float32Array(3*a),this._spot=new Float32Array(2*a),this._falloff=new Float32Array(3*a))},i.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._positions.set(d._wposition,3*c),this._spot.set(d._spotData,2*c),this._falloff.set(d._falloffData,3*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){
var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},i.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLSpotDirections(this._directions),a.uLSpotColors(this._colors),a.uLSpotPositions(this._positions),a.uLSpotSpot(this._spot),a.uLSpotFalloff(this._falloff),this._invalid=!1)},j.prototype=Object.create(h.prototype),j.prototype.constructor=j,j.prototype.genCodePerLights=function(a,b,c){var d={index:b,shadowIndex:c};return s(d)},j.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a))},j.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},j.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLDirDirections(this._directions),a.uLDirColors(this._colors),this._invalid=!1)},k.prototype=Object.create(h.prototype),k.prototype.constructor=k,k.prototype.genCodePerLights=function(a,b,c){var d={index:b,shadowIndex:c};return u(d)},k.prototype.allocate=function(a){null!==this._colors&&this._colors.length/3===a||(this._colors=new Float32Array(3*a),this._positions=new Float32Array(3*a),this._falloff=new Float32Array(3*a))},k.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._colors.set(d._color,3*c),this._positions.set(d._wposition,3*c),this._falloff.set(d._falloffData,3*c),d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},k.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLPointColors(this._colors),a.uLPointPositions(this._positions),a.uLPointFalloff(this._falloff),this._invalid=!1)},b.exports=d},{"./templates/directional-light":40,"./templates/directional-lights-pre":41,"./templates/point-light":42,"./templates/point-lights-pre":43,"./templates/post-light-setup":44,"./templates/pre-light-setup":45,"./templates/shadow-maps-pre":46,"./templates/spot-light":47,"./templates/spot-lights-pre":48,"nanogl-pbr/lib/chunk":227,"nanogl-pbr/lib/enum":229,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/lights/light":234}],40:[function(a,b,c){b.exports=function(a){var b="";return b+="{\n\n  // -------- DIFFUSE\n  float dContrib = (1.0/3.141592) * sdot( uLDirDirections["+a.index+"] ,worldNormal );\n\n  ",a.shadowIndex>-1&&(b+="\n  {\n    vec3 fragCoord = calcShadowPosition( uShadowTexelBiasVector["+a.shadowIndex+"], uShadowMatrices["+a.shadowIndex+"] , worldNormal, uShadowMapSize["+a.shadowIndex+"].y );\n    float shOccl = calcLightOcclusions(tShadowMap"+a.shadowIndex+",fragCoord,uShadowMapSize["+a.shadowIndex+"]);\n    dContrib *= shOccl;\n  }\n  "),b+="\n\n  diffuseCoef   += dContrib * uLDirColors["+a.index+"].rgb;\n\n}"}},{}],41:[function(a,b,c){b.exports=function(a){var b="";return b+="#define NUM_D_LIGHTS "+a.count+"\n\n",a.count>0&&(b+="\nuniform vec3 uLDirDirections [NUM_D_LIGHTS];\nuniform vec4 uLDirColors     [NUM_D_LIGHTS]; // rgb + iblShadowing\n"),b+="\n\n"}},{}],42:[function(a,b,c){b.exports=function(a){var b="";return b+="{\n\n  vec3 lightDir= uLPointPositions["+a.index+"] - vWorldPosition;\n  float invLightDist=inversesqrt(dot(lightDir,lightDir));\n  lightDir *= invLightDist;\n\n  // spot effect\n  float falloff = saturate( uLPointFalloff["+a.index+"].z / invLightDist );\n  falloff = 1.0 + falloff * ( uLPointFalloff["+a.index+"].x + uLPointFalloff["+a.index+"].y * falloff );\n\n  vec3 lightContrib = falloff * uLPointColors["+a.index+"].rgb;\n\n\n  // --------- SPEC\n  vec3 H = normalize( lightDir + viewDir );\n  float NoH = sdot( H,worldNormal );\n  float sContrib = specularMul * pow( NoH, roughness );\n  // -------- DIFFUSE\n  float dContrib = (1.0/3.141592) * sdot( lightDir, worldNormal );\n\n  diffuseCoef   += dContrib * lightContrib;\n  LS_SPECULAR   += sContrib  * lightContrib;\n\n  // specularColor *= 0.0;\n\n}"}},{}],43:[function(a,b,c){b.exports=function(a){var b="";return b+="#define NUM_P_LIGHTS "+a.count+"\n\n",a.count>0&&(b+="\nuniform vec3 uLPointPositions  [NUM_P_LIGHTS];\nuniform vec3 uLPointFalloff    [NUM_P_LIGHTS];\nuniform vec3 uLPointColors     [NUM_P_LIGHTS]; // rgb\n"),b+="\n\n"}},{}],44:[function(a,b,c){b.exports=function(a){var b="";return b+="\n// post light setup\n"}},{}],45:[function(a,b,c){b.exports=function(a){var b="";return b+="// no pre light code"}},{}],46:[function(a,b,c){b.exports=function(a){var b="";b+="\n\n#define SHADOW_COUNT "+a.shadowCount+"\n\n";for(var c=0;c<a.shadowCount;c++)b+="\n  uniform sampler2D tShadowMap"+c+";\n";return b+="\n\n\n\n\nuniform highp vec2 uShadowKernelRotation;\nuniform highp mat4 uShadowMatrices[SHADOW_COUNT];\nuniform highp vec4 uShadowTexelBiasVector[SHADOW_COUNT];\nuniform       vec2 uShadowMapSize[SHADOW_COUNT];\n\n\n// RGB depth decoding\n// ------------------\nhighp float decodeDepthRGB(highp vec3 rgb){\n  return(rgb.x+rgb.y*(1.0/255.0))+rgb.z*(1.0/65025.0);\n}\n\n\n\n#if depthFormat( D_RGB )\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return decodeDepthRGB( texture2D(t,uvs).xyz );\n  }\n  //define FETCH_DEPTH(t,uvs) decodeDepthRGB( texture2D(t,uvs).xyz )\n#endif\n\n#if depthFormat( D_DEPTH )\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return texture2D(t,uvs).x;\n  }\n  //define FETCH_DEPTH(t,uvs) texture2D(t,uvs).x\n#endif\n\n\n\n\n\n\nfloat resolveShadowNoFiltering(highp float fragZ, sampler2D depth,highp vec2 uv ){\n    return step( fragZ, FETCH_DEPTH(depth,uv.xy));\n}\n\n\nfloat resolveShadow2x1(highp float fragZ, sampler2D depth,highp vec2 uv, vec2 mapSize ){\n\n  highp float coordsPx = uv.x*mapSize.x;\n  highp float uvMin = floor( coordsPx ) * mapSize.y;\n  highp float uvMax = ceil(  coordsPx ) * mapSize.y;\n\n  vec2 occl = vec2(\n    FETCH_DEPTH(depth,vec2(uvMin,uv.y)),\n    FETCH_DEPTH(depth,vec2(uvMax,uv.y))\n  );\n\n  occl = step( vec2(fragZ), occl );\n\n  highp float ratio = coordsPx - uvMin*mapSize.x;\n  return ( ratio * occl.y + occl.x ) - ratio * occl.x;\n\n}\n\nfloat resolveShadow2x2(highp float fragZ, sampler2D depth,highp vec2 uv, vec2 mapSize ){\n\n  highp vec2 coordsPx = uv*mapSize.x;\n  highp vec2 uvMin=floor( coordsPx ) *mapSize.y;\n  highp vec2 uvMax=ceil(  coordsPx ) *mapSize.y;\n\n  vec4 occl = vec4(\n    FETCH_DEPTH(depth,uvMin),\n    FETCH_DEPTH(depth,vec2(uvMax.x,uvMin.y)),\n    FETCH_DEPTH(depth,vec2(uvMin.x,uvMax.y)),\n    FETCH_DEPTH(depth,uvMax)\n  );\n\n  occl = step( vec4(fragZ), occl );\n\n  highp vec2 ratio = coordsPx - uvMin*mapSize.x;\n  vec2  t = ( ratio.y * occl.zw + occl.xy ) - ratio.y * occl.xy;\n\n  return(ratio.x*t.y+t.x)-ratio.x*t.x;\n}\n\n\nfloat calcLightOcclusions(sampler2D depth, highp vec3 fragCoord, vec2 mapSize ){\n  float s;\n\n  highp vec2 kernelOffset = uShadowKernelRotation * ( 4.0 / mapSize.x );\n\n  // NO FILTER\n  #if shadowFilter( PCFNONE )\n\n    s = resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy );\n  #endif\n\n  // PCF4x1\n  #if shadowFilter( PCF4x1 )\n\n    s = resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy + kernelOffset                    );\n    s+= resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy - kernelOffset                    );\n    s+= resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy + vec2(-kernelOffset.y,kernelOffset.x)  );\n    s+= resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy + vec2(kernelOffset.y,-kernelOffset.x)  );\n    s /= 4.0;\n  #endif\n\n  // PCF4x4\n  #if shadowFilter( PCF4x4 )\n\n    s = resolveShadow2x2( fragCoord.z, depth, fragCoord.xy + kernelOffset                        , mapSize );\n    s+=resolveShadow2x2( fragCoord.z, depth, fragCoord.xy - kernelOffset                         , mapSize );\n    s+=resolveShadow2x2( fragCoord.z, depth, fragCoord.xy + vec2(-kernelOffset.y,kernelOffset.x) , mapSize );\n    s+=resolveShadow2x2( fragCoord.z, depth, fragCoord.xy + vec2(kernelOffset.y,-kernelOffset.x) , mapSize );\n    s /= 4.0;\n  #endif\n\n  // PCF2x2\n  #if shadowFilter( PCF2x2 )\n\n    s = resolveShadow2x1( fragCoord.z, depth, fragCoord.xy + kernelOffset , mapSize);\n    s +=resolveShadow2x1( fragCoord.z, depth, fragCoord.xy - kernelOffset , mapSize);\n    s /= 2.0;\n  #endif\n\n\n  return s;\n\n}\n\n\n\nvec3 calcShadowPosition( vec4 texelBiasVector, mat4 shadowProjection, vec3 worldNormal, float invMapSize )\n{\n  float WoP = dot( texelBiasVector, vec4( vWorldPosition, 1.0 ) );\n\n  WoP *= .0005+2.0*invMapSize;\n\n  highp vec4 fragCoord = shadowProjection * vec4( vWorldPosition + WoP * worldNormal, 1.0);\n  return fragCoord.xyz / fragCoord.w;\n}\n\n\n"}},{}],47:[function(a,b,c){b.exports=function(a){var b="";return b+="{\n\n  vec3 lightDir= uLSpotPositions["+a.index+"] - vWorldPosition;\n  float invLightDist=inversesqrt(dot(lightDir,lightDir));\n  lightDir *= invLightDist;\n\n  // spot effect\n  float falloff = saturate( uLSpotFalloff["+a.index+"].z / invLightDist );\n  falloff = 1.0 + falloff * ( uLSpotFalloff["+a.index+"].x + uLSpotFalloff["+a.index+"].y * falloff );\n\n  float s = saturate( dot( lightDir, uLSpotDirections["+a.index+"] ) );\n  s = saturate( uLSpotSpot["+a.index+"].x-uLSpotSpot["+a.index+"].y * (1.0-s*s) );\n\n  vec3 lightContrib = (falloff *s ) * uLSpotColors["+a.index+"].rgb;\n\n\n  // --------- SPEC\n  vec3 H = normalize( lightDir + viewDir );\n  float NoH = sdot( H,worldNormal );\n  float sContrib = specularMul * pow( NoH, roughness );\n  // -------- DIFFUSE\n  float dContrib = (1.0/3.141592) * sdot( lightDir, worldNormal );\n\n  ",a.shadowIndex>-1&&(b+="\n  {\n    vec3 fragCoord = calcShadowPosition( uShadowTexelBiasVector["+a.shadowIndex+"], uShadowMatrices["+a.shadowIndex+"] , worldNormal, uShadowMapSize["+a.shadowIndex+"].y );\n    float shOccl = calcLightOcclusions(tShadowMap"+a.shadowIndex+",fragCoord,uShadowMapSize["+a.shadowIndex+"]);\n    dContrib *= shOccl;\n    sContrib  *= shOccl;\n\n    #if iblShadowing\n      float sDamp = uLSpotColors["+a.index+"].a;\n      specularColor *= mix( sDamp, 1.0, shOccl );\n    #endif\n\n    // sContrib = sin( decodeDepthRGB(texture2D(tShadowMap"+a.shadowIndex+",fragCoord.xy).xyz)*200.0);\n    // dContrib = sin( decodeDepthRGB(texture2D(tShadowMap"+a.shadowIndex+",fragCoord.xy).xyz)*200.0);\n\n    // diffuseCoef = vec3( decodeDepthRGB(texture2D(tShadowMap"+a.shadowIndex+",fragCoord.xy).xyz ) );\n  }\n  "),b+="\n\n\n  diffuseCoef   += dContrib * lightContrib;\n  LS_SPECULAR   += sContrib  * lightContrib;\n\n  // specularColor *= 0.0;\n\n}"}},{}],48:[function(a,b,c){b.exports=function(a){var b="";return b+="#define NUM_S_LIGHTS "+a.count+"\n\n",a.count>0&&(b+="\nuniform vec3 uLSpotPositions  [NUM_S_LIGHTS];\nuniform vec3 uLSpotFalloff    [NUM_S_LIGHTS];\nuniform vec2 uLSpotSpot       [NUM_S_LIGHTS];\nuniform vec3 uLSpotDirections [NUM_S_LIGHTS];\nuniform vec4 uLSpotColors     [NUM_S_LIGHTS]; // rgb + iblShadowing\n"),b+="\n\n"}},{}],49:[function(a,b,c){function d(a){return Math.min(1,Math.max(0,a))}function e(a){return a<0?-1:1}function f(a,b,c,d,e){var f=(a-b)/(c-b),g=f*(e-d)+d;return g}function g(a,b){return Math.min(a+Math.random()*(b-a),b)}function h(a){for(;a>=s;)a-=s;for(;a<0;)a+=s;return a}function i(a,b){var c=b-a,d=c-s,e=c+s;return Math.abs(d)<Math.abs(c)&&(c=d),Math.abs(e)<Math.abs(c)&&(c=e),a+c}function j(a,b){n.normalize(r,b),n.cross(p,VUP,r),n.normalize(p,p),n.cross(q,r,p),a.set(o)}function k(a,b,c,d,e){var f,g,h,i,j,k=b[c+0],l=b[c+1],m=b[c+2],n=b[c+3],o=b[d+0],p=b[d+1],q=b[d+2],r=b[d+3];return g=k*o+l*p+m*q+n*r,g<0&&(g=-g,o=-o,p=-p,q=-q,r=-r),1-g>1e-6?(f=Math.acos(g),h=Math.sin(f),i=Math.sin((1-e)*f)/h,j=Math.sin(e*f)/h):(i=1-e,j=e),a[0]=i*k+j*o,a[1]=i*l+j*p,a[2]=i*m+j*q,a[3]=i*n+j*r,a}var l=a("gl-matrix"),m=(l.mat4,l.mat3),n=l.vec3,o=(l.quat,m.create()),p=new Float32Array(o.buffer,0,3),q=new Float32Array(o.buffer,12,3),r=new Float32Array(o.buffer,24,3);VUP=n.fromValues(0,1,0);var s=2*Math.PI;b.exports={clamp:d,sign:e,map:f,randomFloat:g,normalizeAngle:h,normalizeDeltaAngle:i,mat3Lookat:j,quatSlerp:k}},{"gl-matrix":192}],50:[function(a,b,c){function d(a,b,c){var d,e;if(void 0!==a.touches){var f;if(a.touches.length>0?f=a.touches:a.changedTouches&&a.changedTouches.length>0&&(f=a.changedTouches),f){for(var d=0,e=0,g=0;g<f.length;g++)d+=f[g].clientX,e+=f[g].clientY;d/=f.length,e/=f.length}}else d=a.clientX,e=a.clientY;b[0]=2*d/u.renderer.canvasWidth-1,b[1]=-(2*e/u.renderer.canvasHeight-1),c[0]=2*d/u.renderer.canvasWidth-1,c[1]=-(2*e/u.renderer.canvasWidth-1)}function e(a){A=!0,d(a,v,w),E.emit("move",v)}function f(a){A=!0,z=!0,d(a,v,w),x.set(v),y.set(w),E.emit("down",v)}function g(a){A=!0,z=!1,d(a,v,w),E.emit("up",v)}function h(){B=Date.now()}function i(){return Date.now()-B>5e3}function j(a){i()&&e(a)}function k(a){A=!1,z=!1,E.emit("leave",a)}function l(a){i()&&f(a)}function m(a){i()&&g(a)}function n(a){h(),e(a),q(a)}function o(a){h(),f(a),E.emit("touchdown",a)}function p(a){h(),g(a),q(a),E.emit("touchup",a)}function q(a){if(void 0!==a.touches&&a.touches.length>1){var b=a.touches[0].clientX-a.touches[1].clientX,c=a.touches[0].clientY-a.touches[1].clientY,d=Math.sqrt(b*b+c*c);if(C){var e=d/D;E.emit("pinch",e)}else C=!0,D=d,E.emit("pinchstart")}else C=!1}function r(a){u=a,t=u.renderer.canvas,t.addEventListener("mousemove",j),t.addEventListener("mouseleave",k),t.addEventListener("mousedown",l),t.addEventListener("mouseup",m),t.addEventListener("touchmove",n),t.addEventListener("touchstart",o),t.addEventListener("touchend",p)}var s=a("event-emitter"),t=null,u=null,v=new Float32Array(2),w=new Float32Array(2),x=new Float32Array(2),y=new Float32Array(2),z=!1,A=!0,B=0,C=!1,D=0,E={getEl:function(){return t},coords:v,ncoords:w,dcoords:x,ndcoords:y,init:r,isDown:function(){return z},isOver:function(){return A}};s(E),b.exports=E},{"event-emitter":186}],51:[function(a,b,c){function d(a){function b(){d--,c.notify(1-d/a.length),0===d&&c.resolve(!0)}for(var c=m.defer(),d=a.length,e=0;e<a.length;e++)a[e].then(b,c.reject);return c.promise}function e(a){return i(a,"").then(function(a){return JSON.parse(a)})}function f(a){return i(a,"arraybuffer")}function g(a){var b=m.defer(),c=new Image;return c.onload=function(){b.resolve(c)},c.onerror=function(){b.reject()},c.crossOrigin="anonymous",c.src=a,b.promise}function h(){for(var a=0;a<n.length;a++)n[a].xhr.abort(),n[a].defer.reject();o={},n.length=0}function i(a,b){return k(a,b).defer.promise.then(j)}function j(a){return a.xhr.response}function k(a,b){var c,d,e="GET";c=m.defer(),d=new XMLHttpRequest;var f={xhr:d,id:p++,defer:c};return d.open(e,a,!0),"arraybuffer"===b&&d.setRequestHeader("Accept","application/octet-stream"),d.responseType=b,d.onload=function(){return c.resolve(f)},d.error=function(a){return c.reject(f)},d.send(),n.push(f),o[f.id]=f,c.promise.then(l),f}function l(a){delete o[a.id];var b=n.indexOf(a);b>-1&&n.splice(b,1)}var m=a("when"),n=[],o={},p=0;b.exports={loadJson:e,loadBytes:f,loadImage:g,whenAll:d,releaseAll:h}},{when:280}],52:[function(a,b,c){function d(a){var b=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT),c=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT);return c.precision>0&&b.precision>0}function e(a){var b=a.gl;this.hasHighp=d(b),this.programs=[this.background=new f(b),this.debugFbo=new f(b)],this.compile()}var f=a("nanogl/program"),g=a("glslify");f.debug=!1,e.prototype={precision:function(){return this.hasHighp?"highp":"mediump"},compile:function(){var a="\n";a+="precision "+this.precision()+" float;\n",this.background.compile(g(["#define GLSLIFY 1\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\nuniform vec2 uScreenRatio;\n\nvarying vec3 vScreenPos;\nvarying vec2 vNoiseTC;\n\n  \nvoid main( void ){\n\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n  // vTexCoord = aTexCoord;\n  vScreenPos = gl_Position.xyw;\n  vNoiseTC   = aTexCoord * uScreenRatio;\n}\n"]),g(["#define GLSLIFY 1\nvarying vec3 vScreenPos;\nvarying vec2 vNoiseTC;\n\nuniform vec3 uColor;\nuniform sampler2D tNoise;\n\nvoid main(void){\n  \n  float uvy = (vScreenPos.y/vScreenPos.z) *.5 +.5;\n  // gl_FragColor = texture2D( tGradient, vec2( vTexCoord.y, 0.0) );\n  float grad = uvy * .50;\n\n  gl_FragColor.rgb = uColor *(1.0-grad) + grad; \n\n  float noise = texture2D( tNoise, vNoiseTC ).r;\n  gl_FragColor.rgb += gl_FragColor.rgb * ( .03 * noise - 0.015 );\n\n  gl_FragColor.a = 1.0;\n\n}\n"]),a),this.debugFbo.compile(g(["#define GLSLIFY 1\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord = aTexCoord;\n\n}\n"]),g(["#define GLSLIFY 1\nvarying vec2 vTexCoord;\n\nuniform sampler2D tTex;\n\nvoid main(void){\n  \n  gl_FragColor = texture2D( tTex, vTexCoord );\n\n}\n"]),a),this.process()},process:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].use()},dispose:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].dispose();this.programs=null}},b.exports=e},{glslify:205,"nanogl/program":253}],53:[function(a,b,c){function d(){return o()?q:p}function e(a){t=a,l()}function f(a){return t}function g(){e(p)}function h(){e(q)}function i(a){return r[a][t]}function j(a,b,c){u.push({scope:a,fname:b}),c||a[b](!0)}function k(){u=[]}function l(){for(var a=0;a<u.length;a++)u[a].scope[u[a].fname](!1)}function m(){var a=["#define "+i("shaderQuality")+" 1"];return a.join("\n")}var n=a("lib/getQuery"),o=a("lib/ismobile"),p=1,q=0,r={half_dpi:[!1,!1],max_dpi:[3,2],anisotropy:[0,4],gshadow_low:[!0,!1],shaderQuality:["QUALITY_LO","QUALITY_HI"],space_smoke_hd:[!1,!0],space_gshadow:[!1,!0]},s=n("quality",d()),t=parseInt(s),u=[],v={setHI:g,setLOW:h,setQuality:e,getQuality:f,param:i,on:j,release:k,getMacroDefs:m};b.exports=v},{"lib/getQuery":36,"lib/ismobile":38}],54:[function(a,b,c){function d(){this.pos=new Float32Array(3),this.dir=new Float32Array(3),this._invalid=!0}var e=a("gl-matrix"),f=a("lib/mouse"),g=e.vec3,h=e.mat3,i=e.mat4,j=(g.create(),i.create()),k=(h.create(),g.create());d.prototype={update:function(a){this._invalid&&(k[0]=f.coords[0],k[1]=f.coords[1],k[2]=1,g.copy(this.pos,a._wposition),i.invert(j,a._viewProj),g.transformMat4(this.dir,k,j),g.subtract(this.dir,this.dir,this.pos),g.normalize(this.dir,this.dir),this._invalid=!1)}},b.exports=d},{"gl-matrix":192,"lib/mouse":50}],55:[function(a,b,c){function d(){var a=document.getElementById("gl-canvas");this.onLoaded=this._onLoaded.bind(this),this.onLoadProgress=this._onLoadProgress.bind(this),this.onDragProgress=this._onDragProgress.bind(this),this.onNextSection=this._onNextSection.bind(this),this.model=new h,this.renderer=new f(a),this.scene=new g,i.on("next_section",this.onNextSection),i.on("drag_progress",this.onDragProgress),this.renderer.scene=this.scene,this.scene.init(this.renderer,this.model),this.load(),this.renderer.play()}a("lib/browser-detect");var e=a("promise-polyfill");window.Promise||(window.Promise=e);var f=a("./renderer"),g=a("./scene"),h=a("./model"),i=a("./ui");d.prototype={load:function(){return this.scene.load().then(this.onLoaded,null,this.onLoadProgress)},_onLoaded:function(){var a=this.model;setTimeout(function(){i.dispatch("show_logo"),6!=a.getSection()&&i.dispatch("show_nav")},3e3),this.scene.loaded()},_onLoadProgress:function(a){},_onNextSection:function(){this.model.next(),6==this.model.getSection()&&i.dispatch("hide_nav")},_onDragProgress:function(a,b){}},window.App=d},{"./model":56,"./renderer":155,"./scene":156,"./ui":158,"lib/browser-detect":31,"promise-polyfill":259}],56:[function(a,b,c){function d(){this._section=0,this._position=0;var a=parseInt(f("section",0));this.setSection(a)}var e=a("event-emitter"),f=a("lib/getQuery"),g=7,h=["SECTION_CHANGE","POS_CHANGE"];d.prototype={setSection:function(a){this._section!==a&&(this._section=a,this.emit(d.SECTION_CHANGE))},getSection:function(){return this._section},setPosition:function(a){a=Math.max(0,Math.min(g-1,a)),this._position!==a&&(this._position=a,this.emit(d.POS_CHANGE))},getPosition:function(){return this._position},hasNext:function(){return this._section<g-1},hasPrev:function(){return this._section>0},next:function(){this.hasNext&&this.setSection(this._section+1)},prev:function(){this.hasPrev&&this.setSection(this._section-1)}},h.forEach(function(a){d[a]=a,d.prototype[a]=a}),e(d.prototype),b.exports=d},{"event-emitter":186,"lib/getQuery":36}],57:[function(a,b,c){function d(a){this.onSectionChange=this._onSectionChange.bind(this),this.onDragProgress=this._onDragProgress.bind(this),this.model=a.model,this.scene=a,this.stwTimeStart=0,this.stwStartPos=0,this.stwProgress=1,this.navSlide=0;var b=this.model;b.on(b.SECTION_CHANGE,this.onSectionChange),f.on("drag_progress",this.onDragProgress),this.dragProgress=0}var e=a("lib/ease"),f=(a("lib/math"),a("ui"));d.prototype={preRender:function(){var a=this.scene.dt;if(this.stwProgress<1){this.stwProgress+=a/2;var b=this.scene.model.getSection()-this.stwStartPos;mp=this.stwStartPos+b*e.easeInOutCubic(this.stwProgress)}else mp=this.scene.model.getSection();this.model.setPosition(mp+.1*this.dragProgress)},_onDragProgress:function(a,b){this.stwProgress>=1&&(this.dragProgress=b)},_onSectionChange:function(){this.scene.model.getSection();this.dragProgress=0,this.stwTimeStart=this.scene.time,this.stwProgress=0,this.stwStartPos=this.model.getPosition()-.1*this.dragProgress}},b.exports=d},{"lib/ease":33,"lib/math":49,ui:158}],58:[function(a,b,c){function d(a){this.gl=a,this.vertices=new Float32Array(g),this.indices=new Uint16Array(h),this.drawingBuffer=null,this.drawingMethod="drawTriangles",this.setup()}var e=a("nanogl/arraybuffer"),f=a("nanogl/indexbuffer"),g=[-1,1,-1,0,0,0,1,0,-1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,1,-1,1,0,0,1,0,-1,1,1,0,0,-1,0,0,-1,-1,1,1,0,-1,0,0,-1,-1,-1,1,1,-1,0,0,-1,1,-1,0,1,-1,0,0,1,1,1,1,1,1,0,0,1,-1,1,0,1,1,0,0,1,-1,-1,0,0,1,0,0,1,1,-1,1,0,1,0,0,1,1,1,1,1,0,0,1,1,-1,1,1,0,0,0,1,-1,-1,1,0,0,0,0,1,-1,1,1,0,1,0,0,1,1,1,-1,0,0,0,0,-1,1,-1,-1,0,1,0,0,-1,-1,-1,-1,1,1,0,0,-1,-1,1,-1,1,0,0,0,-1,-1,-1,-1,1,1,0,-1,0,-1,-1,1,1,0,0,-1,0,1,-1,1,0,0,0,-1,0,1,-1,-1,0,1,0,-1,0],h=[0,1,2,0,2,3,5,4,6,6,4,7,8,9,10,8,10,11,13,12,14,15,14,12,16,17,18,16,18,19,21,20,22,22,20,23];d.prototype.setup=function(){var a=this.gl;this.buffer=new e(a),this.buffer.data(this.vertices),this.buffer.attrib("aPosition",3,a.FLOAT),this.buffer.attrib("aNormal",3,a.FLOAT),this.buffer.attrib("aTexCoord",2,a.FLOAT),this.ibuffer=new f(a,a.UNSIGNED_SHORT),this.ibuffer.data(this.indices),this.drawingBuffer=this.ibuffer},d.prototype.bind=function(a){this.gl;this.buffer.attribPointer(a),this.ibuffer.bind()},d.prototype.render=function(){this.drawingBuffer[this.drawingMethod]()},b.exports=d},{"nanogl/arraybuffer":249,"nanogl/indexbuffer":252}],59:[function(a,b,c){function d(a,b){g.call(this),this.gl=a,this.mod=b,this.setup()}var e=a("./box-geom"),f=a("./debug-material"),g=a("nanogl-node");d.prototype=Object.create(g.prototype),d.prototype.constructor=d,d.prototype.setup=function(){this.geom=new e(this.gl),this.material=new f(this.mod)},d.prototype.preRender=function(){},d.prototype.render=function(){this.material.prepare(this),this.geom.bind(this.mod.programs.debug),this.geom.render()},b.exports=d},{"./box-geom":58,"./debug-material":60,"nanogl-node":214}],60:[function(a,b,c){function d(a){this.mod=a,this.prg=a.programs.debug;var b=a.scene.gl;this.cfg=a.scene.glstate.config().enableDepthTest(!0).enableBlend().blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA)}var e=a("gl-matrix").mat4,f=e.create();d.prototype.prepare=function(a){var b=this.prg;b.bind(),this.cfg.apply(),this.mod.scene.camera.modelViewProjectionMatrix(f,a._wmatrix),b.uMVP(f)},b.exports=d},{"gl-matrix":192}],61:[function(a,b,c){function d(a){this.onModelPosChange=this._onModelPosChange.bind(this),this.scene=a,this.mods=[],this.ctxs=[],this.actives=[],this._loaded=!1;for(var b=0;b<n.length;b++){var c=this.makeContext(),d=n[b](c);this.mods.push(d),this.ctxs.push(c),this.actives.push(!1)}this._activeMods=[],this._pcache=-.123;var e=this.scene.model;e.on(e.POS_CHANGE,this.onModelPosChange),this.updateLifecycle(),this._gui()}function e(){this.decodeAudio=this._decodeAudio.bind(this),this.createBufferNode=this._createBufferNode.bind(this),this.scene=null,this.audioOutput=null,this.node=new g}function f(a,b,c){this.ctx=a,this.audioBuffer=b,this.dest=c,this.gain=null}var g=a("nanogl-node"),h=a("when"),j=a("gl-matrix"),k=a("dev/gui"),l=(a("consts"),a("config")),m=a("lib/net"),n=a("sections"),o=j.vec3,p=o.fromValues(0,0,0),q=o.fromValues(0,.14,1.24),r=o.fromValues(0,.14,0),s=o.create(),t=o.create();d.prototype={_onModelPosChange:function(){this.updateLifecycle()},updateLifecycle:function(){var a,b=this.scene.model._position;for(a=0;a<this.ctxs.length;a++){var c=this.mods[a],d=a-b;d=Math.min(1,Math.max(-1,d));var e=Math.abs(d)<1;this.actives[a]!==e?(c.setPosition(d),this.ctxs[a].audioOutput.gain.value=1-Math.abs(d),this.ctxs[a]._position=d,e?(c.start(),this.scene.audio.connectModule(this.ctxs[a].audioOutput)):(c.stop(),this.ctxs[a].audioOutput.disconnect()),this.actives[a]=e):this.actives[a]&&(c.setPosition(d),this.ctxs[a].audioOutput.gain.value=1-Math.abs(d),this.ctxs[a]._position=d)}},_proxiedCall:function(a){if(this._loaded)for(this._updateActives(),i=0;i<this._activeMods.length;i++)this._activeMods[i][a]()},preRender:function(){var a,b=this.scene.section_sep;for(a=0;a<this.ctxs.length;a++)this.ctxs[a].node.x=a*b;this._proxiedCall("preRender")},rttPass:function(){this._proxiedCall("rttPass")},render:function(){this._proxiedCall("render")},postRender:function(){this._proxiedCall("postRender")},getCameraPosition:function(a,b){this._updateActives();var c=this.scene.model._position;for(a.set(p),b.set(p),i=0;i<this.mods.length;i++){var d=Math.abs(i-c);if(d<1){var e=this.mods[i];d=1-Math.min(1,d),s.set(q),t.set(r),e.getCameraPosition(s,t),o.scaleAndAdd(a,a,s,d),o.scaleAndAdd(b,b,t,d)}}},_updateActives:function(){var a=this.scene.model._position;if(a<0&&(a=0),this._pcache!==a){this._activeMods.length=0,this._pcache=a;var b=Math.floor(a),c=Math.ceil(a);this._activeMods[0]=this.mods[b],b!==c&&(this._activeMods[1]=this.mods[c])}},makeContext:function(){var a=new e;return a.setScene(this.scene),this.scene.root.add(a.node),a},loadAll:function(){return this.mods.reduce(function(a,b){return a.concat(b.getLoadables())},[])},getCurrent:function(){var a=this.scene.model._position,b=0|Math.round(a);return this.mods[b]},step:function(){},_gui:function(){for(var a=k.addFolder("sections"),b=this,c=[],d=0;d<this.mods.length;d++)c[d]=function(a){return function(){b.scene.model.setSection(a)}}(d),a.add(c,d)}},e.prototype={setScene:function(a){this.scene=a;var b=this.scene.audio.ac;this.audioContext=b,this.audioOutput=b.createGain()},makeAudioSource:function(a){a=l.asset_url(a);var b=document.createElement("audio");b.src=a;var c=this.audioContext,d=c.createMediaElementSource(b);return void 0===d.mediaElement&&(d.mediaElement=b),d},makeAudioBufferSource:function(a){return m.loadBytes(l.asset_url(a)).then(this.decodeAudio).then(this.createBufferNode)},_decodeAudio:function(a){var b=h.defer();return this.audioContext.decodeAudioData(a,function(a){b.resolve(a)}),b.promise},_createBufferNode:function(a){return new f(this.audioContext,a,this.audioOutput)}},f.prototype={play:function(a,b){var c=this,d=this.ctx.createBufferSource();if(d.buffer=this.audioBuffer,void 0!==b){var e=this.ctx.createGain();e.connect(this.dest),d.connect(e),e.gain.value=b,this.gain=e}else d.connect(this.dest);return a?d.loop=!0:d.addEventListener("ended",function(){c.gain=null,this.disconnect()}),d.start(),d},volume:function(a){this.gain&&(this.gain.gain.value=a)}},b.exports=d},{config:17,consts:18,"dev/gui":20,"gl-matrix":192,"lib/net":51,"nanogl-node":214,sections:157,when:280}],62:[function(a,b,c){function d(a){this.bulb=a,this.intersect=!1,this.mousePos=null}var e=a("lib/mouse"),f=a("gl-matrix"),g=f.vec2,h=f.vec3,i=f.mat4,j=g.create(),k=h.create(),l=h.create(),m=h.create(),n=i.create(),o=i.create();d.prototype={checkIntersect:function(){i.invert(o,this.bulb.node._wmatrix),h.transformMat4(m,this.getMousePosition(),o);var a=h.length(m),b=.001,c=3*this.cappedCone([m[0],m[1]-.053,m[2]],.043*b,.068*b,.035*b),d=Math.min(c,a),e=.04;return d<e},cappedCone:function(a,b,c,d){var e=-a[1]-b,f=a[1]-b,h=.5*(c-d)/b,i=Math.max(Math.sqrt((a[0]*a[0]+a[2]*a[2])*(1-h*h))+f*h-d,f);return g.max(j,g.fromValues(e,i),g.create()),g.length(j)+Math.min(Math.max(e,i),0)},getMousePosition:function(){k[0]=e.coords[0],k[1]=e.coords[1],k[2]=1;var a=this.bulb.scene.camera;i.invert(n,a._viewProj),h.transformMat4(k,k,n),h.sub(k,k,a._wposition);var b=(a._wposition[2]-this.bulb.node.position[2])/k[2];return l[0]=a._wposition[0]-k[0]*b,l[1]=a._wposition[1]-k[1]*b,l[2]=this.bulb.node.position[2],l}},b.exports=d},{"gl-matrix":192,"lib/mouse":50}],63:[function(a,b,c){function d(a){this.bulb=a}var e=a("../gl/sphere"),f=a("../consts").NB_DIVISONS;d.prototype={setup:function(){var a=this.bulb.mod.physic,b=a.world,c=.04;this.debugSphere=new e(this.bulb.mod),this.debugSphere.node.setScale(c),this.body=new CANNON.Body({mass:5,sleepTimeLimit:.001,sleepSpeedLimit:1});var d=new CANNON.Sphere(c);this.body.addShape(d),this.body.position.set(0,this.bulb.mod.rope.spheres[f-1].physic.body.position.y,0),this.body.velocity.set(0,0,0),this.body.angularVelocity.set(0,0,0),this.body.collisionResponse=!1,this.body.linearDamping=.01,this.body.angularDamping=.01,this.body.invInertia.x=0,this.body.invInertia.y=0,this.body.updateInertiaWorld(!0),b.addBody(this.body);var g=new CANNON.PointToPointConstraint(this.body,new CANNON.Vec3(0,.18,0),this.bulb.mod.rope.spheres[f-1].physic.body,new CANNON.Vec3(0,0,0));b.addConstraint(g)},sync:function(){var a=this.bulb.node,b=this.debugSphere.node,c=a.rotation,d=a.position,e=b.rotation,f=b.position,g=this.body.quaternion,h=this.body.position;c[0]=e[0]=g.x,c[1]=e[1]=g.y,c[2]=e[2]=g.z,c[3]=e[3]=g.w,d[0]=f[0]=h.x,d[1]=f[1]=h.y,a.invalidate()},render:function(){this.bulb.mod.debugPhysic&&this.debugSphere.render()}},b.exports=d},{"../consts":69,"../gl/sphere":71}],64:[function(a,b,c){function d(a){this.mod=a,this.scene=a.scene,this.gl=this.scene.gl,this.intensity=0,h.call(this,this.scene,"bulb"),this.lsetup=new f,this.plight=new g(this.gl),this.plight.radius=2,this.plight.falloffCurve=1,this.lsetup.add(this.plight),this.physic=new o(this),this.physic.setup(),this.control=new p(this),this.node.add(this.physic.debugSphere.node),this.setupMaterials()}var e=a("nanogl-pbr/standard"),f=a("nanogl-pbr/lib/lights/light-setup"),g=a("nanogl-pbr/lib/lights/point-light"),h=a("assets/awd-scene"),i=a("lib/color"),j=a("lib/math").map,k=a("./glass"),l=a("./glow-material"),m=a("./culot-material"),n=a("./filament-material"),o=a("./bulb-physic"),p=a("./bulb-control"),q=a("gl-matrix"),r=a("../consts").INITIAL_IMPULSE,s=q.mat4,t=q.vec3,u=t.create(),v=s.create();d.prototype=Object.create(h.prototype),d.prototype.constructor=d,d.prototype.getLoadables=function(){var a=h.prototype.getLoadables.call(this);return a},d.prototype.getAssetPath=function(a){return"light/"+a},d.prototype.getTexturePath=function(a){return"light/"+a},d.prototype.getAwdUrl=function(){return this.getAssetPath("scene.awd")},d.prototype.preRender=function(){s.invert(v,this.container._wmatrix),t.transformMat4(u,this.scene.camera._wposition,v),this.glowplane.lookAt(u),this.glowmat.intensity.set(.5*this.intensity);var a=Math.max(.1,Math.min(.5,6*this.intensity));this.filamat.intensity.set(a);var b=j(this.intensity,0,.6,5,12);this.plight._color.set([b,b,b]),this.lsetup.update(),this.physic.sync()},d.prototype.impulse=function(){this.physic.body.applyImpulse(r,this.physic.body.position);
},d.prototype.setupMaterials=function(){var a=this.mats,b=this.texs;b.makeTex("culot_OCCLU",this.getAssetPath("culot_OCCLU.jpg")).setFilter(!0,!1,!1),b.makeTex("shadow",this.getAssetPath("shadow.jpg")).setFilter(!0,!1,!1);var c=new m(this.gl);c._precision="highp",c.setIBL(this.scene.env.ibl),c.setLightSetup(this.lsetup),c.albedo=c.iAlbedo.attachUniform("uColor"),c.gloss=c.iGloss.attachUniform("uGloss"),c.specular=c.iSpecular.attachUniform("uSpecular"),c.occlu=c.iCavity.attachSampler("tOcclusion","vTexCoord"),c.iCavityStrength.attachConstant([1,1]),c.occlu.set(b.get("culot_OCCLU")),i.HexInput(c.albedo,14255446),i.HexInput(c.specular,13597002),c.gloss.set(.1),c.conserveEnergy.set(!1),c.perVertexIrrad.set(!0),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"base"),c=new e(this.gl),c._precision="highp",c.setIBL(this.scene.env.ibl),c.setLightSetup(this.lsetup),c.albedo=c.iAlbedo.attachUniform("uColor"),c.gloss=c.iGloss.attachUniform("uGloss"),c.specular=c.iSpecular.attachUniform("uSpecular"),c.fresnel=c.iFresnel.attachUniform("uFresnel"),i.HexInput(c.albedo,0),i.HexInput(c.specular,1052688),i.HexInput(c.fresnel,6316128),c.gloss.set(.86),c.conserveEnergy.set(!1),c.perVertexIrrad.set(!0),c.glossNearest.set(!0),c._mask=2,c.config.enableBlend(),c.config.blendFunc(this.gl.ONE,this.gl.CONSTANT_COLOR),c.config.blendColor(.95,.95,.95,1),c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!1),a.registerMaterial(c,"glass"),this.glassMat=c,c=new n(this.gl),c._precision="lowp",c.intensity=c.iIntensity.attachUniform("uIntensity"),c.intensity.set(1),this.filamat=c,a.registerMaterial(c,"filament"),c=new l(this.gl),c._precision="lowp",c.intensity=c.iIntensity.attachUniform("uIntensity"),c.intensity.set(1),c.params=c.iParam.attachUniform("uparams"),c.params.set(1.8,.64,1.4),this.glowmat=c,a.registerMaterial(c,"glow"),c=new e(this.gl),c._precision="highp",c.setIBL(this.scene.env.ibl),c.setLightSetup(this.lsetup),c.albedo=c.iAlbedo.attachUniform("uColor"),c.gloss=c.iGloss.attachConstant(.4),c.specular=c.iSpecular.attachUniform("uSpecular"),i.HexInput(c.albedo,16777215),i.HexInput(c.specular,0),c.perVertexIrrad.set(!0),c.glossNearest.set(!0),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"metal"),c=new e(this.gl),c._precision="highp",c.setIBL(this.scene.env.ibl),c.setLightSetup(this.lsetup),c.albedo=c.iAlbedo.attachUniform("uColor"),c.gloss=c.iGloss.attachConstant(0),c.specular=c.iSpecular.attachUniform("uSpecular"),i.HexInput(c.albedo,16777215),i.HexInput(c.specular,0),c.perVertexIrrad.set(!0),c.glossNearest.set(!0),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"white"),c=new e(this.gl),c._precision="highp",c.setIBL(this.scene.env.ibl),c.setLightSetup(this.lsetup),c.albedo=c.iAlbedo.attachUniform("uColor"),c.gloss=c.iGloss.attachConstant(0),c.specular=c.iSpecular.attachUniform("uSpecular"),i.HexInput(c.albedo,14255446),i.HexInput(c.specular,0),c.perVertexIrrad.set(!0),c.glossNearest.set(!0),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"orange")},d.prototype._postParse=function(){this.container=this.loader.getObjectByName("container"),this.glowplane=this.loader.getObjectByName("glow_plane"),this.glowplane.add(this.plight);var a=this.loader.getObjectByName("bulbe"),b=this.meshes.indexOf(a);this.meshes.splice(b,1),this.glass=new k(this.scene,this.glassMat,a),this.subrenderables.push(this.glass)},b.exports=d},{"../consts":69,"./bulb-control":62,"./bulb-physic":63,"./culot-material":65,"./filament-material":66,"./glass":67,"./glow-material":68,"assets/awd-scene":1,"gl-matrix":192,"lib/color":32,"lib/math":49,"nanogl-pbr/lib/lights/light-setup":233,"nanogl-pbr/lib/lights/point-light":235,"nanogl-pbr/standard":239}],65:[function(a,b,c){function d(a){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iAlbedo=this.inputs.add(new h("albedo",3)),this.iSpecular=this.inputs.add(new h("specular",3)),this.iGloss=this.inputs.add(new h("gloss",1)),this.iNormal=this.inputs.add(new h("normal",3)),this.iOcclusion=this.inputs.add(new h("occlusion",1)),this.iCavity=this.inputs.add(new h("cavity",1)),this.iCavityStrength=this.inputs.add(new h("cavityStrength",2)),this.iEmissive=this.inputs.add(new h("emissive",1)),this.iEmissiveScale=this.inputs.add(new h("emissiveScale",1)),this.iFresnel=this.inputs.add(new h("fresnel",3)),this.conserveEnergy=this.inputs.add(new i("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new i("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new i("glossNearest",!1)),this.tonemap=this.inputs.add(new i("tonemap",!0)),this.config=new e,this._prgcache=g.getCache(a),this._uid="culo",this._precision="highp",this._vertSrc=f(['#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nattribute vec3 aTangent;\nattribute vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\nvarying mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  varying mediump vec3 vWorldTangent;\n  varying mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n    #if HAS_iblExpo\n      vIrradiance = iblExpo().x * pow( vIrradiance, vec3( iblExpo().y ) );\n    #endif\n  #endif\n\n  vTexCoord = aTexCoord;\n}']),this._fragSrc=f(['#define GLSLIFY 1\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\nuniform vec3 uCameraPosition;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\nvarying mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  varying mediump vec3 vWorldTangent;\n  varying mediump vec3 vWorldBitangent;\n#endif\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n// INCLUDES\n// =========\n\nvec2 octwrapDecode( vec3 v ) {\n  // Project the sphere onto the octahedron, and then onto the xy plan\n  vec2 p = v.xy / dot(  abs( v ) , vec3(1.0) );\n  p = vec2( p.x+p.y-1.0, p.x-p.y );\n\n  if( v.z < 0.0 )\n    p.x *= -1.0;\n\n  // p.x *= sign( v.z );\n  return p;\n}\n\nvec3 decodeRGBE( vec4 hdr ){\n  return hdr.rgb * exp2( (hdr.a*255.0)-128.0 );\n  // return hdr.rgb * pow( 2.0, (hdr.a*255.0)-128.0 );\n}\n\nconst vec2 _IBL_UVM_2281831123 = vec2(\n  0.25*(254.0/256.0),\n  0.125*0.5*(254.0/256.0)\n);\n\nvec3 SpecularIBL( sampler2D tEnv, vec3 skyDir, float roughness)\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  float r7   = 7.0*roughness;\n  float frac = fract(r7);\n\n  uvA = uvA * _IBL_UVM_2281831123 + vec2(\n      0.5,\n      0.125*0.5 + 0.125 * ( r7 - frac )\n    );\n\n  #if glossNearest\n\n    return decodeRGBE( texture2D(tEnv,uvA) );\n\n  #else\n\n    vec2 uvB=uvA+vec2(0.0,0.125);\n    return  mix(\n      decodeRGBE( texture2D(tEnv,uvA) ),\n      decodeRGBE( texture2D(tEnv,uvB) ),\n      frac\n    );\n\n  #endif\n\n}\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 sss,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*sss + dot*fresnel();\n  #else\n    return( 1.0 - dot )*sss + dot;\n  #endif\n}\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n// ------------------------------\n//\nvec3 toneMap(vec3 c){\n  vec3 sqrtc = sqrt( c );\n  return(sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n}\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef=SampleSH(worldNormal, uSHCoeffs );\n    #if HAS_iblExpo\n      diffuseCoef = iblExpo().x * pow( diffuseCoef, vec3( iblExpo().y ) );\n    #endif\n  #endif\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n  #if HAS_iblExpo\n    specularColor = iblExpo().x * pow( specularColor, vec3( iblExpo().y ) );\n  #endif\n\n  #pragma SLOT lightsf\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n  #if HAS_cavity\n    // float cav = cavity() * 2.0;\n    // diffuseCoef    *= cav * cavityStrength().r;\n\n    float cav = cavity() * 2.0 - 1.0;\n    specularColor  *= cav * cavityStrength().r;\n    // specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  #if tonemap\n    gl_FragColor.xyz = toneMap( diffuseCoef*albedoSq + specularColor );\n  #else\n    gl_FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n  #endif\n\n  gl_FragColor.a = 1.0;\n\n}'])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=a("nanogl-pbr/lib/flag"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a,this.inputs.addChunks(a.getChunks())},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.uWorldMatrix(a._wmatrix),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244,"nanogl/program":253}],66:[function(a,b,c){function d(a){this.prg=null,this._mask=4,this.inputs=new i,this.iIntensity=this.inputs.add(new h("intensity",1)),this.config=(new e).enableBlend().blendFunc(a.ONE,a.ONE).enableCullface(!1).enableDepthTest().depthMask(!1),this._prgcache=g.getCache(a),this._uid="lfilament",this._precision="highp",this._vertSrc=f(["#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\n\nvarying float vTexCoordY;\n\nvoid main( void ){\n  \n  #pragma SLOT v\n\n  vec4 p = vec4(aPosition, 1.0);\n  gl_Position    = uMVP         * p;\n  // vTexCoord = aTexCoord;\n  vTexCoordY = aTexCoord.y;\n}"]),this._fragSrc=f(["#define GLSLIFY 1\n\nvarying float vTexCoordY;\n\n#pragma SLOT pf\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // float glow = glowtex();\n\n  float dist = max( 0.0, vTexCoordY );\n  float glow = pow( dist, 1.4 );\n\n  gl_FragColor = vec4( vec3(glow*intensity()), 1.0 );\n}"])}var e=a("nanogl-state/config"),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=a("nanogl-pbr/lib/chunks-tree"),j=a("gl-matrix").mat4,k=j.create();d.prototype={prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k)},prepareShadow:function(a,b){},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)&&(console.log("dirty input"),!0)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244}],67:[function(a,b,c){function d(a,b,c){this.mat=b,this.mesh=c,this.scene=a;var d=c.gl;this.frontCfg=(new e).enableCullface(!0).cullFace(d.FRONT),this.backCfg=(new e).enableCullface(!0).cullFace(d.BACK)}var e=a("nanogl-state/config");d.prototype={render:function(a,b){this.mesh.render(this.scene,a,this.backCfg),this.mesh.render(this.scene,a,this.frontCfg)},renderPass:function(){},renderDepth:function(){}},b.exports=d},{"nanogl-state/config":244}],68:[function(a,b,c){function d(a){this.prg=null,this._mask=4,this.inputs=new i,this.iIntensity=this.inputs.add(new h("intensity",1)),this.iParam=this.inputs.add(new h("param",3)),this.config=(new e).enableBlend().blendFunc(a.ONE,a.ONE).enableCullface(!1).enableDepthTest(!1).depthMask(!1),this._prgcache=g.getCache(a),this._uid="lightglow",this._precision="highp",this._vertSrc=f(["#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\n\nvarying vec2 vTexCoord;\n\nvoid main( void ){\n  \n  #pragma SLOT v\n\n  vec4 p = vec4(aPosition, 1.0);\n  gl_Position    = uMVP         * p;\n  // vTexCoord = aTexCoord;\n  vTexCoord = aTexCoord * 2.0 - 1.0;\n}"]),this._fragSrc=f(["#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\n#pragma SLOT pf\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // float glow = glowtex();\n\n  float dist = length( vTexCoord );\n\n  float glow =\n    (1.0 - min( 1.0, ( dist* param().x) ))        + \n    (1.0 - min( 1.0, ( dist    ) )) * param().y;\n\n  glow = pow( glow, param().z );\n\n  gl_FragColor = vec4( vec3(glow*intensity()), 1.0 );\n}"])}var e=a("nanogl-state/config"),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=a("nanogl-pbr/lib/chunks-tree"),j=a("gl-matrix").mat4,k=j.create();d.prototype={prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k)},prepareShadow:function(a,b){},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)&&(console.log("dirty input"),!0)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244}],69:[function(a,b,c){b.exports={NB_DIVISONS:15,ROPE_LENGTH:.48,DISTANCE_FROM_FLOOR:.67,ROPE_THICKNESS:.0022,MOUSE_FORCE_CONSTRAINT:.3,INITIAL_IMPULSE:new CANNON.Vec3(1.8,0,0)}},{}],70:[function(a,b,c){function d(a,b,c){e.call(this,a);var d=b||1,g=c||32;this.sphereData=f(d,{segments:g});var h=this.parseData(this.sphereData);this.data(h),this.attrib("aPosition",3,a.FLOAT),this.attrib("aTexCoord",2,a.FLOAT),this.attrib("aNormal",3,a.FLOAT),this.attrib("aTriangleIndex",1,a.FLOAT)}var e=a("nanogl/arraybuffer"),f=a("primitive-sphere");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.parseData=function(a){for(var b=new Float32Array(3*a.cells.length*9),c=0,d=0;d<a.cells.length;d++)for(var e=0;e<3;e++){var f=a.cells[d][e];b[c]=a.positions[f][0],b[c+1]=a.positions[f][1],b[c+2]=a.positions[f][2],b[c+3]=a.uvs[f][0],b[c+4]=a.uvs[f][1],b[c+5]=a.normals[f][0],b[c+6]=a.normals[f][1],b[c+7]=a.normals[f][2],b[c+8]=d,c+=9}return b},d.prototype.render=function(){this.drawLines()},b.exports=d},{"nanogl/arraybuffer":249,"primitive-sphere":257}],71:[function(a,b,c){function d(a,b){this.mod=a,this.scene=a.scene,this.gl=this.scene.gl,this.node=new f,this.prg=new e(this.gl,h(["precision lowp float;\n#define GLSLIFY 1\n\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\n  \nvoid main( void ) {\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n}\n"]),h(["precision highp float;\n#define GLSLIFY 1\n\nvoid main(void) {\n  gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.1 );\n}\n"])),this.geom=new g(this.gl,1,8),this.cfg=this.scene.glstate.config().enableBlend().blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA).enableCullface().enableDepthTest(!1).depthMask(!1)}var e=a("nanogl/program"),f=a("nanogl-node"),g=a("../gl/sphere-geom"),h=a("glslify");d.prototype={render:function(){this.prg.use(),this.prg.uMVP(this.scene.camera.getMVP(this.node._wmatrix)),this.cfg.apply(),this.geom.attribPointer(this.prg),this.geom.render()}},b.exports=d},{"../gl/sphere-geom":70,glslify:205,"nanogl-node":214,"nanogl/program":253}],72:[function(a,b,c){function d(a){this.context=a,this.scene=a.scene,this.gl=a.scene.gl,this.node=a.node,this.mouseDown=this.mouseDown.bind(this),this.mouseUp=this.mouseUp.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.touchDown=this.touchDown.bind(this),this.touchUp=this.touchUp.bind(this),this.physic=new k(this),this.rope=new m(this),this.bulb=new l(this),this.bulb.node.setScale(2.2),this.shadow=new f(this),this.shadow.setTex(this.bulb.texs.get("shadow")),this.intensity=0,this.debugPhysic=!1,this.node.add(this.bulb.node),this.node.add(this.shadow.node),this.node.add(this.rope.node),this.cfg=this.scene.glstate.config()}function e(a){return new d(a)}var f=a("./shadow"),g=a("lib/math").map,h=a("lib/math").randomFloat,i=a("lib/ismobile"),j=a("lib/mouse"),k=a("./physic"),l=a("./bulb/bulb"),m=a("./rope/rope"),n=a("./sound-manager"),o=a("dev/gui");d.prototype={setPosition:function(a){},getLoadables:function(){var a=this.bulb.getLoadables();return a},start:function(){i()?(j.on("touchdown",this.touchDown),j.on("touchup",this.touchUp)):(j.on("down",this.mouseDown),j.on("up",this.mouseUp),j.on("leave",this.mouseLeave)),this.soundManager=new n(this),this.bulb.impulse()},stop:function(){this.soundManager.stop(),i()?(j.off("touchdown",this.touchDown),j.off("touchup",this.touchUp)):(j.off("down",this.mouseDown),j.off("up",this.mouseUp),j.off("leave",this.mouseLeave))},touchDown:function(){this.bulb.control.checkIntersect()&&this.physic.addMouseConstraint(this.bulb.physic.body)},touchUp:function(){this.physic.removeMouseConstraint()},mouseDown:function(){this.bulb.control.checkIntersect()&&this.physic.addMouseConstraint(this.bulb.physic.body)},mouseUp:function(){this.physic.removeMouseConstraint()},mouseLeave:function(){this.physic.removeMouseConstraint()},preRender:function(){var a=this.scene.dt;this.intensity=Math.min(.6,Math.max(0,.6*this.bulb.physic.body.velocity.length()))+h(0,.06),this.physic.step(a),this.bulb.preRender(),this.bulb.intensity=this.intensity,this.rope.preRender(),this.shadow.opacity=g(this.intensity,0,.6,this.shadow.defaultOpacity,.25),this.shadow.node.x=this.bulb.node.x,this.shadow.node.setScale(.65*this.bulb.node.y),this.soundManager&&this.soundManager.update()},rttPass:function(){},render:function(){this.cfg.apply(),this.bulb.render(1),this.shadow.render(),this.bulb.render(2),this.bulb.render(4),this.rope.render(),this.bulb.physic.render()},postRender:function(){},getCameraPosition:function(a,b){},debug:function(){var a=o.addFolder("light");this.soundManager.debug(a),this.shadow.debug(a),a.add(this,"debugPhysic").name("debug physic"),a.add(this.bulb,"impulse")}},b.exports=e},{"./bulb/bulb":64,"./physic":73,"./rope/rope":76,"./shadow":77,"./sound-manager":78,"dev/gui":20,"lib/ismobile":38,"lib/math":49,"lib/mouse":50}],73:[function(a,b,c){function d(a){this.mod=a,this.world=new CANNON.World,this.world.gravity.set(0,-2.82,0),this.world.solver.iterations=g+2;var b=new CANNON.Body({mass:0}),c=new CANNON.Plane;b.addShape(c),b.quaternion.setFromEuler(-Math.PI/2,0,0,"XYZ"),this.add(b);var d=new CANNON.Sphere(.1);this.jointBody=new CANNON.Body({mass:0}),this.jointBody.addShape(d),this.jointBody.collisionFilterGroup=0,this.jointBody.collisionFilterMask=0,this.add(this.jointBody),this.mouseConstraint=null}var e=1/60,f=3,g=a("./consts").NB_DIVISONS,h=a("./consts").MOUSE_FORCE_CONSTRAINT;d.prototype={step:function(a){if(this.mouseConstraint){var b=this.mod.bulb.control.getMousePosition(),c=b[0],d=b[1],g=b[2];this.jointBody.position.set(c,d,g),this.mouseConstraint.update()}this.world.step(e,a,f)},addMouseConstraint:function(a){this.removeMouseConstraint();var b=this.mod.bulb.control.getMousePosition(),c=b[0],d=b[1],e=b[2],f=new CANNON.Vec3(c,d,e).vsub(a.position),g=a.quaternion.inverse(),i=g.vmult(f);this.jointBody.position.set(c,d,e),this.mouseConstraint=new CANNON.PointToPointConstraint(a,i,this.jointBody,new CANNON.Vec3(0,0,0),h),this.world.addConstraint(this.mouseConstraint)},removeMouseConstraint:function(){this.mouseConstraint&&(this.world.removeConstraint(this.mouseConstraint),this.mouseConstraint=null)},add:function(a){this.world.addBody(a)},remove:function(a){this.world.removeBody(a)}},b.exports=d},{"./consts":69}],74:[function(a,b,c){function d(a){this.spheres=a.spheres,this.gl=a.gl,e.call(this,this.gl),this.attrib("aPosition",4,this.gl.FLOAT),this.vertices=new Float32Array(8*this.spheres.length)}var e=a("nanogl/arraybuffer"),f=a("../consts").ROPE_THICKNESS;d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.update=function(){for(var a=this.vertices,b=1,c=0,d=1/(this.spheres.length-1),e=0;e<this.spheres.length;e++){var g=this.spheres[e],h=8*e,i=g.physic.body.position.x,j=g.physic.body.position.y;if(e>0){var k=this.spheres[e-1].physic.body.position;c=-k.x+i,b=k.y-j;var l=Math.sqrt(b*b+c*c);b/=l,c/=l}a[h+0]=i+b*f,a[h+1]=j+c*f,a[h+2]=0,a[h+3]=e*d,a[h+4]=i-b*f,a[h+5]=j-c*f,a[h+6]=1,a[h+7]=e*d}this.data(a)},d.prototype.preRender=function(){this.update()},d.prototype.render=function(){this.drawTriangleStrip()},b.exports=d},{"../consts":69,"nanogl/arraybuffer":249}],75:[function(a,b,c){function d(a,b){this.renderable=a,this.index=b}var e=a("../consts").NB_DIVISONS,f=a("../consts").ROPE_LENGTH,g=a("../consts").DISTANCE_FROM_FLOOR;d.prototype={setup:function(){var a=this.renderable.mod.physic,b=a.world;this.body=new CANNON.Body({mass:0===this.index?0:1,sleepTimeLimit:.001,sleepSpeedLimit:1});var c=g*f;this.sphereRadius=c/e/2;var d=new CANNON.Sphere(.005);this.body.addShape(d);var h=g-c;this.body.position.set(0,h+(e-(this.index+1))*(2*this.sphereRadius),0),this.body.linearDamping=.8,b.addBody(this.body)},sync:function(){var a=this.renderable.node,b=a.rotation,c=a.position,d=this.body.quaternion,e=this.body.position;b[0]=d.x,b[1]=d.y,b[2]=d.z,b[3]=d.w,c[0]=e.x,c[1]=e.y,a.invalidate()}},b.exports=d},{"../consts":69}],76:[function(a,b,c){function d(a){this.mod=a,this.scene=a.scene,this.gl=this.scene.gl,this.world=a.physic.world,this.node=new e,this.spheres=[],this.createSpheres(),this.geom=new i(this),this.prg=new f(this.gl,g(["precision lowp float;\n#define GLSLIFY 1\n\nattribute vec4 aPosition;\n\nuniform mat4 uMVP;\n\nvarying float vSide;\nvarying float vAlpha;\n\nvoid main( void ) {\n  gl_Position = uMVP * vec4( aPosition.xy, 0.0, 1.0 );\n  vSide = aPosition.z;\n  vAlpha = min( 1.0, aPosition.w*1.4 );\n\n}\n"]),g(["precision highp float;\n#define GLSLIFY 1\n\nuniform vec3 uColor;\n\nvarying float vSide;\nvarying float vAlpha;\n\nvoid main(void) {\n  float shad = .9+.1*sin( vSide * 3.141592 );\n  float alpha = vAlpha;\n  gl_FragColor = vec4( vec3(uColor*shad), alpha );\n\n}\n"])),this.color=l.create(),k.HexToVec(15242592,this.color),this.cfg=this.scene.glstate.config().enableDepthTest().depthMask(!1).enableBlend().blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}var e=a("nanogl-node"),f=a("nanogl/program"),g=a("glslify"),h=a("../gl/sphere"),i=a("./rope-geom"),j=a("./rope-sphere-physic"),k=a("lib/color"),l=a("gl-matrix").vec3,m=a("../consts").NB_DIVISONS;d.prototype={createSpheres:function(){for(var a=null,b=0;b<m;b++){var c=new h(this.mod);if(c.physic=new j(c,b),c.physic.setup(),c.node.setScale(c.physic.sphereRadius),this.node.add(c.node),this.spheres.push(c),a){var d=new CANNON.DistanceConstraint(c.physic.body,a);d.collideConnected=!1,this.world.addConstraint(d)}a=c.physic.body}},preRender:function(){for(var a=0;a<m&&this.mod.debugPhysic;a++){var b=this.spheres[a];b.physic.sync()}this.geom.preRender()},render:function(){for(var a=0;a<m&&this.mod.debugPhysic;a++){var b=this.spheres[a];b.render()}this.prg.use(),this.prg.uMVP(this.scene.camera.getMVP(this.node._wmatrix)),this.prg.uColor(this.color),this.cfg.apply(),this.geom.attribPointer(this.prg),this.geom.render()}},b.exports=d},{"../consts":69,"../gl/sphere":71,"./rope-geom":74,"./rope-sphere-physic":75,"gl-matrix":192,glslify:205,"lib/color":32,"nanogl-node":214,"nanogl/program":253}],77:[function(a,b,c){function d(a){var b=a.scene.gl;this.mod=a,this.gl=b,this.defaultOpacity=.05,this.opacity=this.defaultOpacity,this.node=new f;var c=3,d=2.5;this.plane=new g(b,-c/2,-d/2,c,d),this.prg=new e(b,h(["precision lowp float;\n#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n  vec2 p = aPosition;\n  gl_Position = uMVP * vec4( p.x, 0.0, p.y, 1.0 );\n\n  vTexCoord = aTexCoord;// * 2.0 - 1.0;\n}\n"]),h(["precision lowp float;\n#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\nuniform float uOpacity;\nuniform sampler2D tShadow;\n\nvoid main(void) {\n\n  float lum = 1.0 - texture2D( tShadow, vTexCoord ).r;\n\n  gl_FragColor = vec4( vec3( lum * uOpacity ), 1.0 );\n\n}\n"])),this.cfg=a.scene.glstate.config().enableBlend().blendFunc(b.ONE,b.ONE).enableDepthTest().depthMask(!0)}var e=a("nanogl/program"),f=a("nanogl-node"),g=a("nanogl-primitives-2d/rect"),h=a("glslify");d.prototype={setTex:function(a){this.tex=a},render:function(){this.prg.use(),this.prg.uMVP(this.mod.scene.camera.getMVP(this.node._wmatrix)),this.prg.tShadow(this.tex),this.prg.uOpacity(this.opacity),this.plane.attribPointer(this.prg),this.cfg.apply(),this.plane.render()},debug:function(a){a.add(this,"opacity",0,1,.01).name("shadow opacity")}},b.exports=d},{glslify:205,"nanogl-node":214,"nanogl-primitives-2d/rect":242,"nanogl/program":253}],78:[function(a,b,c){var d=a("lib/math").map,e=a("freeverb"),f=.7,g=.35,h=-35,i=7e3,j=5e3,k=function(a){this.mod=a,this.context=this.mod.context,this.audioContext=this.context.audioContext,this.loopSound=this.context.makeAudioSource("sounds/light-loop.mp3"),this.loopSound.mediaElement.loop=!0,this.loopSound.mediaElement.volume=f,this.loopSound.mediaElement.play(),this.highBiquadFilter=this.audioContext.createBiquadFilter(),this.highBiquadFilter.type="highshelf",this.highBiquadFilter.frequency.value=i,this.highBiquadFilter.gain.value=0,this.lowBiquadFilter=this.audioContext.createBiquadFilter(),this.lowBiquadFilter.type="lowshelf",this.lowBiquadFilter.frequency.value=j,this.lowBiquadFilter.gain.value=0,this.reverb=e(this.audioContext),this.reverb.roomSize=.6,this.reverb.dampening=5e3,this.reverb.dry.value=1,this.reverb.wet.value=.6,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=0,this.loopSound.connect(this.highBiquadFilter),this.highBiquadFilter.connect(this.lowBiquadFilter),this.lowBiquadFilter.connect(this.reverb),this.reverb.connect(this.gainNode),this.gainNode.connect(this.context.audioOutput)};k.prototype={debug:function(a){var b=a.addFolder("sound"),c=b.addFolder("high biquad filter");c.add(this.highBiquadFilter.frequency,"value",0,15e3,1).name("frequency"),c.add(this.highBiquadFilter.gain,"value",-h,h,.1).name("gain");var d=b.addFolder("low biquad filter");d.add(this.lowBiquadFilter.frequency,"value",0,15e3,1).name("frequency"),d.add(this.lowBiquadFilter.gain,"value",-h,h,.1).name("gain");var e=b.addFolder("reverb");e.add(this.reverb,"roomSize",0,1,.01).name("room size"),e.add(this.reverb,"dampening",0,2e4,1).name("dampening"),e.add(this.reverb.wet,"value",0,1,.01).name("wet"),e.add(this.reverb.dry,"value",0,1,.01).name("dry")},update:function(){this.gainNode.gain.value=Math.min(1,Math.max(g,this.mod.intensity)),this.highBiquadFilter.gain.value=d(this.mod.intensity,0,.6,h,0),this.lowBiquadFilter.gain.value=d(this.mod.intensity,0,.6,0,h)},stop:function(){this.loopSound.disconnect(),this.highBiquadFilter.disconnect(),this.lowBiquadFilter.disconnect(),this.reverb.disconnect(),this.gainNode.disconnect()}},b.exports=k},{freeverb:187,"lib/math":49}],79:[function(a,b,c){function d(a){this.context=a,this.scene=a.scene,this.onLoadComplete=this._onLoadComplete.bind(this),this.onLoadProgress=this._onLoadProgress.bind(this),this.section=document.getElementById("section-loading"),this.spinner=new i(document.getElementsByClassName("spinner")[0]),this.showProgress=0,this.letters=new f(this,"intro"),this.scene.sroot.add(this.letters.node),this._pos=1}function e(a){return new d(a)}var f=a("../text/letters"),g=a("lib/math"),h=a("lib/ease"),i=a("ui/spinner"),j=g.clamp,k=function(){};d.prototype={
setPosition:function(a){this._pos=a},getLoadables:function(){var a=[];return a=a.concat(this.letters.getLoadables())},start:function(){this.section.style.display="block",this.spinner.start(),this.spinner.show(),this.scene.loadPromise.then(this.onLoadComplete,null,this.onLoadProgress)},stop:function(){this.spinner.stop(),this.section.style.display="none"},_onLoadComplete:function(){this.spinner.hide()},_onLoadProgress:function(a){},rttPass:k,postRender:k,preRender:function(){this.showProgress+=this.scene.dt/4,this.showProgress=j(this.showProgress);var a=j(1.7*(this.showProgress-.3));this.letters.alpha=j(a)-j(Math.abs(7*this._pos)),this.letters.blur=1-j(a),this.letters.spread=h.easeInOutCubic(1-j(a)),this.letters.preRender()},render:function(){this.letters.render(2)},getCameraPosition:function(a,b){}},b.exports=e},{"../text/letters":154,"lib/ease":33,"lib/math":49,"ui/spinner":166}],80:[function(a,b,c){function d(a){this._onNextSection=this._onNextSection.bind(this),this.context=a,this.scene=a.scene,this.section=document.getElementById("section-outro");var b=BrowserDetect.isDesktop?document.getElementById("bigyear"):document.getElementById("bigyear-mobile");this.lines=new h(b),this._pos=1,g.on("next_section",this._onNextSection),this.activate()}function e(a){return new d(a)}var f=(a("../text/letters"),a("lib/math")),g=a("./../../ui"),h=(a("lib/ease"),a("ui/svg-line-animations")),i=(a("./mixins/replay_interaction"),f.clamp),j=function(){};d.prototype={activate:function(){var a=this,b=[this.section.querySelector(".btn-replay"),this.section.querySelector(".socials .facebook"),this.section.querySelector(".socials .twitter"),this.section.querySelector(".socials .instagram")];b.forEach(function(b){b.addEventListener("mouseenter",a._onMouseEnter),b.addEventListener("mouseleave",a._onMouseLeave)})},setPosition:function(a){this._pos=a},getLoadables:function(){var a=[];return a},start:function(){this.byp=1},stop:function(){this.section.style.display="none"},rttPass:j,postRender:j,preRender:function(){this.lines.setProgress(i(Math.abs(1.3*this._pos)))},render:function(){},getCameraPosition:function(a,b){},_onMouseEnter:function(a){g.dispatch("attach_mouse",1.2)},_onMouseLeave:function(){g.dispatch("detach_mouse")},_onNextSection:function(){if(6===this.scene.model.getSection()){this.section.style.display="block";var a=this;TweenLite.delayedCall(1,function(){var b=a.section.querySelector(".section-outro__content");b.classList.remove("hidden")}),TweenLite.delayedCall(1.5,function(){var b=a.section.querySelector(".socials");b.classList.remove("hidden")}),TweenLite.delayedCall(2,function(){var b=a.section.querySelector(".btn-replay");b.classList.remove("hidden")})}}},b.exports=e},{"../text/letters":154,"./../../ui":158,"./mixins/replay_interaction":81,"lib/ease":33,"lib/math":49,"ui/svg-line-animations":167}],81:[function(a,b,c){"use strict";function d(a,b,c){var d=b[0]-c[0],e=b[1]-c[1],f=Math.sqrt(d*d+e*e);a[0]=d/f,a[1]=e/f}function e(a,b){a[0]*=b,a[1]*=b}var f=a("../../../ui"),g=a("../../../ui/mouse"),h=[0,0],i=[0,0],j=[0,0],k=[0,0],l=0,m=.33,n=l,o=l,p=!1,q={top:0,left:0,right:0,bottom:0,width:0,height:0},r=new g;b.exports={_activateReplay:function(){this._onReplayEnter=this._onReplayEnter.bind(this),this._onReplayLeave=this._onReplayLeave.bind(this),this.$replayBtn=this.section.querySelector(".btn-replay"),this.$replayBtnSVG=this.section.querySelector(".btn-replay svg"),this.$replayBtnSPAN=this.section.querySelector(".btn-replay span"),this.$replayBtnSVG.addEventListener("mouseenter",this._onReplayEnter),this.$replayBtnSVG.addEventListener("mouseleave",this._onReplayLeave)},_desactivateReplay:function(){this.$replayBtnSVG.removeEventListener("mouseenter",this._onReplayEnter),this.$replayBtnSVG.removeEventListener("mouseleave",this._onReplayLeave),q=null},_onReplayEnter:function(){f.dispatch("attach_mouse",2.4),p=!0,q=this.$replayBtn.getBoundingClientRect(),n=m},_onReplayLeave:function(){f.dispatch("detach_mouse"),p=!1,j[0]=0,j[0]=0,n=l},_onReplayUpdate:function(){p&&(i[0]=r.x||0,i[1]=r.y||0,h[0]=q.left+.5*q.width,h[1]=q.top+.5*q.height,d(j,h,i),e(j,-2)),k[0]+=.25*(j[0]-k[0]),k[1]+=.25*(j[1]-k[1]),o+=.25*(n-o),this.$replayBtnSPAN.style.transform="scaleX("+(1+o)+") scaleY("+(1+o)+")",this.$replayBtn.style.webkitTransform="matrix(1, 0, 0, 1, "+k[0]+", "+k[1]+")",this.$replayBtn.style.transform="matrix(1, 0, 0, 1, "+k[0]+", "+k[1]+")"}}},{"../../../ui":158,"../../../ui/mouse":160}],82:[function(a,b,c){function d(a){this.gl=a,this.allocate()}var e=a("nanogl/arraybuffer"),f=a("nanogl/indexbuffer"),g=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],h=[0,1,2,0,2,3];d.prototype={allocate:function(){var a=this.gl;this.vertices=new Float32Array(g),this.indices=new Uint16Array(h),this.buffer=new e(a),this.buffer.data(this.vertices),this.buffer.attrib("aPosition",3,a.FLOAT),this.ibuffer=new f(a,a.UNSIGNED_SHORT),this.ibuffer.data(this.indices)},bind:function(a){this.buffer.attribPointer(a),this.ibuffer.bind()},render:function(){this.ibuffer.drawTriangles()}},b.exports=d},{"nanogl/arraybuffer":249,"nanogl/indexbuffer":252}],83:[function(a,b,c){function d(a,b){a.scene.gl;this.color=b,this.prg=a.programs.frame,this.cfg=a.scene.glstate.config().enableCullface(!0).enableDepthTest(!0).enablePolygonOffset().polygonOffset(0,-1e3),this.normalMatrix=e.create()}var e=(a("nanogl/program"),a("gl-matrix").mat3),f=a("gl-matrix").mat4,g=(e.create(),f.create());d.prototype={prepare:function(a,b){var c=this.prg;c.bind();var d=a.mod.scene;this.cfg.apply(),d.camera.modelViewProjectionMatrix(g,a._wmatrix),c.uMVP(g),c.uColor(this.color),c.uTime(b)}},b.exports=d},{"gl-matrix":192,"nanogl/program":253}],84:[function(a,b,c){function d(a){this.gl=a,this.allocate()}var e=a("nanogl/arraybuffer"),f=a("nanogl/indexbuffer"),g=[-.8359375,-1,0,0,0,.8359375,-1,0,1,0,.8359375,1,0,1,1,-.8359375,1,0,0,1],h=[0,1,2,0,2,3];d.prototype={allocate:function(){var a=this.gl;this.vertices=new Float32Array(g),this.indices=new Uint16Array(h),this.buffer=new e(a),this.buffer.data(this.vertices),this.buffer.attrib("aPosition",3,a.FLOAT),this.buffer.attrib("aTexCoord",2,a.FLOAT),this.ibuffer=new f(a,a.UNSIGNED_SHORT),this.ibuffer.data(this.indices)},bind:function(a){this.buffer.attribPointer(a),this.ibuffer.bind()},render:function(){this.ibuffer.drawTriangles()}},b.exports=d},{"nanogl/arraybuffer":249,"nanogl/indexbuffer":252}],85:[function(a,b,c){function d(a){this.mod=a;var b=a.scene.gl;this.prgFront=a.programs.sheet,this.prgBack=a.programs.back,this.cfgFront=a.scene.glstate.config().enableCullface(!0).cullFace(b.BACK).enableDepthTest(!0).enableBlend().blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),this.cfgBack=a.scene.glstate.config().enableCullface(!0).cullFace(b.FRONT).enableDepthTest(!0).enableBlend().blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),this.normalMatrix=e.create()}var e=(a("nanogl/program"),a("gl-matrix").mat3),f=a("gl-matrix").mat4,g=(e.create(),f.create());d.prototype={prepareFront:function(a){var b=this.prgFront;b.bind();var c=a.mod.scene;e.fromMat4(this.normalMatrix,a.node._matrix),this.cfgFront.apply(),c.camera.modelViewProjectionMatrix(g,a.node._wmatrix),b.uMVP(g)},prepareBack:function(a){var b=this.prgBack;b.bind();var c=a.mod.scene;e.fromMat4(this.normalMatrix,a.node._matrix),this.cfgBack.apply(),b.uTex(this.mod.polaroid.texs.get("sheet_back_DIFF")),c.camera.modelViewProjectionMatrix(g,a.node._wmatrix),b.uMVP(g)},getAssetPath:function(a){return"photo/"+a}},b.exports=d},{"gl-matrix":192,"nanogl/program":253}],86:[function(a,b,c){function d(a){this.context=a,this.scene=a.scene,this.gl=this.scene.gl,this.programs=new f(this),this.progress,this.cfg=this.scene.glstate.config().enableCullface(!1).enableDepthTest(!1).depthMask(!1);var b=BrowserDetect.isDesktop?128:64,c=BrowserDetect.isDesktop?4:2;this.gshadow=new h(this.scene,3,4,b,c),this.physic=new g(this),this.sheets=new i(this),this.polaroid=new j(this),this.flash=new k(this),a.node.add(this.gshadow.node),a.node.add(this.polaroid.node),this.soundManager=new n(a),this.onMouseClick=this._onMouseClick.bind(this),this.debug()}function e(a){return new d(a)}var f=a("./programs"),g=a("./physic"),h=a("entities/ground-shadow"),i=a("./sheets/sheets"),j=a("./polaroid/polaroid"),k=a("./polaroid/flash"),l=a("lib/mouse"),m=a("gl-matrix").vec3,n=a("./sound-manager"),o=a("dev/gui");d.prototype={setPosition:function(a){this.progress=a,a>.8&&(this.preRender(),this.render())},getLoadables:function(){return[].concat(this.polaroid.getLoadables())},start:function(){this.reset(),l.on("up",this.onMouseClick),this.polaroid.physic.jump([0,0,0],[0,0,0])},_onMouseClick:function(a){if(0==this.context._position){var b=m.create();this.getPolaroidProjection(b),this.flash.trigger(b);var c=this.polaroid.physic.jump(b,a);this.sheets.jump(c),this.sheets.throw(),this.soundManager.playShoot()}},getPolaroidProjection:function(a){var b=this.polaroid._polaroidMesh._wposition;m.transformMat4(a,b,this.scene.camera._viewProj)},stop:function(){l.off("up",this.onMouseClick)},reset:function(){this.sheets.reset(),this.polaroid.reset()},preRender:function(){var a=this.scene.dt;this.physic.step(a),this.sheets.preRender(),this.polaroid.preRender(),this.flash.preRender()},rttPass:function(){this.gShadowPass()},gShadowPass:function(){var a=this.scene.glstate;a.apply(),this.gshadow.prepare();var b=this.gshadow.getDefaultDepthPass();b.use(),a.push(this.gshadow.defaultCfg),a.apply(),this.sheets.renderShadowPass(b,this.gshadow.camera),this.polaroid.renderProgram(this.gshadow.camera,b),a.pop(),this.gshadow.process()},render:function(){this.gshadow.render(this.scene.camera),this.sheets.render(),this.polaroid.render(1),this.flash.render()},postRender:function(){},getCameraPosition:function(a,b){},debug:function(){var a=o.addFolder("photo");this.sheets.debug(a),this.polaroid.debug(a)}},b.exports=e},{"./physic":87,"./polaroid/flash":88,"./polaroid/polaroid":90,"./programs":91,"./sheets/sheets":96,"./sound-manager":97,"dev/gui":20,"entities/ground-shadow":23,"gl-matrix":192,"lib/mouse":50}],87:[function(a,b,c){function d(a){this.mod=a;var b=new CANNON.World;b.gravity.set(0,-.82,0),this.world=b;var c=new CANNON.Material("groundMaterial");c.friction=.2;var d=new CANNON.Body({mass:0,material:c,collisionFilterGroup:g,collisionFilterMask:-1}),e=new CANNON.Plane;d.addShape(e),d.position.z=0,d.quaternion.setFromEuler(-Math.PI/2,0,0,"XYZ"),d.name="ground",this.add(d);var f=new CANNON.Body({mass:0,collisionFilterGroup:g,collisionFilterMask:-1}),h=new CANNON.Plane;f.addShape(h),f.position.z=1.5,f.quaternion.setFromEuler(-Math.PI,0,0,"XYZ"),f.name="frontWall",this.add(f)}var e=1/60,f=3,g=1;d.prototype={step:function(a){this.world.step(e,a,f)},add:function(a){this.world.addBody(a)},remove:function(a){this.world.removeBody(a)}},b.exports=d},{}],88:[function(a,b,c){function d(a){this.mod=a,this.gl=a.scene.gl,this.scene=a.scene,this.intensity=0,this.prg=new e(this.gl,f(["precision lowp float;\n#define GLSLIFY 1\nattribute vec2 aPosition;\n// attribute vec2 aTexCoord;\n\nvarying vec2 vCoord;\n\nvoid main( void ){\n\n  gl_Position =  vec4( aPosition, 0.0, 1.0 );\n  vCoord = aPosition;\n}\n"]),f(["precision lowp float;\n#define GLSLIFY 1\n\nuniform float uIntensity;\nuniform vec2 uCenter;\n\nvarying vec2 vCoord;\n\nvoid main(){\n\n    float dist = distance(vCoord, uCenter);\n    // gl_FragColor = vec4(uIntensity );\n    gl_FragColor = vec4(uIntensity ) * (1.0-dist*.3/.5 + (uIntensity*.5));\n// }\n}"])),this.cfg=this.scene.glstate.config().enableBlend().blendFunc(this.gl.ONE,this.gl.ONE),this.center=new Float32Array(2)}var e=a("nanogl/program"),f=a("glslify"),g=(a("lib/mouse"),a("lib/math"));d.prototype={preRender:function(){this.intensity-=this.scene.dt/.3,this.intensity=g.clamp(this.intensity)},render:function(){this.intensity<=0||(this.prg.use(),this.prg.uCenter(this.center),this.prg.uIntensity(Math.pow(this.intensity,4)),this.scene.quad.attribPointer(this.prg),this.cfg.apply(),this.scene.quad.render())},trigger:function(a){this.center[0]=a[0],this.center[1]=a[1],this.intensity=1}},b.exports=d},{glslify:205,"lib/math":49,"lib/mouse":50,"nanogl/program":253}],89:[function(a,b,c){function d(a,b){this.mod=b,this.renderable=a,this.body=null}var e=1,f=2,g=(a("gl-matrix").quat,1.4),h=1,i=1,j=function(){},k=-2*Math.PI/3,l=0,m=0,n=.09*g,o=0,p=new CANNON.Vec3(0,0,0),q=!1;d.prototype.setup=function(){var a=this.renderable.mod.physic,b=a.world,c=22,d=new CANNON.Body({mass:c,collisionFilterGroup:f,collisionFilterMask:e}),h=new CANNON.Box(new CANNON.Vec3(.1*g,.06*g,.08*g));d.addShape(h),d.linearDamping=.3,this.body=d,this.body.quaternion.setFromEuler(0,k,0,"XYZ"),this.body.position.y=n,this.body.position.z=o,this.body.addEventListener("collide",this.onCollide.bind(this)),b.addBody(d)},d.prototype.reset=function(){var a=this.body;a.position.set(0,n,o);var b=l,c=m,d=k;a.quaternion.setFromEuler(b,d,c,"XYZ")},d.prototype.sync=function(){var a=this.renderable._polaroidMesh,b=a.rotation,c=a.position,d=this.body.quaternion,e=this.body.position;b[0]=d.x,b[1]=d.y,b[2]=d.z,b[3]=d.w,c[0]=e.x,c[1]=e.y,c[2]=e.z,a.invalidate()},d.prototype.jump=function(a,b){q=!1;var c=b[0]-a[0],d=(b[1]-a[1],c<0?1:-1),e=1*-c;e+=Math.random()*d,e*=2+2*Math.random(),h*=Math.random()<.5?1:-1,i=i<0?1:-1,i+=Math.random()*i;var f=.5+2*Math.random(),g=Math.random()<.5?.1:-.05;return p.set(this.body.position.x,this.body.position.y,this.body.position.z+g),this.body.applyImpulse(new CANNON.Vec3(2*h+.5*Math.random(),f,0),p),{impulse:[h,f,i],center:this.body.position}},d.prototype.onCollide=function(a){"ground"===a.body.name&&(q=!0,this.mod.soundManager.playHit())},d.prototype.onTouchedGround=j,b.exports=d},{"gl-matrix":192}],90:[function(a,b,c){function d(a){this.mod=a,this.scene=a.scene,this.gl=this.scene.gl,f.call(this,this.scene,"polaroid"),this.gravityScale=-(200+500*Math.random()),this.physic=new h(this,this.mod),this.physic.setup(),this.setupMaterials()}var e=a("nanogl-pbr/standard"),f=a("assets/awd-scene"),g=a("lib/color"),h=(a("../../common/box-mesh"),a("./polaroid-physic")),i=new CANNON.Vec3(0,0,0);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.getLoadables=function(){var a=f.prototype.getLoadables.call(this);return a},d.prototype.getAssetPath=function(a){return"photo/"+a},d.prototype.getTexturePath=function(a){return"photo/"+a},d.prototype.getAwdUrl=function(){return this.getAssetPath("scene.awd")},d.prototype.setupMaterials=function(){var a=this.mats,b=this.texs;b.makeTex("polaroid_OCCLU",this.getAssetPath("polaroid_OCCLU.jpg")).setFilter(!0,!1,!1),b.makeTex("polaroid_NRM",this.getAssetPath("polaroid_NRM.jpg")).setFilter(!0,!0,!1),b.makeTex("polaroid_DIFF",this.getAssetPath("polaroid_DIFF.jpg")).setFilter(!0,!1,!1),b.makeTex("sheet_back_DIFF",this.getAssetPath("sheet_back_DIFF.jpg")).setFilter(!0,!0,!1);var c=new e(this.gl);c._precision="highp",c.setIBL(this.scene.env.ibl),c.albedo=c.iAlbedo.attachSampler("tColor","vTexCoord"),c.albedo.set(b.get("polaroid_DIFF")),c.gloss=c.iGloss.attachUniform("uGloss"),c.specular=c.iSpecular.attachUniform("uSpecular"),c.normal=c.iNormal.attachSampler("tNormal","vTexCoord"),c.normal.set(b.get("polaroid_NRM")),c.occlu=c.iCavity.attachSampler("tOcclusion","vTexCoord"),c.iCavityStrength.attachConstant([1,1]),c.occlu.set(b.get("polaroid_OCCLU")),g.HexInput(c.specular,4210752),c.gloss.set(.3),c.conserveEnergy.set(!1),c.perVertexIrrad.set(!1),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"boitier"),c=new e(this.gl),c._precision="highp",c.setIBL(this.scene.env.ibl),c.albedo=c.iAlbedo.attachUniform("uColor"),c.gloss=c.iGloss.attachUniform("uGloss"),c.specular=c.iSpecular.attachUniform("uSpecular"),c.normal=c.iNormal.attachSampler("tNormal","vTexCoord"),c.normal.set(b.get("polaroid_NRM")),c.occlu=c.iCavity.attachSampler("tOcclusion","vTexCoord"),c.iCavityStrength.attachConstant([1,1]),c.occlu.set(b.get("polaroid_OCCLU")),g.HexInput(c.albedo,0),g.HexInput(c.specular,2105376),c.gloss.set(1),c.conserveEnergy.set(!1),c.perVertexIrrad.set(!1),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"glass")},d.prototype.preRender=function(){f.prototype.preRender.apply(this,arguments),this.mod.progress<0&&(i.set(0,this.gravityScale*this.mod.progress,0),this.physic.body.applyForce(i,this.physic.body.position)),this.physic.sync()},d.prototype.render=function(){f.prototype.render.apply(this,arguments)},d.prototype._postParse=function(){this._polaroidMesh=this.loader.getObjectByName("boitier"),this._polaroidMesh.setScale(1.4),this.physic.sync()},d.prototype.debug=function(a){},d.prototype.reset=function(){this.physic.reset()},b.exports=d},{"../../common/box-mesh":59,"./polaroid-physic":89,"assets/awd-scene":1,"lib/color":32,"nanogl-pbr/standard":239}],91:[function(a,b,c){function d(a){var b=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT),c=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT);return c.precision>0&&b.precision>0}function e(a){var b=a.gl;this.hasHighp=d(b),this.programs=[this.sheet=new f(b),this.debug=new f(b),this.frame=new f(b),this.back=new f(b)],this.compile()}var f=a("nanogl/program"),g=a("glslify");e.prototype={precision:function(){return this.hasHighp?"highp":"mediump"},compile:function(){var a="\n";a+="precision "+this.precision()+" float;\n",this.sheet.compile(g(["#define GLSLIFY 1\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\n\nvarying vec2 vTexCoord;\n\nvoid main(){\n\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n\n  vTexCoord = aTexCoord;\n  \n}"]),g(["#define GLSLIFY 1\nvoid main(){\n\n  gl_FragColor = vec4( 1.0 );\n}"]),a),this.debug.compile(g(["#define GLSLIFY 1\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\n\nvoid main(){\n\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n}"]),g(["#define GLSLIFY 1\nvoid main(){\n    gl_FragColor = vec4( 1.0,0.0,0.0,.5 );\n}"]),a),this.frame.compile(g(["#define GLSLIFY 1\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\nvoid main(){\n\n  gl_Position = uMVP * vec4( aPosition, 1.0 );  \n}"]),g(["#define GLSLIFY 1\nuniform float uTime;\nuniform vec3 uColor;\n\nvoid main(){\n  vec3 finalColor =  mix(vec3(0.0), uColor, uTime);\n\n  gl_FragColor = vec4( finalColor , 1.0 );\n}"]),a),this.back.compile(g(["#define GLSLIFY 1\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\n\nvarying vec2 vTexCoord;\n\nvoid main(){\n\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n\n  vTexCoord = aTexCoord;\n  \n}"]),g(["#define GLSLIFY 1\nuniform sampler2D uTex;\n\nvarying vec2 vTexCoord;\n\nvoid main(){\n\n  gl_FragColor = vec4( texture2D(uTex,vTexCoord).rgb, 1.0);\n}"]),a),this.process()},process:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].use()},dispose:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].dispose();this.programs=null}},b.exports=e},{glslify:205,"nanogl/program":253}],92:[function(a,b,c){function d(a){e.call(this),this.mod=a,this.gl=this.mod.scene.gl,this.geometry=new f(this.gl),this.material=new g(this.mod,h[Math.floor(Math.random()*h.length)])}var e=a("nanogl-node"),f=a("../gl/frame-geometry"),g=a("../gl/frame-material"),h=[[234/255,187/255,107/255],[223/255,165/255,.4],[212/255,144/255,97/255]];d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.render=function(a){this.material.prepare(this,a),this.geometry.bind(this.material.prg),this.geometry.render()},b.exports=d},{"../gl/frame-geometry":82,"../gl/frame-material":83,"nanogl-node":214}],93:[function(a,b,c){function d(a){this.mod=a,this.nbEntities=0,this.entities=[]}var e=a("./sheet");d.prototype={init:function(a){this.nbEntities=a;for(var b=0;b<this.nbEntities;b++){var c=new e(this.mod,!1);c.node.z=-2,c.node.setScale(.1),this.mod.context.node.add(c.node),this.entities.push(c)}},getEntity:function(){var a=this.entities[0];return this.entities.splice(0,1),a},releaseEntity:function(a){a.reset(),this.entities.push(a)}},b.exports=d},{"./sheet":95}],94:[function(a,b,c){function d(a){this.renderable=a,this.body=null}var e=1,f=4;d.prototype={setup:function(){var a=this.renderable.mod.physic,b=a.world,c=new CANNON.Material("sheetMaterial");c.friction=.2;var d=.018,g=new CANNON.Body({mass:d,material:c,sleepTimeLimit:.001,sleepSpeedLimit:1,collisionFilterGroup:f,collisionFilterMask:e}),h=new CANNON.Box(new CANNON.Vec3(.08359375,.1,.001));g.addShape(h);var i=0,j=1+Math.random(),k=.4*-Math.random()+.2;g.position.set(i,j,k),g.linearDamping=.3,this.body=g,b.addBody(g)},reset:function(){var a=0,b=1+Math.random(),c=.4*-Math.random()+.2;this.body.position.set(a,b,c),rx=Math.random()<.3?.5*-Math.PI:.5*Math.PI,ry=2*-Math.PI*Math.random()*.1,rz=2*-Math.PI*Math.random()*.1,this.body.quaternion.setFromEuler(rx,ry,rz,"XYZ")},sync:function(){var a=this.renderable.node,b=a.rotation,c=a.position,d=this.body.quaternion,e=this.body.position;b[0]=d.x,b[1]=d.y,b[2]=d.z,b[3]=d.w,c[0]=e.x,c[1]=e.y,c[2]=e.z,a.invalidate()}},b.exports=d},{}],95:[function(a,b,c){function d(a,b){this.mod=a,this.node=new e,this.isStart=b,this.geometry=null,this.material=null,this.gravityScale=-(.2+.5*Math.random()),this.physic=null,this.isVisible=!1,this.frame=new i(this.mod),this.frame.y=.15,this.frame.setScale(.7),this.node.add(this.frame),this.startTime=-6e3+2e3*Math.random(),this.elapsedTime=0,this.endTime=2e3,this._uid=Math.random(),this.setup()}var e=a("nanogl-node"),f=a("../gl/sheet-geometry"),g=a("../gl/sheet-material"),h=a("./sheet-physic"),i=a("./frame"),j=a("gl-matrix").mat4,k=a("gl-matrix").vec3,l=j.create(),m=(k.create(),1),n=2,o=4,p=new CANNON.Vec3(0,0,0);d.prototype={setup:function(){this.mod.gl;this.geometry=new f(this.mod.gl),this.material=new g(this.mod),this.physic=new h(this),this.physic.setup()},reset:function(){this.startTime=-8e4+5e4*Math.random(),this.elapsedTime=0,this.physic.reset(),this.physic.sync()},preRender:function(){this.mod.progress<0&&(p.set(0,this.gravityScale*this.mod.progress,0),this.physic.body.applyForce(p,this.physic.body.position));var a=this.mod.scene.dt;this.elapsedTime+=1e3*a,this.elapsedTime=Math.max(Math.min(this.elapsedTime,this.endTime),1e3),this.physic.sync()},render:function(){var a=this.isStart?1:this.elapsedTime/this.endTime;this.frame.render(Math.pow(a,2)),this.material.prepareFront(this),this.geometry.bind(this.material.prgFront),this.geometry.render(),this.material.prepareBack(this),this.geometry.bind(this.material.prgBack),this.geometry.render()},renderShadowPass:function(a,b){j.scale(l,this.node._wmatrix,[.7*.8359375,.7,.7]),a.uMVP(b.getMVP(l)),this.geometry.bind(a),this.geometry.render()},collideWidthPolaroid:function(){this.physic.body.collisionFilterMask=m|n|o}},b.exports=d},{"../gl/sheet-geometry":84,"../gl/sheet-material":85,"./frame":92,"./sheet-physic":94,"gl-matrix":192,"nanogl-node":214}],96:[function(a,b,c){function d(a){this.mod=a,this.scene=a.scene,this.nbSheets=k,this.sheets=[],this.startSheets=[],this.pool=new j(this.mod),this.setup()}var e=a("gl-matrix").mat4,f=a("gl-matrix").quat,g=a("gl-matrix").vec3,h=a("nanogl-node/math"),i=a("./sheet"),j=a("./pool"),k=(a("lib/mouse"),BrowserDetect.isDesktop?50:10),l=e.create(),m=f.create(),n=g.create(),o=g.create(),p=.04,q=new CANNON.Vec3(0,p,0),r=new CANNON.Vec3(0,0,0),s=[{p:[-.3,0,.1],r:[.5*-Math.PI,0,.6*Math.PI]},{p:[-.1,0,.35],r:[.5*-Math.PI,0,.3*Math.PI]},{p:[.15,0,.3],r:[.5*-Math.PI,0,0]}];d.prototype={setup:function(){this.pool.init(k);for(var a=0;a<s.length;a++){var b=new i(this.mod,!0);b.node.z=1,b.node.setScale(.1);var c=s[a].p,d=s[a].r,e=b.physic.body.position,f=b.physic.body.quaternion;e.x=c[0],e.y=c[1],e.z=c[2],f.setFromEuler(d[0],d[1],d[2],"XYZ"),this.mod.context.node.add(b.node),this.startSheets.push(b),b.physic.sync(),b.collideWidthPolaroid()}},throw:function(){var a=this.getSheet();this.sheets.push(a);var b=(this.mod.context,this.mod.polaroid._polaroidMesh),c=(a.node.rotation,a.node.position,a.physic.body.quaternion),d=a.physic.body.position;e.identity(l),e.rotateX(l,l,.5*-Math.PI),e.rotateZ(l,l,.5*-Math.PI),l[12]=.07,l[13]=-.05,e.multiply(l,b._matrix,l),h.decomposeMat4(l,n,m,o),c.x=m[0],c.y=m[1],c.z=m[2],c.w=m[3],d.x=n[0],d.y=n[1],d.z=n[2],a.physic.body.velocity=new CANNON.Vec3(0,0,0),a.physic.body.applyLocalImpulse(q,r),a.collideWidthPolaroid()},getSheet:function(){if(0===this.pool.entities.length){var a=this.sheets[0];this.pool.releaseEntity(a),this.sheets.splice(0,1)}var b=this.pool.getEntity();return b},jump:function(a){if(a&&a.impulse)for(var b=0;b<this.sheets.length;b++){this.sheets[b],3e-4*a.impulse[0]*Math.random(),3e-4*a.impulse[1]*Math.random()}},reset:function(){for(var a=0;a<this.sheets.length;a++){var b=this.sheets[a];b.reset()}},preRender:function(){for(var a=0;a<this.sheets.length;a++){var b=this.sheets[a];b.preRender()}for(var a=0;a<this.startSheets.length;a++){var b=this.startSheets[a];b.preRender()}},render:function(){for(var a=0;a<this.sheets.length;a++){var b=this.sheets[a];b.render()}for(var a=0;a<this.startSheets.length;a++){var b=this.startSheets[a];b.render()}},renderShadowPass:function(a,b){for(var c=0;c<this.sheets.length;c++){var d=this.sheets[c];d.renderShadowPass(a,b)}for(var c=0;c<this.startSheets.length;c++){var d=this.startSheets[c];d.renderShadowPass(a,b)}},debug:function(a){a.add(this,"nbSheets",1,k).onChange(this.reset.bind(this)),a.add(this,"reset")}},b.exports=d},{"./pool":93,"./sheet":95,"gl-matrix":192,"lib/mouse":50,"nanogl-node/math":213}],97:[function(a,b,c){function d(a){this.context=a,this.prevShootSound=null,this.soundPool=[],this.hitSounds=[];for(var b=0;b<e.length;b++)a.makeAudioBufferSource(e[b]).then(function(a){this.hitSounds.push(a)}.bind(this));this.shootSounds=[];for(var b=0;b<f.length;b++)a.makeAudioBufferSource(f[b]).then(function(a){this.shootSounds.push(a)}.bind(this))}var e=["sounds/polaroid-hit-01.mp3","sounds/polaroid-hit-02.mp3","sounds/polaroid-hit-03.mp3","sounds/polaroid-hit-04.mp3","sounds/polaroid-hit-05.mp3"],f=["sounds/polaroid-shoot-01.mp3","sounds/polaroid-shoot-02.mp3","sounds/polaroid-shoot-03.mp3","sounds/polaroid-shoot-04.mp3"],g=0,h=0;d.prototype={playHit:function(){var a=this.hitSounds[h];a&&(a.volume(.5+.5*Math.random()),a.play(),h++,h%=e.length)},playShoot:function(){var a=this.shootSounds[g];a.volume(.7),a.play(),g++,g%=f.length}},b.exports=d},{}],98:[function(a,b,c){function d(a,b,c,d){return a[0]=d*(Math.sin(c)*Math.sin(b)),a[1]=d*Math.cos(c),a[2]=d*(Math.sin(c)*Math.cos(b)),a}function e(a){var b=a.scene.gl;this.mod=a,this.gl=b,this.node=new g,this.node.setScale(2),this.buffer=new h(b),this.buffer.attrib("aPosition",3,b.FLOAT),this.buffer.attrib("aScale",1,b.FLOAT),this.buffer.attrib("aScaleDelay",1,b.FLOAT),this.setupBuffer(),this.prg=new f(b,i(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec3 aPosition;\nattribute float aScale;\nattribute float aScaleDelay;\n\nuniform mat4 uMVP;\nuniform float uTime;\n\nvoid main( void ){\n\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n\n  gl_PointSize = max( aScale * 20.0 * sin( uTime * 0.5 + aScaleDelay ), 0.0 );\n\n}"]),i(["precision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D tAlbedo;\n\nvoid main(void){\n\n  vec3 color = texture2D( tAlbedo, gl_PointCoord ).rgb;\n\n  gl_FragColor = vec4( color, 1.0 );\n\n}\n"])),this.cfg=a.scene.glstate.config().enableBlend().blendFunc(b.ONE,b.ONE).enableDepthTest().depthMask(!1),this.time=0}var f=a("nanogl/program"),g=a("nanogl-node"),h=a("nanogl/arraybuffer"),i=(a("nanogl-primitives-2d/rect"),a("glslify")),j=(a("gl-matrix").quat,a("lib/math").clamp,a("lib/math").map,a("gl-matrix").vec3);a("dev/gui");e.prototype={setupBuffer:function(){for(var a=100,b=new Float32Array(5*a),c=j.create(),e=!0,f=Math.floor(20*Math.random()),g=0,h=0,i=0,k=100*Math.random(),l=0;l<a;l++){g>=f&&(e=!0),e&&(e=!1,h=Math.random()*Math.PI*2,i=Math.PI/2+(Math.random()*Math.PI/4-Math.PI/8),f=Math.floor(5+5*Math.random()),g=0,k=Math.random()*Math.PI*4),g+=1;d(c,h+.1*Math.random()-.05,i+.1*Math.random()-.05,.8+.1*Math.random()),b.set([c[0],c[1],c[2],Math.random()+1,k],5*l)}this.buffer.data(b)},preRender:function(a){this.node.rotateY(.1*-a),this.time+=a},setTex:function(a){this.tex=a},render:function(){this.prg.use(),this.prg.uMVP(this.mod.scene.camera.getMVP(this.node._wmatrix)),this.prg.tAlbedo(this.tex),this.prg.uTime(this.time),this.buffer.attribPointer(this.prg),this.cfg.apply(),this.buffer.drawPoints()}},b.exports=e},{"dev/gui":20,"gl-matrix":192,glslify:205,"lib/math":49,"nanogl-node":214,"nanogl-primitives-2d/rect":242,"nanogl/arraybuffer":249,"nanogl/program":253}],99:[function(a,b,c){function d(a,b,c,d){f.call(this,a),this.cubeData=g(b,c,d),this.parseData(this.cubeData);var h=e;this.data(h),this.attrib("aPosition",3,a.FLOAT),this.attrib("aTexCoord",2,a.FLOAT),this.attrib("aNormal",3,a.FLOAT),this.attrib("aTriangleIndex",1,a.FLOAT)}var e,f=a("nanogl/arraybuffer"),g=a("primitive-cube");d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.parseData=function(a){e=new Float32Array(3*a.cells.length*9);for(var b=0,c=0;c<a.cells.length;c++)for(var d=(a.positions[f],0);d<3;d++){var f=a.cells[c][d];e[b]=a.positions[f][0],e[b+1]=a.positions[f][1],e[b+2]=a.positions[f][2],e[b+3]=a.uvs[f][0],e[b+4]=a.uvs[f][1],e[b+5]=a.normals[f][0],e[b+6]=a.normals[f][1],e[b+7]=a.normals[f][2],e[b+8]=c,b+=9}},d.prototype.render=function(){this.drawTriangles()},b.exports=d},{"nanogl/arraybuffer":249,"primitive-cube":256}],100:[function(a,b,c){function d(a){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iAlbedo=this.inputs.add(new h("albedo",3)),this.iSpecular=this.inputs.add(new h("specular",3)),this.iGloss=this.inputs.add(new h("gloss",1)),this.iNormal=this.inputs.add(new h("normal",3)),this.iOcclusion=this.inputs.add(new h("occlusion",1)),this.iCavity=this.inputs.add(new h("cavity",1)),this.iCavityStrength=this.inputs.add(new h("cavityStrength",2)),this.iEmissive=this.inputs.add(new h("emissive",1)),this.iEmissiveScale=this.inputs.add(new h("emissiveScale",1)),this.iFresnel=this.inputs.add(new h("fresnel",3)),this.conserveEnergy=this.inputs.add(new i("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new i("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new i("glossNearest",!1)),this.tonemap=this.inputs.add(new i("tonemap",!0)),this.config=new e,this._prgcache=g.getCache(a),this._uid="fil",this._precision="highp",this._vertSrc=f(['#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nattribute vec3 aTangent;\nattribute vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\nvarying mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  varying mediump vec3 vWorldTangent;\n  varying mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n    #if HAS_iblExpo\n      vIrradiance = iblExpo().x * pow( vIrradiance, vec3( iblExpo().y ) );\n    #endif\n  #endif\n\n  vTexCoord = aTexCoord;\n}']),
this._fragSrc=f(['#define GLSLIFY 1\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\nuniform vec3 uCameraPosition;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\nvarying mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  varying mediump vec3 vWorldTangent;\n  varying mediump vec3 vWorldBitangent;\n#endif\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n// INCLUDES\n// =========\n\nvec2 octwrapDecode( vec3 v ) {\n  // Project the sphere onto the octahedron, and then onto the xy plan\n  vec2 p = v.xy / dot(  abs( v ) , vec3(1.0) );\n  p = vec2( p.x+p.y-1.0, p.x-p.y );\n\n  if( v.z < 0.0 )\n    p.x *= -1.0;\n\n  // p.x *= sign( v.z );\n  return p;\n}\n\nvec3 decodeRGBE( vec4 hdr ){\n  return hdr.rgb * exp2( (hdr.a*255.0)-128.0 );\n  // return hdr.rgb * pow( 2.0, (hdr.a*255.0)-128.0 );\n}\n\nconst vec2 _IBL_UVM_2281831123 = vec2(\n  0.25*(254.0/256.0),\n  0.125*0.5*(254.0/256.0)\n);\n\nvec3 SpecularIBL( sampler2D tEnv, vec3 skyDir, float roughness)\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  float r7   = 7.0*roughness;\n  float frac = fract(r7);\n\n  uvA = uvA * _IBL_UVM_2281831123 + vec2(\n      0.5,\n      0.125*0.5 + 0.125 * ( r7 - frac )\n    );\n\n  #if glossNearest\n\n    return decodeRGBE( texture2D(tEnv,uvA) );\n\n  #else\n\n    vec2 uvB=uvA+vec2(0.0,0.125);\n    return  mix(\n      decodeRGBE( texture2D(tEnv,uvA) ),\n      decodeRGBE( texture2D(tEnv,uvB) ),\n      frac\n    );\n\n  #endif\n\n}\n\nfloat map(float value, float inMin, float inMax, float outMin, float outMax) {\n  return outMin + (outMax - outMin) * (value - inMin) / (inMax - inMin);\n}\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n// ------------------------------\n//\nvec3 toneMap(vec3 c){\n  vec3 sqrtc = sqrt( c );\n  return(sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n}\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef=SampleSH(worldNormal, uSHCoeffs );\n    #if HAS_iblExpo\n      diffuseCoef = iblExpo().x * pow( diffuseCoef, vec3( iblExpo().y ) );\n    #endif\n  #endif\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n  #if HAS_iblExpo\n    specularColor = iblExpo().x * pow( specularColor, vec3( iblExpo().y ) );\n  #endif\n\n  #pragma SLOT lightsf\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n  #if HAS_cavity\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  #if tonemap\n    gl_FragColor.xyz = toneMap( diffuseCoef*albedoSq + specularColor );\n  #else\n    gl_FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n  #endif\n\n  float distFactor = map( (0.65 - vWorldPosition.y), 0.0, 0.8, 0.0, 1.0 );\n  gl_FragColor.xyz *= distFactor;\n\n  gl_FragColor.a = 1.0;\n\n}'])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=a("nanogl-pbr/lib/flag"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a,this.inputs.addChunks(a.getChunks())},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.uWorldMatrix(a._wmatrix),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244,"nanogl/program":253}],101:[function(a,b,c){function d(a){this.gui=o.addFolder("planes"),this.context=a;var b=a.scene;this.scene=b,this.node=new f,this.planeScene=new h(this),this.shadow=new l(this),this.shadow.setTex(this.planeScene.texs.get("shadow")),this.planes=[],this.planeShadows=[];for(var c=null,d=null,e=0;e<g.planesCount;e++)c=new j(this),d=new m(this,c),this.planes.push(c),this.planeShadows.push(d),d.setTex(this.planeScene.texs.get("plane_shadow")),this.node.add(c.node),this.node.add(d.node);this.ribbons=[];for(var p=null,e=0;e<this.planes.length;e++)p=new k(this,this.planes[e]),this.ribbons.push(p),this.node.add(p.node);this.planeCtrl=new i(this.planes),this.node.setScale(.1),this.node.y=.2,this.shadow.node.y=-2,this.shadow.node.setScale(5),this.planeScene.node.setScale(14),this.node.add(this.planeScene.node),this.node.add(this.shadow.node),a.node.add(this.node),this.cfg=this.scene.glstate.config(),this.soundsManager=new n(a,this.planes),this.canLaunch=!1}function e(a){return new d(a)}var f=a("nanogl-node"),g=a("./model"),h=a("./plane/plane-scene"),i=a("./plane/planes-ctrl"),j=a("./plane/plane"),k=a("./plane/ribbon"),l=(a("./clouds"),a("./shadow")),m=a("./plane/plane-shadow"),n=a("./sounds-manager"),o=a("dev/gui");d.prototype={setPosition:function(a){a<.1&&a>-.1?this.canLaunch=!0:this.canLaunch=!1},getLoadables:function(){var a=this.planeScene.getLoadables();return a},start:function(){},stop:function(){this.soundsManager.stop()},rttPass:function(){},preRender:function(){var a=this.scene.dt;this.soundsManager.update(a),this.canLaunch&&this.planeCtrl.update(),this.planeScene.preRender();for(var b=0;b<this.planes.length;b++)this.planes[b].preRender(),this.planeShadows[b].preRender(),this.ribbons[b].preRender()},render:function(){for(var a=0;a<this.ribbons.length;a++)this.ribbons[a].update();this.cfg.apply();for(var a=0;a<this.planes.length;a++)this.planes[a].render(1);this.planeScene.render(1),this.shadow.render();for(var a=0;a<this.planeShadows.length;a++)this.planeShadows[a].render();for(var a=0;a<this.ribbons.length;a++)this.ribbons[a].render()},postRender:function(){},getCameraPosition:function(a,b){}},b.exports=e},{"./clouds":98,"./model":102,"./plane/plane":105,"./plane/plane-scene":103,"./plane/plane-shadow":104,"./plane/planes-ctrl":106,"./plane/ribbon":107,"./shadow":108,"./sounds-manager":109,"dev/gui":20,"nanogl-node":214}],102:[function(a,b,c){b.exports={landDelay:.7,planesCount:6,launchOnHold:!1}},{}],103:[function(a,b,c){function d(a){this.mod=a,this.scene=a.scene,this.gl=this.scene.gl,h.call(this,this.scene,"plane");this.gl,this.scene;this.setupMaterials()}var e=(a("nanogl/program"),a("nanogl-node"),a("../gl/cube-geom"),a("glslify"),a("nanogl-pbr/standard")),f=a("../gl/fil-material"),g=a("lib/color"),h=a("assets/awd-scene"),i=a("gl-matrix").mat3,j=a("gl-matrix").mat4,k=a("gl-matrix").quat,l=a("gl-matrix").vec3,m=(l.create(),l.create());m[2]=1;j.create(),k.create(),l.create(),l.create(),k.create(),k.create(),j.create(),j.create(),i.create(),i.create();d.prototype=Object.create(h.prototype),d.prototype.constructor=d,d.prototype.getLoadables=function(){var a=h.prototype.getLoadables.call(this);return a},d.prototype.planeMesh=function(){return this._planeMesh},d.prototype.getAssetPath=function(a){return"planes/"+a},d.prototype.getTexturePath=function(a){return"planes/"+a},d.prototype.getAwdUrl=function(){return this.getAssetPath("scene.awd")},d.prototype.setupMaterials=function(){var a=this.mats,b=this.texs;a.lib;b.makeTex("plane_OCCLU",this.getAssetPath("plane_OCCLU.jpg")).setFilter(!0,!1,!1),b.makeTex("plane_shadow",this.getAssetPath("plane_shadow.jpg")).setFilter(!0,!1,!1),b.makeTex("earth",this.getAssetPath("earth.jpg")).setFilter(!0,!1,!1),b.makeTex("shadow",this.getAssetPath("shadow.jpg")).setFilter(!0,!1,!1),b.makeTex("cloud",this.getAssetPath("cloud.jpg")).setFilter(!0,!1,!1);var c=new e(this.gl);c._precision="highp",c.setIBL(this.scene.env.ibl),c.albedo=c.iAlbedo.attachAttribute("aColor"),c.gloss=c.iGloss.attachUniform("uGloss"),c.specular=c.iSpecular.attachUniform("uSpecular"),c.occlu=c.iCavity.attachSampler("tOcclusion","vTexCoord"),c.iCavityStrength.attachConstant([1,1]),g.HexInput(c.specular,3158064),c.gloss.set(.3),c.occlu.set(b.get("plane_OCCLU")),c.tonemap.set(!0),c.conserveEnergy.set(!1),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"plane");var c=new e(this.gl);c._precision="highp",c.setIBL(this.scene.env.ibl),c.albedo=c.iAlbedo.attachSampler("tColor","vTexCoord"),c.gloss=c.iGloss.attachUniform("uGloss"),c.specular=c.iSpecular.attachUniform("uSpecular"),g.HexInput(c.specular,3158064),c.gloss.set(.3),c.albedo.set(b.get("earth")),c.tonemap.set(!0),c.perVertexIrrad.set(!1),c.conserveEnergy.set(!1),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"globe");var c=new f(this.gl);c._precision="highp",c.setIBL(this.scene.env.ibl),c.albedo=c.iAlbedo.attachSampler("tColor","vTexCoord"),c.gloss=c.iGloss.attachUniform("uGloss"),c.specular=c.iSpecular.attachUniform("uSpecular"),g.HexInput(c.specular,3158064),c.gloss.set(.3),c.albedo.set(b.get("earth")),c.tonemap.set(!0),c.perVertexIrrad.set(!1),c.conserveEnergy.set(!1),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!1),c.config.enableBlend(),c.config.blendFunc(this.gl.ONE,this.gl.ONE),a.registerMaterial(c,"fil")},d.prototype.preRender=function(){var a=this.loader.getObjectByName("globe_mesh");a.rotateZ(.002)},d.prototype._postParse=function(){this._planeMesh=this.loader.getObjectByName("plane");var a=this.meshes.indexOf(this._planeMesh);this.meshes.splice(a,1)},b.exports=d},{"../gl/cube-geom":99,"../gl/fil-material":100,"assets/awd-scene":1,"gl-matrix":192,glslify:205,"lib/color":32,"nanogl-node":214,"nanogl-pbr/standard":239,"nanogl/program":253}],104:[function(a,b,c){function d(a,b){var c=a.scene.gl;this.mod=a,this.gl=c,this.plane=b,this.node=new f,this.node.setScale(1),this.node.rotateY(-Math.PI/2),this.node.y=-2;var d=1,i=1,j=0;this.planeBuffer=new g(c,-d/2,-i/2+j,d,i),this.prg=new e(c,h(["precision lowp float;\n#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n  vec2 p = aPosition;\n  gl_Position = uMVP * vec4( p.x, 0.0, p.y, 1.0 );\n\n  vTexCoord = aTexCoord;// * 2.0 - 1.0;\n}\n"]),h(["precision lowp float;\n#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D tShadow;\nuniform float uAlpha;\n\n// float toneMap(float c){\n//   float sqrtc = sqrt( c );\n//   return(sqrtc-sqrtc*c) + c*(0.4672*c+0.5328);\n// }\n\nvoid main(void){\n  \n  // float dist = clamp( length( vTexCoord ), 0.0, 1.0 );\n  // dist = .5*toneMap( dist ) + .5;\n  // dist = pow( dist, .5 );\n\n  float lum = .8 + .2 * ( texture2D( tShadow, vTexCoord ).g + ( 1.0 - uAlpha ) );\n  \n  gl_FragColor = vec4( vec3(lum), 1.0 );\n\n}\n"])),this.cfg=a.scene.glstate.config().enableBlend().blendFunc(c.ZERO,c.SRC_COLOR).enableDepthTest().depthMask(!1),this.spreadFactor=0}var e=a("nanogl/program"),f=a("nanogl-node"),g=a("nanogl-primitives-2d/rect"),h=a("glslify"),i=a("gl-matrix").quat,j=a("lib/math").clamp,k=a("lib/math").map;d.prototype={preRender:function(){var a=this.plane,b=a.orbitNode.rotation,c=this.node.rotation;c[0]=0,c[1]=b[1],c[2]=0,c[3]=b[3];var d=-Math.PI/2*1;d-=Math.PI/2*j(a.flyProgress)*a.direction,i.rotateY(c,c,d),this.spreadFactor=a.node.y-this.node.y-.1,this.spreadFactor=k(this.spreadFactor,0,3,0,1),this.node.x=a.node.x,this.node.z=a.node.z,this.node.setScale(a.getScaleSize()+1.2*this.spreadFactor)},setTex:function(a){this.tex=a},render:function(){(this.plane.landed||this.plane.flying)&&(this.prg.use(),this.prg.uMVP(this.mod.scene.camera.getMVP(this.node._wmatrix)),this.prg.tShadow(this.tex),this.prg.uAlpha(1-this.spreadFactor),this.planeBuffer.attribPointer(this.prg),this.cfg.apply(),this.planeBuffer.render())}},b.exports=d},{"gl-matrix":192,glslify:205,"lib/math":49,"nanogl-node":214,"nanogl-primitives-2d/rect":242,"nanogl/program":253}],105:[function(a,b,c){function d(a){this.MAX_ORBIT_Z=A,this.MIN_ORBIT_Z=B,this.node=new e,this.scene=a.scene,this.mod=a,this.orbitNode=new e,this.planeNode=new e,this.node.add(this.orbitNode),this.node.add(this.planeNode),this.orbitRot=n.create(),this.inOrbitPos=n.create(),this.landedPos=n.create(),this.grabbedPos=n.create(),this.planePosition=n.create(),this.landed=!1,this.flying=!1,this.placed=!1,this.randFlyPeriod=1e3*Math.random(),this.direction=1,this.flyProgress=0,this.grabProgress=0,this.landProgress=0,this.reset()}var e=(a("nanogl/program"),a("nanogl-node")),f=(a("glslify"),a("nanogl-pbr/standard"),a("lib/color"),a("assets/awd-scene"),a("lib/ease")),g=a("lib/mouse"),h=a("lib/math").map,i=a("event-emitter"),j=a("../model"),k=a("gl-matrix").mat3,l=a("gl-matrix").mat4,m=a("gl-matrix").quat,n=a("gl-matrix").vec3,o=a("lib/math").clamp,p=n.create(),q=l.create(),r=l.create(),s=l.create(),t=l.create(),u=l.create(),v=l.create(),w=(l.create(),k.create(),k.create(),m.create());m.rotateX(w,w,-Math.PI/2.2),m.rotateZ(w,w,-Math.PI/2);var x=m.create(),y=m.create();m.rotateX(y,y,-Math.PI),m.rotateY(y,y,-Math.PI);var z=m.create(),A=4.5,B=1.5,C=17;d.prototype={render:function(a,b){if(this.landed||this.flying){var c=this.mod.planeScene.planeMesh();c._wmatrix.set(this.node._wmatrix),c.render(this.scene,a,b)}},renderProgram:function(a,b){if(this.landed||this.flying){var c=this.mod.planeScene.planeMesh();c._wmatrix.set(this.node._wmatrix),c.renderProgram(a,b,1)}},reset:function(){this.orbitRot[0]=0,this.orbitRot[1]=.5*(Math.random()<.5?-1:1),this.orbitRot[2]=0,this.inOrbitPos[0]=0,this.inOrbitPos[1]=0,this.inOrbitPos[2]=A,this.landedPos[0]=0,this.landedPos[1]=-1.9,this.landedPos[2]=4.5,this.grabbedPos[0]=0,this.grabbedPos[1]=-1.8,this.grabbedPos[2]=8,this.scale=C,this._scale=C,this.orbitZ=A,this._orbitZ=A,this.landed=!1,this.flying=!1,this.flyProgress=0,this.grabProgress=0,this.landProgress=0,this.placed=!1,this.randFlyPeriod=1e3*Math.random(),this.randFlySpeed=.5+1.5*Math.random()},land:function(){this.landed=!0},launch:function(){this.landed=!1,this.flying=!0},lowerOrbit:function(){this.orbitZ!==B&&(this.orbitZ-=(A-B)/(j.planesCount-1),this.scale=(this.orbitZ-B)/(A-B)*17)},getOrbitSize:function(){return(this._orbitZ-B)/(A-B)},getScaleSize:function(){return this._scale/17},isFlying:function(){return this.flyProgress>0},preRender:function(){if(this.landed||this.flying){var a=this.scene.dt,b=this.orbitRot,c=this.inOrbitPos,d=this.landedPos,e=this.grabbedPos;this.landProgress+=1*a,this.landProgress=o(this.landProgress),this.landed||(this.landProgress=0),this.flyProgress+=a,this.flying||(this.flyProgress=0),g.isDown()&&!this.flying&&(this.grabProgress+=1.2*a,j.launchOnHold&&(this.grabProgress=1)),this.grabProgress=o(this.grabProgress);var i=f.easeOutQuad(this.grabProgress);if(g.isDown()&&!this.flying){this.placed=!0;var k=g.coords[0],A=g.coords[1];A=(A+1)/2,b[0]=b[0]+(.3*A-b[0])*i,b[1]=b[1]+(.3*-k-b[1])*i,j.launchOnHold&&(this.flying=!0)}g.isDown()||!this.placed||this.flying||(this.emit("flystart",this),this.flying=!0),this._orbitZ=this._orbitZ+(this.orbitZ-this._orbitZ)*a,c[2]=this._orbitZ;var B=b[1]>0?1:-1;this.direction=B;var C=Math.max(0,1.4*this.flyProgress),D=B*C,E=.2*Math.sin(.2*this.flyProgress*this.randFlySpeed);l.rotateY(r,q,-b[1]+D);var F=-Math.PI/20;F*=1-f.easeOutCubic(o(h(this.landProgress,0,.8,0,1))),l.rotateX(s,q,-b[0]+F),l.rotateZ(t,q,E),l.multiply(u,q,r),l.multiply(u,u,s),l.multiply(u,t,u),this.orbitNode.setMatrix(u);var G=o(1*this.flyProgress);G=f.easeOutQuad(G);var H=f.easeOutQuad(this.landProgress);p[0]=d[0],p[1]=d[1],p[2]=d[2]+5*(1-H),n.lerp(p,p,e,i),n.lerp(this.planePosition,p,c,G),l.translate(s,q,this.planePosition),l.multiply(v,u,s);var I=B>0?y:x,J=Math.abs(.5*Math.sin(this.flyProgress));m.rotateX(z,I,B*J);var K=o(this.flyProgress);K=f.easeOutCubic(K),m.slerp(z,w,z,K),l.fromQuat(r,z),l.multiply(v,v,r),this.node.setMatrix(v),this._scale=this._scale+(this.scale-this._scale)*a,this.node.setScale(this._scale),this._scale<=1&&this.reset()}}},i(d.prototype),b.exports=d},{"../model":102,"assets/awd-scene":1,"event-emitter":186,"gl-matrix":192,glslify:205,"lib/color":32,"lib/ease":33,"lib/math":49,"lib/mouse":50,"nanogl-node":214,"nanogl-pbr/standard":239,"nanogl/program":253}],106:[function(a,b,c){function d(a){this.planes=a,this.currentPlane=null}var e=a("../model");d.prototype={update:function(){var a=!1;this.currentPlane&&this.currentPlane.flying&&this.currentPlane.flyProgress>e.landDelay&&(this.currentPlane=null);for(var b=0;b<this.planes.length;b++){var c=this.planes[b];null!==this.currentPlane||c.flying||c.landed||(a=!0,this.currentPlane=this.planes[b],this.currentPlane.land())}if(a)for(var b=0;b<this.planes.length;b++){var c=this.planes[b];c!==this.currentPlane&&c.flying&&c.lowerOrbit()}}},b.exports=d},{"../model":102}],107:[function(a,b,c){function d(a,b){this.mod=a,this.scene=a.scene,this.gl=this.scene.gl,this.plane=b;var c=this.gl;this.node=new i,this.prg=new e(c,f(["precision highp float;\n#define GLSLIFY 1\n\nattribute vec3 aPosition;\nattribute vec2 aUv;\n\nuniform mat4 uMVP;\n\nvarying vec2 vUv;\n\nvoid main( void ){\n\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n  vUv = aUv;\n\n}\n"]),f(["precision highp float;\n#define GLSLIFY 1\n\nuniform vec3 uColor;\n\nvarying vec2 vUv;\n\nvoid main(void){\n\n  vec3 c = uColor;\n\n  c *= clamp( (1.0 - abs( ( vUv.x * 2.0 - 1.0 ) ) * 1.2 ) , 0.0, 0.7 );\n  c *= clamp( ( abs( ( ( vUv.y ) * 2.0 - 1.0 ) ) ) , 0.0, 1.0 ) * 1.0 - vUv.x;\n\n  gl_FragColor = vec4( c, 1.0 );\n}\n"])),this.buffer=new g(c),this.buffer.attrib("aPosition",3,c.FLOAT),this.buffer.attrib("aUv",2,c.FLOAT),this.color=j.create(),h.HexToVec(16777215,this.color),this.cfg=this.scene.glstate.config().enableCullface(!1).enableDepthTest(!0).enableBlend().blendFunc(this.gl.ONE,this.gl.ONE).depthMask(!1),this.time=0,this.baseSpline=[],this.make()}var e=a("nanogl/program"),f=a("glslify"),g=a("nanogl/arraybuffer"),h=a("lib/color"),i=a("nanogl-node"),j=a("gl-matrix").vec3,k=(a("gl-matrix").mat4,j.create());d.prototype={make:function(){var a=[],b=j.create(),c=j.create();c[0]=0,c[1]=1,c[2]=0;for(var d=0;d<this.baseSpline.length;d+=3){b[0]=this.baseSpline[d],b[1]=this.baseSpline[d+1],b[2]=this.baseSpline[d+2];var e=d%2==0?.15:-.15;e*=this.plane.getScaleSize(),c[0]=0,c[1]=e,c[2]=0,j.transformQuat(c,c,this.plane.node.rotation),a.push(b[0]),a.push(b[1]),a.push(b[2]),a.push(d/this.baseSpline.length),a.push(d%2==0?0:1)}this.buffer.data(new Float32Array(a))},update:function(){if(!this.plane.flying&&!this.plane.landed||!this.plane.flying&&this.plane.placed)return this.baseSpline=[],void h.HexToVec(16777215,this.color);var a=this.plane.flying?400:50,b=this.plane.getOrbitSize()*a,c=this.plane.node._matrix;k[0]=c[12],k[1]=c[13],k[2]=c[14];var d=this.baseSpline.length%2==0?.05:-.05;d*=this.plane.getScaleSize();var e=j.create();for(e[0]=0,e[1]=d,e[2]=0,j.transformQuat(e,e,this.plane.node.rotation),this.baseSpline.push(k[0]+e[0],k[1]+e[1],k[2]+e[2]);this.baseSpline.length>b;)this.baseSpline.splice(0,6);this.make()},preRender:function(){this.time+=this.scene.dt,this.make()},render:function(){this.baseSpline.length<12||(this.prg.use(),this.prg.uMVP(this.scene.camera.getMVP(this.node._wmatrix)),this.prg.uColor(this.color),this.cfg.apply(),this.buffer.bind(),this.buffer.attribPointer(this.prg),this.buffer.drawTriangleStrip())}},b.exports=d},{"gl-matrix":192,glslify:205,"lib/color":32,"nanogl-node":214,"nanogl/arraybuffer":249,"nanogl/program":253}],108:[function(a,b,c){function d(a){var b=a.scene.gl;this.mod=a,this.gl=b,this.node=new f;var c=3,d=2.5,i=-.4;this.plane=new g(b,-c/2,-d/2+i,c,d),this.prg=new e(b,h(["precision lowp float;\n#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n  vec2 p = aPosition;\n  gl_Position = uMVP * vec4( p.x, 0.0, p.y, 1.0 );\n\n  vTexCoord = aTexCoord;// * 2.0 - 1.0;\n}\n"]),h(["precision lowp float;\n#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D tShadow;\nuniform float uAlpha;\n\n// float toneMap(float c){\n//   float sqrtc = sqrt( c );\n//   return(sqrtc-sqrtc*c) + c*(0.4672*c+0.5328);\n// }\n\nvoid main(void){\n  \n  // float dist = clamp( length( vTexCoord ), 0.0, 1.0 );\n  // dist = .5*toneMap( dist ) + .5;\n  // dist = pow( dist, .5 );\n\n  float lum = .8 + .2 * ( texture2D( tShadow, vTexCoord ).g + ( 1.0 - uAlpha ) );\n  \n  gl_FragColor = vec4( vec3(lum), 1.0 );\n\n}\n"])),this.cfg=a.scene.glstate.config().enableBlend().blendFunc(b.ZERO,b.SRC_COLOR).enableDepthTest().depthMask(!1)}var e=a("nanogl/program"),f=a("nanogl-node"),g=a("nanogl-primitives-2d/rect"),h=a("glslify");d.prototype={setTex:function(a){this.tex=a},render:function(){this.prg.use(),this.prg.uMVP(this.mod.scene.camera.getMVP(this.node._wmatrix)),this.prg.tShadow(this.tex),this.prg.uAlpha(1),this.plane.attribPointer(this.prg),this.cfg.apply(),this.plane.render()}},b.exports=d},{glslify:205,"nanogl-node":214,"nanogl-primitives-2d/rect":242,"nanogl/program":253}],109:[function(a,b,c){function d(a,b){this.context=a,this.planes=b,this.planesSounds=[];for(var c=1;c<5;c++)a.makeAudioBufferSource("sounds/plane-0"+c+".mp3").then(function(a){this.planesSounds.push(a)}.bind(this));for(var c=0;c<this.planes.length;c++)this.planes[c].on("flystart",this.onFlyStart.bind(this));this.loopSound={},a.makeAudioBufferSource("sounds/plane-loop.mp3").then(function(a){this.loopSound=a,this.loopSound.play(!0,0)}.bind(this)),this.lastPlanePlaying=null}a("dev/gui");d.prototype={onFlyStart:function(a){var b=Math.floor(Math.random()*this.planesSounds.length),c=this.planesSounds[b];c.play(!1,1),this.loopSound.volume(.8),this.lastPlanePlaying=c},stop:function(){for(var a=0;a<this.planesSounds.length;a++)this.planesSounds[a].volume(0);this.loopSound.volume(0)},update:function(a){}},b.exports=d},{"dev/gui":20}],110:[function(a,b,c){"use strict";function d(a,b){this.scene=a,this.meshes=[],this.node=new e}var e=a("nanogl-node");d.prototype.addChild=function(a){this.meshes.indexOf(a)===-1&&(this.meshes.push(a),this.node.add(a))},d.prototype.removeChild=function(a){var b=this.meshes.indexOf(a);b!==-1&&(this.meshes.splice(b,1),this.node.remove(a))},d.prototype.preRender=function(a){},d.prototype.render=function(a,b){for(var c=this.meshes,d=0,e=c.length;d<e;d++)c[d].render(this.scene,a,b)},d.prototype.renderPass=function(a,b,c){for(var d=this.meshes,e=0,f=d.length;e<f;e++)d[e].renderPass(a,b,c)},d.prototype.renderDepth=function(a,b,c){for(var d=this.meshes,e=0,f=d.length;e<f;e++)d[e].renderDepth(a,b,void 0,c)},d.prototype.renderProgram=function(a,b,c){for(var d=this.meshes,e=0,f=d.length;e<f;e++)d[e].renderProgram(a,b,c)},b.exports=d},{"nanogl-node":214}],111:[function(a,b,c){"use strict";function d(a){this._mask=1,this.inputs=new i,this.config=new e,this.iColor=this.inputs.add(new g("color",3)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iAmbiantColor=this.inputs.add(new g("ambiant",3)),this.fresnelProps=[0,0,0,0,0],this.fAntenneAnimation=this.inputs.add(new h("ANTENNE_ANIMATION",!1)),this.fSphereAnimation=this.inputs.add(new h("SPHERE_ANIMATION",!1)),this.fEyeAnimation=this.inputs.add(new h("EYE_ANIMATION",!1)),this.fFakeOcclusion=this.inputs.add(new h("FAKE_OCCLU",!0)),this._prgcache=f.getCache(a),this._uid="basic",this._precision="highp",this._vertSrc=j(["#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\n\nvarying vec4 vMVPPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldNormal;\nvarying vec2 vTexCoord;\n\n#if EYE_ANIMATION\nvarying float vFresnel;\nuniform float uFresnelProps[5];\n#endif\n\nuniform mat4 uModelViewProjectionMatrix;\nuniform mat4 uModelMatrix;\nuniform float uAntenneProgress;\nuniform vec3 uCameraPosition;\nuniform float uWakeUpProgress;\n\nstruct VertexData {\n  vec4 position;\n  vec4 worldPosition;\n  vec4 MVPPosition;\n\n  vec3 normal;\n  vec3 worldNormal;\n\n  vec2 uv;\n};\n\n#define saturate(x) clamp(x, 0.0, 1.0)\n#define sdot(x,y) saturate(dot(x,y))\n\n#define PI 3.141592653589793\n\nvoid AntenneAnimation( inout vec4 pos, in float progress ) {\n  float strength =  pos.y / 0.01;\n\n  float initialAngle = atan(pos.y, pos.x);\n  float angle        = (PI * 0.125 * progress) * strength;\n  float hypo         = sqrt(pos.x*pos.x + pos.y*pos.y);\n\n  vec2 position = vec2(\n    hypo * cos(initialAngle + angle),\n    hypo * sin(initialAngle + angle)\n  );\n\n  pos.x = position.x;\n  pos.y = position.y;\n}\n\n#define PI 3.141592653589793\n\nvoid SphereAnimation( inout vec4 pos, in float progress ) {\n  float strength =  0.125;\n\n  float initialAngle = atan(pos.y, pos.x);\n  float angle        = (PI * 0.125 * progress) * strength;\n  float hypo         = sqrt(pos.x*pos.x + pos.y*pos.y);\n\n  vec2 position = vec2(\n    hypo * cos(initialAngle + angle),\n    hypo * sin(initialAngle + angle)\n  );\n\n  pos.x = position.x;\n  pos.y = position.y;\n}\n\nvoid getPositions( inout VertexData d ) {\n  d.position      = vec4( aPosition, 1.0 );\n  d.worldPosition = uModelMatrix * d.position;\n  d.MVPPosition   = uModelViewProjectionMatrix * d.position;\n}\n\nvoid getNormals( inout VertexData d ) {\n  d.normal      = normalize(aNormal);\n  d.worldNormal = (uModelMatrix * vec4(d.normal, 0.0)).xyz;\n  d.worldNormal = normalize(d.worldNormal);\n}\n\nvoid getTextCoords( inout VertexData d ) {\n  d.uv = aTexCoord;\n}\n\nvoid main() {\n\n  VertexData d;\n  getPositions( d );\n  getNormals( d );\n  getTextCoords( d );\n\n  #if ANTENNE_ANIMATION\n  AntenneAnimation( d.position, uAntenneProgress );\n  d.MVPPosition = uModelViewProjectionMatrix * d.position;\n  #endif\n\n  #if SPHERE_ANIMATION\n  SphereAnimation( d.position, uAntenneProgress );\n  d.MVPPosition = uModelViewProjectionMatrix * d.position;\n  #endif\n\n  #if EYE_ANIMATION\n  float wakeUpProgress = uWakeUpProgress;\n  vec3 I        = normalize( uCameraPosition.xyz - d.worldPosition.xyz );\n  vec3 N        = normalize( d.worldNormal.xyz );\n  float fresnel = pow(sdot(I, N), uFresnelProps[3]);\n  fresnel       = clamp(fresnel, 0.0, 1.0);\n  vFresnel      = fresnel * wakeUpProgress;\n  #endif\n\n  #pragma SLOT v\n\n  vMVPPosition   = d.MVPPosition.xyzw;\n  vWorldPosition = d.worldPosition.xyz;\n  vWorldNormal   = d.worldNormal.xyz;\n  vTexCoord      = d.uv;\n\n  gl_Position = d.MVPPosition;\n\n}"]),this._fragSrc=j(["#define GLSLIFY 1\n#pragma SLOT pf\n\nvarying vec4 vMVPPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldNormal;\nvarying vec2 vTexCoord;\n\n#if EYE_ANIMATION\nvarying float vFresnel;\nuniform float uFresnelProps[5];\n#endif\n\nvoid main() {\n\n  #pragma SLOT f\n\n  vec3 xcolor = color();\n\n  #if EYE_ANIMATION\n  vec3 fresnelColor = vec3(uFresnelProps[0], uFresnelProps[1], uFresnelProps[2]);\n  xcolor = xcolor + fresnelColor * vFresnel;\n  #endif\n\n  // OCCLUSION\n  #if HAS_cavity\n  xcolor *= cavity() * cavityStrength().r + 1.0 - cavityStrength().r;\n  #endif\n\n  #if FAKE_OCCLU\n  float occlu = vWorldPosition.y * 100. + (vWorldNormal.y + 1.0);\n  occlu *= 0.5;\n  occlu = clamp(occlu, 0.0, 1.0);\n  xcolor *= occlu * 0.5 + 0.5;\n  #endif\n\n  // AMBIANT xCOLOR\n  #if HAS_ambiant\n  xcolor += ambiant();\n  #endif\n\n  gl_FragColor = vec4(xcolor, 1.0);\n}"])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/chunks-tree"),j=a("glslify"),k=a("../store"),l=a("gl-matrix").mat4,m=l.create();d.prototype.prepare=function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),b.modelViewProjectionMatrix(m,a._wmatrix),c.uModelViewProjectionMatrix(m),c.uModelMatrix(a._wmatrix),c.uWakeUpProgress&&c.uWakeUpProgress(k._WAKE_UP_PROGRESS),c.uFresnelProps&&c.uFresnelProps(this.fresnelProps),c.uCameraPosition&&c.uCameraPosition(b._wposition),c.uAntenneProgress&&c.uAntenneProgress(k.ANTENNE_WAVE_PROGRESS)},d.prototype._isDirty=function(){return!(null!==this.prg&&!this.inputs._isDirty)},d.prototype.compile=function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)},b.exports=d},{"../store":123,"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244,"nanogl/program":253}],112:[function(a,b,c){"use strict";function d(a){this.module=a,this.scene=this.module.scene,this.physic=new e(this),this.gshadow=new f(this.scene,1,1,128,4),this.gshadow.opacity=1,this.gshadow.enabled=[!1,!0],this.node=this.gshadow.node}var e=a("./physic"),f=a("../../../entities/ground-shadow");d.prototype.render=function(){this.gshadow.render(this.scene.camera)},d.prototype.shadowPass=function(){var a=this.scene.glstate;a.apply(),this.gshadow.prepare();var b=this.gshadow.getDefaultDepthPass();b.use(),a.push(this.gshadow.defaultCfg),a.apply(),this.onRenderProgram&&this.onRenderProgram(this.gshadow,b),a.pop(),this.gshadow.process()},b.exports=d},{"../../../entities/ground-shadow":23,"./physic":113}],113:[function(a,b,c){
"use strict";function d(a){this.worldPhysic=a.module.physic,this.module=a.module,this.ground_body=new CANNON.Body({mass:0}),this.ground_body.__name="ground";var b=new CANNON.Plane;this.ground_body.addShape(b),this.ground_body.position.y=0,this.ground_body.quaternion.setFromEuler(-Math.PI/2,0,0,"XYZ"),this.worldPhysic.addBody(this.ground_body),this.test_body=new CANNON.Body({mass:0}),this.test_body.quaternion.setFromEuler(-Math.PI/2,0,0,"XYZ"),b=new CANNON.Cylinder(.1,.1,1,20),this.test_body.addShape(b),this.worldPhysic.addBody(this.test_body)}b.exports=d},{}],114:[function(a,b,c){"use strict";function d(a){this.gShadowPass=this.gShadowPass.bind(this),this.context=a,this.node=a.node,this.scene=a.scene,this.gl=a.scene.gl,this.cfg=this.scene.glstate.config(),this.robotScene=new h(this),this.physic=new j(this),this.robot=new k(this),this.pieces=new l(this),this.ground=new i(this),this.ground.onRenderProgram=this.gShadowPass,this.node.add(this.robot.origin),this.node.add(this.pieces.origin),this.context.node.add(this.ground.node),this.debug(),this._hasGravity=!0,this.loadPromise=f.all(this.getLoadables())}function e(a){return new d(a)}var f=a("when"),g=a("dev/gui"),h=a("./robot_scene"),i=a("./ground/ground"),j=a("./physic"),k=a("./robot/robot"),l=a("./pieces/pieces"),m=a("./store"),n=(a("../common/box-mesh"),a("./programs"),a("lib/mouse")),o=a("./sound-manager"),p=!1,q=0,r=1,s=0;d.prototype={setPosition:function(a){},getLoadables:function(){return this.robotScene.getLoadables()},start:function(){if(!p){this.SM=new o(this.context);var a=this;this.loadPromise.then(function(){a.robot.setup(),a.pieces.setup(),p=!0})}},stop:function(){this.SM&&this.SM.stop()},preRender:function(){this.physic.step(this.scene.dt),this.robot.preRender(this.scene.dt),this.pieces.preRender(),this.box&&this.box.preRender(),!n.isDown()||n.isDown()&&s>20?(this.levitate(n.isDown()),n.isDown&&(s=0)):s++,this.SM&&this.SM.update(),m._ANTENNE_WAVE_SPEED+=.01*(m.ANTENNE_WAVE_SPEED-m._ANTENNE_WAVE_SPEED),m._WAKE_UP_PROGRESS+=.01*(m.WAKE_UP_PROGRESS-m._WAKE_UP_PROGRESS),r=m._ANTENNE_WAVE_SPEED,q+=this.scene.dt*r,m.ANTENNE_WAVE_PROGRESS=Math.cos(q)},rttPass:function(){this.ground.shadowPass()},render:function(){this.ground.render(),this.robot.render(1),this.pieces.render(1),this.box&&this.box.render()},postRender:function(){},gShadowPass:function(a,b){this.robot.renderProgram(a.camera,b),this.pieces.renderProgram(a.camera,b)},getCameraPosition:function(a,b){a[1]-=.025,a[2]-=.2},debug:function(){window.RobotXP=this;var a=this,b={gravity:!0,low_gravity:function(){console.log("low"),a.levitate(!0)},reset_gravity:function(){console.log("reset"),a.levitate(!1)},toggle_gravity:function(){this.gravity=!this.gravity,this.gravity?this.reset_gravity():this.low_gravity()},boxScale:{x:.001,y:.001,z:.001},updateBox:function(){a.box.scale=[b.boxScale.x,b.boxScale.y,b.boxScale.z],a.box.invalidate()}},c=g.addFolder("robot");c.add(this.physic.world.gravity,"x"),c.add(this.physic.world.gravity,"y",-.82,.01),c.add(this.physic.world.gravity,"z"),c.add(b,"low_gravity"),c.add(b,"reset_gravity"),g.add(b,"toggle_gravity"),c.add(b.boxScale,"x").onChange(b.updateBox),c.add(b.boxScale,"y").onChange(b.updateBox),c.add(b.boxScale,"z").onChange(b.updateBox)},levitate:function(a){a=!a,a!==this._hasGravity&&(this._hasGravity=a,this._hasGravity?(this.physic.world.gravity.y=-.82,this.pieces.levitate(!1),m.ANTENNE_WAVE_SPEED=1,m.WAKE_UP_PROGRESS=0):(this.physic.world.gravity.y=.01,this.pieces.levitate(!0),m.ANTENNE_WAVE_SPEED=50,m.WAKE_UP_PROGRESS=1))}},b.exports=e},{"../common/box-mesh":59,"./ground/ground":112,"./physic":115,"./pieces/pieces":117,"./programs":118,"./robot/robot":120,"./robot_scene":121,"./sound-manager":122,"./store":123,"dev/gui":20,"lib/mouse":50,when:280}],115:[function(a,b,c){"use strict";function d(a){this.module=a,this.world=new CANNON.World,this.world.gravity.set(0,-.82,0)}var e=1/60,f=3;d.prototype.step=function(a){this.world.step(e,a,f)},d.prototype.addBody=function(a){this.world.addBody(a)},d.prototype.removeBody=function(a){this.world.removeBody(a)},b.exports=d},{}],116:[function(a,b,c){"use strict";function d(a,b){this.node=a,this.module=b,this.body=null,this.soundPlayed=!0,this.random=Math.random()}var e=.3,f=.3,g=new CANNON.Vec3,h=new CANNON.Vec3,i={Cog:function(){var a=new CANNON.Body({mass:.018}),b=new CANNON.Cylinder(.0111,.0111,.0028,20);return a.addShape(b),a},"Cog.002":function(){var a=new CANNON.Body({mass:.018}),b=new CANNON.Cylinder(.0111*.667,.0111*.667,.0018676,20);return a.addShape(b),a},Cylinder:function(){var a=new CANNON.Body({mass:.018}),b=new CANNON.Cylinder(.0042,.0042,.0127,20);return a.addShape(b),a},Icosphere:function(){var a=new CANNON.Body({mass:.018}),b=new CANNON.Sphere(.004975);return a.addShape(b),a},Spring:function(){var a=1.5,b=new CANNON.Body({mass:.018}),c=new CANNON.Cylinder(.01045*a,.01045*a,.0256*a,20);return b.addShape(c),b},"Spring.002":function(){var a=1.5,b=new CANNON.Body({mass:.018}),c=new CANNON.Cylinder(.01045*.531*a,.01045*.531*a,.0135936*a,20);return b.addShape(c),b},Wrench:function(){var a=new CANNON.Body({mass:.1}),b=new CANNON.Box(new CANNON.Vec3(.0813,.0159,.0036));return a.addShape(b),a},Arm:function(){var a=new CANNON.Body({mass:.03}),b=.00885,c=.0287,d=.5*c,e=.00625,f=.513*.1,g=.5*f,h=.8*.1,i=.5*h,j=new CANNON.Cylinder(b,b,c,20),k=new CANNON.Cylinder(e,e,f,20);return a.addShape(j,new CANNON.Vec3(0,0,-i+d)),a.addShape(k,new CANNON.Vec3(0,0,+i-g)),a},_Default:function(){var a=new CANNON.Body({mass:.018}),b=new CANNON.Box(new CANNON.Vec3(.01,.01,.01));return a.addShape(b),a}};d.prototype.setup=function(){var a=this,b=this.module.physic,c=this.node,d=i[this.node.name]||i._Default,e=d();e.__name=this.node.name,e.addEventListener("collide",function(b){"ground"!==b.body.__name||a.soundPlayed||(a.soundPlayed=!0,a.module.SM.play(a.node.name))}),this.body=e,e.position.set(c.x,c.y,c.z),e.quaternion.set(c.rotation[0],c.rotation[1],c.rotation[2],c.rotation[3]),b.addBody(e)},d.prototype.levitate=function(){var a=Math.random()>.5?1:-1,b=.25;this.body.applyImpulse(new CANNON.Vec3(1e-5*a,1e-4*b,0),new CANNON.Vec3(0,0,0))},d.prototype.sync=function(){if(this.body){var a=this.node,b=a.rotation,c=a.position,d=this.body.quaternion,e=this.body.position;b[0]=d.x,b[1]=d.y,b[2]=d.z,b[3]=d.w,c[0]=e.x,c[1]=e.y,c[2]=e.z,a.invalidate()}},d.prototype.preStep=function(){g=new CANNON.Vec3,this.body.position.negate(g);var a=g.length();a>f&&(h=g.clone(),h.normalize(),this.body.force.y=.05*h.y*Math.pow(Math.abs(g.y),2),this.body.velocity.y*=.985),a>e&&(h=g.clone(),h.normalize(),this.body.force.x=.02*h.x*Math.pow(Math.abs(g.x),2),this.body.force.z=.02*h.z*Math.pow(Math.abs(g.z),2))},b.exports=d},{}],117:[function(a,b,c){"use strict";function d(a){e.call(this,a.scene,"pieces"),this._onPreStep=this._onPreStep.bind(this),this.module=a,this.gl=a.gl,this.origin=new f,this.origin.add(this.node),this.meshesByName={},this.lowGravity=!1,this.module.physic.world.addEventListener("preStep",this._onPreStep)}var e=a("../entities/group"),f=a("nanogl-node"),g=a("./physic"),h=a("../gl/basic-material"),i=a("lib/color"),j=["Arm","Cog","Cog.002","Cylinder","Cube","Spring","Spring.002","Wrench"],k=null;d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.constructor=d,d.prototype.setup=function(){var a=(this.module.robotScene.texs,this);this.module.robotScene.meshes.forEach(function(b){j.indexOf(b.name)!==-1&&(a.meshesByName[b.name]=b,a._overrideMaterial(b),a.addChild(b),b.physic=new g(b,a.module),b.physic.setup())})},d.prototype.getAssetPath=function(a){return"robot/"+a},d.prototype.preRender=function(){for(var a=this.meshes,b=0,c=a.length;b<c;b++)a[b].physic.sync()},d.prototype.getMesh=function(a){return this.meshesByName[a]},d.prototype.levitate=function(a){if(this.lowGravity=a,this.lowGravity){this.resetSounds();for(var b=this.meshes,c=0,d=b.length;c<d;c++)b[c].physic.levitate()}},d.prototype._onPreStep=function(){if(this.lowGravity)for(var a=this.meshes,b=0,c=a.length;b<c;b++)a[b].physic.preStep()},d.prototype._overrideMaterial=function(a){a.name.match(/Arm/)?(a.materials[0]=this.getMaterial(),a.materials[1]=this.getMaterial()):a.materials[0]=this.getMaterial()},d.prototype.getMaterial=function(){if(k)return k;var a=this.module.robotScene.texs,b=new h(this.gl);return b.color=b.iColor.attachAttribute("aColor"),b.occlu=b.iCavity.attachSampler("tOcclusion","vTexCoord"),b.occlu.set(a.get("robot_pieces_OCCLU")),b.occluStrength=b.iCavityStrength.attachConstant([1,1]),b.config.enableDepthTest(!0),b.ambiant=b.iAmbiantColor.attachUniform("uAmbiantColor"),i.HexInput(b.ambiant,69894),k=b},d.prototype.resetSounds=function(){for(var a=this.meshes,b=0,c=a.length;b<c;b++)a[b].physic.soundPlayed=!1},b.exports=d},{"../entities/group":110,"../gl/basic-material":111,"./physic":116,"lib/color":32,"nanogl-node":214}],118:[function(a,b,c){function d(a){var b=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT),c=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT);return c.precision>0&&b.precision>0}function e(a){var b=a.gl;this.hasHighp=d(b),this.programs=[],this.compile()}a("nanogl/program"),a("glslify");e.prototype={precision:function(){return this.hasHighp?"highp":"mediump"},compile:function(){var a="\n";a+="precision "+this.precision()+" float;\n",this.process()},process:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].use()},dispose:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].dispose();this.programs=null}},b.exports=e},{glslify:205,"nanogl/program":253}],119:[function(a,b,c){"use strict";function d(a){this.module=a.module,this.robot=a,this.body=null}d.prototype.setup=function(){var a=(this.robot.module.physic,new CANNON.Body({mass:.018,sleepTimeLimit:.001,sleepSpeedLimit:1})),b=new CANNON.Box(new CANNON.Vec3(.0951,.12,.0559));a.addShape(b,new CANNON.Vec3(0,.12,0)),a.position.set(this.robot.origin.x,this.robot.origin.y,this.robot.origin.z),a.linearDamping=.3,this.body=a},d.prototype.sync=function(){var a=this.robot.origin,b=a.rotation,c=a.position,d=this.body.quaternion,e=this.body.position;b[0]=d.x,b[1]=d.y,b[2]=d.z,b[3]=d.w,c[0]=e.x,c[1]=e.y,c[2]=e.z,a.invalidate()},b.exports=d},{}],120:[function(a,b,c){"use strict";function d(a){e.call(this,a.scene,"robot"),this.gl=a.scene.gl,this.module=a,this.origin=new f,this.origin.add(this.node),this.meshesByName={}}var e=a("../entities/group"),f=(a("./physic"),a("nanogl-node")),g=a("../gl/basic-material"),h=a("lib/color"),i=a("../store"),j=a("gl-matrix").quat,k=["Head","Ear","Neck","Eye","Antenne","Antenne base","Corrections","Sphere"],l=0,m=[];d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setup=function(){var a=this;this.module.robotScene.meshes.forEach(function(b){k.indexOf(b.name)!==-1&&(a.meshesByName[b.name]=b,a._overrideMaterial(b),a.addChild(b),"Ear"===b.name&&(m[0]=b.rotation[0],m[1]=b.rotation[1],m[2]=b.rotation[2],m[3]=b.rotation[3]))})},d.prototype.preRender=function(a){if(this.node.y=.025*i._WAKE_UP_PROGRESS,this.node.rotateY(.005*i._WAKE_UP_PROGRESS),this.meshesByName["Antenne base"]&&this.meshesByName["Antenne base"].rotateZ(.005+.001*i._ANTENNE_WAVE_SPEED),this.meshesByName.Ear){j.copy(this.meshesByName.Ear.rotation,m),l+=a*i._WAKE_UP_PROGRESS;var b=Math.cos(50*l);this.meshesByName.Ear.rotateZ(.025*b*i._WAKE_UP_PROGRESS)}},d.prototype.getMesh=function(a){return this.meshesByName[a]},d.prototype._overrideMaterial=function(a){var b,c=this.module.robotScene.texs;a.name.match(/^(Antenne)$/)?(b=this.createMaterial(),b.fAntenneAnimation.enable(),a.materials[0]=b):a.name.match(/^(Sphere)$/)?(b=this.createMaterial(),b.fSphereAnimation.enable(),a.materials[0]=b):a.name.match(/^(Ear)$/)?(b=this.createMaterial(),b.occluStrength=b.iCavityStrength.attachConstant([.65,1]),a.materials[0]=b,a.materials[1]=b):a.name.match(/^(Eye)$/)?(b=new g(this.gl),b.color=b.iColor.attachAttribute("aColor"),b.config.enableDepthTest(!0),b.fEyeAnimation.enable(),b.fresnelProps=[.264,.697,.461,25,1],a.materials[0]=b):(b=a.materials[0],b.occlu=b.iCavity.attachSampler("tOcclusion","vTexCoord"),b.occlu.set(c.get("robot_OCCLU")),b.occluStrength=b.iCavityStrength.attachConstant([.5,1]),b.ambiant=b.iAmbiantColor.attachUniform("uAmbiantColor"),h.HexInput(b.ambiant,69894))},d.prototype.createMaterial=function(){var a=this.module.robotScene.texs,b=new g(this.gl);return b.color=b.iColor.attachAttribute("aColor"),b.occlu=b.iCavity.attachSampler("tOcclusion","vTexCoord"),b.occlu.set(a.get("robot_OCCLU")),b.occluStrength=b.iCavityStrength.attachConstant([1,1]),b.config.enableDepthTest(!0),b.ambiant=b.iAmbiantColor.attachUniform("uAmbiantColor"),h.HexInput(b.ambiant,69894),b},b.exports=d},{"../entities/group":110,"../gl/basic-material":111,"../store":123,"./physic":119,"gl-matrix":192,"lib/color":32,"nanogl-node":214}],121:[function(a,b,c){"use strict";function d(a){e.call(this,a.scene,"robot_scene"),this.module=a,this.scene=a.scene,this.mats.lib.defaultMaterial=this.getDefaultMaterial(),this.setupMaterials()}var e=a("assets/awd-scene"),f=(a("nanogl-pbr/standard"),a("./gl/basic-material")),g=a("lib/color");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.getLoadables=function(){return e.prototype.getLoadables.call(this)},d.prototype.getAssetPath=function(a){return"robot/"+a},d.prototype.getTexturePath=function(a){return"robot/"+a},d.prototype.texPath=function(a){return[this.getTexturePath(a+".jpg")]},d.prototype.getAwdUrl=function(){return this.getAssetPath("scene.awd")},d.prototype.setupMaterials=function(){var a=this.mats,b=this.texs;b.makeTex("robot_OCCLU",this.getAssetPath("robot_OCCLU.jpg")).setFilter(!0,!1,!1),b.makeTex("robot_pieces_OCCLU",this.getAssetPath("robot_pieces_OCCLU.jpg")).setFilter(!0,!1,!1);var c=new f(this.gl);c.color=c.iColor.attachAttribute("aColor"),c.config.enableDepthTest(!0),a.registerMaterial(c,"Robot_Metal"),c=new f(this.gl),c.color=c.iColor.attachAttribute("aColor"),c.config.enableDepthTest(!0),a.registerMaterial(c,"Robot_Eye"),c=new f(this.gl),c.color=c.iColor.attachAttribute("aColor"),c.config.enableDepthTest(!0),a.registerMaterial(c,"Robot_Head")},d.prototype.getDefaultMaterial=function(){var a=(this.mats,new f(this.gl));return a.color=a.iColor.attachUniform("uColor"),g.HexInput(a.color,16755234),a.fAntenneAnimation.enable(),a.config.enableDepthTest(!0),a},b.exports=d},{"./gl/basic-material":111,"assets/awd-scene":1,"lib/color":32,"nanogl-pbr/standard":239}],122:[function(a,b,c){"use strict";function d(a){this.context=a,Object.keys(f).forEach(function(b){b.match(/(levitation|antenne)/)?a.makeAudioBufferSource(f[b].url).then(function(a){f[b].audio=a,f[b].audio.play(!0,0)}):(f[b].audio=a.makeAudioSource(f[b].url),f[b].audio.connect(a.audioOutput))})}var e=a("./store"),f={antenne:{url:"sounds/robot/SFX_Voeux_2017_MMP_ROBOT_ANTENNE-02-V4.mp3"},levitation:{url:"sounds/robot/SFX_Voeux_2017_MMP_ROBOT_LEVITATION-04-V4.mp3"},bague:{url:"sounds/robot/SFX_Voeux_2017_MMP_ROBOT_PIECES-Bague-V4.mp3"},barre:{url:"sounds/robot/SFX_Voeux_2017_MMP_ROBOT_PIECES-Barre-V4.mp3"},cle:{url:"sounds/robot/SFX_Voeux_2017_MMP_ROBOT_PIECES-Cle-V4.mp3"},engrenage:{url:"sounds/robot/SFX_Voeux_2017_MMP_ROBOT_PIECES-Engrenage-V4.mp3"},ressort:{url:"sounds/robot/SFX_Voeux_2017_MMP_ROBOT_PIECES-Ressort-V4.mp3"}},g={Cog:"engrenage","Cog.002":"engrenage",Cylinder:"bague",Spring:"ressort","Spring.002":"ressort",Wrench:"cle",Arm:"barre"};d.prototype={update:function(){f.levitation.audio&&f.antenne.audio&&(f.levitation.audio.volume(Math.max(0,Math.min(e._WAKE_UP_PROGRESS,1))),f.antenne.audio.volume(Math.max(0,Math.min(e._WAKE_UP_PROGRESS,1))))},play:function(a){g[a]&&f[g[a]]&&f[g[a]].audio.mediaElement.play()},stop:function(){f.levitation.audio&&f.antenne.audio&&(f.antenne.audio.volume(0),f.levitation.audio.volume(0))}},b.exports=d},{"./store":123}],123:[function(a,b,c){var d={ANTENNE_WAVE_SPEED:1,_ANTENNE_WAVE_SPEED:1,ANTENNE_WAVE_PROGRESS:0,WAKE_UP_PROGRESS:0,_WAKE_UP_PROGRESS:0};b.exports=d},{}],124:[function(a,b,c){function d(a){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iAlbedo=this.inputs.add(new h("albedo",3)),this.iSpecular=this.inputs.add(new h("specular",3)),this.iLightmap=this.inputs.add(new h("lightmap",3)),this.iGloss=this.inputs.add(new h("gloss",1)),this.iNormal=this.inputs.add(new h("normal",3)),this.iOcclusion=this.inputs.add(new h("occlusion",1)),this.iCavity=this.inputs.add(new h("cavity",1)),this.iCavityStrength=this.inputs.add(new h("cavityStrength",2)),this.iFresnel=this.inputs.add(new h("fresnel",3)),this.iEmissive=this.inputs.add(new h("emissive",1)),this.iEmissiveScale=this.inputs.add(new h("emissiveScale",1)),this.iblExpo2=this.inputs.add(new h("iblExpo2",1)),this.conserveEnergy=this.inputs.add(new i("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new i("perVertexIrrad",!1)),this.pureGloss=this.inputs.add(new i("pureGloss",!1)),this.glossNearest=this.inputs.add(new i("glossNearest",!1)),this.tonemap=this.inputs.add(new i("tonemap",!1)),this.config=new e,this.bgGradient=null,this._prgcache=g.getCache(a),this._uid="groundmat",this._precision="highp",this._vertSrc=f(['#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform mat4 uM;\nvarying vec2 vTexCoord;\nvarying float vScreenY;\nvarying float vBorder;\nvarying vec3 vWorldPosition;\n\n#if HAS_normal\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 p = vec4(aPosition, 1.0);\n\n  vWorldPosition = (uWorldMatrix * p).xyz;\n  gl_Position    = uMVP         * p;\n\n  vTexCoord = aPosition.xz;\n  vScreenY = (gl_Position.y/gl_Position.w)*.5+.5;\n\n  vec2 vb = (aPosition.xz*2.0 - 1.0);\n  vb = pow( vb, vec2(4.0) );\n  vBorder = clamp( 1.0 - (vb.x+vb.y), 0.0, 1.0 );\n}']),this._fragSrc=f(['#define GLSLIFY 1\n\nuniform vec3 uCameraPosition;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\nvarying float vScreenY;\nvarying float vBorder;\n\n#pragma SLOT pf\n\n#if HAS_normal\n#endif\n\nuniform sampler2D tBGGradient;\n\n// IBL\n// ========\nuniform vec2 uEnvTonemap;\n\nuniform sampler2D tEnv;\n#if pureGloss\n  uniform sampler2D tEnvHi;\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n// INCLUDES\n// =========\n\nvec2 octwrapDecode( vec3 v ) {\n  // Project the sphere onto the octahedron, and then onto the xy plan\n  vec2 p = v.xy / dot(  abs( v ) , vec3(1.0) );\n  p = vec2( p.x+p.y-1.0, p.x-p.y );\n\n  if( v.z < 0.0 )\n    p.x *= -1.0;\n\n  // p.x *= sign( v.z );\n  return p;\n}\n\nvec3 decodeRGBE( vec4 hdr ){\n  return hdr.rgb * exp2( (hdr.a*255.0)-128.0 );\n  // return hdr.rgb * pow( 2.0, (hdr.a*255.0)-128.0 );\n}\n\nconst vec2 _IBL_UVM_529295689 = vec2(\n  0.25*(254.0/256.0),\n  0.125*0.5*(254.0/256.0)\n);\n\nvec3 SpecularIBL( sampler2D tEnv, vec3 skyDir, float roughness)\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  float r7   = 7.0*roughness;\n  float frac = fract(r7);\n\n  uvA = uvA * _IBL_UVM_529295689 + vec2(\n      0.5,\n      0.125*0.5 + 0.125 * ( r7 - frac )\n    );\n\n  #if glossNearest\n\n    return decodeRGBE( texture2D(tEnv,uvA) );\n\n  #else\n\n    vec2 uvB=uvA+vec2(0.0,0.125);\n    return  mix(\n      decodeRGBE( texture2D(tEnv,uvA) ),\n      decodeRGBE( texture2D(tEnv,uvB) ),\n      frac\n    );\n\n  #endif\n\n}\n\nvec3 SampleEnvHi( sampler2D tEnv, vec3 skyDir )\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  uvA = vec2(\n    0.25*(254.0/256.0),\n    0.5 *(254.0/256.0)\n    ) * uvA + vec2(0.5,0.5);\n\n  return decodeRGBE( texture2D(tEnv,uvA) );\n}\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = 1.0-VoH;\n  dot = pow( dot, 5.0 );\n  dot *= glo*glo;\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n// ------------------------------\n//\n\n#if HAS_normal\n\n#endif\n\n// ------------------------------\n//\nvec3 toneMap(vec3 c){\n  vec3 sqrtc = sqrt( c );\n  return(sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n}\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      normal();\n    #else\n      vec3( 0.0, 1.0, 0.0 );\n    #endif\n  worldNormal.xz = worldNormal.xz * 2.0 - 1.0;\n  // worldNormal = normalize( worldNormal );\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef=SampleSH( worldNormal, uSHCoeffs );\n    #if HAS_iblExpo\n      diffuseCoef = iblExpo().x * pow( diffuseCoef, vec3( iblExpo().y ) );\n    #endif\n  #endif\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n\n  #if pureGloss\n    vec3 specularColor = SampleEnvHi( tEnvHi, worldReflect );\n  #else\n    vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n  #endif\n\n  #if HAS_iblExpo\n    specularColor = iblExpo().x * pow( specularColor, vec3( iblExpo().y ) );\n  #endif\n\n  #if HAS_iblExpo2\n    specularColor = iblExpo2() * specularColor;\n  #endif\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n\n  #pragma SLOT lightsf\n\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    // alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n  #if HAS_cavity\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    specularColor += vec3( e ) * albedoSq;\n  #endif\n\n  // #if tonemap\n  //   gl_FragColor.xyz = toneMap( diffuseCoef*albedoSq + specularColor );\n  // #else\n  //   gl_FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n  // #endif\n\n  // #if HAS_lightmap\n  //   gl_FragColor.xyz *= lightmap();\n  // #endif\n\n  vec3 bg = texture2D( tBGGradient, vec2( vScreenY, -1.5/8.0 ) ).rgb;\n  gl_FragColor.xyz = mix(bg,  (diffuseCoef * bg + specularColor) * lightmap(), vBorder );\n  // gl_FragColor.xyz = toneMap( diffuseCoef*albedoSq + specularColor );\n  // gl_FragColor.xyz = albedoSq + specularColor;\n  gl_FragColor.a = 1.0;\n\n}'])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=a("nanogl-pbr/lib/flag"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4,l=k.create();d.prototype={setIBL:function(a){this.ibl=a,this.inputs.addChunks(a.getChunks())},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(l,a._wmatrix),c.uMVP(l),c.uWorldMatrix(a._wmatrix),c.tBGGradient(this.bgGradient),c.uCameraPosition&&c.uCameraPosition(b._wposition)},prepareShadow:function(a,b){},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244,"nanogl/program":253}],125:[function(a,b,c){function d(a){e.call(this,a),this._uid="inststd",this._precision="highp",this._vertSrc=f(['#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nattribute vec3 aTangent;\nattribute vec3 aBitangent;\n\nattribute vec4 iData; // pos+scale\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\nvarying mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  varying mediump vec3 vWorldTangent;\n  varying mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition*iData.w + iData.xyz , 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH(vWorldNormal, uSHCoeffs );\n    #if HAS_iblExpo\n      vIrradiance = iblExpo().x * pow( vIrradiance, vec3( iblExpo().y ) );\n    #endif\n  #endif\n\n  vTexCoord = aTexCoord;\n}'])}var e=a("nanogl-pbr/standard"),f=a("glslify");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,b.exports=d},{glslify:205,"nanogl-pbr/standard":239}],126:[function(a,b,c){function d(a){this.ibl=null,this.prg=null,this._mask=1,this.sampleCount=0,this.inputs=new j,this.iAlbedo=this.inputs.add(new h("albedo",3)),this.iNormal=this.inputs.add(new h("normal",3)),this.conserveEnergy=this.inputs.add(new i("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new i("perVertexIrrad",!1)),this.pureGloss=this.inputs.add(new i("pureGloss",!1)),this.glossNearest=this.inputs.add(new i("glossNearest",!1)),this.tonemap=this.inputs.add(new i("tonemap",!1)),this.config=new e,this._prgcache=g.getCache(a),this._uid="lightmapacc",this._precision="highp",this._vertSrc=f(['#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\n\n// uniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\n#if HAS_normal\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 p = vec4(aPosition, 1.0);\n  // p.y *= 10.0;\n\n  vWorldPosition = (uWorldMatrix * p).xyz;\n\n  gl_Position = vec4(\n    aPosition.x * 2.0 - 1.0,\n    aPosition.z * 2.0 - 1.0,\n    0.0,\n    1.0\n  );\n\n  vTexCoord = aPosition.xz;\n}']),this._fragSrc=f(['#define GLSLIFY 1\n\nuniform vec3 uCameraPosition;\nuniform float uSampleCount;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\n#pragma SLOT pf\n\n#if HAS_normal\n#endif\n\n// IBL\n// ========\nuniform vec2 uEnvTonemap;\n\nuniform sampler2D tEnv;\n#if pureGloss\n  uniform sampler2D tEnvHi;\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n// INCLUDES\n// =========\n\nvec2 octwrapDecode( vec3 v ) {\n  // Project the sphere onto the octahedron, and then onto the xy plan\n  vec2 p = v.xy / dot(  abs( v ) , vec3(1.0) );\n  p = vec2( p.x+p.y-1.0, p.x-p.y );\n\n  if( v.z < 0.0 )\n    p.x *= -1.0;\n\n  // p.x *= sign( v.z );\n  return p;\n}\n\nvec3 decodeRGBE( vec4 hdr ){\n  return hdr.rgb * exp2( (hdr.a*255.0)-128.0 );\n  // return hdr.rgb * pow( 2.0, (hdr.a*255.0)-128.0 );\n}\n\nconst vec2 _IBL_UVM_529295689 = vec2(\n  0.25*(254.0/256.0),\n  0.125*0.5*(254.0/256.0)\n);\n\nvec3 SpecularIBL( sampler2D tEnv, vec3 skyDir, float roughness)\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  float r7   = 7.0*roughness;\n  float frac = fract(r7);\n\n  uvA = uvA * _IBL_UVM_529295689 + vec2(\n      0.5,\n      0.125*0.5 + 0.125 * ( r7 - frac )\n    );\n\n  #if glossNearest\n\n    return decodeRGBE( texture2D(tEnv,uvA) );\n\n  #else\n\n    vec2 uvB=uvA+vec2(0.0,0.125);\n    return  mix(\n      decodeRGBE( texture2D(tEnv,uvA) ),\n      decodeRGBE( texture2D(tEnv,uvB) ),\n      frac\n    );\n\n  #endif\n\n}\n\nvec3 SampleEnvHi( sampler2D tEnv, vec3 skyDir )\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  uvA = vec2(\n    0.25*(254.0/256.0),\n    0.5 *(254.0/256.0)\n    ) * uvA + vec2(0.5,0.5);\n\n  return decodeRGBE( texture2D(tEnv,uvA) );\n}\n\n// ------------------------------\n//\n\n#if HAS_normal\n\n#endif\n\n// ------------------------------\n//\nvec3 toneMap(vec3 c){\n  vec3 sqrtc = sqrt( c );\n  return(sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n}\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      normal();\n    #else\n      vec3( 0.0, 1.0, 0.0 );\n    #endif\n  worldNormal.xz = worldNormal.xz * 2.0 - 1.0;\n  // worldNormal = normalize( worldNormal );\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  // #if perVertexIrrad\n  //   vec3 diffuseCoef = vIrradiance;\n  // #else\n  //   vec3 diffuseCoef=0.00001 * SampleSH( worldNormal, uSHCoeffs );\n  //   #if HAS_iblExpo\n  //     diffuseCoef = iblExpo().x * pow( diffuseCoef, vec3( iblExpo().y ) );\n  //   #endif\n  // #endif\n\n  vec3 diffuseCoef = vec3( 0.0 );\n\n  // IBL reflexion\n  // --------------\n\n  // vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  // vec3 worldReflect = reflect( -viewDir, worldNormal );\n  // float NoV = sdot( viewDir, worldNormal );\n\n  #pragma SLOT lightsf\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    // alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n  gl_FragColor.xyz = diffuseCoef*albedoSq;\n  // gl_FragColor.xyz = 0.00001*gl_FragColor.xyz + vec3(1.0, 0.0, 0.0 ); \n\n  gl_FragColor.a = 1.0 / (1.0 + uSampleCount);\n\n}']);
}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=a("nanogl-pbr/lib/flag"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4;k.create();d.prototype={setIBL:function(a){this.ibl=a,this.inputs.addChunks(a.getChunks())},setLightSetup:function(a){var b=a._modelsMap.lm.getChunks();b.unshift(a.depthFormat.createProxy()),this.inputs.addChunks(b)},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),c.uWorldMatrix(a._wmatrix),c.uSampleCount(this.sampleCount),c.uCameraPosition&&c.uCameraPosition(b._wposition)},prepareShadow:function(a,b){},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244,"nanogl/program":253}],127:[function(a,b,c){function d(a){this.prg=null,this._mask=2,this.inputs=new i,this.iShadow=this.inputs.add(new h("shadow",1)),this.config=(new e).enableBlend().blendFunc(a.ZERO,a.SRC_ALPHA).enableCullface(!1).enableDepthTest(!0).depthMask(!1),this._prgcache=g.getCache(a),this._uid="rocclu",this._precision="highp",this._vertSrc=f(["#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\n\nvarying vec2 vTexCoord;\n\nvoid main( void ){\n  \n  #pragma SLOT v\n\n  vec4 p = vec4(aPosition, 1.0);\n  gl_Position    = uMVP         * p;\n  // vTexCoord = aTexCoord;\n  vTexCoord = aTexCoord;\n}"]),this._fragSrc=f(["#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\n#pragma SLOT pf\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // float glow = glowtex();\n\n  float occlu = .3 + .7*shadow();\n\n  gl_FragColor = vec4( vec3(0.0), occlu );\n}"])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=(a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/chunks-tree")),j=a("gl-matrix").mat4,k=j.create();d.prototype={prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k)},prepareShadow:function(a,b){},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244,"nanogl/program":253}],128:[function(a,b,c){function d(a){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iAlbedo=this.inputs.add(new h("albedo",3)),this.iSpecular=this.inputs.add(new h("specular",3)),this.iLightmap=this.inputs.add(new h("lightmap",3)),this.iGloss=this.inputs.add(new h("gloss",1)),this.iNormal=this.inputs.add(new h("normal",3)),this.iOcclusion=this.inputs.add(new h("occlusion",1)),this.iCavity=this.inputs.add(new h("cavity",1)),this.iCavityStrength=this.inputs.add(new h("cavityStrength",2)),this.iFresnel=this.inputs.add(new h("fresnel",3)),this.iEmissive=this.inputs.add(new h("emissive",1)),this.iEmissiveScale=this.inputs.add(new h("emissiveScale",1)),this.iblExpo2=this.inputs.add(new h("iblExpo2",1)),this.conserveEnergy=this.inputs.add(new i("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new i("perVertexIrrad",!1)),this.pureGloss=this.inputs.add(new i("pureGloss",!1)),this.glossNearest=this.inputs.add(new i("glossNearest",!1)),this.tonemap=this.inputs.add(new i("tonemap",!0)),this.config=new e,this.bgGradient=null,this._prgcache=g.getCache(a),this._uid="smokemat",this._precision="highp",this._vertSrc=f(['#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nattribute vec4 iData; // pos+scale\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform mat4 uM;\nvarying vec2 vTexCoord;\nvarying vec2 vScreen;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldNormal;\n\n#if HAS_normal\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\n  \n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 p = vec4( aPosition*iData.w + iData.xyz , 1.0 );\n  // vec4 p = vec4(aPosition, 1.0);\n\n  vWorldPosition = (uWorldMatrix * p).xyz;\n  gl_Position    = uMVP         * p;\n\n  vTexCoord = aTexCoord;\n  vScreen = (gl_Position.xy/gl_Position.w)*.5+.5;\n\n  vWorldNormal    = rotate( uWorldMatrix, normalize(aPosition) );\n\n}']),this._fragSrc=f(['#define GLSLIFY 1\n\nuniform vec3 uCameraPosition;\n\nuniform mat3 uInverseView;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\nvarying vec2 vScreen;\nvarying float vBorder;\n\nvarying vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n#endif\n\nuniform sampler2D tBGGradient;\n\n// IBL\n// ========\nuniform vec2 uEnvTonemap;\n\nuniform sampler2D tEnv;\n#if pureGloss\n  uniform sampler2D tEnvHi;\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n// INCLUDES\n// =========\n\nvec2 octwrapDecode( vec3 v ) {\n  // Project the sphere onto the octahedron, and then onto the xy plan\n  vec2 p = v.xy / dot(  abs( v ) , vec3(1.0) );\n  p = vec2( p.x+p.y-1.0, p.x-p.y );\n\n  if( v.z < 0.0 )\n    p.x *= -1.0;\n\n  // p.x *= sign( v.z );\n  return p;\n}\n\nvec3 decodeRGBE( vec4 hdr ){\n  return hdr.rgb * exp2( (hdr.a*255.0)-128.0 );\n  // return hdr.rgb * pow( 2.0, (hdr.a*255.0)-128.0 );\n}\n\nconst vec2 _IBL_UVM_529295689 = vec2(\n  0.25*(254.0/256.0),\n  0.125*0.5*(254.0/256.0)\n);\n\nvec3 SpecularIBL( sampler2D tEnv, vec3 skyDir, float roughness)\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  float r7   = 7.0*roughness;\n  float frac = fract(r7);\n\n  uvA = uvA * _IBL_UVM_529295689 + vec2(\n      0.5,\n      0.125*0.5 + 0.125 * ( r7 - frac )\n    );\n\n  #if glossNearest\n\n    return decodeRGBE( texture2D(tEnv,uvA) );\n\n  #else\n\n    vec2 uvB=uvA+vec2(0.0,0.125);\n    return  mix(\n      decodeRGBE( texture2D(tEnv,uvA) ),\n      decodeRGBE( texture2D(tEnv,uvB) ),\n      frac\n    );\n\n  #endif\n\n}\n\nvec3 SampleEnvHi( sampler2D tEnv, vec3 skyDir )\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  uvA = vec2(\n    0.25*(254.0/256.0),\n    0.5 *(254.0/256.0)\n    ) * uvA + vec2(0.5,0.5);\n\n  return decodeRGBE( texture2D(tEnv,uvA) );\n}\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = 1.0-VoH;\n  dot = pow( dot, 5.0 );\n  dot *= glo*glo;\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n// ------------------------------\n//\n\n#if HAS_normal\n\n#endif\n\n// ------------------------------\n//\nvec3 toneMap(vec3 c){\n  vec3 sqrtc = sqrt( c );\n  return(sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n}\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      normal();\n    #else\n      vec3( 0.0, 1.0, 0.0 );\n    #endif\n  // worldNormal.xy = worldNormal.xy * 2.0 - 1.0;\n  // worldNormal = vWorldNormal + 0.00000001 * normalize(uInverseView * worldNormal);\n  // worldNormal = normalize( worldNormal );\n  worldNormal = normalize(uInverseView * worldNormal);\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef=SampleSH( worldNormal, uSHCoeffs );\n    #if HAS_iblExpo\n      diffuseCoef = iblExpo().x * pow( diffuseCoef, vec3( iblExpo().y ) );\n    #endif\n  #endif\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n\n  #if pureGloss\n    vec3 specularColor = SampleEnvHi( tEnvHi, worldReflect );\n  #else\n    vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n  #endif\n\n  #if HAS_iblExpo\n    specularColor = iblExpo().x * pow( specularColor, vec3( iblExpo().y ) );\n  #endif\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n\n  #pragma SLOT lightsf\n\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n  #if HAS_cavity\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    specularColor += vec3( e ) * albedoSq;\n  #endif\n\n  #if tonemap\n    gl_FragColor.xyz = toneMap( diffuseCoef*albedoSq + specularColor );\n  #else\n    gl_FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n  #endif\n\n  // #if HAS_lightmap\n  //   gl_FragColor.xyz *= lightmap();\n  // #endif\n\n  // vec3 bg = texture2D( tBGGradient, vec2( vScreenY, 0.0) ).rgb;\n  // gl_FragColor.xyz = mix(bg,  (diffuseCoef * bg + specularColor) * lightmap(), vBorder );\n  // gl_FragColor.xyz = toneMap( diffuseCoef*albedoSq + specularColor );\n\n  // gl_FragColor.xyz = gl_FragColor.xyz * 0.00001 + normal();\n  gl_FragColor.a = 1.0;\n\n}'])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=a("nanogl-pbr/lib/flag"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4,l=a("gl-matrix").mat3,m=k.create(),n=l.create();d.prototype={setIBL:function(a){this.ibl=a,this.inputs.addChunks(a.getChunks())},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(m,a._wmatrix),c.uMVP(m),c.uWorldMatrix(a._wmatrix),l.fromMat4(n,b._wmatrix),c.uInverseView(n),c.uCameraPosition&&c.uCameraPosition(b._wposition)},prepareShadow:function(a,b){},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244,"nanogl/program":253}],129:[function(a,b,c){function d(a){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new h,this.config=new e,this.tex=null,this._prgcache=g.getCache(a),this._uid="smokesimpmat",this._precision="highp",this._vertSrc=f(["#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec4 iData; // pos+scale\n\nuniform mat4 uMVP;\nuniform float uSizeFactor;\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\n  \n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 p = vec4( iData.xyz , 1.0 );\n  // vec4 p = vec4(aPosition, 1.0);\n\n  gl_Position = uMVP * p;\n  gl_PointSize = (uSizeFactor * iData.w) / gl_Position.w;\n\n}"]),this._fragSrc=f(["#define GLSLIFY 1\n\n// uniform vec3 uCameraPosition;\n\n#pragma SLOT pf\n\nuniform sampler2D tTex;\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  gl_FragColor = texture2D( tTex, gl_PointCoord );\n\n  if(gl_FragColor.a < 0.9 ) discard;\n\n}"])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=(a("nanogl-pbr/lib/input"),a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/chunks-tree")),i=a("gl-matrix").mat4,j=a("gl-matrix").mat3,k=i.create();j.create();d.prototype={setIBL:function(a){this.ibl=a,this.inputs.addChunks(a.getChunks())},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.tTex(this.tex)},prepareShadow:function(a,b){},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244,"nanogl/program":253}],130:[function(a,b,c){function d(a,b,c){this.gl=a,this.segw=b,this.segh=c;var d=(b+1)*(c+1),h=b*c*2,i=new Float32Array(d*g);this.verts=i;var j,k,l=new Uint16Array(3*h),m=1/b,n=1/c;for(j=0;j<=c;j++){var o=0===j||j===c-1?0:.7;for(k=0;k<=b;k++){var p=(j*(b+1)+k)*g,q=o*(0===k||k===b?0:.7);i[p+0]=(k+q*Math.random())*m,i[p+1]=0,i[p+2]=(j+q*Math.random())*n}}for(j=0;j<c;j++)for(k=0;k<b;k++){var p=6*(j*b+k),r=j*(b+1)+k,s=(j+1)*(b+1)+k;l[p+0]=r,l[p+1]=s,l[p+2]=r+1,l[p+3]=r+1,l[p+4]=s,l[p+5]=s+1}this.vbuffer=new e(a).attrib("aPosition",g,a.FLOAT),this.ibuffer=new f(a,a.UNSIGNED_SHORT,l)}var e=a("nanogl/arraybuffer"),f=a("nanogl/indexbuffer"),g=3;d.prototype={updateHeights:function(a){for(var b=(this.segw+1)*(this.segh+1),c=this.verts,d=0;d<b;d++){var e=d*g;c[e+1]=a.sample(c[e+0],c[e+2])}this.vbuffer.data(c)},attribPointer:function(a){this.vbuffer.attribPointer(a),this.ibuffer.bind()},render:function(){this.ibuffer.drawTriangles()}},b.exports=d},{"nanogl/arraybuffer":249,"nanogl/indexbuffer":252}],131:[function(a,b,c){function d(a){var b=a.scene;this.updateGeom=this._updateGeom.bind(this),this.mod=a,this.scene=b,this.node=new e,this.geom=new f(b.gl,64,64),this.cfg=b.glstate.config().enableCullface(!0).enableDepthTest(!0),this.heightmap=new g,this.normalGen=new h(this),this.lightmapGen=new i(this),this.groundMat=this.makeGroundMat(),this.node.x=-1,this.node.z=-1.3,this.node.setScale(2)}var e=a("nanogl-node"),f=a("./ground-geom"),g=a("./heightmap"),h=a("./normal-gen"),i=a("./lightmap-gen"),j=a("./gl/ground-material"),k=a("lib/color");d.prototype={preRender:function(){},rttPass:function(){this.normalGen.render(),this.lightmapGen.render()},render:function(){this.renderPbr()},renderPbr:function(){var a=this.groundMat,b=this.scene.glstate;a.prepare(this.node,this.scene.camera),this.geom.attribPointer(a.prg),b.push(a.config),b.apply(),this.geom.render(),b.pop()},renderPass:function(a,b,c){c.prepare(this.node,a),this.geom.attribPointer(c.prg),this.scene.glstate.apply(),this.geom.render()},loadHeight:function(){return this.heightmap.load("./assets/height1.png").then(this.updateGeom)},getLoadables:function(){return[this.loadHeight()]},_updateGeom:function(){this.geom.updateHeights(this.heightmap),this.normalGen.invalidate()},makeGroundMat:function(){var a=this.scene,b=new j(a.gl);return b._precision="highp",b.setIBL(a.env.ibl),b.albedo=b.iAlbedo.attachUniform("uAlbedo"),b.gloss=b.iGloss.attachUniform("uGloss"),b.specular=b.iSpecular.attachUniform("uSpecular"),b.normal=b.iNormal.attachSampler("tNormal","vTexCoord"),b.lmap=b.iLightmap.attachSampler("tLightmap","vTexCoord"),b.bgGradient=this.scene.bg.gradientTex,k.HexInput(b.albedo,16777215),k.HexInput(b.specular,4210752),b.gloss.set(.3),b.normal.set(this.normalGen.nrmTex()),b.lmap.set(this.lightmapGen.tex()),b.tonemap.enable(),b._mask=1,b.config.enableCullface(!0),b.config.enableDepthTest(),b.config.depthMask(!0),b}},b.exports=d},{"./gl/ground-material":124,"./ground-geom":130,"./heightmap":132,"./lightmap-gen":134,"./normal-gen":136,"lib/color":32,"nanogl-node":214}],132:[function(a,b,c){function d(){this.decode=this._decode.bind(this),this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=f,this.data=new Float32Array(f*f),this.min=0,this.max=0,this.ctx=this.canvas.getContext("2d")}var e=a("lib/net"),f=128;d.prototype={load:function(a){return e.loadImage(a).then(this.decode)},sample:function(a,b){var c=2*a-1,d=2*b-1,e=Math.max(c*c,d*d),g=1-e,h=Math.floor(a*(f-1))+Math.floor(b*f)*f;return this.data[h]*g},_decode:function(a){a.width,a.height;this.ctx.drawImage(a,0,0,f,f);var b=this.ctx.getImageData(0,0,f,f);return this._normalize(b.data)},_normalize:function(a){var b=f*f,c=this.data,d=.05/255;this.min=1e3,this.max=0;for(var e=0;e<b;e++){var g=a[4*e],h=g*d;this.min=Math.min(this.min,h),this.max=Math.max(this.max,h),c[e]=h}return c}},b.exports=d},{"lib/net":51}],133:[function(a,b,c){function d(a){this.soundsLoaded=this._soundsLoaded.bind(this),this.context=a,this.gl=a.scene.gl,this.scene=a.scene,this.node=a.node,this.dezoom=0,this.physic=new l(this),this.programs=new m(this),this.lights=new k(this),this.ship=new n(this),this.gshadow=new h(this.scene,1,1),this.gshadow.enabled=j.param("space_gshadow"),this.gshadow.opacity=.7,this.node.add(this.lights.node),this.node.add(this.gshadow.node),this.node.z=.3,this.gshadowSmoke=this.gshadow.makeCustomDepthPass(f(["#define GLSLIFY 1\nattribute vec3 aPosition;\nattribute vec4 iData;\n\nuniform mat4 uMVP;\n\n#ifdef D_RGB \n  varying vec2 fragZW;\n#endif\n\n  \nvoid main( void ){\n\n  vec4 pos = vec4( aPosition*iData.w*1.5 + iData.xyz , 1.0 );\n  gl_Position    = uMVP         * pos;\n\n  #ifdef D_RGB\n    fragZW = gl_Position.zw;\n  #endif\n}\n"])),this.currentFc=1,this.thrustGain=this.context.audioContext.createGain(),this.thrustGain.connect(this.context.audioOutput),this.thrustGain.gain.value=0}function e(a){return new d(a)}var f=(a("nanogl-node"),a("glslify")),g=a("when"),h=(a("./ground"),a("entities/ground-shadow")),i=a("lib/math"),j=a("lib/quality"),k=a("./lights"),l=a("./physic"),m=a("./programs"),n=a("./ship/ship");d.prototype={_soundsLoaded:function(a){this.thrustSound=a.shift().play(!0),this.thrustStart=a.shift(),this.thrustStop=a.shift(),this.contacts=a,this.thrustSound.disconnect(),this.thrustSound.connect(this.thrustGain)},getLoadables:function(){for(var a=[],b=[this.context.makeAudioBufferSource("sounds/lander-loop.mp3"),this.context.makeAudioBufferSource("sounds/lander-start.mp3"),this.context.makeAudioBufferSource("sounds/lander-stop.mp3")],c=0;c<4;c++){var d=this.context.makeAudioBufferSource("sounds/lander-hit-0"+c+".mp3");b.push(d)}return g.all(b).then(this.soundsLoaded),a=a.concat(this.ship.getLoadables()),a=a.concat(b)},setPosition:function(){},start:function(){this.ship.reset()},stop:function(){},thrustChange:function(a){var b=a?this.thrustStart:this.thrustStop;b.play(!1,.4)},playContact:function(a,b){var c;a?(c=this.currentFc,this.currentFc++,4==this.currentFc&&(this.currentFc=1)):c=0,this.contacts[c].play(!1,b)},preRender:function(){var a=this.scene.dt;this.physic.step(a),this.ship.preRender();var b=this.thrustGain.gain.value;this.ship.thrust._thrust?b+=a/.2:b-=a/.2,this.thrustGain.gain.value=i.clamp(b),this.gshadow.node.x=this.ship.origin.x,this.gshadow.node.z=this.ship.origin.z,this.gshadow.spread=.6+Math.min(1.5,5*this.ship.origin.y),this.gshadow.depth=.5;var c=this.ship.origin.y-.2;c=Math.min(.09,Math.max(0,c)),this.dezoom+=(c-this.dezoom)*this.scene.dt*.3},rttPass:function(){this.ship.rttPass(),this.gshadow.enabled&&this.gShadowPass()},render:function(){this.ship.render(1),this.ship.render(2),this.gshadow.render(this.scene.camera)},postRender:function(){},gShadowPass:function(){var a,b=this.scene.glstate;b.apply(),this.gshadow.prepare(),b.push(this.gshadow.defaultCfg),b.apply(),a=this.gshadow.getDefaultDepthPass(),a.use(),this.ship.renderProgram(this.gshadow.camera,a),a=this.gshadowSmoke,a.use(),this.ship.thrust.renderPrg(this.gshadow.camera,a),b.pop(),this.gshadow.process(),b.apply()},getCameraPosition:function(a,b){a[1]+=1.5*this.dezoom,a[2]+=1.5*this.dezoom,b[1]=.7*a[1],b[2]=.5}},b.exports=e},{"./ground":131,"./lights":135,"./physic":137,"./programs":138,"./ship/ship":146,"entities/ground-shadow":23,glslify:205,"lib/math":49,"lib/quality":53,"nanogl-node":214,when:280}],134:[function(a,b,c){function d(a){this.ground=a,this.scene=a.scene,this.mod=a.mod,this.gl=this.scene.gl;var b=this.gl;this.accMat=this.makeMaterial(),this.float_texture_ext=b.getExtension("OES_texture_float"),this.halfFloat=b.getExtension("OES_texture_half_float"),this.float_texture_ext_l=b.getExtension("OES_texture_half_float_linear"),this.halfFloat_l=b.getExtension("OES_texture_float_linear");var c=[b.FLOAT];this.halfFloat&&c.unshift(this.halfFloat.HALF_FLOAT_OES),this.fbo=new e(b,{depth:!1,stencil:!1,type:c,format:b.RGB}),this.fbo.resize(h,h),this.fbo.color.clamp()}var e=a("nanogl/fbo"),f=a("./gl/lightmap-accu"),g=a("lib/color"),h=1024;d.prototype={tex:function(){return this.fbo.color},render:function(){this.accMat.sampleCount>1024||(this.accMat.sampleCount++,this.fbo.bind(),this.gl.viewport(0,0,h,h),this.scene.glstate.push(this.accMat.config),this.ground.renderPass(null,1,this.accMat),this.scene.glstate.pop())},makeMaterial:function(){var a=this.scene,b=a.gl,c=new f(b);return c._precision="highp",c.setLightSetup(this.mod.lights.lmSetup),c.albedo=c.iAlbedo.attachUniform("uAlbedo"),g.HexInput(c.albedo,16711422),c.normal=c.iNormal.attachSampler("tNormal","vTexCoord"),c.normal.set(this.ground.normalGen.nrmTex()),c._mask=1,c.config.enableCullface(!1),c.config.enableDepthTest(!1),c.config.enableBlend(!0),c.config.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),c}},b.exports=d},{"./gl/lightmap-accu":126,"lib/color":32,"nanogl/fbo":251}],135:[function(a,b,c){function d(a){var b=a.scene;this.scene=b,this.gl=b.gl;var c=this.gl;this.node=new h,this.lmSetup=new f,this.lmSetup._registerModel("lm",new i);var j=2;this.lmSetup.bounds.fromMinMax([j*-.6,j*-.1,j*-.6],[.6*j,.2*j,.6*j]),this.lmDirs=[];for(var k=0;k<d.NUM_LIGHTMAP_DIR;k++){var l=new e(c);l.lookAt([1,-.1,0]);var m=3;l._color.set([m,m,m]),l._shadowmapSize=1024,l.castShadows(!0),this.lmDirs.push(l),this.lmSetup.add(l),this.node.add(l)}this.lmDepthPass=new g(c),this.lmDepthPass.setLightSetup(this.lmSetup),this.depthCfg=b.glstate.config().enableCullface(!1).enableDepthTest(!0).depthMask(!0)}var e=a("nanogl-pbr/lib/lights/directional-light"),f=a("nanogl-pbr/lib/lights/light-setup"),g=a("nanogl-pbr/depthpass"),h=a("nanogl-node"),i=a("lib/lightmap/lightmap-model"),j=a("gl-matrix"),k=j.vec3,l=k.create();d.NUM_LIGHTMAP_DIR=4;var m=k.fromValues(1,1,1);k.normalize(m,m),d.prototype={preRender:function(){for(var a=0;a<this.lmDirs.length;a++){k.random(l,1),l[1]=-Math.abs(l[1]);var b=-k.dot(m,l);b=.5*b+.5,b<0&&(b=0);var c=this.lmDirs[a]._color;c[0]=2*b,c[1]=2*b,c[2]=2*b,this.lmDirs[a].lookAt(l)}}},b.exports=d},{"gl-matrix":192,"lib/lightmap/lightmap-model":39,"nanogl-node":214,"nanogl-pbr/depthpass":215,"nanogl-pbr/lib/lights/directional-light":232,"nanogl-pbr/lib/lights/light-setup":233}],136:[function(a,b,c){function d(a){this._valid=!1,this.ground=a,this.gl=a.scene.gl,this.nrm_fbo=new e(this.gl),this.nrm_fbo.resize(g,g),this.nrm_fbo.color.clamp(),this.depth_fbo=f.create(this.gl,{depth:!0,format:this.gl.RGB}),this.depth_fbo.resize(g,g),this.depth_fbo.color.clamp(),this.depthCfg=this.ground.scene.glstate.config().enableCullface(!1).depthMask(!0).enableDepthTest(),this.nrmCfg=this.ground.scene.glstate.config().enableCullface(!1).depthMask(!1).enableDepthTest(!1)}var e=a("nanogl/fbo"),f=a("nanogl-depth-texture/fbo"),g=2048;d.prototype={nrmTex:function(){return this.nrm_fbo.color},render:function(){if(!this._valid){var a=this.ground.mod.programs;this.gl.viewport(0,0,g,g),this.gl.clearColor(.5,0,0,0),this.gl.clearDepth(1);var b=this.depth_fbo.attachment.isDepthTexture()?a.depth:a.depthRGB;this.depth_fbo.bind(),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),b.use(),b.zScale(1/this.ground.heightmap.max),this.depthCfg.apply(),this.ground.geom.attribPointer(b),this.ground.geom.render();var c=this.depth_fbo.attachment,d=c.isDepthTexture()?c.buffer:this.depth_fbo.color,e=this.depth_fbo.attachment.isDepthTexture()?a.normal:a.normalRGB;this.nrm_fbo.bind(),this.gl.clear(this.gl.COLOR_BUFFER_BIT),e.use(),e.tDepth(d),d.clamp(),e.zScale(this.ground.heightmap.max),e.uPixelSize(1/g);var f=this.ground.scene.quad;f.attribPointer(e),this.nrmCfg.apply(),f.render()}},invalidate:function(){this._valid=!1}},b.exports=d},{"nanogl-depth-texture/fbo":210,"nanogl/fbo":251}],137:[function(a,b,c){function d(a){this.mod=a;var b=new CANNON.World;b.gravity.set(0,-.82,0),b.defaultContactMaterial.friction=.01,this.world=b;var c=new CANNON.Body({mass:0}),d=new CANNON.Plane;c.addShape(d),c.position.y=-.003,c.quaternion.setFromEuler(-Math.PI/2,0,0,"XYZ"),b.addBody(c);for(var f=0;f<e.length/4;f++){var g=new CANNON.Body({mass:0}),h=e[4*f+0]/1e3,i=e[4*f+1]/1e3,j=e[4*f+2]/1e3,k=e[4*f+3]/1e3;g.addShape(new CANNON.Sphere(k),new CANNON.Vec3(h,j,-i)),b.addBody(g)}}var e=a("./ship/physdata_rocks");d.prototype={step:function(a){this.world.step(a)}},b.exports=d},{"./ship/physdata_rocks":144}],138:[function(a,b,c){function d(a){var b=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT),c=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT);return c.precision>0&&b.precision>0}function e(a){var b=a.gl;this.hasHighp=d(b),this.programs=[this.ground=new f(b),this.depth=new f(b),this.depthRGB=new f(b),this.normal=new f(b),this.normalRGB=new f(b),this.smokeDepth=new f(b),this.smokeDepthRGB=new f(b),this.blurDepth=new f(b),this.blurDepthRGB=new f(b),this.smokeNormal=new f(b),this.blurNormal=new f(b)],this.compile()}var f=a("nanogl/program"),g=a("glslify"),h=a("./ship/smoke-renderer");e.prototype={precision:function(){return this.hasHighp?"highp":"mediump"},compile:function(){var a="\n";a+="precision "+this.precision()+" float;\n",this.depth.compile(g(["#define GLSLIFY 1\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\nuniform float zScale;\n\n#ifdef D_RGB \n  varying vec2 fragZW;\n#endif\n\n  \nvoid main( void ){\n\n  vec4 pos = vec4( aPosition, 1.0 );\n  gl_Position = vec4(\n    aPosition.x * 2.0 - 1.0,\n    aPosition.z * 2.0 - 1.0,\n    (aPosition.y * zScale * 2.0 - 1.0),\n    1.0\n  );\n\n  #ifdef D_RGB\n    fragZW=gl_Position.zw;\n  #endif\n}\n"]),g(["#define GLSLIFY 1\n\n#ifdef D_RGB\n\n  varying vec2 fragZW;\n\n  vec3 encodeDepthRGB(float depth){\n    vec4 c = vec4(1.0,255.0,65025.0,16581375.0)*depth;\n    c=fract(c);\n    c.xyz-=c.yzw*(1.0/255.0);\n    return c.xyz;\n  }\n\n#endif\n\nvoid main(void){\n\n  \n  #ifdef D_RGB\n    gl_FragColor.xyz = encodeDepthRGB( ( fragZW.x / fragZW.y ) * 0.5 + 0.5 );\n    gl_FragColor.w=0.0;\n  #else\n    gl_FragColor = vec4( 0.0 );\n  #endif\n\n}\n"]),a),this.depthRGB.compile(g(["#define GLSLIFY 1\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\nuniform float zScale;\n\n#ifdef D_RGB \n  varying vec2 fragZW;\n#endif\n\n  \nvoid main( void ){\n\n  vec4 pos = vec4( aPosition, 1.0 );\n  gl_Position = vec4(\n    aPosition.x * 2.0 - 1.0,\n    aPosition.z * 2.0 - 1.0,\n    (aPosition.y * zScale * 2.0 - 1.0),\n    1.0\n  );\n\n  #ifdef D_RGB\n    fragZW=gl_Position.zw;\n  #endif\n}\n"]),g(["#define GLSLIFY 1\n\n#ifdef D_RGB\n\n  varying vec2 fragZW;\n\n  vec3 encodeDepthRGB(float depth){\n    vec4 c = vec4(1.0,255.0,65025.0,16581375.0)*depth;\n    c=fract(c);\n    c.xyz-=c.yzw*(1.0/255.0);\n    return c.xyz;\n  }\n\n#endif\n\nvoid main(void){\n\n  \n  #ifdef D_RGB\n    gl_FragColor.xyz = encodeDepthRGB( ( fragZW.x / fragZW.y ) * 0.5 + 0.5 );\n    gl_FragColor.w=0.0;\n  #else\n    gl_FragColor = vec4( 0.0 );\n  #endif\n\n}\n"]),a+"#define D_RGB 1"),this.ground.compile(g(["#define GLSLIFY 1\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\nvarying vec2 vTexCoord;\n\nvoid main( void ){\n\n  vTexCoord = aPosition.xz;\n\n  vec4 pos = vec4( aPosition, 1.0 );\n  gl_Position = uMVP * pos;\n  // gl_Position = vec4( aPosition, .5, 1.0 );\n\n}\n"]),g(["#define GLSLIFY 1\nvarying vec2 vTexCoord;\n\nuniform sampler2D tNormal;\nuniform vec3 uLightDir;\n\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\nvoid main( void ){\n\n  vec3 nrm = texture2D( tNormal, vTexCoord ).rgb;\n  nrm.xz = nrm.xz * 2.0 - 1.0;\n\n  float lum = sdot( uLightDir, nrm );\n\n  gl_FragColor = vec4( vec3(lum), 0.0 );\n  // gl_FragColor = vec4( nrm.xy, vTexCoord.y, 0.0 );\n\n}\n"]),a),this.normal.compile(g(["#define GLSLIFY 1\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord = aTexCoord;\n\n}\n"]),g(["#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D tDepth;\nuniform float zScale;\nuniform float uPixelSize;\n\n// RGB depth decoding\n// ------------------\nhighp float decodeDepthRGB(highp vec3 rgb){\n  return(rgb.x+rgb.y*(1.0/255.0))+rgb.z*(1.0/65025.0);\n}\n\n#ifdef D_RGB\n\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return decodeDepthRGB( texture2D(t,uvs).xyz );\n  }\n\n#else\n\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return texture2D(t,uvs).x;\n  }\n\n#endif\n\nvoid main(void){\n\n  float depth = FETCH_DEPTH( tDepth, vTexCoord ) * zScale;\n  float depthDX = FETCH_DEPTH( tDepth, vTexCoord + vec2( uPixelSize, 0.0 ) ) * zScale;\n  float depthDY = FETCH_DEPTH( tDepth, vTexCoord + vec2( 0.0, uPixelSize ) ) * zScale;\n\n  vec3 vtan = vec3( uPixelSize, 0.0, depthDX-depth );\n  vec3 vbin = vec3( 0.0, uPixelSize, depthDY-depth );\n\n  vec3 nrm = normalize( cross( vtan, vbin ) );\n  nrm.xy = nrm.xy*.5+.5; \n  \n  gl_FragColor.xyz = nrm.xzy;\n  // gl_FragColor.xy = vTexCoord.xy;\n  gl_FragColor.w = 1.0;\n\n}\n"]),a),
this.normalRGB.compile(g(["#define GLSLIFY 1\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord = aTexCoord;\n\n}\n"]),g(["#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D tDepth;\nuniform float zScale;\nuniform float uPixelSize;\n\n// RGB depth decoding\n// ------------------\nhighp float decodeDepthRGB(highp vec3 rgb){\n  return(rgb.x+rgb.y*(1.0/255.0))+rgb.z*(1.0/65025.0);\n}\n\n#ifdef D_RGB\n\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return decodeDepthRGB( texture2D(t,uvs).xyz );\n  }\n\n#else\n\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return texture2D(t,uvs).x;\n  }\n\n#endif\n\nvoid main(void){\n\n  float depth = FETCH_DEPTH( tDepth, vTexCoord ) * zScale;\n  float depthDX = FETCH_DEPTH( tDepth, vTexCoord + vec2( uPixelSize, 0.0 ) ) * zScale;\n  float depthDY = FETCH_DEPTH( tDepth, vTexCoord + vec2( 0.0, uPixelSize ) ) * zScale;\n\n  vec3 vtan = vec3( uPixelSize, 0.0, depthDX-depth );\n  vec3 vbin = vec3( 0.0, uPixelSize, depthDY-depth );\n\n  vec3 nrm = normalize( cross( vtan, vbin ) );\n  nrm.xy = nrm.xy*.5+.5; \n  \n  gl_FragColor.xyz = nrm.xzy;\n  // gl_FragColor.xy = vTexCoord.xy;\n  gl_FragColor.w = 1.0;\n\n}\n"]),a+"#define D_RGB 1"),this.smokeDepth.compile(g(["#define GLSLIFY 1\n\nattribute vec3 aPosition;\nattribute vec4 iData;\n\nuniform mat4 uMVP;\n\nuniform float zScale;\n\n#ifdef D_RGB \n  varying vec2 fragZW;\n#endif\n\n  \nvoid main( void ){\n\n  vec4 pos = vec4( aPosition*iData.w + iData.xyz , 1.0 );\n  gl_Position    = uMVP         * pos;\n\n  #ifdef D_RGB\n    fragZW=gl_Position.zw;\n  #endif\n}\n\n"]),g(["#define GLSLIFY 1\n\n#ifdef D_RGB\n\n  varying vec2 fragZW;\n\n  vec3 encodeDepthRGB(float depth){\n    vec4 c = vec4(1.0,255.0,65025.0,16581375.0)*depth;\n    c=fract(c);\n    c.xyz-=c.yzw*(1.0/255.0);\n    return c.xyz;\n  }\n\n#endif\n\nvoid main(void){\n\n  \n  #ifdef D_RGB\n    gl_FragColor.xyz = encodeDepthRGB( ( fragZW.x / fragZW.y ) * 0.5 + 0.5 );\n    gl_FragColor.w=0.0;\n  #else\n    gl_FragColor = vec4( 0.0 );\n  #endif\n\n}\n"]),a),this.smokeDepthRGB.compile(g(["#define GLSLIFY 1\n\nattribute vec3 aPosition;\nattribute vec4 iData;\n\nuniform mat4 uMVP;\n\nuniform float zScale;\n\n#ifdef D_RGB \n  varying vec2 fragZW;\n#endif\n\n  \nvoid main( void ){\n\n  vec4 pos = vec4( aPosition*iData.w + iData.xyz , 1.0 );\n  gl_Position    = uMVP         * pos;\n\n  #ifdef D_RGB\n    fragZW=gl_Position.zw;\n  #endif\n}\n\n"]),g(["#define GLSLIFY 1\n\n#ifdef D_RGB\n\n  varying vec2 fragZW;\n\n  vec3 encodeDepthRGB(float depth){\n    vec4 c = vec4(1.0,255.0,65025.0,16581375.0)*depth;\n    c=fract(c);\n    c.xyz-=c.yzw*(1.0/255.0);\n    return c.xyz;\n  }\n\n#endif\n\nvoid main(void){\n\n  \n  #ifdef D_RGB\n    gl_FragColor.xyz = encodeDepthRGB( ( fragZW.x / fragZW.y ) * 0.5 + 0.5 );\n    gl_FragColor.w=0.0;\n  #else\n    gl_FragColor = vec4( 0.0 );\n  #endif\n\n}\n"]),a+"#define D_RGB 1"),this.blurDepth.compile(g(["#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord = aTexCoord;\n\n}\n"]),g(["#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\nuniform sampler2D tDepth;\nuniform float uPixelSize;\n\n// RGB depth decoding\n// ------------------\nhighp float decodeDepthRGB(highp vec3 rgb){\n  return(rgb.x+rgb.y*(1.0/255.0))+rgb.z*(1.0/65025.0);\n}\n\n#ifdef D_RGB\n\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return decodeDepthRGB( texture2D(t,uvs).xyz );\n  }\n\n#else\n\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return texture2D(t,uvs).x;\n  }\n\n#endif\n\nvoid main(void){\n\n  vec2 dtc = vec2( 1.5 * uPixelSize, .5*uPixelSize );\n\n  float depth   = \n    FETCH_DEPTH( tDepth, vTexCoord ) +\n    FETCH_DEPTH( tDepth, vTexCoord + dtc.xy ) +\n    FETCH_DEPTH( tDepth, vTexCoord + dtc.yx ) +\n    FETCH_DEPTH( tDepth, vTexCoord - dtc.xy ) +\n    FETCH_DEPTH( tDepth, vTexCoord - dtc.yx );\n\n  depth /= 5.0;\n\n  gl_FragColor.r = depth;\n  gl_FragColor.gba = vec3( 1.0 );\n\n}\n"]),a),this.blurDepthRGB.compile(g(["#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord = aTexCoord;\n\n}\n"]),g(["#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\nuniform sampler2D tDepth;\nuniform float uPixelSize;\n\n// RGB depth decoding\n// ------------------\nhighp float decodeDepthRGB(highp vec3 rgb){\n  return(rgb.x+rgb.y*(1.0/255.0))+rgb.z*(1.0/65025.0);\n}\n\n#ifdef D_RGB\n\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return decodeDepthRGB( texture2D(t,uvs).xyz );\n  }\n\n#else\n\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return texture2D(t,uvs).x;\n  }\n\n#endif\n\nvoid main(void){\n\n  vec2 dtc = vec2( 1.5 * uPixelSize, .5*uPixelSize );\n\n  float depth   = \n    FETCH_DEPTH( tDepth, vTexCoord ) +\n    FETCH_DEPTH( tDepth, vTexCoord + dtc.xy ) +\n    FETCH_DEPTH( tDepth, vTexCoord + dtc.yx ) +\n    FETCH_DEPTH( tDepth, vTexCoord - dtc.xy ) +\n    FETCH_DEPTH( tDepth, vTexCoord - dtc.yx );\n\n  depth /= 5.0;\n\n  gl_FragColor.r = depth;\n  gl_FragColor.gba = vec3( 1.0 );\n\n}\n"]),a+"#define D_RGB 1"),this.smokeNormal.compile(g(["#define GLSLIFY 1\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\n\nattribute vec4 iData;\n\nuniform mat4 uMVP;\nuniform mat3 uMV;\n\nvarying vec3 vViewNormal;\n  \nvoid main( void ){\n\n  vec4 pos = vec4( aPosition*iData.w + iData.xyz , 1.0 );\n  gl_Position    = uMVP         * pos;\n\n  vViewNormal = uMV * aNormal;\n\n}\n\n"]),g(["#define GLSLIFY 1\n\nvarying vec3 vViewNormal;\n\nvoid main(void){\n\n  vec3 color = normalize( vViewNormal );\n  // color.rg = color.rg * .5 + .5;\n  gl_FragColor.xyz = color;\n\n  gl_FragColor.a=0.0;\n\n}\n"]),a),this.blurNormal.compile(g(["#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord = aTexCoord;\n\n}\n"]),g(["#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\nuniform sampler2D tNormal;\nuniform vec3 uKernel[NUM_SAMPLES];\n\nvoid main(void){\n\n  vec3 color = vec3(0.0);\n\n  for(int i=0; i<NUM_SAMPLES; ++i)\n  {\n    vec3 kernel = uKernel[i].xyz;\n    color += texture2D( tNormal, vTexCoord + kernel.xy ).xyz * kernel.z;\n  }\n\n  gl_FragColor = vec4( normalize( color ), 0.0 );\n  // gl_FragColor = vec4(  color, 0.0 );\n\n}\n"]),a+"#define NUM_SAMPLES "+h.BLUR_SAMPLES),this.process()},process:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].use()},dispose:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].dispose();this.programs=null}},b.exports=e},{"./ship/smoke-renderer":148,glslify:205,"nanogl/program":253}],139:[function(a,b,c){function d(){this.thrust=!1,this.ship=null,this.target=g.fromValues(0,2,0)}var e=a("gl-matrix"),f=a("lib/mouse");MathUtils=a("lib/math");var g=e.vec3,h=(e.vec2,e.quat),i=e.mat4,j=(e.mat3,g.create()),k=(g.create(),i.create());h.create(),Math.PI;d.prototype={init:function(a){this.ship=a},release:function(){},preRender:function(){var a=(this.ship.scene.dt,f.coords,this.ship.aaMatrix),b=(a[13]<.3,.135+2*(.3-a[13]));if(b>.1){this.target[2]=this.ship.baseZ,i.invert(k,a),g.transformMat4(j,this.target,k),g.normalize(j,j);var c=Math.sqrt(j[0]*j[0]+j[1]*j[1]),d=Math.min(.5,c),e=d/c*3;this.ship.physic.thrust(b,j[0]*e,j[2]*e)}else this.ship.thrust.thrust(!1)}},b.exports=d},{"gl-matrix":192,"lib/math":49,"lib/mouse":50}],140:[function(a,b,c){function d(){this.thrust=!1,this.ship=null,this.thrust=!1,this.c=0,this.target=g.fromValues(0,2,.5),this.landedDefer=null}var e=a("gl-matrix"),f=a("when"),g=(a("lib/mouse"),a("lib/math"),e.vec3),h=(e.vec2,e.quat),i=e.mat4,j=(e.mat3,g.create()),k=(g.create(),i.create());h.create(),Math.PI;d.prototype={init:function(a){this.ship=a,this.landedDefer&&this.landedDefer.reject(),this.landedDefer=f.defer()},release:function(){},preRender:function(){var a=this.ship.origin._matrix;if(this.c++,this.c>15&&(this.c=0,this.thrust=this.ship.velocity[1]<-.0015&&a[13]>.02),a[13]<.15&&(this.thrust=!1),a[13]<.09&&this.landedDefer.resolve(),this.thrust){this.target[2]=this.ship.baseZ;var b=.2,c=this.ship.aaMatrix;i.invert(k,c),g.transformMat4(j,this.target,k),g.normalize(j,j);var d=Math.sqrt(j[0]*j[0]+j[1]*j[1]),e=Math.min(.5,d),f=e/d*3;this.ship.physic.thrust(b,j[0]*f,j[2]*f)}else this.ship.thrust.thrust(!1)},onLanded:function(){return this.landedDefer.promise}},b.exports=d},{"gl-matrix":192,"lib/math":49,"lib/mouse":50,when:280}],141:[function(a,b,c){function d(){this.thrust=!1,this.ship=null,this.pos=g.create(),this.vel=g.create(),this.avel=0,this.angle=0,this.twist=0,this.autoPilot=!0,this.target=g.fromValues(0,2,.5)}var e=a("gl-matrix"),f=a("lib/mouse");MathUtils=a("lib/math");var g=e.vec3,h=(e.vec2,e.quat),i=e.mat4,j=(e.mat3,g.create()),k=g.create(),l=i.create();h.create(),Math.PI;d.prototype={init:function(a){this.ship=a},release:function(){},preRender:function(){var a=(this.ship.scene.dt,f.coords,this.ship.aaMatrix);this.target[1]=a[13]+2,this.target[2]=this.ship.baseZ;var b=f.isDown();if(this.getMousePosition(k,f.coords),this.target[0]=k[0],b){var c=.2;i.invert(l,a),g.transformMat4(j,this.target,l),g.normalize(j,j),this.ship.physic.thrust(c,2*j[0],2*j[2])}else this.ship.thrust.thrust(!1);this.thrust=b},getMousePosition:function(a,b){j[0]=b[0],j[1]=b[1],j[2]=1;var c=this.ship.scene.camera;i.invert(l,c._viewProj),g.transformMat4(j,j,l),g.sub(j,j,c._wposition);var d=(c._wposition[2]-.5)/j[2];a[0]=c._wposition[0]-j[0]*d,a[1]=c._wposition[1]-j[1]*d}},b.exports=d},{"gl-matrix":192,"lib/math":49,"lib/mouse":50}],142:[function(a,b,c){function d(a){this.ship=a,this.controler=null}d.prototype={setControler:function(a){this.controler&&this.controler.release(),this.controler=a,a.init(this.ship)},preRender:function(){this.controler&&this.controler.preRender()}},b.exports=d},{}],143:[function(a,b,c){b.exports=[0,0,70.7711,58.663,0,0,176.221,16.4904,.131619,-109.609,-1.95397,16.4904,95.1235,54.9494,-1.95397,16.4904,-94.2505,54.886,-1.95397,16.4904]},{}],144:[function(a,b,c){b.exports=[264.435,20.6507,8.36814,36.5566,284.653,-99.4366,0,20.7954,256.643,-135.31,0,9.40483,175.9,-212.732,0,14.4275,-240.441,-32.5052,4.90506,31.3012,-262.97,-88.826,1.43916,13.9513,-162.892,-188.471,0,8.66476]},{}],145:[function(a,b,c){function d(a){this.onCollide=this._onCollide.bind(this),this.ship=a,this.body=null}var e=a("gl-matrix");a("lib/mouse");MathUtils=a("lib/math");var f=e.vec3,g=(e.vec2,e.quat),h=e.mat4,i=(e.mat3,f.create()),j=f.create(),k=f.create(),l=f.create(),m=(h.create(),g.create(),a("./physdata"));d.prototype={reset:function(){this.body.position.set(0,.5,this.ship.baseZ),this.body.velocity.set(0,0,0),this.body.angularVelocity.set(0,.3,0),this.body.quaternion.setFromEuler(.05*Math.random(),.05*Math.random(),.05*Math.random(),"XYZ")},thrust:function(a,b,c){var d=70,e=this.ship.aaMatrix;i[0]=e[4],i[1]=e[5],i[2]=e[6],k[0]=e[0],k[1]=e[1],k[2]=e[2],l[0]=e[8],l[1]=e[9],l[2]=e[10],j[0]=e[12],j[1]=e[13],j[2]=e[14],f.scaleAndAdd(j,j,i,-.0551);var g=this.ship.physic.body,h=new CANNON.Vec3(j[0],j[1],j[2]);f.scaleAndAdd(i,i,k,-b),f.scaleAndAdd(i,i,l,-c),f.normalize(i,i);var m=new CANNON.Vec3(i[0]*a*d,i[1]*a*d,i[2]*a*d);this.ship.thrust.thrust(a>0),this.ship.thrust.thrustDir.set(i),g.applyForce(m,h)},setup:function(){var a=this.ship.mod.physic,b=a.world,c=10,d=new CANNON.Body({mass:c});this.body=d;for(var e=0;e<m.length/4;e++){var f=m[4*e+0]/1e3,g=m[4*e+1]/1e3,h=m[4*e+2]/1e3,i=m[4*e+3]/1e3;d.addShape(new CANNON.Sphere(i),new CANNON.Vec3(f,h-.07,-g))}d.addEventListener("collide",this.onCollide),b.addBody(d),this.reset()},_onCollide:function(a){var b=-this.body.velocity.y,c=this.body.shapes.indexOf(a.contact.si);if(c>1){if(b<.1)return;var d=1+Math.floor(3*Math.random()),e=MathUtils.clamp(.2+.8*b);this.ship.mod.playContact(d,e)}else c>-1&&this.ship.mod.playContact(0,.4)},clearForces:function(){this.body.force.set(0,0,0),this.body.torque.set(0,0,0)},sync:function(){var a=this.ship.origin,b=a.rotation,c=a.position,d=this.body.quaternion,e=this.body.position;b[0]=d.x,b[1]=d.y,b[2]=d.z,b[3]=d.w,c[0]=e.x,c[1]=e.y,c[2]=e.z,a.invalidate(),a.updateMatrix()}},b.exports=d},{"./physdata":143,"gl-matrix":192,"lib/math":49,"lib/mouse":50}],146:[function(a,b,c){function d(a,b){a[4]=s[0]=b[4],a[5]=s[1]=b[5],a[6]=s[2]=b[6],a[12]=b[12],a[13]=b[13],a[14]=b[14],q.cross(t,s,v),q.squaredLength<.001?(q.cross(u,w,s),q.cross(t,s,u)):q.cross(u,t,s),q.normalize(t,t),q.normalize(u,u),a[0]=u[0],a[1]=u[1],a[2]=u[2],a[8]=t[0],a[9]=t[1],a[10]=t[2]}function e(a){this.mod=a;var b=a.scene;i.call(this,b,"spaceship"),this.onResetLanded=this._onResetLanded.bind(this),this.origin=new g,this.origin.add(this.node),this.aaMatrix=r.create(),this.physic=new n(this),this.control=new m(this),this.setupMaterials(),this.physic.setup(),this.baseZ=0,this.node.y=-.07,this.framesUpsideDown=0,this.origin.rotateZ(-.7),this.prevPos=q.create(),this.velocity=q.create(),a.node.add(this.origin)}var f=(a("when"),a("gl-matrix")),g=a("nanogl-node"),h=a("nanogl-pbr/standard"),i=a("assets/awd-scene"),j=(a("dev/gui"),a("config"),a("lib/color")),k=(a("../gl/instanced-standard"),a("../gl/rock-occlu")),l=a("./thrust"),m=a("../scontrol/master"),n=a("./ship-physic"),o=a("../scontrol/ctrl-manual"),p=(a("../scontrol/ctrl-auto-hover"),a("../scontrol/ctrl-auto-landing")),q=f.vec3,r=f.mat4,s=q.create(),t=q.create(),u=q.create(),v=q.fromValues(1,0,0),w=q.fromValues(0,0,1),x=40;e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.reset=function(){this.physic.reset(),this.physic.sync();var a=new p;this.control.setControler(a),a.onLanded().then(this.onResetLanded)},e.prototype._onResetLanded=function(){this.control.setControler(new o)},e.prototype.getLoadables=function(){var a=i.prototype.getLoadables.call(this);return a},e.prototype.getAssetPath=function(a){return"space/"+a},e.prototype.getTexturePath=function(a){return"space/"+a},e.prototype.getAwdUrl=function(){return this.getAssetPath("scene.awd")},e.prototype.texPath=function(a){return[this.getTexturePath(a+"_LB.jpg"),this.getTexturePath(a+"_L0.jpg"),this.getTexturePath(a+"_L1.jpg")]},e.prototype.preRender=function(){this.framesUpsideDown>x&&(this.reset(),this.framesUpsideDown=0),this.prevPos.set(this.origin.position),d(this.aaMatrix,this.origin._matrix),this.physic.clearForces(),this.control.preRender(),this.thrust.preRender(),this.physic.sync(),q.sub(this.velocity,this.origin.position,this.prevPos),this.isUpside()?this.framesUpsideDown++:this.framesUpsideDown=0},e.prototype.isUpside=function(){return this.origin._matrix[5]<.1},e.prototype.rttPass=function(){this.thrust.rttPass()},e.prototype.renderSmokeRtt=function(a){this.thrust.renderPrg(this.scene.camera,a)},e.prototype.renderProgram=function(a,b){this.shipmesh.renderProgram(a,b)},e.prototype.setupTextures=function(){},e.prototype.setupMaterials=function(){var a=this.mats,b=this.texs;a.lib;b.makeTex("OCCLUS",this.getAssetPath("OCCLUS.jpg")).setFilter(!0,!1,!1),b.makeTex("smoke",this.getAssetPath("smoke.png"),this.gl.RGBA).setFilter(!0,!1,!1).nobbc(),this.smokeTex=b.get("smoke");var c=new h(this.gl);c._precision="highp",c.setIBL(this.scene.env.ibl),c.albedo=c.iAlbedo.attachAttribute("aColor"),c.gloss=c.iGloss.attachAttribute("aTexCoord1"),c.specular=c.iSpecular.attachUniform("uSpecular"),c.occlu=c.iCavity.attachSampler("tOcclusion","vTexCoord","g"),c.iCavityStrength.attachConstant([1,1]),j.HexInput(c.specular,3158064),c.occlu.set(b.get("OCCLUS")),c.tonemap.set(!0),c.glossNearest.set(!0),c.conserveEnergy.set(!1),c.perVertexIrrad.set(!0),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"spaceship");var c=new h(this.gl);c._precision="highp",c.setIBL(this.scene.env.ibl),c.albedo=c.iAlbedo.attachUniform("uColor"),c.gloss=c.iGloss.attachConstant(.2),c.specular=c.iSpecular.attachUniform("uSpecular"),c.occlu=c.iCavity.attachSampler("tOcclusion","vTexCoord","r"),c.iCavityStrength.attachConstant([.7,.7]),j.HexInput(c.albedo,7241900),j.HexInput(c.specular,1381653),c.occlu.set(b.get("OCCLUS")),c.tonemap.set(!0),c.glossNearest.set(!0),c.conserveEnergy.set(!1),c.perVertexIrrad.set(!0),c._mask=1,c.config.enableCullface(!0),c.config.enableDepthTest(),c.config.depthMask(!0),a.registerMaterial(c,"rock");var c=new k(this.gl);c._precision="lowp",c.stex=c.iShadow.attachSampler("tshadow","vTexCoord","b"),c.stex.set(b.get("OCCLUS")),a.registerMaterial(c,"rocclu")},e.prototype._postParse=function(){this.shipmesh=this.loader.getObjectByName("lowp");var a=this.loader.getObjectByName("rocks");this.mod.node.add(a);var b=this.loader.getObjectByName("rock_occlu");this.mod.node.add(b);var c=this.loader.getObjectByName("smoke"),d=this.meshes.indexOf(c);this.meshes.splice(d,1),this.thrust=new l(this,c.geom.subgeoms[0]),this.subrenderables.push(this.thrust)},b.exports=e},{"../gl/instanced-standard":125,"../gl/rock-occlu":127,"../scontrol/ctrl-auto-hover":139,"../scontrol/ctrl-auto-landing":140,"../scontrol/ctrl-manual":141,"../scontrol/master":142,"./ship-physic":145,"./thrust":150,"assets/awd-scene":1,config:17,"dev/gui":20,"gl-matrix":192,"lib/color":32,"nanogl-node":214,"nanogl-pbr/standard":239,when:280}],147:[function(a,b,c){function d(a,b){var c=a.gl,d=b.ship;this.thrust=b,this.mod=d.mod,this.scene=a,this.ship=d,this.gl=c,this.createMaterial()}var e=(a("nanogl/fbo"),a("nanogl-depth-texture/fbo"),a("gl-matrix")),f=(a("dev/fbo-debug"),a("lib/color"),a("../gl/smoke-simple-material")),g=e.mat4,h=e.mat3,i=(g.create(),h.create(),d.BLUR_SAMPLES=9);d.prototype={createMaterial:function(){var a=new f(this.gl);a.tex=this.ship.smokeTex,a._precision="highp",a.setIBL(this.scene.env.ibl),a._mask=1,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0),this.smokeMat=a},renderMask:function(){},rttPass:function(){},attribPointer:function(a){this.thrust.particles.iaBuffer.attribPointer(a)},render:function(){if(0!==this.thrust.particles.numInstance){var a=(this.scene.gl,this.smokeMat);a.prepare(this.thrust.parentNode,this.scene.camera);var b=this.scene.camera.lens.getProjection();a.prg.uSizeFactor(.013*this.scene.renderer.height*b[5]),this.attribPointer(a.prg),this.scene.glstate.push(a.config),this.scene.glstate.apply(),this.thrust.particles.iaBuffer.drawPoints(this.thrust.particles.numInstance,0),this.scene.glstate.pop()}},renderPrg:function(a,b){},computeKernel:function(a,b,c){for(var d=b?0:1,e=b?1:0,f=Math.sqrt(Math.PI),g=0,h=0;h<i;++h){var j=3*h,k=h-Math.round((i-1)/2),l=4*k/i;l=Math.exp(-l*l/2)/f,g+=l,a[j+d]=k*c,a[j+e]=0,a[j+2]=l}for(h=0;h<i;++h)a[3*h+2]/=g}},b.exports=d},{"../gl/smoke-simple-material":129,"dev/fbo-debug":19,"gl-matrix":192,"lib/color":32,"nanogl-depth-texture/fbo":210,"nanogl/fbo":251}],148:[function(a,b,c){function d(a,b){var c=a.gl,d=b.ship;this.thrust=b,this.mod=d.mod,this.scene=a,this.ship=d,this.gl=c,this.createMaterial(),this.blurKernelA=new Float32Array(3*m),this.blurKernelB=new Float32Array(3*m),this.computeKernel(this.blurKernelA,!0,1/l),this.computeKernel(this.blurKernelB,!1,1/l),this.iaExt=c.getExtension("ANGLE_instanced_arrays"),this.float_texture_ext=c.getExtension("OES_texture_float"),this.halfFloat=c.getExtension("OES_texture_half_float"),this.float_texture_ext_l=c.getExtension("OES_texture_half_float_linear"),this.halfFloat_l=c.getExtension("OES_texture_float_linear");var f=[c.FLOAT,c.UNSIGNED_BYTE];this.halfFloat&&f.unshift(this.halfFloat.HALF_FLOAT_OES),this.depth_fbo=new e(c,{depth:!0,stencil:!0,type:f,format:c.RGB}),this.depth_fbo.resize(l,l),this.depth_fbo.color.clamp(),this.depth_fbo.color.setFilter(!0,!1,!1),this.blurA_fbo=new e(c,{depth:!0,stencil:!0,type:f,format:c.RGB}),this.blurA_fbo.resize(l,l),this.blurA_fbo.color.clamp(),this.blurA_fbo.color.setFilter(!0,!1,!1),c.bindFramebuffer(c.FRAMEBUFFER,this.blurA_fbo.fbo),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,this.depth_fbo.attachment.buffer),this.blurB_fbo=new e(c,{depth:!0,stencil:!0,type:f,format:c.RGB}),this.blurB_fbo.resize(l,l),this.blurB_fbo.color.clamp(),this.blurB_fbo.color.setFilter(!0,!1,!1),c.bindFramebuffer(c.FRAMEBUFFER,this.blurB_fbo.fbo),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,this.depth_fbo.attachment.buffer),this.nrm_fbo=new e(c,{depth:!0,type:f,format:c.RGB}),this.fboSetupCfg=this.scene.glstate.config().colorMask(!0,!0,!0,!0).depthMask(!0),this.depthCfg=this.scene.glstate.config().enableCullface(!1).depthMask(!0).enableDepthTest(),this.blurCfg=this.scene.glstate.config().enableCullface(!1).depthMask(!1).enableDepthTest(!1),this.nrmCfg=this.scene.glstate.config().enableCullface(!1).depthMask(!1).enableDepthTest(!1),this.drawStencilCfg=this.scene.glstate.config().enableStencil(!0).stencilFunc(c.ALWAYS,1,255).stencilOp(c.KEEP,c.KEEP,c.REPLACE).stencilMask(255),this.testStencilCfg=this.scene.glstate.config().enableStencil(!0).stencilFunc(c.EQUAL,1,255),this.smokeMat.normal.set(this.blurB_fbo.color)}var e=a("nanogl/fbo"),f=(a("nanogl-depth-texture/fbo"),a("gl-matrix")),g=(a("dev/fbo-debug"),a("lib/color")),h=a("../gl/smoke-material"),i=f.mat4,j=f.mat3,k=(i.create(),j.create()),l=512,m=d.BLUR_SAMPLES=9;d.prototype={createMaterial:function(){var a=new h(this.gl);a._precision="highp",a.setIBL(this.scene.env.ibl),a.albedo=a.iAlbedo.attachUniform("uColor"),a.gloss=a.iGloss.attachUniform("uGloss"),a.specular=a.iSpecular.attachUniform("uSpecular"),a.normal=a.iNormal.attachSampler("tNormal","vScreen"),g.HexInput(a.albedo,16316664),g.HexInput(a.specular,3158064),a.gloss.set(0),a.tonemap.set(!0),a.conserveEnergy.set(!1),a._mask=1,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0),this.smokeMat=a},renderMask:function(){},rttPass:function(){var a=this.scene,b=this.gl,c=this.scene.glstate;this.depth_fbo.resize(l,l),b.clearColor(0,0,0,0),b.clearDepth(1),this.fboSetupCfg.apply(),this.depth_fbo.bind(),this.depth_fbo.clear(),b.clearDepth(1);var d;d=this.mod.programs.smokeNormal,d.use(),j.fromMat4(k,a.camera._view),d.uMV(k),c.push(this.depthCfg),c.push(this.drawStencilCfg),c.apply(),this.ship.renderSmokeRtt(d),c.pop(),c.pop(),c.push(this.blurCfg),c.push(this.testStencilCfg),c.apply(),b.clearColor(0,0,0,0);var e=this.scene.quad,f=this.mod.programs.blurNormal;e.attribPointer(f),f.use(),this.blurA_fbo.bind(),b.clear(b.COLOR_BUFFER_BIT),f.tNormal(this.depth_fbo.color),f.uKernel(this.blurKernelA);var e=this.scene.quad;e.render(),this.blurB_fbo.bind(),b.clear(b.COLOR_BUFFER_BIT),f.tNormal(this.blurA_fbo.color),f.uKernel(this.blurKernelB),e.render(),c.pop(),c.pop()},attribPointer:function(a){this.thrust.sphere.buffers[0].attribPointer(a),this.thrust.particles.iaBuffer.attribPointer(a),this.iaExt.vertexAttribDivisorANGLE(a.iData(),1),this.thrust.sphere.ibuffer.bind()},render:function(){var a=this.scene.gl,b=this.thrust.sphere.ibuffer,c=this.smokeMat;c.prepare(this.thrust.parentNode,this.scene.camera),this.attribPointer(c.prg);var d=b.size/b.typeSize;this.scene.glstate.push(c.config),this.scene.glstate.apply(),this.iaExt.drawElementsInstancedANGLE(a.TRIANGLES,d,b.type,0,this.thrust.particles.numInstance),this.scene.glstate.pop(),this.iaExt.vertexAttribDivisorANGLE(c.prg.iData(),0)},renderPrg:function(a,b){var c=this.scene.gl,d=this.thrust.sphere.ibuffer;this.attribPointer(b),b.uMVP(a.getMVP(this.thrust.parentNode._wmatrix));var e=d.size/d.typeSize;this.iaExt.drawElementsInstancedANGLE(c.TRIANGLES,e,d.type,0,this.thrust.particles.numInstance),this.iaExt.vertexAttribDivisorANGLE(b.iData(),0)},computeKernel:function(a,b,c){for(var d=b?0:1,e=b?1:0,f=Math.sqrt(Math.PI),g=0,h=0;h<m;++h){var i=3*h,j=h-Math.round((m-1)/2),k=4*j/m;k=Math.exp(-k*k/2)/f,g+=k,a[i+d]=j*c,a[i+e]=0,a[i+2]=k}for(h=0;h<m;++h)a[3*h+2]/=g}},b.exports=d},{"../gl/smoke-material":128,"dev/fbo-debug":19,"gl-matrix":192,"lib/color":32,"nanogl-depth-texture/fbo":210,"nanogl/fbo":251}],149:[function(a,b,c){function d(a){this.scene=a;var b=a.gl;this.pinfos=new Float64Array(f*i),this.particles=new Float32Array(f*h),this.iaBuffer=new e(b).attrib("iData",4,b.FLOAT);var c=f*h;this.iaBuffer.data(c),this.numInstance=0,this.startQuad=0,this.endQuad=0,this.times=[]}var e=a("nanogl/arraybuffer"),f=(a("nanogl/indexbuffer"),512),g=4,h=4*g,i=5,j=.8;d.prototype={addParticle:function(a,b,c,d){var e=this.scene.time;e+=.1*Math.random()-.05;var h=this.endQuad;this.endQuad++,this.endQuad>f-1&&(this.endQuad=0),this.times.push(e);var j=a[1]/c[1],k=h*g;this.particles[k+0]=a[0],this.particles[k+1]=a[1],this.particles[k+2]=a[2],this.particles[k+3]=d;var l=h*i;this.pinfos[l+0]=b[0],this.pinfos[l+1]=b[1],this.pinfos[l+2]=b[2],this.pinfos[l+3]=a[0]+j*c[0],this.pinfos[l+4]=a[2]+j*c[2]},simulate:function(){for(var a=this.scene.dt,b=this.particles,c=this.pinfos,d=0;d<f;d++){var e=4*d,g=d*i;if(c[g+0]*=.96,c[g+1]*=.96,c[g+2]*=.96,b[e+0]+=c[g+0]*a,b[e+1]+=c[g+1]*a,b[e+2]+=c[g+2]*a,b[e+1]<.01){var h=Math.sqrt(c[g+0]*c[g+0]+c[g+1]*c[g+1]+c[g+2]*c[g+2]),k=b[e+0]-c[g+3],l=b[e+2]-c[g+4],m=h/Math.sqrt(k*k+l*l);c[g+0]=k*m,c[g+1]=0,c[g+2]=l*m,b[e+1]=.011}b[e+3]-=a/j*1.4,b[e+3]<0&&(b[e+3]=0)}},updateRange:function(){for(var a=this.scene.time,b=this.startQuad,c=this.endQuad,d=this.times,e=f;b!==c&&d[0]-a<-j;)d.shift(),b++,b>e&&(b=0);this.startQuad=b},updateBuffer:function(){var a,b=this.particles.buffer;if(this.endQuad<this.startQuad){dv=f-this.startQuad,a=new Float32Array(b,0,this.endQuad*g),this.iaBuffer.subData(a,0);var c=this.startQuad*h;a=new Float32Array(b,c,dv*g),this.iaBuffer.subData(a,this.endQuad*h),this.numInstance=dv+this.endQuad}else{dv=this.endQuad-this.startQuad;var c=this.startQuad*h;a=new Float32Array(b,c,dv*g),this.iaBuffer.subData(a,0),this.numInstance=dv}},drawcalls:function(a){}},b.exports=d},{"nanogl/arraybuffer":249,"nanogl/indexbuffer":252}],150:[function(a,b,c){function d(a,b){this.scene=a.scene,this.ship=a,this.parentNode=this.ship.mod.node,this._thrust=!1,this.thrustDir=new Float32Array(3),this.sphere=b,this.particles=new f(this.scene),this.on=!0,g.param("space_smoke_hd")?this.renderer=new h(this.scene,this):this.renderer=new i(this.scene,this)}var e=(a("nanogl/arraybuffer"),a("gl-matrix")),f=a("./thrust-particles"),g=(a("lib/mouse"),a("lib/quality")),h=a("./smoke-renderer"),i=a("./simple-smoke-renderer"),j=e.vec3,k=e.mat4,l=j.create(),m=j.create(),n=j.create();k.create();d.prototype={thrust:function(a){this._thrust!==a&&(this.ship.mod.thrustChange(a),this._thrust=a)},attribPointer:function(a){this.sphere.buffers[0].attribPointer(a),this.particles.iaBuffer.attribPointer(a),this.ext.vertexAttribDivisorANGLE(a.iData(),1),this.sphere.ibuffer.bind()},preRender:function(){var a=this.ship.origin._matrix;n[0]=a[4],n[1]=a[5],n[2]=a[6],l[0]=a[12],l[1]=a[13],l[2]=a[14],j.scaleAndAdd(l,l,n,-.06);var b=this.thrustDir;if(this._thrust)for(var c=0;c<5;c++)j.random(m,.2),j.scaleAndAdd(m,m,b,-.6),this.particles.addParticle(l,m,b,1+.9*Math.random());this.particles.simulate(),this.particles.updateRange(),this.particles.updateBuffer()},rttPass:function(){this.renderer.rttPass()},render:function(a,b){this.renderer.render(a,b)},renderPrg:function(a,b){this.renderer.renderPrg(a,b)},renderPass:function(a,b,c){},renderDepth:function(a,b,c){}},b.exports=d},{"./simple-smoke-renderer":147,"./smoke-renderer":148,"./thrust-particles":149,"gl-matrix":192,"lib/mouse":50,"lib/quality":53,"nanogl/arraybuffer":249}],151:[function(a,b,c){function d(a){var b=a.gl;this.gl=b,this.scene=a,this.levels=[],this.fbos=[],this.blurSamples=17,this.valid=!1,this.tmpBlur=null,this.prg=new f(b,e(["precision lowp float;\n#define GLSLIFY 1\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord = aTexCoord;\n\n}\n"]),e(["precision lowp float;\n#define GLSLIFY 1\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D tInput;\nuniform float uSpread;\nuniform vec3 uKernel[NUM_SAMPLES];\n\nvoid main(void){\n\n  float shadow = 0.0;\n\n  for(int i=0; i<NUM_SAMPLES; ++i)\n  {\n    vec3 kernel = uKernel[i].xyz;\n    shadow += texture2D( tInput, vTexCoord + kernel.xy * uSpread ).x * kernel.z;\n  }\n\n  gl_FragColor = vec4( shadow, vec3(0.0) );\n  \n\n}\n"]),"#define NUM_SAMPLES "+this.blurSamples),this.blurCfg=a.glstate.config().enableCullface(!1).depthMask(!1).enableDepthTest(!1),this.blurKernelA=new Float32Array(3*this.blurSamples),this.blurKernelB=new Float32Array(3*this.blurSamples)}var e=a("glslify"),f=(a("nanogl-node"),a("lib/quality"),a("nanogl-camera"),a("nanogl/program")),g=(a("nanogl-state/config"),a("nanogl/fbo")),h=(a("nanogl-depth-texture/fbo"),a("nanogl-primitives-2d/rect"),a("dev/fbo-debug"),6);d.NUM_LEVELS=h,d.prototype={process:function(){if(!this._valid){var a=this.scene.cmntexs.get("txt_sheet");if(0!=a.width){var b=2;this.levels.push(a),this.size=a.width,this.computeKernel(this.blurKernelA,!0,1/this.size),this.computeKernel(this.blurKernelB,!1,1/this.size),this.tmpBlur=this.makeBlurFbo();for(var c=0;c<h;c++){var d=this.makeBlurFbo();this.processLevel(this.levels[c],d,b*((c+1)/h)),this.fbos.push(d),this.levels.push(d.color)}this._valid=!0}}},processLevel:function(a,b,c){var d=this.prg,e=this.gl;e.clearColor(0,0,0,0),this.blurCfg.apply(),d.use(),d.uSpread(c);var f=this.scene.quad;f.attribPointer(d),this.tmpBlur.bind(),e.clear(e.COLOR_BUFFER_BIT),d.tInput(a),d.uKernel(this.blurKernelA),f.render(),b.bind(),e.clear(e.COLOR_BUFFER_BIT),d.tInput(this.tmpBlur.color),d.uKernel(this.blurKernelB),f.render()},makeBlurFbo:function(){var a=this.gl,b=new g(a,{format:a.RED});return b.resize(this.size,this.size),b.color.bind(),b.color.clamp(),b.color.setFilter(!0,!1,!1),b},computeKernel:function(a,b,c){for(var d=b?0:1,e=b?1:0,f=Math.sqrt(Math.PI),g=0,h=0;h<this.blurSamples;++h){var i=3*h,j=h-Math.round((this.blurSamples-1)/2),k=4*j/this.blurSamples;k=Math.exp(-k*k/2)/f,g+=k,a[i+d]=j*c,a[i+e]=0,a[i+2]=k}for(h=0;h<this.blurSamples;++h)a[3*h+2]/=g}},b.exports=d},{"dev/fbo-debug":19,glslify:205,"lib/quality":53,"nanogl-camera":207,"nanogl-depth-texture/fbo":210,"nanogl-node":214,"nanogl-primitives-2d/rect":242,"nanogl-state/config":244,"nanogl/fbo":251,"nanogl/program":253}],152:[function(a,b,c){function d(a){this.prg=null,this._mask=2,this.inputs=new i,this.iTex1=this.inputs.add(new h("alpha1",1)),this.iTex2=this.inputs.add(new h("alpha2",1)),this.iMix=this.inputs.add(new h("tmix",1)),this.iAlpha=this.inputs.add(new h("talpha",1)),this.iTShadow=this.inputs.add(new h("tshadow",1)),this.iShadow=this.inputs.add(new h("shadow",1)),this.config=(new e).enableBlend().blendFunc(a.ONE,a.SRC_ALPHA).enableCullface(!1).enableDepthTest(!1).depthMask(!1),this._prgcache=g.getCache(a),this._uid="lfilament",this._precision="highp",this._vertSrc=f(["#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\n\nvarying vec2 vTexCoord;\n\nvoid main( void ){\n  \n  #pragma SLOT v\n\n  vec4 p = vec4(aPosition, 1.0);\n  gl_Position    = uMVP         * p;\n  // vTexCoord = aTexCoord;\n  vTexCoord = aTexCoord;\n}"]),this._fragSrc=f(["#define GLSLIFY 1\nvarying vec2 vTexCoord;\n\n#pragma SLOT pf\n\nvoid main( void ){\n  #pragma SLOT f\n\n  // black alpha\n  float xshadow = tshadow() * shadow() * .08;\n\n  // white alpha\n  float lum = talpha() * mix( alpha1(), alpha2(), tmix() );\n\n  \n  gl_FragColor = vec4( vec3(lum), (1.0 - lum) * (1.0 - xshadow ) );\n}"])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=(a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/chunks-tree")),j=a("gl-matrix").mat4,k=j.create();d.prototype={prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k)},prepareShadow:function(a,b){},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty);
},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":192,glslify:205,"nanogl-pbr/lib/chunks-tree":228,"nanogl-pbr/lib/flag":230,"nanogl-pbr/lib/input":231,"nanogl-pbr/lib/program-cache":237,"nanogl-state/config":244,"nanogl/program":253}],153:[function(a,b,c){function d(a){this.mesh=a;var b=a.geom.subgeoms[0].bounds.center;this.initialX=b[0]}var e=(a("nanogl-node"),a("gl-matrix")),f=(a("lib/ease"),e.vec3,e.quat);e.vec2,f.create();d.prototype={preRender:function(a){var b=this.initialX*(1+.4*a);this.mesh.x=b-this.initialX}},b.exports=d},{"gl-matrix":192,"lib/ease":33,"nanogl-node":214}],154:[function(a,b,c){function d(a,b){this.sid=b,this.mod=a;var c=a.context.scene;f.call(this,c,b),this.setupMaterials(),this.node.y=.14;var d=BrowserDetect.isDesktop?.6:.9;this.node.setScale(1.2*d),this.blur=0,this.alpha=1,this.spread=1,this.letters=[]}var e=(a("when"),a("gl-matrix")),f=(a("nanogl-node"),a("nanogl-pbr/standard"),a("assets/awd-scene")),g=(a("dev/gui"),a("config"),a("lib/color"),a("lib/mouse"),a("lib/math")),h=a("./letter"),i=a("./letter-mat"),j=a("./blur-preprocessor"),k=e.vec3,l=e.mat4,m=(k.create(),k.create(),l.create(),j.NUM_LEVELS);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.getLoadables=function(){var a=f.prototype.getLoadables.call(this);return a},d.prototype.getAssetPath=function(a){return this.sid+"/"+a},d.prototype.getTexturePath=function(a){return this.sid+"/"+a},d.prototype.getAwdUrl=function(){return this.getAssetPath("scene.awd")},d.prototype.texPath=function(a){return[this.getTexturePath(a+"_LB.jpg"),this.getTexturePath(a+"_L0.jpg"),this.getTexturePath(a+"_L1.jpg")]},d.prototype.preRender=function(){for(var a=0;a<this.letters.length;a++)this.letters[a].preRender(this.spread)},d.prototype.render=function(a,b){var c=this.blur;c=g.clamp(c);var d=c*m,e=Math.floor(d),h=Math.ceil(d),i=d-e;this.mat.tshadow.set(this.scene.txtblur.levels[5]),this.mat.shadow.set((1-c)*this.alpha),this.mat.tex1.set(this.scene.txtblur.levels[e]),this.mat.tex2.set(this.scene.txtblur.levels[h]),this.mat.mix.set(i),this.mat.alpha.set(this.alpha),f.prototype.render.call(this,a,b)},d.prototype.rttPass=function(){},d.prototype.setupMaterials=function(){var a=this.mats,b=(this.texs,a.lib,new i(this.gl));b._precision="lowp",b.tex1=b.iTex1.attachSampler("tTex1","vTexCoord","r"),b.tex2=b.iTex2.attachSampler("tTex2","vTexCoord","r"),b.tshadow=b.iTShadow.attachSampler("tShadow","vTexCoord","r"),b.mix=b.iMix.attachUniform("uMix"),b.alpha=b.iAlpha.attachUniform("uAlpha"),b.shadow=b.iShadow.attachUniform("uShadow"),this.mat=b,a.registerMaterial(b,"letters")},d.prototype._postParse=function(){for(var a=0;a<this.meshes.length;a++){var b=new h(this.meshes[a]);this.letters.push(b)}},b.exports=d},{"./blur-preprocessor":151,"./letter":153,"./letter-mat":152,"assets/awd-scene":1,config:17,"dev/gui":20,"gl-matrix":192,"lib/color":32,"lib/math":49,"lib/mouse":50,"nanogl-node":214,"nanogl-pbr/standard":239,when:280}],155:[function(a,b,c){var d=a("nanogl-renderer"),e=(a("./scene"),d({pixelRatio:window.devicePixelRatio,init:function(){this.scene=null},getContextOptions:function(){return{depth:!0,antialias:!0,stencil:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}},render:function(a){this.scene&&this.scene.render(a)},resize:function(){}}));b.exports=e},{"./scene":156,"nanogl-renderer":243}],156:[function(a,b,c){function d(){this.dt=0,this.time=0}function e(){this.accum=0,this.dt=0,this.fps=3e3,this.step=function(a){return this.accum+=a,!(this.accum<1/this.fps)&&(this.dt=this.accum,this.accum=0,!0)}}var f=a("when"),g=a("nanogl-state"),h=a("nanogl-node"),i=a("nanogl-camera"),j=a("nanogl-primitives-2d/rect"),k=a("lib/programs"),l=a("lib/env"),m=a("lib/mouse"),n=a("lib/net"),o=a("lib/ray"),p=a("modules"),q=a("modules/text/blur-preprocessor"),r=(a("./consts"),a("assets/materials-lib")),s=a("assets/textures-loader"),t=a("camera/camera-ctrl"),u=a("camera/max-controler"),v=a("camera/xp-controler"),w=a("entities/background"),x=a("model/mcontroler"),y=a("audio"),z=a("dev/mat-gui"),A=a("dev/fbo-debug");d.prototype={init:function(a,b){this.onLoaded=this._onLoaded.bind(this),this.loaddefer=f.defer(),this.loadPromise=this.loaddefer.promise,this.renderer=a,this.model=b,this.gl=this.renderer.gl,m.init(this),this.mctrl=new x(this),this.sroot=new h,this.root=new h,this.texlib=new s(this),this.cmntexs=this.texlib.createProvider("cmn"),this.createCmnTextures(),this.glstate=new g(this.gl),this.quad=new j(this.gl),this.mray=new o,this.audio=new y(this),this.programs=new k(this),this.bg=new w(this),this.matlib=new r(this),this.env=new l(this),this.mods=new p(this),this.txtblur=new q(this),this.camera=this.makeCamera(),this.camCtrl=new t(this),this.maxcam=new u(this.renderer.canvas),this.xpcam=new v(this),this.camCtrl.setControler(this.xpcam),this.sroot.add(this.camera),this.sroot.add(this.root),this.section_sep=0,this.lagsim=new e},getMouseRay:function(){return this.mray.update(this.camera),this.mray},loaded:function(){this.matlib.compileAll(),this.mods._loaded=!0,this.mods.updateLifecycle()},render:function(a){if(this.lagsim.step(a)){a=this.lagsim.dt,this.dt=a,this.time+=a,this.computeSectionSep(),this.mods.step();var b=this.gl;this.root.x=-this.model._position*this.section_sep,this.mctrl.preRender(),this.mods.preRender(),this.camCtrl.preRender(),this.sroot.updateWorldMatrix(),this.camera.updateViewProjectionMatrix(this.renderer.width,this.renderer.height),this.mray._invalid=!0,this.audio.preRender(),this.txtblur.process(),this.mods.rttPass(),b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,this.renderer.width,this.renderer.height),b.clearColor(1,1,1,1),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),this.bg.render(),this.mods.render(),A.render(this)}},computeSectionSep:function(){var a=this.camera.lens._hfov,b=this.camera.z+1,c=2*b*Math.tan(a/2);this.section_sep=.6*c},load:function(){var a=[];a=a.concat(this.env.getLoadables()),a=a.concat(this.cmntexs.getLoadables()),a=a.concat(this.mods.loadAll());var b=n.whenAll(a);return b.then(this.loaddefer.resolve,this.loaddefer.reject,this.loaddefer.notify),b},_onLoaded:function(){return z.registerMaterials(this.matlib),this.matlib.compileAll(),!0},makeCamera:function(){var a=i.makePerspectiveCamera();return a.lens.setAutoFov(43.68/180*Math.PI),a.lens.near=.1,a.lens.far=500,a._matrix.set([1,0,0,0,0,1,0,0,0,0,1,0,0,.14,1.24,1]),a.setMatrix(a._matrix),a},createCmnTextures:function(){this.cmntexs.makeTex("txt_sheet","intro/labels_spritesheet.png").setFilter(!0,!0,!0).nobbc().genMipmap()}},b.exports=d},{"./consts":18,"assets/materials-lib":5,"assets/textures-loader":10,audio:12,"camera/camera-ctrl":14,"camera/max-controler":15,"camera/xp-controler":16,"dev/fbo-debug":19,"dev/mat-gui":21,"entities/background":22,"lib/env":34,"lib/mouse":50,"lib/net":51,"lib/programs":52,"lib/ray":54,"model/mcontroler":57,modules:61,"modules/text/blur-preprocessor":151,"nanogl-camera":207,"nanogl-node":214,"nanogl-primitives-2d/rect":242,"nanogl-state":246,when:280}],157:[function(a,b,c){b.exports=[a("modules/loading"),a("modules/light"),a("modules/photo"),a("modules/robot"),a("modules/planes"),a("modules/space"),a("modules/outro")]},{"modules/light":72,"modules/loading":79,"modules/outro":80,"modules/photo":86,"modules/planes":101,"modules/robot":114,"modules/space":133}],158:[function(a,b,c){function d(){this.onAttachMouse=this.onAttachMouse.bind(this),this.onDetachMouse=this.onDetachMouse.bind(this),this.onNextSection=this.onNextSection.bind(this),this.onDragProgress=this.onDragProgress.bind(this),this.mousedown=this.mousedown.bind(this),this.mouseup=this.mouseup.bind(this),this.update=this.update.bind(this),this.mouse=new e,this.navigation=new f,this.navigation.dragger.on("attach_mouse",this.onAttachMouse),this.navigation.dragger.on("detach_mouse",this.onDetachMouse),this.navigation.dragger.on("next_section",this.onNextSection),this.navigation.dragger.on("drag_progress",this.onDragProgress),window.addEventListener("mousedown",this.mousedown),window.addEventListener("mouseup",this.mouseup),this.update(),this.$logo=document.querySelector(".logo"),this.$logo.addEventListener("mouseenter",function(){h.dispatch("attach_mouse")}),this.$logo.addEventListener("mouseleave",function(){h.dispatch("detach_mouse")})}var e=a("./mouse"),f=a("./navigation"),g=(a("./../model"),a("gsap").TweenLite);a("./utils").clamp,a("./navigation/states").STATES,a("./navigation/nav-consts");a("./spinner"),d.prototype={update:function(){window.requestAnimationFrame(this.update),this.mouse.update(),this.navigation.setMouseCoords(this.mouse.getCoords()),this.navigation.update(),this.isAnimating=!1,this.mouse.$span.style.borderWidth=2/this.mouse.scale+"px"},mousedown:function(){this.mouse.down()},mouseup:function(){this.mouse.up()},onAttachMouse:function(a,b){this.mouse.isAttached=!0,this.isAnimating||(b=b||1.6,g.to(this.mouse,.3,{scale:b,ease:Back.easeOut}))},onDetachMouse:function(a){this.mouse.isAttached=!1,this.isAnimating||g.to(this.mouse,.3,{scale:1,ease:Back.easeOut})},onNextSection:function(){h.dispatch("next_section")},onDragProgress:function(a){h.dispatch("drag_progress",a)},showLogo:function(){var a=document.querySelector(".logo");a.classList.remove("hidden")},toggleShowNav:function(){var a=document.querySelector(".navigation");a.classList.toggle("hidden"),a.classList.contains("hidden")&&(a.style.display="none")}};var h={};h.dispatch=function(a,b){if(j[a]){var b=Array.prototype.slice.apply(arguments);j[a].forEach(function(a){a.apply(null,b)})}},h.on=function(a,b){j[a]||(j[a]=[]),j[a].push(b)};var i=new d,j={};j.show_logo=[i.showLogo],j.show_nav=[i.toggleShowNav],j.hide_nav=[i.toggleShowNav],j.attach_mouse=[i.onAttachMouse],j.detach_mouse=[i.onDetachMouse],b.exports=h},{"./../model":56,"./mouse":160,"./navigation":163,"./navigation/nav-consts":164,"./navigation/states":165,"./spinner":166,"./utils":168,gsap:206}],159:[function(a,b,c){"use strict";function d(a,b){this.x=a||0,this.y=b||0}d.random2D=function(){var a=2*Math.random(),b=2*Math.random();return new d(a,b)},d.add=function(a,b){return new d(a.x+b.x,a.y+b.y)},d.sub=function(a,b){return new d(a.x-b.x,a.y-b.y)},d.get=function(a){return new d(a.x,a.y)},d.div=function(a,b){return new d(a.x/b,a.y/b)},d.dot=function(a,b){return new d(a.x*b.x,a.y*b.y)},d.prototype={get:function(){return this},add:function(a){this.x=this.x+a.x,this.y=this.y+a.y},sub:function(a){this.x=this.x-a.x,this.y=this.y-a.y},mult:function(a){this.x=this.x*a,this.y=this.y*a},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.mag();0!==a&&this.div(a)},div:function(a){this.x=this.x/a,this.y=this.y/a},limit:function(a){this.mag()>a&&(this.normalize(),this.mult(a))},heading:function(){return Math.atan2(this.y,this.x)}},window.PVector=d,b.exports=d},{}],160:[function(a,b,c){function d(){this.x=null,this.y=null,this.previousScale=0,this.tightening=0,this.scale=1,this.ready=!1,this.$cnt=document.querySelector(".mouse-cursor"),this.$span=this.$cnt.querySelector("span"),window.addEventListener("mousemove",this.move.bind(this),!1),window.addEventListener("touchstart",this.move.bind(this),!1),window.addEventListener("touchmove",this.move.bind(this),!1),window.addEventListener("touchend",this.move.bind(this),!1),this.isMobile=!BrowserDetect.isDesktop,this.isAttached=!1}var e=a("./utils"),f=a("gsap").TweenLite;d.prototype={move:function(a){if("touchstart"==a.type||"touchmove"==a.type||"touchend"==a.type){var b=a.touches[0]||a.changedTouches[0];this.x=b.clientX,this.y=b.clientY}else this.x=a.clientX,this.y=a.clientY},getCoords:function(){return{x:this.x,y:this.y}},update:function(){this.isMobile||null===this.x&&null===this.y||(this.ready||(this.$cnt.classList.remove("disabled"),this.ready=!0),e.cssTranslateElement(this.$cnt.style,this.x-22,this.y-22,1,this.scale))},up:function(){var a={a:.8,b:1};this.isAttached&&(a={a:1,b:1.6}),this.$cnt.style.opacity=1,f.to(a,.15,{a:a.b,ease:Power4.easeOut,onUpdate:function(){this.scale=a.a}.bind(this)})},down:function(){var a={a:1,b:.8},b=1;this.isAttached&&(a={a:1.6,b:1},b=0),this.$cnt.style.opacity=b,f.to(a,.15,{a:a.b,ease:Power4.easOut,onUpdate:function(){this.scale=a.a}.bind(this)})}},b.exports=d},{"./utils":168,gsap:206}],161:[function(a,b,c){function d(a){this.ctx=a,this.isMobile=!BrowserDetect.isDesktop,this.$cursor=document.querySelector(".dragger-cursor"),this.$area=document.querySelector(".dragger-area"),this.mouseCoords=new h(0,0),this.touchStartX=0,this.touchEndX=0,this.draggerMover=new e(0,m),this.ratio=0,this.ratioResetPellet=0,this.ratioResetDragger=0,this.pelletRad=28,this.pelletRad2=30,this.cursorNextRad=0,this.currentState=j.DEFAULT,this.dragProgress=0,this.loaded=!1,this.arrowTex=null,this.arrowAlpha=1,this.loadArrow(function(){this.loaded=!0,this.addListeners()}.bind(this))}function e(a,b){this.location=new h(a,b),this.angle=0,this.aVelocity=0,this.t=new h(0,0),this.radiusOut=30,this.radiusIn=0}var f=a("event-emitter"),g=a("./../utils"),h=a("./../lib/pvector"),i=a("gsap").TweenLite,j=a("./states.js").STATES,k=a("./nav-consts"),l=k.MIN_AREA_X,m=k.MID_AREA_Y,n=k.RATIO_MOUSE_COLLISION,o=k.DISTANCE_MOUSE_COLLISION,p=.9,q=0,r=new h(0,0),s=!1;d.prototype={loadArrow:function(a){this.arrowTex=document.createElement("img"),this.arrowTex.onload=a,this.arrowTex.src="./assets/images/nav-arrow-mask.png"},resize:function(a,b,c,d){r=new h(d,c),q=a-l},addListeners:function(){this.$cursor.addEventListener("mousedown",this.mousedown.bind(this)),this.$cursor.addEventListener("touchstart",this.mousedown.bind(this)),window.addEventListener("mouseup",this.mouseup.bind(this)),window.addEventListener("touchend",this.mouseup.bind(this))},update:function(){this.loaded&&(this.currentState==j.DEFAULT&&this.updateStateDefault(),this.currentState==j.DRAGOVER&&this.updateStateDragOver(),this.currentState==j.UNLOCKED&&this.updateStateUnlocked(),this.currentState==j.RESET&&this.updateStateReset())},draw:function(){this.drawPelletEnd(),this.drawCursorDragger()},drawCursorDragger:function(){this.ctx.save(),this.ctx.beginPath(),this.isMobile||this.ctx.translate(this.draggerMover.t.x,this.draggerMover.t.y);this.draggerMover.t.x,this.draggerMover.t.y;this.ctx.arc(this.ratio*(q-l)+l,this.draggerMover.location.y,this.draggerMover.radiusOut,0,2*Math.PI,!1),this.ctx.arc(this.ratio*(q-l)+l,this.draggerMover.location.y,this.draggerMover.radiusIn,0,2*Math.PI,!0),this.ctx.fillStyle="rgba(255,255, 255, 1.0)",this.ctx.fill(),this.ctx.clip(),this.ctx.globalCompositeOperation="xor",this.ctx.globalAlpha=this.arrowAlpha,this.ctx.drawImage(this.arrowTex,this.ratio*(q-l)+l-5,this.draggerMover.location.y-8),this.ctx.globalAlpha=1,this.isMobile||this.ctx.translate(-this.draggerMover.t.x,-this.draggerMover.t.y),this.ctx.restore()},drawPelletEnd:function(){this.ctx.beginPath(),this.ctx.arc(q,m,this.pelletRad,0,2*Math.PI,!1),this.ctx.arc(q,m,this.pelletRad2,0,2*Math.PI,!0),this.ctx.fillStyle="white",this.ctx.fill()},drawNextCursor:function(){this.ctx.beginPath(),this.ctx.arc(0*(q-l)+l,m,this.cursorNextRad,0,2*Math.PI,!1),this.ctx.fillStyle="white",this.ctx.fill()},preUpdateStatesDefault:function(){i.to(this.draggerMover,.3,{radiusOut:s?50:30,ease:Back.easeOut})},updateStateDefault:function(){this.ratioReset=0,this.draggerMover.location.x*=p,this.draggerMover.location.x<.001&&(this.draggerMover.location.x=0);var a=new h(r.x+l/2,r.y+this.draggerMover.location.y/2),b=h.sub(this.mouseCoords,a),c=b.mag(),d=1-g.clamp(c/o,0,1);this.draggerMover.t.mult(p),d>n&&(this.draggerMover.t=b),this.updateMouseState(d),this.ratio=g.clamp(this.draggerMover.location.x/q*2,0,1),this.setDragProgress(this.ratio)},preUpdateStatesDragover:function(){var a=h.get(this.draggerMover.t);i.to(a,.2,{x:0,y:0,ease:Power4.easeOut,onUpdate:function(){this.draggerMover.t=new h(a.x,a.y)}.bind(this)}),i.to(this.draggerMover,.3,{radiusOut:46,ease:Back.easeOut})},updateStateDragOver:function(){this.draggerMover.location.x=this.mouseCoords.x-this.touchStartX,this.ratio=g.clamp(this.draggerMover.location.x/q*2,0,1),this.setDragProgress(this.ratio),this.ratio>=k.RATIO_TO_UNLOCK&&this.setState(j.UNLOCKED)},preUpdateStatesUnlocked:function(){s=!1,this.emit("detach_mouse",0)},updateStateUnlocked:function(){this.draggerMover.location.x*=1.025,this.ratio=g.clamp(this.draggerMover.location.x/q*2,0,1),this.setDragProgress(this.ratio),this.draggerMover.location.x>=q/2&&(this.draggerMover.location.x=q/2,this.setState(j.RESET))},preUpdateStatesOut:function(a){i.fromTo(this,.4,{ratioResetPellet:0},{ratioResetPellet:1,ease:Power4.easeOut}),i.fromTo(this.navigation.$dom,.25,{autoAlpha:1},{autoAlpha:0,onComplete:a}),i.to(this.navigation.$dom,.25,{autoAlpha:1,delay:2})},preUpdateStatesReset:function(){i.fromTo(this,.4,{ratioResetPellet:0},{ratioResetPellet:1,ease:Power4.easeOut}),i.fromTo(this,.4,{ratioResetDragger:0},{ratioResetDragger:1,delay:.2,ease:Back.easeOut,onComplete:function(){this.draggerMover.location.x=0,this.ratio=0,this.draggerMover.radiusIn=0,this.cursorNextRad=0,this.setState(j.DEFAULT)}.bind(this)}),this.arrowAlpha=0,i.fromTo(this,.4,{arrowAlpha:0},{arrowAlpha:1,delay:.6,ease:Power4.easeOut})},updateStateReset:function(){this.draggerMover.radiusOut=50-20*this.ratioResetPellet,this.draggerMover.radiusIn=28*this.ratioResetPellet,this.cursorNextRad=30*this.ratioResetDragger},updateMouseState:function(a){a>=n?s||(s=!0,i.to(this.draggerMover,.3,{radiusOut:50,ease:Back.easeOut}),this.emit("attach_mouse",a)):s&&(s=!1,i.to(this.draggerMover,.3,{radiusOut:30,ease:Back.easeOut}),this.emit("detach_mouse",a))},mouseup:function(a){this.touchEndX=this.mouseCoords.x,this.touchStartX=0,this.touchEndX=0,this.currentState==j.DRAGOVER&&this.setState(j.DEFAULT)},mousedown:function(a){if("touchstart"==a.type||"touchmove"==a.type||"touchend"==a.type){var b=a.touches[0]||a.changedTouches[0];this.touchStartX=b.clientX}else this.touchStartX=this.mouseCoords.x;this.setState(j.DRAGOVER)},setMouseCoords:function(a){this.mouseCoords=new h(a.x,a.y)},setDragProgress:function(a){this.dragProgress=a,this.emit("drag_progress",a)},setState:function(a){if(this.currentState=a,a==j.DEFAULT&&this.preUpdateStatesDefault(),a==j.DRAGOVER&&this.preUpdateStatesDragover(),a==j.UNLOCKED&&this.preUpdateStatesUnlocked(),a==j.RESET){var b=this;this.preUpdateStatesOut(function(){b.preUpdateStatesReset()})}this.emit("update_state",a),this.currentState==j.RESET&&this.emit("next_section")}},f(d.prototype),b.exports=d},{"./../lib/pvector":159,"./../utils":168,"./nav-consts":164,"./states.js":165,"event-emitter":186,gsap:206}],162:[function(a,b,c){function d(a){this.ctx=a,this.mouseCoords=new f(0,0),this.dragProgress=0,this.isAnimationReset=!1,this.dots=[];for(var b=0;b<q;b++)this.dots.push(new e(b,0,80,1))}function e(a,b,c,d){this.id=a,this.location=new f(b,c),this.origin=new f(b,c),this.alpha=d,this.radius=2.6}var f=a("./../lib/pvector"),g=a("./../utils"),h=a("gsap").TweenLite,i=a("./states.js").STATES,j=a("./nav-consts"),k=j.MIN_GUITAR_STRING_AREA_X,l=0,m=j.MIN_AREA_X,n=0,o=null,p=null,q=j.DOTS_ITEMS;d.prototype={update:function(){if(!this.isAnimationReset)for(var a=this.dragProgress*n+m,b=0;b<q;b++){var c=f.sub(this.dots[b].location,new f(a,0)),d=1-g.clamp((c.x-j.DISTANCE_DOT_COLLISION)/j.DISTANCE_DOT_COLLISION,0,1);this.dots[b].alpha=1-d}},draw:function(){for(var a=0;a<q;a++){var b=this.dots[a];this.ctx.beginPath(),this.ctx.arc(b.location.x,b.location.y,b.radius,0,2*Math.PI,!1),this.ctx.fillStyle="rgba(255, 255, 255, "+b.alpha+" )",this.ctx.fill()}},resize:function(a,b,c,d){p=new f(a,b),o=new f(d,c),l=a-2*k,n=a-2*m;for(var e=(q-1)/l,g=0;g<q;g++){var h=g/e+k;this.dots[g].location.x=h,this.dots[g].origin=f.get(this.dots[g].location)}},setMouseCoords:function(a){this.mouseCoords=new f(a.x||0,a.y||0)},setDragProgress:function(a){this.dragProgress=a},updateState:function(a){function b(){this.isAnimationReset=!1}if(a==i.RESET){this.isAnimationReset=!0;for(var c=.3,d=0;d<q;d++)this.dots[d].alpha=0,h.to(this.dots[d],.3,{alpha:1,delay:c+=.01,ease:Power4.easeOut,onComplete:d==q-1?b.bind(this):null})}}};b.exports=d},{"./../lib/pvector":159,"./../utils":168,"./nav-consts":164,"./states.js":165,gsap:206}],163:[function(a,b,c){function d(){this.$dom=document.querySelector(".navigation"),this.$canvas=this.$dom.querySelector("canvas"),this.ctx=this.$canvas.getContext("2d"),this.mouseCoords={x:null,y:null},this.dragger=new e(this.ctx),this.dragger.navigation=this,this.dragger.on("update_state",this.onUpdateState.bind(this)),this.guitarString=new f(this.ctx),window.addEventListener("resize",this.resize.bind(this)),this.resize()}var e=a("./dragger"),f=a("./guitar-string"),g=0,h=0,i=0,j=0;d.prototype={update:function(){this.ctx.clearRect(0,0,2*g,2*h),this.dragger.setMouseCoords(this.mouseCoords),this.dragger.update(),this.guitarString.setMouseCoords(this.mouseCoords),this.guitarString.setDragProgress(this.dragger.dragProgress),this.guitarString.update(),this.draw()},draw:function(){this.guitarString.draw(),this.dragger.draw()},setMouseCoords:function(a){this.mouseCoords=a},resize:function(){var a=this.$dom.getBoundingClientRect();i=a.top,j=a.left,g=2*this.$dom.offsetWidth,h=2*this.$dom.offsetHeight,this.$canvas.width=g,this.$canvas.height=h,this.$canvas.style.width=g/2+"px",this.$canvas.style.height=h/2+"px",this.guitarString.resize(g,h,i,j),this.dragger.resize(g,h,i,j)},onDragProgress:function(a){},onUpdateState:function(a){this.guitarString.updateState(a)},show:function(){this.$dom.classList.remove("hidden")},hide:function(){this.$dom.classList.add("hidden")}},b.exports=d},{"./dragger":161,"./guitar-string":162}],164:[function(a,b,c){b.exports={MIN_AREA_X:90,MID_AREA_Y:80,RATIO_MOUSE_COLLISION:.2,DISTANCE_MOUSE_COLLISION:20,RATIO_TO_UNLOCK:.8,DISTANCE_DOT_COLLISION:BrowserDetect.isDesktop?35:30,MIN_GUITAR_STRING_AREA_X:BrowserDetect.isDesktop?160:150,DOTS_ITEMS:BrowserDetect.isDesktop?15:10}},{}],165:[function(a,b,c){var d={DEFAULT:1,DRAGOVER:2,UNLOCKED:3,RESET:4};b.exports.STATES=d},{}],166:[function(a,b,c){function d(a){this.render=this._render.bind(this),this.svg=a,this.path=a.getElementsByTagName("path")[0],this.running=!1,this.angle=0,this.arc=.3,this.radius=50}var e=Math.PI,f=2*Math.PI,g=a("lib/ease");a("lib/mouse");d.prototype={show:function(){this.svg.style.opacity=1},hide:function(){this.svg.style.opacity=0},start:function(){this.running||(this.running=!0,this.render())},stop:function(){this.running=!1},_render:function(){if(this.running){for(this.angle+=.01;this.angle>1;)this.angle-=1;var a=f*g.easeInOutCubic(Math.pow(this.angle,1.1)),b=f*g.easeInOutCubic(Math.pow(this.angle,.9)),c=4+this.radius+this.radius*Math.cos(a-e/2),d=4+this.radius+this.radius*Math.sin(a-e/2),h=4+this.radius+this.radius*Math.cos(b-e/2),i=4+this.radius+this.radius*Math.sin(b-e/2),j="M"+c+" "+d+" A 50 50 0 0 1 "+h+" "+i;this.path.setAttribute("d",j),requestAnimationFrame(this.render)}}},b.exports=d},{"lib/ease":33,"lib/mouse":50}],167:[function(a,b,c){function d(a,b){b=b||{},this.direction=b.direction?b.direction:1,this.elSvg=a;var c=this.elSvg.querySelectorAll(".svg-line-animations");this.domLines=[];for(var d=c.length-1;d>=0;d--){var f=c[d],g=0;switch(f.tagName){case"line":g+=e.getLineLength(f);break;case"path":g+=e.getPathLength(f);break;case"polyline":g+=e.getPolylineLength(f);break;case"circle":g+=e.getCircleLength(f);break;case"polygon":g+=e.getPolygonLength(f)}TweenMax.set(f,{strokeDasharray:g+" "+g,strokeDashoffset:this.direction*g}),this.domLines.push({el:f,length:g})}}var e={getRectLength:function(a){var b=a.getAttribute("width"),c=a.getAttribute("height");return 2*b+2*c},getPolylineLength:function(a){for(var b,c=0,d=a,e=0;e<d.points.numberOfItems;e++){var f=d.points.getItem(e);e>0&&(c+=Math.sqrt(Math.pow(f.x-b.x,2)+Math.pow(f.y-b.y,2))),b=f}return c},getPolygonLength:function(a){var b=a.getAttribute("points");b=b.split(" ");for(var c,d,e,f,g=null,h=null,i=0,j=0;j<b.length;j++){var k=b[j].split(",");null==g&&null==h?(/(\r\n|\n|\r)/gm.test(k[0])&&(k[0]=k[0].replace(/(\r\n|\n|\r)/gm,""),k[0]=k[0].replace(/\s+/g,"")),/(\r\n|\n|\r)/gm.test(k[1])&&(k[0]=k[1].replace(/(\r\n|\n|\r)/gm,""),k[0]=k[1].replace(/\s+/g,"")),g=k[0],h=k[1],e=k[0],f=k[1]):""!=k[0]&&""!=k[1]&&(/(\r\n|\n|\r)/gm.test(k[0])&&(k[0]=k[0].replace(/(\r\n|\n|\r)/gm,""),k[0]=k[0].replace(/\s+/g,"")),/(\r\n|\n|\r)/gm.test(k[1])&&(k[0]=k[1].replace(/(\r\n|\n|\r)/gm,""),k[0]=k[1].replace(/\s+/g,"")),c=k[0],d=k[1],i+=Math.sqrt(Math.pow(c-g,2)+Math.pow(d-h,2)),g=c,h=d,j==b.length-2&&(i+=Math.sqrt(Math.pow(e-g,2)+Math.pow(f-h,2))))}return i},getLineLength:function(a){var b=a.getAttribute("x1"),c=a.getAttribute("x2"),d=a.getAttribute("y1"),e=a.getAttribute("y2"),f=Math.sqrt(Math.pow(c-b,2)+Math.pow(e-d,2));return f},getCircleLength:function(a){var b=a.getAttribute("r"),c=2*Math.PI*b;return c},getPathLength:function(a){var b=a,c=b.getTotalLength();return c}};d.prototype={setProgress:function(a){for(var b=this.domLines.length-1;b>=0;b--)this.domLines[b].el.style.strokeDashoffset=a*this.domLines[b].length}},b.exports=d},{}],168:[function(a,b,c){b.exports.cssTranslateElement=function(a,b,c,d,e){d||(d=1),e||(e=1);var f="translate("+b*d+"px, "+c*d+"px) scale("+e+")";a.webkitTransform=f,a.MozTransform=f,a.msTransform=f,a.OTransform=f,a.transform=f},b.exports.clamp=function(a,b,c){return b||(b=0),c||(c=1),Math.max(b,Math.min(c,a))},b.exports.map=function(a,b,c,d,e){var f=(a-b)/(c-b),g=f*(e-d)+d;return g}},{}],169:[function(a,b,c){(function(d){!function(a){if("object"==typeof c&&"undefined"!=typeof b)b.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof d?d:"undefined"!=typeof self?self:this,e.awdlib_pil=a()}}(function(){return function b(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};c[h][0].call(l.exports,function(a){var b=c[h][1][a];return f(b?b:a)},l,l.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof a&&a,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){function d(a,b,c){for(var d=c.transforms,f=0;f<d.length;f++)b=e(a,b,d[f]);return b}function e(a,b,c){var d=c.transform.data;return f(a,b,d),b+7}function f(a,b,c){a[b+0]=c[12],a[b+1]=c[13],a[b+2]=c[14];var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]),e=Math.sqrt(c[4]*c[4]+c[5]*c[5]+c[6]*c[6]),f=Math.sqrt(c[8]*c[8]+c[9]*c[9]+c[10]*c[10]);o[0]=c[0]/d,o[1]=c[1]/d,o[2]=c[2]/d,o[3]=c[4]/e,o[4]=c[5]/e,o[5]=c[6]/e,o[6]=c[8]/f,o[7]=c[9]/f,o[8]=c[10]/f,g(a,b+3,o)}function g(a,b,c){var d,e=c[0]+c[4]+c[8];if(e>0)d=Math.sqrt(e+1),a[b+3]=.5*d,d=.5/d,a[b+0]=(c[5]-c[7])*d,a[b+1]=(c[6]-c[2])*d,a[b+2]=(c[1]-c[3])*d;else{var f=0;c[4]>c[0]&&(f=1),c[8]>c[3*f+f]&&(f=2);var g=(f+1)%3,h=(f+2)%3;d=Math.sqrt(c[3*f+f]-c[3*g+g]-c[3*h+h]+1),a[b+f]=.5*d,d=.5/d,a[b+3]=(c[3*g+h]-c[3*h+g])*d,a[b+g]=(c[3*g+f]+c[3*f+g])*d,a[b+h]=(c[3*h+f]+c[3*f+h])*d}return a}var h=a("types/properties"),i=a("types/awdString"),j=a("consts"),k=a("types/userAttr"),l=a("BaseElement"),m=a("./extInfos"),n=l.createStruct(m.COMPACT_SKEL_ANIM,m.URI,{init:function(){this.name="",this.model=j.MODEL_ANIMATION_STATE,this.extras=new k,this.props=new h({}),this.numFrames=0,this.numBones=0,this.data=null},read:function(a){this.name=i.read(a),this.numFrames=a.U16(),this.numBones=a.U16(),this.props.read(a);var b=a.U8();a.ptr+=b;var c=this.numFrames*this.numBones*7;this.data=new Float32Array(a.buffer,a.ptr,c),a.ptr+=4*c,this.extras.read(a)},write:void 0,convertFromSkeletonAnimation:function(a){var b=a.frames;this.numFrames=b.length,this.numBones=b[0].pose.transforms.length,this.data=new Float32Array(this.numFrames*this.numBones*7);for(var c=0,e=0;e<b.length;e++)c=d(this.data,c,b[e].pose)},toString:function(){return"[CompactSkeletonAnimation"+this.name+"]"}}),o=new Float32Array(9);b.exports=n},{"./extInfos":4,BaseElement:7,consts:13,"types/awdString":15,"types/properties":16,"types/userAttr":17}],2:[function(a,b,c){var d=a("../../src/BaseElement"),e=a("../../src/bufferReader"),f=a("../../src/consts"),g=a("../std/Geometry"),h=a("./extInfos"),i=function(){this.data=null,this.attributes=[],this.ftype=f.AWD_FIELD_FLOAT32};i.HEAD_SIZE=6,i.prototype={allocate:function(a,b){var c=g.getArray(b);this.data=new c(a)},read:function(a){var b=a.U8(),c=a.U8(),d=this.attributes;this.ftype=c;var e=0;this.isIndex=!1;for(var h=0;b>h;h++){var i=a.U8(),j=a.U8();i===f.INDEX&&(b>1&&console.warn("interleaved index buffer is not alone"),this.isIndex=!0),e+=j,d.push({type:i,len:j})}var k=a.U8();a.ptr+=k;var l=a.U32(),m=a.ptr+l,n=g.getTypeSize(c),o=l/n;this.numVertices=o/e;var p=g.getArray(c);this.data=new p(a.buffer,a.ptr,o),a.ptr=m},write:void 0};var j=function(a){var b=new g.SubGeom;b.extras=a.extras.clone(),b.props=a.props.clone();for(var c,d,h,j=a.buffers,k={},l=0,m=j.length;m>l;l++)d=j[l],2!==d.type?(c=d.ftype,k[c]||(k[c]={list:[],ftype:c}),k[c].list.push(d)):(h=new i,h.attributes.push({type:2,len:3}),h.data=d.data,h.ftype=f.AWD_FIELD_UINT16,h.isIndex=!0,b.buffers.push(h));for(var n in k){var o=k[n].list,p=o[0].numVertices;c=k[n].ftype,h=new i,b.buffers.push(h),h.ftype=c;var q,r=[];for(l=0,m=o.length;m>l;l++){d=o[l];var s=new e(d.data.buffer);for(h.attributes.push({type:d.type,len:d.components}),q=0;q<d.components;q++)r.push(s)}var t=g.getArray(c),u=new t(r.length*p),v=g.getReadFunc(c,r[0]),w=0;for(l=0;p>l;l++)for(q=0,m=r.length;m>q;q++)u[w++]=v.call(r[q]);h.data=u}return b},k=d.createStruct(h.INTERLEAVED_GEOM,h.URI,g.prototype);k.prototype.fromGeometry=function(a){this.name=a.name,this.extras=a.extras.clone(),this.props=a.props.clone();for(var b=0,c=a.subGeoms.length;c>b;b++){var d=a.subGeoms[b];this.subGeoms.push(j(d))}},k.prototype.subGeomFactory=function(){var a=g.prototype.subGeomFactory();return a.bufferFactory=this.bufferFactory,a},k.prototype.bufferFactory=function(){return new i},k.prototype.toString=function(){return"[InterleavedGeometry "+this.name+"]"},b.exports=k},{"../../src/BaseElement":7,"../../src/bufferReader":10,"../../src/consts":13,"../std/Geometry":5,"./extInfos":4}],3:[function(a,b,c){var d=a("../../src/extension"),e=a("./InterleavedGeometry"),f=a("./CompactSkeletonAnimation"),g=a("./extInfos"),h=[e,f],i=g;i.getExtension=function(){var a=new d(g.URI);return a.addStructs(h),a},b.exports=i},{"../../src/extension":14,"./CompactSkeletonAnimation":1,"./InterleavedGeometry":2,"./extInfos":4}],4:[function(a,b,c){b.exports={URI:"https://github.com/plepers/awd-js",INTERLEAVED_GEOM:1,COMPACT_SKEL_ANIM:2}},{}],5:[function(a,b,c){!function(){"use strict";var c=a("consts"),d=a("types/awdString"),e=a("types/userAttr"),f=a("types/properties"),g=a("BaseElement"),h=g.createStruct(c.GEOMETRY,null,{subGeomFactory:function(){var a=new i;return a.bufferFactory=this.bufferFactory,a},bufferFactory:function(){return new k},init:function(){this.model=c.MODEL_GEOMETRY,this.name="",this.extras=new e,this.props=new f({}),this.subGeoms=[]},read:function(a){this.name=d.read(a);var b=a.U16(),c=this.awd.header.geoNrType,e=this.props;e.expected[1]=c,e.expected[2]=c,e.read(a);var f=e.get(1,1),g=e.get(2,1);1===f&&1===g||console.log("WARN defined scale UV in geometry");for(var h,i=this.subGeoms,j=0;b>j;j++)h=this.subGeomFactory(),h.read(this.awd,a),i.push(h);this.extras.read(a)},write:void 0,toString:function(){return"[Geometry "+this.name+"]"}}),i=function(){this.buffers=[],this.extras=new e,this.props=new f({})};i.prototype={getBuffersByType:function(a,b){void 0===b&&(b=[]);var c,d;if(a instanceof Array)for(c=0,d=a.length;d>c;c++)this.getBuffersByType(a[c],b);else for(c=0,d=this.buffers.length;d>c;c++)this.buffers[c].type===a&&b.push(this.buffers[c]);return b},read:function(a,b){var c=b.U32(),d=b.ptr+c,e=a.header.geoNrType,f=this.props;f.expected[1]=e,f.expected[2]=e,f.read(b);var g=f.get(1,1),h=f.get(2,1);1===g&&1===h||console.log("WARN defined scale UV in sub-geometry");for(var i,j=-1;b.ptr<d;)i=this.bufferFactory(),i.read(b),
!i.isIndex&&i.numVertices>-1&&(j>-1&&i.numVertices!==j&&console.log("Warn buffers in geom has differents num vertices",j,i.numVertices),j=i.numVertices),this.buffers.push(i);-1===j&&console.log("Error, Can't resolve geom buffers sizes");for(var k=0,l=this.buffers.length;l>k;k++)i=this.buffers[k],-1!==i.numVertices||i.isIndex||i.solveSize(j);this.extras.read(b)},write:function(a,b){var c=b.skipBlockSize();this.writeProps(a,b);for(var d=0,e=this.buffers.length;e>d;d++){var f=this.buffers[d];f.write(b)}b.writeBlockSize(c),this.extras.write(b)},writeProps:function(a,b){var c=a.header.geoNrType,d=this.props;d.expected[1]=c,d.expected[2]=c,d.set(1,1),d.set(2,1),d.write(b)}};var j=function(a){return 2===a?c.AWD_FIELD_UINT16:a},k=function(){this.data=null,this.numVertices=-1,this.type=0,this.components=0,this.ftype=c.T_FLOAT,this.isIndex=!1};k.HEAD_SIZE=6,k.prototype={allocate:function(a,b){var c=o(b);void 0===c&&console.log(b),this.data=new c(a)},solveSize:function(a){this.numVertices=a,this.components=this.data.length/a},read:function(a){var b=a.U8(),d=a.U8(),e=a.U32(),f=a.ptr+e;d=j(d),d!==c.AWD_FIELD_UINT8&&d!==c.AWD_FIELD_UINT16&&d!==c.AWD_FIELD_FLOAT32&&d!==c.AWD_FIELD_FLOAT64&&console.log("WARN unexpected stream data type ",d,b,e);var g=p(b);this.isIndex=b===c.INDEX,this.type=b,this.components=g,this.ftype=d;var h=l(d),i=e/h;-1!==g&&(this.numVertices=i/g),this.allocate(i,d);for(var k=m(d,a),n=this.data,o=0;a.ptr<f;)n[o++]=k.call(a)},write:function(a){a.U8(this.type),a.U8(this.ftype);for(var b=a.skipBlockSize(),c=n(this.ftype,a),d=this.data,e=0,f=d.length;f>e;e++)c.call(a,d[e]);a.writeBlockSize(b)}};var l=function(a){switch(a){case c.AWD_FIELD_UINT8:return 1;case c.AWD_FIELD_UINT16:return 2;case c.AWD_FIELD_FLOAT32:return 4;case c.AWD_FIELD_FLOAT64:return 8}throw new Error("WARN getTypeSize - unexpected stream data type "+a)},m=function(a,b){switch(a){case c.AWD_FIELD_UINT8:return b.U8;case c.AWD_FIELD_UINT16:return b.U16;case c.AWD_FIELD_FLOAT32:return b.F32;case c.AWD_FIELD_FLOAT64:return b.F64}throw new Error("WARN getReadFunc - unexpected stream data type "+a)},n=function(a,b){switch(a){case c.AWD_FIELD_UINT8:return b.U8;case c.AWD_FIELD_UINT16:return b.U16;case c.AWD_FIELD_FLOAT32:return b.F32;case c.AWD_FIELD_FLOAT64:return b.F64}throw new Error("WARN getWriteFunc - unexpected stream data type "+a)},o=function(a){switch(a){case c.AWD_FIELD_UINT8:return Uint8Array;case c.AWD_FIELD_UINT16:return Uint16Array;case c.AWD_FIELD_FLOAT32:return Float32Array;case c.AWD_FIELD_FLOAT64:return Float64Array}throw new Error("WARN getArray - unexpected stream data type "+a)},p=function(a){switch(a){case c.POSITION:case c.INDEX:case c.NORMAL:case c.TANGENT:case c.BINORMAL:return 3;case c.UVS:return 2;case c.JOIN_WGT:case c.JOIN_IDX:return-1;default:return-1}};h.SubGeom=i,h.VertexBuffer=k,h.getTypeSize=l,h.getReadFunc=m,h.getWriteFunc=n,h.getArray=o,h.fixC4D_Type=j,b.exports=h}()},{BaseElement:7,consts:13,"types/awdString":15,"types/properties":16,"types/userAttr":17}],6:[function(a,b,c){String.prototype.codePointAt||!function(){"use strict";var a=function(){try{var a={},b=Object.defineProperty,c=b(a,a,a)&&b}catch(a){}return c}(),b=function(a){if(null==this)throw TypeError();var b=String(this),c=b.length,d=a?Number(a):0;if(d!=d&&(d=0),!(0>d||d>=c)){var e,f=b.charCodeAt(d);return f>=55296&&56319>=f&&c>d+1&&(e=b.charCodeAt(d+1),e>=56320&&57343>=e)?1024*(f-55296)+e-56320+65536:f}};a?a(String.prototype,"codePointAt",{value:b,configurable:!0,writable:!0}):String.prototype.codePointAt=b}()},{}],7:[function(a,b,c){!function(){var c=a("./consts"),d=a("./chunk"),e={_setup:function(a,b){this.awd=a,this.chunk=b,this.id=b.id},init:function(){this.injectDeps=!1,this.model=c.MODEL_GENERIC},getDependencies:function(){return this.deps?this.deps:null},prepareAndAdd:void 0,prepareChunk:function(){null===this.chunk&&(this.chunk=new d),this.chunk.type=this.type,this.chunk.ns=this.ns}},f={};f.createStruct=function(a,b,c){var d=function(){this.type=a,this.nsUri=b,this.ns=0,this.injectDeps=!0,this.init(),this.chunk=null,this.id=-1};d.TYPE=a;var f;for(f in e)d.prototype[f]=e[f];for(f in c)d.prototype[f]=c[f];return d},b.exports=f}()},{"./chunk":12,"./consts":13}],8:[function(a,b,c){var d=a("./consts"),e=a("./BaseElement"),f=e.createStruct(d.GENERIC,-1,{read:function(a){this.buf=new ArrayBuffer(this.chunk.size),a.readBytes(this.buf,this.chunk.size),this.setDeps()},write:function(a){a.writeBytes(this.buf,this.chunk.size)},setDeps:function(){for(var a,b=this.awd._elements,c=[],d=0,e=b.length;e>d;d++)a=b[d],c.push(a);this.deps=c},prepareAndAdd:void 0,prepareChunk:function(){}});b.exports=f},{"./BaseElement":7,"./consts":13}],9:[function(a,b,c){!function(){var c=a("./types/awdString"),d=a("./consts"),e=a("./BaseElement"),f=e.createStruct(d.NAMESPACE,null,{init:function(){this.uri="",this.nsId=0},read:function(a){this.nsId=a.U8(),this.uri=c.read(a)},write:void 0});b.exports=f}()},{"./BaseElement":7,"./consts":13,"./types/awdString":15}],10:[function(a,b,c){!function(){var a=function(a,b,c){this.buffer=a,this.ptr=0,this.littleEndien=!0,b=b||0,c=c||a.byteLength,this.view=new DataView(a,b,c),this.length=this.view.byteLength};a.prototype={setPosition:function(a){this.ptr=a},setLittleEndian:function(a){this.littleEndien=a},bytesAvailable:function(){return this.length-this.ptr},I8:function(){return this.view.getInt8(this.ptr++)},U8:function(){return this.view.getUint8(this.ptr++)},I16:function(){var a=this.view.getInt16(this.ptr,this.littleEndien);return this.ptr+=2,a},U16:function(){var a=this.view.getUint16(this.ptr,this.littleEndien);return this.ptr+=2,a},I32:function(){var a=this.view.getInt32(this.ptr,this.littleEndien);return this.ptr+=4,a},U32:function(){var a=this.view.getUint32(this.ptr,this.littleEndien);return this.ptr+=4,a},F32:function(){var a=this.view.getFloat32(this.ptr,this.littleEndien);return this.ptr+=4,a},F64:function(){var a=this.view.getFloat64(this.ptr,this.littleEndien);return this.ptr+=8,a},readBytes:function(a,b){void 0===b&&(b=a.byteLength);var c=new Int8Array(a),d=new Int8Array(this.buffer,this.ptr,b);c.set(d),this.ptr+=b},subArray:function(a){var b=new Int8Array(this.buffer,this.ptr,a);return this.ptr+=a,b},readUTFBytes:function(a){for(var b,c,d,e=this.ptr+a,f=[],g=0;this.ptr<e;)b=this.U8(),0!==b&&(128>b?f[g++]=String.fromCharCode(b):b>191&&224>b?(c=this.U8(),f[g++]=String.fromCharCode((31&b)<<6|63&c)):(c=this.U8(),d=this.U8(),f[g++]=String.fromCharCode((15&b)<<12|(63&c)<<6|63&d)));return f.join("")}},b.exports=a}()},{}],11:[function(a,b,c){b.exports={}},{"string.prototype.codepointat":6}],12:[function(a,b,c){!function(){var a=function(){this.id=0,this.ns=0,this.type=0,this.flags=0,this.size=0,this.data=null};a.prototype={read:function(a){this.id=a.U32(),this.ns=a.U8(),this.type=a.U8(),this.flags=a.U8(),this.size=a.U32()},write:void 0},b.exports=a}()},{}],13:[function(a,b,c){!function(){var a={UNCOMPRESSED:0,DEFLATE:1,LZMA:2,AWD_FIELD_INT8:1,AWD_FIELD_INT16:2,AWD_FIELD_INT32:3,AWD_FIELD_UINT8:4,AWD_FIELD_UINT16:5,AWD_FIELD_UINT32:6,AWD_FIELD_FLOAT32:7,AWD_FIELD_FLOAT64:8,AWD_FIELD_BOOL:21,AWD_FIELD_COLOR:22,AWD_FIELD_BADDR:23,AWD_FIELD_STRING:31,AWD_FIELD_BYTEARRAY:32,AWD_FIELD_VECTOR2x1:41,AWD_FIELD_VECTOR3x1:42,AWD_FIELD_VECTOR4x1:43,AWD_FIELD_MTX3x2:44,AWD_FIELD_MTX3x3:45,AWD_FIELD_MTX4x3:46,AWD_FIELD_MTX4x4:47,INT8:1,INT16:2,INT32:3,UINT8:4,UINT16:5,UINT32:6,FLOAT32:7,FLOAT64:8,AWDSTRING:31,AWDBYTEARRAY:32,MAGIC:4282180,GENERIC:0,GEOMETRY:1,PRIMITIVE:11,CONTAINER:22,MESH:23,MATERIAL:81,TEXTURE:82,SKELETON:101,SKELETON_POSE:102,SKELETON_ANIMATION:103,ANIMATION_SET:113,ANIMATOR:122,NAMESPACE:254,METADATA:255,MODEL_ENTITY:2,MODEL_SKYBOX:4,MODEL_CAMERA:8,MODEL_SEGMENT_SET:16,MODEL_MESH:32,MODEL_GEOMETRY:64,MODEL_SKELETON:128,MODEL_SKELETON_POSE:256,MODEL_CONTAINER:512,MODEL_TEXTURE:1024,MODEL_TEXTURE_PROJECTOR:2048,MODEL_MATERIAL:4096,MODEL_ANIMATION_SET:8192,MODEL_ANIMATION_STATE:16384,MODEL_ANIMATION_NODE:32768,MODEL_ANIMATOR:65536,MODEL_STATE_TRANSITION:1<<17,MODEL_LIGHT:1<<18,MODEL_LIGHT_PICKER:1<<19,MODEL_SHADOW_MAP_METHOD:1<<20,MODEL_EFFECTS_METHOD:1<<21,MODEL_GENERIC:-1,POSITION:1,INDEX:2,UVS:3,NORMAL:4,TANGENT:5,JOIN_IDX:6,JOIN_WGT:7,SUVS:8,COLOR:11,BINORMAL:12,DEFAULT_NS:0};b.exports=a}()},{}],14:[function(a,b,c){var d=a("./DefaultElement"),e=a("./Namespace"),f=function(a){this.nsUri=a,this.structs=[],this.nsId=0};f.prototype={addStruct:function(a){this.structs.push(a)},addStructs:function(a){for(var b=0,c=a.length;c>b;b++)this.addStruct(a[b])},create:function(a){for(var b,c=this.structs,e=0,f=c.length;f>e;e++)if(b=c[e],b.TYPE===a)return new b;return new d},createNamespace:function(){var a=new e;return a.uri=this.nsUri,a}},b.exports=f},{"./DefaultElement":8,"./Namespace":9}],15:[function(a,b,c){b.exports={read:function(a){var b=a.U16();return a.readUTFBytes(b)},write:function(a,b){b.U16(a.length),b.writeUTFBytes(a)},getUTFBytesLength:function(a){for(var b=0,c=0,d=a.length;d>c;c++){var e,f=a[c].codePointAt(0);128>f?e=1:2048>f?e=2:65536>f?e=3:2097152>f&&(e=4),b+=e}return b}}},{}],16:[function(a,b,c){!function(){var c=a("../consts"),d=(a("./awdString"),a("../bufferWriter")),e=a("../bufferReader"),f=function(a){this.expected=a,this.vars={}};f.prototype={clone:function(){var a=new d(64);this.write(a);var b=new f(this.expected);return b.read(new e(a.buffer)),b},read:function(a){var b=this.expected,c=a.U32(),d=a.ptr+c;if(b)for(;a.ptr<d;){var e,f=a.U16(),g=a.U32();this.expected.hasOwnProperty(f)?(e=b[f],this.set(f,this.parseAttrValue(e,g,a))):a.ptr+=g}a.ptr!==d&&(console.log("Warn Properties don't read entire data ",a.ptr,d,c),a.ptr=d)},write:void 0,set:function(a,b){this.vars[a]=b},get:function(a,b){return this.vars.hasOwnProperty(a)?this.vars[a]:b},writeAttrValue:void 0,parseAttrValue:function(a,b,d){var e,f;switch(a){case c.AWD_FIELD_INT8:e=1,f=d.I8;break;case c.AWD_FIELD_INT16:e=2,f=d.I16;break;case c.AWD_FIELD_INT32:e=4,f=d.I32;break;case c.AWD_FIELD_BOOL:case c.AWD_FIELD_UINT8:e=1,f=d.U8;break;case c.AWD_FIELD_UINT16:e=2,f=d.U16;break;case c.AWD_FIELD_UINT32:case c.AWD_FIELD_BADDR:e=4,f=d.U32;break;case c.AWD_FIELD_FLOAT32:e=4,f=d.F32;break;case c.AWD_FIELD_FLOAT64:e=8,f=d.F64;break;case c.AWD_FIELD_STRING:var g=d.U16();g===b&&console.log("WARN may be Prefab bug / String property bug!!"),d.ptr-=2;var h=d.readUTFBytes(b);return h;case c.AWD_FIELD_VECTOR2x1:case c.AWD_FIELD_VECTOR3x1:case c.AWD_FIELD_VECTOR4x1:case c.AWD_FIELD_MTX3x2:case c.AWD_FIELD_MTX3x3:case c.AWD_FIELD_MTX4x3:case c.AWD_FIELD_MTX4x4:e=8,f=d.F64}if(b>e){var i,j,k;for(i=[],j=0,k=b/e;k>j;)i.push(f.call(d)),j++;return i}return f.call(d)}},b.exports=f}()},{"../bufferReader":10,"../bufferWriter":11,"../consts":13,"./awdString":15}],17:[function(a,b,c){!function(){var c=a("../consts"),d=a("./awdString"),e=a("../bufferWriter"),f=a("../bufferReader"),g=function(){this.attributes={},this._list=[]};g.prototype={clone:function(){var a=new e(64);this.write(a);var b=new g;return b.read(new f(a.buffer)),b},addAttribute:function(a,b,c,d){var e={name:a,value:b,type:c,ns:d};this.attributes[a]=e,this._list.push(e)},read:function(a){var b,e=a.U32();if(e>0){b={};for(var f=a.ptr+e;a.ptr<f;){var g,h=a.U8(),i=d.read(a),j=a.U8(),k=a.U32();switch(j){case c.AWDSTRING:g=a.readUTFBytes(k);break;case c.INT8:g=a.I8();break;case c.INT16:g=a.I16();break;case c.INT32:g=a.I32();break;case c.BOOL:case c.UINT8:g=a.U8();break;case c.UINT16:g=a.U16();break;case c.UINT32:case c.BADDR:g=a.U32();break;case c.FLOAT32:g=a.F32();break;case c.FLOAT64:g=a.F64();break;default:g="unimplemented attribute type "+j+"ns : "+h,a.ptr+=k}this.addAttribute(i,g,j,h),b[i]=g}}return b},write:void 0},b.exports=g}()},{"../bufferReader":10,"../bufferWriter":11,"../consts":13,"./awdString":15}],awdlib_pil:[function(a,b,c){b.exports={InterleavedGeometry:a("./InterleavedGeometry"),CompactSkeletonAnimation:a("./CompactSkeletonAnimation"),ext:a("./ext"),extInfos:a("./extInfos")}},{"./CompactSkeletonAnimation":1,"./InterleavedGeometry":2,"./ext":3,"./extInfos":4}]},{},[])("awdlib_pil")})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],170:[function(a,b,c){(function(d){!function(a){if("object"==typeof c&&"undefined"!=typeof b)b.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof d?d:"undefined"!=typeof self?self:this,e.awdlib=a()}}(function(){return function b(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};c[h][0].call(l.exports,function(a){var b=c[h][1][a];return f(b?b:a)},l,l.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof a&&a,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){String.prototype.codePointAt||!function(){"use strict";var a=function(){try{var a={},b=Object.defineProperty,c=b(a,a,a)&&b}catch(a){}return c}(),b=function(a){if(null==this)throw TypeError();var b=String(this),c=b.length,d=a?Number(a):0;if(d!=d&&(d=0),!(0>d||d>=c)){var e,f=b.charCodeAt(d);return f>=55296&&56319>=f&&c>d+1&&(e=b.charCodeAt(d+1),e>=56320&&57343>=e)?1024*(f-55296)+e-56320+65536:f}};a?a(String.prototype,"codePointAt",{value:b,configurable:!0,writable:!0}):String.prototype.codePointAt=b}()},{}],2:[function(a,b,c){!function(){var c=a("./consts"),d=a("./chunk"),e={_setup:function(a,b){this.awd=a,this.chunk=b,this.id=b.id},init:function(){this.injectDeps=!1,this.model=c.MODEL_GENERIC},getDependencies:function(){return this.deps?this.deps:null},prepareAndAdd:void 0,prepareChunk:function(){null===this.chunk&&(this.chunk=new d),this.chunk.type=this.type,this.chunk.ns=this.ns}},f={};f.createStruct=function(a,b,c){var d=function(){this.type=a,this.nsUri=b,this.ns=0,this.injectDeps=!0,this.init(),this.chunk=null,this.id=-1};d.TYPE=a;var f;for(f in e)d.prototype[f]=e[f];for(f in c)d.prototype[f]=c[f];return d},b.exports=f}()},{"./chunk":8,"./consts":9}],3:[function(a,b,c){var d=a("./consts"),e=a("./BaseElement"),f=e.createStruct(d.GENERIC,-1,{read:function(a){this.buf=new ArrayBuffer(this.chunk.size),a.readBytes(this.buf,this.chunk.size),this.setDeps()},write:function(a){a.writeBytes(this.buf,this.chunk.size)},setDeps:function(){for(var a,b=this.awd._elements,c=[],d=0,e=b.length;e>d;d++)a=b[d],c.push(a);this.deps=c},prepareAndAdd:void 0,prepareChunk:function(){}});b.exports=f},{"./BaseElement":2,"./consts":9}],4:[function(a,b,c){!function(){var c=a("./types/awdString"),d=a("./consts"),e=a("./BaseElement"),f=e.createStruct(d.NAMESPACE,null,{init:function(){this.uri="",this.nsId=0},read:function(a){this.nsId=a.U8(),this.uri=c.read(a)},write:void 0});b.exports=f}()},{"./BaseElement":2,"./consts":9,"./types/awdString":18}],5:[function(a,b,c){var d=a("./header"),e=a("./writer"),f=a("./consts"),g=a("./chunk"),h=a("./bufferReader"),i=a("./DefaultElement"),j=function(){this.header=new d,this._elements=[],this._elementsById=[],this._extensions=[]};j.prototype={addElement:function(a){this._elements.push(a),this._elementsById[a.id]=a},removeElement:function(a){var b=this._elements.indexOf(a);b>-1&&this._elements.splice(b,1)},parse:function(a){var b,c=new h(a);for(this.header.read(c);c.bytesAvailable()>0;)b=this.parseChunk(c)},write:function(){return e.write(this)},registerNamespace:function(a){var b=this.getExtension(a.uri);b&&(b.nsId=a.nsId)},addExtension:function(a){if(null===this.getExtension(a.nsUri)){var b,c=this._extensions.push(a),d=a.createNamespace();null!==a.nsUri?(b=c+1,this.addElement(d)):b=0,d.nsId=a.nsId=b}},getExtension:function(a){for(var b=this._extensions,c=0,d=b.length;d>c;c++)if(b[c].nsUri===a)return b[c];return null},getExtensionById:function(a){for(var b=this._extensions,c=0,d=b.length;d>c;c++)if(b[c].nsId===a)return b[c];return null},getDatasByType:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=[]);var d,e;if(a instanceof Array)for(d=0,e=a.length;e>d;d++)this.getDatasByType(a[d],b,c);else for(d=0,e=this._elements.length;e>d;d++)this._elements[d].type===a&&this._elements[d].nsUri===b&&c.push(this._elements[d]);return c},getAssetByID:function(a,b){var c=[],d=0,e=this._elementsById;if(a>0&&e[a])for(;d<b.length;){if(0!==(e[a].model&b[d]))return c.push(!0),c.push(e[a]),c;if(b[d]===f.MODEL_GEOMETRY&&0!==(e[a].model&f.MODEL_MESH))return c.push(!0),c.push(e[a].geometry),c;d++}return c.push(!1),c.push(null),c},parseChunk:function(a){var b=new g;b.read(a);var c=this.structFactory(b),d=a.ptr;c.read(a),a.ptr-d!==b.size&&(console.log("Warn bad block parsing , byte delta : ",b.type,b.ns,a.ptr-d-b.size),a.ptr=d+b.size),b.ns===f.DEFAULT_NS&&b.type===f.NAMESPACE&&this.registerNamespace(c),this.addElement(c)},structFactory:function(a){var b,c=this.getExtensionById(a.ns);return b=c?c.create(a.type):new i,b._setup(this,a),b},resolveNamespace:function(a){if(null==a.nsUri)return 0;var b=this.getExtension(a.nsUri);return b?b.nsId:(console.log("Missing extension "+a.nsUri),0)}},b.exports=j},{"./DefaultElement":3,"./bufferReader":6,"./chunk":8,"./consts":9,"./header":11,"./writer":23}],6:[function(a,b,c){!function(){var a=function(a,b,c){this.buffer=a,this.ptr=0,this.littleEndien=!0,b=b||0,c=c||a.byteLength,this.view=new DataView(a,b,c),this.length=this.view.byteLength};a.prototype={setPosition:function(a){this.ptr=a},setLittleEndian:function(a){this.littleEndien=a},bytesAvailable:function(){return this.length-this.ptr},I8:function(){return this.view.getInt8(this.ptr++)},U8:function(){return this.view.getUint8(this.ptr++)},I16:function(){var a=this.view.getInt16(this.ptr,this.littleEndien);return this.ptr+=2,a},U16:function(){var a=this.view.getUint16(this.ptr,this.littleEndien);return this.ptr+=2,a},I32:function(){var a=this.view.getInt32(this.ptr,this.littleEndien);return this.ptr+=4,a},U32:function(){var a=this.view.getUint32(this.ptr,this.littleEndien);return this.ptr+=4,a},F32:function(){var a=this.view.getFloat32(this.ptr,this.littleEndien);return this.ptr+=4,a},F64:function(){var a=this.view.getFloat64(this.ptr,this.littleEndien);return this.ptr+=8,a},readBytes:function(a,b){void 0===b&&(b=a.byteLength);var c=new Int8Array(a),d=new Int8Array(this.buffer,this.ptr,b);c.set(d),this.ptr+=b},subArray:function(a){var b=new Int8Array(this.buffer,this.ptr,a);return this.ptr+=a,b},readUTFBytes:function(a){for(var b,c,d,e=this.ptr+a,f=[],g=0;this.ptr<e;)b=this.U8(),0!==b&&(128>b?f[g++]=String.fromCharCode(b):b>191&&224>b?(c=this.U8(),f[g++]=String.fromCharCode((31&b)<<6|63&c)):(c=this.U8(),d=this.U8(),f[g++]=String.fromCharCode((15&b)<<12|(63&c)<<6|63&d)));return f.join("")}},b.exports=a}()},{}],7:[function(a,b,c){b.exports={}},{"string.prototype.codepointat":1}],8:[function(a,b,c){!function(){var a=function(){this.id=0,this.ns=0,this.type=0,this.flags=0,this.size=0,this.data=null};a.prototype={read:function(a){this.id=a.U32(),this.ns=a.U8(),this.type=a.U8(),this.flags=a.U8(),this.size=a.U32()},write:void 0},b.exports=a}()},{}],9:[function(a,b,c){!function(){var a={UNCOMPRESSED:0,DEFLATE:1,LZMA:2,AWD_FIELD_INT8:1,AWD_FIELD_INT16:2,AWD_FIELD_INT32:3,AWD_FIELD_UINT8:4,AWD_FIELD_UINT16:5,AWD_FIELD_UINT32:6,AWD_FIELD_FLOAT32:7,AWD_FIELD_FLOAT64:8,AWD_FIELD_BOOL:21,AWD_FIELD_COLOR:22,AWD_FIELD_BADDR:23,AWD_FIELD_STRING:31,AWD_FIELD_BYTEARRAY:32,AWD_FIELD_VECTOR2x1:41,AWD_FIELD_VECTOR3x1:42,AWD_FIELD_VECTOR4x1:43,AWD_FIELD_MTX3x2:44,AWD_FIELD_MTX3x3:45,AWD_FIELD_MTX4x3:46,AWD_FIELD_MTX4x4:47,INT8:1,INT16:2,INT32:3,UINT8:4,UINT16:5,UINT32:6,FLOAT32:7,FLOAT64:8,AWDSTRING:31,AWDBYTEARRAY:32,MAGIC:4282180,GENERIC:0,GEOMETRY:1,PRIMITIVE:11,CONTAINER:22,MESH:23,MATERIAL:81,TEXTURE:82,SKELETON:101,SKELETON_POSE:102,SKELETON_ANIMATION:103,ANIMATION_SET:113,ANIMATOR:122,NAMESPACE:254,METADATA:255,MODEL_ENTITY:2,MODEL_SKYBOX:4,MODEL_CAMERA:8,MODEL_SEGMENT_SET:16,MODEL_MESH:32,MODEL_GEOMETRY:64,MODEL_SKELETON:128,MODEL_SKELETON_POSE:256,MODEL_CONTAINER:512,MODEL_TEXTURE:1024,MODEL_TEXTURE_PROJECTOR:2048,MODEL_MATERIAL:4096,MODEL_ANIMATION_SET:8192,MODEL_ANIMATION_STATE:16384,MODEL_ANIMATION_NODE:32768,MODEL_ANIMATOR:65536,MODEL_STATE_TRANSITION:1<<17,MODEL_LIGHT:1<<18,MODEL_LIGHT_PICKER:1<<19,MODEL_SHADOW_MAP_METHOD:1<<20,MODEL_EFFECTS_METHOD:1<<21,MODEL_GENERIC:-1,POSITION:1,INDEX:2,UVS:3,NORMAL:4,TANGENT:5,JOIN_IDX:6,JOIN_WGT:7,SUVS:8,COLOR:11,BINORMAL:12,DEFAULT_NS:0};b.exports=a}()},{}],10:[function(a,b,c){var d=a("./DefaultElement"),e=a("./Namespace"),f=function(a){this.nsUri=a,this.structs=[],this.nsId=0};f.prototype={addStruct:function(a){this.structs.push(a)},addStructs:function(a){for(var b=0,c=a.length;c>b;b++)this.addStruct(a[b])},create:function(a){for(var b,c=this.structs,e=0,f=c.length;f>e;e++)if(b=c[e],b.TYPE===a)return new b;return new d},createNamespace:function(){var a=new e;return a.uri=this.nsUri,a}},b.exports=f},{"./DefaultElement":3,"./Namespace":4}],11:[function(a,b,c){!function(){var c=a("./consts"),d=function(){this.size=12,this.version={major:0,minor:0},this.streaming=!1,this.accuracyMatrix=!1,this.accuracyGeo=!1,this.accuracyProps=!1,this.geoNrType=c.FLOAT32,this.matrixNrType=c.FLOAT32,this.propsNrType=c.FLOAT32,this.optimized_for_accuracy=!1,this.compression=!1,this.bodylen=0};d.prototype={read:function(a){var b=a.U8()<<16|a.U8()<<8|a.U8();if(b!==c.MAGIC)throw new Error("AWD parse error - bad magic "+b.toString(16));var d=this.version;d.major=a.U8(),d.minor=a.U8();var e=a.U16();this.streaming=1===(1&e),this.optimized_for_accuracy=2===(2&e),2===d.major&&1===d.minor&&(this.accuracyMatrix=2===(2&e),this.accuracyGeo=4===(4&e),this.accuracyProps=8===(8&e)),this.geoNrType=this.accuracyGeo?c.FLOAT64:c.FLOAT32,this.matrixNrType=this.accuracyMatrix?c.FLOAT64:c.FLOAT32,this.propsNrType=this.accuracyProps?c.FLOAT64:c.FLOAT32,this.compression=a.U8(),this.bodylen=a.U32()},write:void 0},b.exports=d}()},{"./consts":9}],12:[function(a,b,c){!function(){var a={}.hasOwnProperty,b=Object.defineProperty,c=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype},d=function(a,c,d,e){b(a,c,{get:d,set:e})};return{extend:c,getset:d}}()},{}],13:[function(a,b,c){var d=a("../consts");b.exports=function(a){var b,c,e=a.getDatasByType(d.GEOMETRY);for(b=0,c=e.length;c>b;b++){var f,g,h=e[b];for(f=0,g=h.subGeoms.length;g>f;f++){var i=h.subGeoms[f],j=i.getBuffersByType([d.POSITION])[0];if(3!==j.components)throw new Error("invalid number of components, should be 3, is "+j.components);var k,l,m,n,o,p,q,r,s=j.data;for(m=p=s[0],n=q=s[1],o=r=s[2],k=3,l=s.length;l>k;k+=3)m=Math.min(m,s[k]),p=Math.max(p,s[k]),n=Math.min(n,s[k+1]),q=Math.max(q,s[k+1]),o=Math.min(o,s[k+2]),r=Math.max(r,s[k+2]);var t=a.header.geoNrType,u=i.props;u.expected[10]=u.expected[11]=u.expected[12]=u.expected[13]=u.expected[14]=u.expected[15]=t,u.set(10,m),u.set(11,n),u.set(12,o),u.set(13,p),u.set(14,q),u.set(15,r)}}}},{"../consts":9}],14:[function(a,b,c){var d=a("../consts");b.exports=function(a){var b,c,e=a.getDatasByType(d.GEOMETRY);for(b=0,c=e.length;c>b;b++){var f,g,h=e[b];for(f=0,g=h.subGeoms.length;g>f;f++){var i,j,k=h.subGeoms[f],l=k.getBuffersByType(d.INDEX);for(i=0,j=l.length;j>i;i++){var m,n,o,p=l[i],q=p.data;for(m=1,n=q.length;n>m;m+=3)o=q[m],q[m]=q[m+1],q[m+1]=o}}}}},{"../consts":9}],15:[function(a,b,c){var d=a("../consts");b.exports=function(a){var b,c,e=a.getDatasByType(d.GEOMETRY);for(b=0,c=e.length;c>b;b++){var f,g,h=e[b];for(f=0,g=h.subGeoms.length;g>f;f++){var i,j,k=h.subGeoms[f],l=k.getBuffersByType(d.UVS);for(i=0,j=l.length;j>i;i++){var m=l[i];if(2!==m.components)throw new Error("invalid number of components, should be 3, is "+m.components);var n,o,p=m.data;for(n=1,o=p.length;o>n;n+=2)p[n]=1-p[n]}}}}},{"../consts":9}],16:[function(a,b,c){var d=a("../consts");b.exports=function(a){var b=a.getDatasByType(d.GEOMETRY);console.log(b.length);var c,e;for(c=0,e=b.length;e>c;c++){var f,g,h=b[c];for(f=0,g=h.subGeoms.length;g>f;f++){var i,j,k=h.subGeoms[f],l=k.getBuffersByType([d.POSITION,d.NORMAL,d.TANGENT]);for(i=0,j=l.length;j>i;i++){var m=l[i];if(3!==m.components)throw new Error("invalid number of components, should be 3, is "+m.components);var n,o,p=m.data;for(n=0,o=p.length;o>n;n+=3)p[n]=-p[n]}}}}},{"../consts":9}],17:[function(a,b,c){function d(a,b){var c,d;for(c=1,d=a.length;d>c;c++)a[c]=b[0]*a[c]+b[5]}function e(a,b){var c,d;for(c=1,d=a.length;d>c;c+=2){var e=a[c],f=a[c+1];a[c+0]=b[0]*e+b[2]*f+b[5],a[c+1]=b[6]*e+b[7]*f+b[10]}}function f(a,b){var c,d;for(c=1,d=a.length;d>c;c+=3){var e=a[c],f=a[c+1],g=a[c+2];a[c+0]=b[0]*e+b[2]*f+b[3]*g+b[5],a[c+1]=b[6]*e+b[7]*f+b[8]*g+b[10],a[c+2]=b[11]*e+b[12]*f+b[13]*g+b[15]}}function g(a,b){var c,d;for(c=1,d=a.length;d>c;c+=4){var e=a[c],f=a[c+1],g=a[c+2],h=a[c+3];a[c+0]=b[0]*e+b[2]*f+b[3]*g+b[4]*h+b[5],a[c+1]=b[6]*e+b[7]*f+b[8]*g+b[9]*h+b[10],a[c+2]=b[11]*e+b[12]*f+b[13]*g+b[14]*h+b[15],a[c+3]=b[16]*e+b[17]*f+b[18]*g+b[19]*h+b[20]}}var h=a("../consts"),i=[null,d,e,f,g];b.exports=function(a,b,c){var d,e,f,g,j,k,l=a.getDatasByType(h.GEOMETRY);for(d=0,e=l.length;e>d;d++){var m=l[d];for(f=0,g=m.subGeoms.length;g>f;f++){var n=m.subGeoms[f],o=n.getBuffersByType(c);for(j=0,k=o.length;k>j;j++){var p=o[j],q=p.components,r=p.data;if(1>q||q>4)throw new Error("invalid number of components, must be [1-4], is "+q);i[q](r,b)}}}}},{"../consts":9}],18:[function(a,b,c){b.exports={read:function(a){var b=a.U16();return a.readUTFBytes(b)},write:function(a,b){b.U16(a.length),b.writeUTFBytes(a)},getUTFBytesLength:function(a){for(var b=0,c=0,d=a.length;d>c;c++){var e,f=a[c].codePointAt(0);128>f?e=1:2048>f?e=2:65536>f?e=3:2097152>f&&(e=4),b+=e}return b}}},{}],19:[function(a,b,c){!function(){var a=function(){this.data=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};a.prototype={read:function(a,b){this.parseMatrix43RawData(a,b,this.data)},write:void 0,parseMatrix43RawData:function(a,b,c){var d=c,e=a.header.accuracyMatrix?b.F64:b.F32;return d[0]=e.call(b),d[1]=e.call(b),d[2]=e.call(b),d[3]=0,d[4]=e.call(b),d[5]=e.call(b),d[6]=e.call(b),d[7]=0,d[8]=e.call(b),d[9]=e.call(b),d[10]=e.call(b),d[11]=0,d[12]=e.call(b),d[13]=e.call(b),d[14]=e.call(b),d[15]=1,isNaN(d[0])&&(d[0]=1,d[1]=0,d[2]=0,d[4]=0,d[5]=1,d[6]=0,d[8]=0,d[9]=0,d[10]=1,d[12]=0,d[13]=0,d[14]=0),d},writeMatrix43RawData:void 0},b.exports=a}()},{}],20:[function(a,b,c){!function(){var c=a("../consts"),d=(a("./awdString"),a("../bufferWriter")),e=a("../bufferReader"),f=function(a){this.expected=a,this.vars={}};f.prototype={clone:function(){var a=new d(64);this.write(a);var b=new f(this.expected);return b.read(new e(a.buffer)),b},read:function(a){var b=this.expected,c=a.U32(),d=a.ptr+c;if(b)for(;a.ptr<d;){var e,f=a.U16(),g=a.U32();this.expected.hasOwnProperty(f)?(e=b[f],this.set(f,this.parseAttrValue(e,g,a))):a.ptr+=g}a.ptr!==d&&(console.log("Warn Properties don't read entire data ",a.ptr,d,c),a.ptr=d)},write:void 0,set:function(a,b){this.vars[a]=b},get:function(a,b){return this.vars.hasOwnProperty(a)?this.vars[a]:b},writeAttrValue:void 0,parseAttrValue:function(a,b,d){var e,f;switch(a){case c.AWD_FIELD_INT8:e=1,f=d.I8;break;case c.AWD_FIELD_INT16:e=2,f=d.I16;break;case c.AWD_FIELD_INT32:e=4,f=d.I32;break;case c.AWD_FIELD_BOOL:case c.AWD_FIELD_UINT8:e=1,f=d.U8;break;case c.AWD_FIELD_UINT16:e=2,f=d.U16;break;case c.AWD_FIELD_UINT32:case c.AWD_FIELD_BADDR:e=4,f=d.U32;break;case c.AWD_FIELD_FLOAT32:e=4,f=d.F32;break;case c.AWD_FIELD_FLOAT64:e=8,f=d.F64;break;case c.AWD_FIELD_STRING:var g=d.U16();g===b&&console.log("WARN may be Prefab bug / String property bug!!"),d.ptr-=2;var h=d.readUTFBytes(b);return h;case c.AWD_FIELD_VECTOR2x1:case c.AWD_FIELD_VECTOR3x1:case c.AWD_FIELD_VECTOR4x1:case c.AWD_FIELD_MTX3x2:case c.AWD_FIELD_MTX3x3:case c.AWD_FIELD_MTX4x3:case c.AWD_FIELD_MTX4x4:e=8,f=d.F64}if(b>e){var i,j,k;for(i=[],j=0,k=b/e;k>j;)i.push(f.call(d)),j++;return i}return f.call(d)}},b.exports=f}()},{"../bufferReader":6,"../bufferWriter":7,"../consts":9,"./awdString":18}],21:[function(a,b,c){!function(){var c=a("../consts"),d=a("./awdString"),e=a("../bufferWriter"),f=a("../bufferReader"),g=function(){this.attributes={},this._list=[]};g.prototype={clone:function(){var a=new e(64);this.write(a);var b=new g;return b.read(new f(a.buffer)),b},addAttribute:function(a,b,c,d){var e={name:a,value:b,type:c,ns:d};this.attributes[a]=e,this._list.push(e)},read:function(a){var b,e=a.U32();if(e>0){b={};for(var f=a.ptr+e;a.ptr<f;){var g,h=a.U8(),i=d.read(a),j=a.U8(),k=a.U32();switch(j){case c.AWDSTRING:g=a.readUTFBytes(k);break;case c.INT8:g=a.I8();break;case c.INT16:g=a.I16();break;case c.INT32:g=a.I32();break;case c.BOOL:case c.UINT8:g=a.U8();break;case c.UINT16:g=a.U16();break;case c.UINT32:case c.BADDR:g=a.U32();break;case c.FLOAT32:g=a.F32();break;case c.FLOAT64:g=a.F64();break;default:g="unimplemented attribute type "+j+"ns : "+h,a.ptr+=k}this.addAttribute(i,g,j,h),b[i]=g}}return b},write:void 0},b.exports=g}()},{"../bufferReader":6,"../bufferWriter":7,"../consts":9,"./awdString":18}],22:[function(a,b,c){!function(){var c=a("../consts"),d=a("./properties"),e=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0};e.prototype={parsePivot:function(a,b){var e=a.header.matrixNrType,f=new d({1:e,2:e,3:e,4:c.UINT8});f.read(b),this.x=f.get(1,0),this.y=f.get(2,0),this.z=f.get(3,0)},writePivot:void 0},b.exports=e}()},{"../consts":9,"./properties":20}],23:[function(a,b,c){!function(){var c=void a("./bufferWriter");b.exports=c}()},{"./bufferWriter":7}],awdlib:[function(a,b,c){var d=a("BaseElement"),e=a("DefaultElement"),f=a("Namespace"),g=a("awd"),h=a("bufferReader"),i=a("bufferWriter"),j=a("chunk"),k=a("consts"),l=a("extension"),m=a("header"),n=a("lang"),o=a("tools/computeBounds"),p=a("tools/flipFaces"),q=a("tools/flipUvsY"),r=a("tools/flipX"),s=a("tools/transform"),t=a("types/awdString"),u=a("types/matrix"),v=a("types/properties"),w=a("types/userAttr"),x=a("types/vec3"),y=a("writer"),z={BaseElement:d,DefaultElement:e,Namespace:f,awd:g,bufferReader:h,bufferWriter:i,chunk:j,consts:k,extension:l,header:m,lang:n,computeBounds:o,flipFaces:p,flipUvsY:q,flipX:r,transform:s,awdString:t,matrix:u,properties:v,userAttr:w,vec3:x,writer:y};b.exports=z},{BaseElement:2,DefaultElement:3,Namespace:4,awd:5,bufferReader:6,bufferWriter:7,chunk:8,consts:9,extension:10,header:11,lang:12,"tools/computeBounds":13,"tools/flipFaces":14,"tools/flipUvsY":15,"tools/flipX":16,"tools/transform":17,"types/awdString":18,"types/matrix":19,"types/properties":20,"types/userAttr":21,"types/vec3":22,writer:23}]},{},[])("awdlib")})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],171:[function(a,b,c){(function(d){!function(a){if("object"==typeof c&&"undefined"!=typeof b)b.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof d?d:"undefined"!=typeof self?self:this,e.awdlib_std=a()}}(function(){return function b(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};c[h][0].call(l.exports,function(a){var b=c[h][1][a];return f(b?b:a)},l,l.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof a&&a,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){!function(){var c=a("types/properties"),d=a("types/awdString"),e=a("consts"),f=a("types/userAttr"),g=a("BaseElement"),h=g.createStruct(e.ANIMATION_SET,null,{init:function(){this.name="",this.model=e.MODEL_ANIMATION_SET,this.extras=new f,this.props=new c({}),this.animations=[]},read:function(a){this.name=d.read(a);var b=a.U16();this.props.read(a),this.animations=[];for(var c,f=0;b>f;f++){var g=a.U32(),h=this.awd.getAssetByID(g,[e.MODEL_ANIMATION_STATE]);if(!h[0])throw new Error("AnimationSet cannot find animation state reference");c=h[1],this.animations.push(c)}this.extras.read(a)},write:void 0,getDependencies:function(){for(var a=[],b=this.animations.length,c=0;b>c;c++){var d=this.animations[c];
a.push(d)}return a},toString:function(){return"[AnimationSet"+this.name+"]"}});b.exports=h}()},{BaseElement:15,consts:21,"types/awdString":23,"types/properties":25,"types/userAttr":26}],2:[function(a,b,c){!function(){var c=a("types/properties"),d=a("types/awdString"),e=a("consts"),f=a("types/userAttr"),g=a("BaseElement"),h=g.createStruct(e.ANIMATOR,null,{init:function(){this.name="",this.model=e.MODEL_ANIMATOR,this.extras=new f,this.animatorProps=new f,this.animatorProps=new c({1:e.AWD_FIELD_BADDR}),this.props=new c({}),this.targets=[],this.skeleton=null,this.animationSet=null,this.activeState=0,this.autoPlay=!1},read:function(a){var b;this.name=d.read(a);var c=a.U16();this.animatorProps.read(a);var f=a.U32(),g=a.U16();this.targets=[];for(var h=0;g>h;h++){var i=a.U32();if(b=this.awd.getAssetByID(i,[e.MODEL_MESH]),!b[0])throw new Error("Animator cannot find target reference");this.targets.push(b[1])}if(this.activeState=a.U16(),this.autoPlay=0!==a.U8(),this.props.read(a),this.extras.read(a),b=this.awd.getAssetByID(f,[e.MODEL_ANIMATION_SET]),!b[0])throw new Error("Animator cannot find AnimationSet reference");if(this.animationSet=b[1],1===c){var j=this.animatorProps.get(1,0);if(b=this.awd.getAssetByID(j,[e.MODEL_SKELETON]),!b[0])throw new Error("Animator cannot find Skeleton reference");this.skeleton=b[1]}},write:void 0,getDependencies:function(){for(var a=[this.skeleton,this.animationSet],b=0;b<this.targets.length;b++)a.push(this.targets[b]);return a},toString:function(){return"[Animator"+this.name+"]"}});b.exports=h}()},{BaseElement:15,consts:21,"types/awdString":23,"types/properties":25,"types/userAttr":26}],3:[function(a,b,c){!function(){var c=a("../../src/types/userAttr"),d=a("../../src/types/awdString"),e=a("../../src/types/vec3"),f=a("../../src/types/matrix"),g=a("../../src/consts"),h=a("../../src/BaseElement"),i=h.createStruct(g.CONTAINER,null,{init:function(){this.model=g.MODEL_CONTAINER,i.super(this)},read:function(a){var b=a.U32();this.matrix.read(this.awd,a),this.name=d.read(a),this.pivot.parsePivot(this.awd,a),this.extras.read(a);var c=this.awd.getAssetByID(b,[g.MODEL_CONTAINER,g.MODEL_MESH,g.MODEL_LIGHT,g.MODEL_ENTITY,g.MODEL_SEGMENT_SET]);if(c[0])void 0!==c[1].addChild&&c[1].addChild(this),this.parent=c[1];else if(b>0)throw new Error("Could not find a parent for this ObjectContainer3D id : "+b)},write:void 0,getDependencies:function(){var a=this.parent;return a?[a]:null},toString:function(){return"[Container "+this.name+"]"},addChild:function(a){-1===this.children.indexOf(a)&&(this.children.push(a),a.parent=this)},removeChild:function(a){var b=this.children.indexOf(a);b>-1&&(this.children.splice(b,1),a.parent=null)}});i.extend=function(a){a.addChild=i.prototype.addChild,a.removeChild=i.prototype.removeChild},i.super=function(a){a.parent=null,a.children=[],a.matrix=new f,a.name="",a.pivot=new e,a.extras=new c},b.exports=i}()},{"../../src/BaseElement":15,"../../src/consts":21,"../../src/types/awdString":23,"../../src/types/matrix":24,"../../src/types/userAttr":26,"../../src/types/vec3":27}],4:[function(a,b,c){!function(){"use strict";var c=a("consts"),d=a("types/awdString"),e=a("types/userAttr"),f=a("types/properties"),g=a("BaseElement"),h=g.createStruct(c.GEOMETRY,null,{subGeomFactory:function(){var a=new i;return a.bufferFactory=this.bufferFactory,a},bufferFactory:function(){return new k},init:function(){this.model=c.MODEL_GEOMETRY,this.name="",this.extras=new e,this.props=new f({}),this.subGeoms=[]},read:function(a){this.name=d.read(a);var b=a.U16(),c=this.awd.header.geoNrType,e=this.props;e.expected[1]=c,e.expected[2]=c,e.read(a);var f=e.get(1,1),g=e.get(2,1);1===f&&1===g||console.log("WARN defined scale UV in geometry");for(var h,i=this.subGeoms,j=0;b>j;j++)h=this.subGeomFactory(),h.read(this.awd,a),i.push(h);this.extras.read(a)},write:void 0,toString:function(){return"[Geometry "+this.name+"]"}}),i=function(){this.buffers=[],this.extras=new e,this.props=new f({})};i.prototype={getBuffersByType:function(a,b){void 0===b&&(b=[]);var c,d;if(a instanceof Array)for(c=0,d=a.length;d>c;c++)this.getBuffersByType(a[c],b);else for(c=0,d=this.buffers.length;d>c;c++)this.buffers[c].type===a&&b.push(this.buffers[c]);return b},read:function(a,b){var c=b.U32(),d=b.ptr+c,e=a.header.geoNrType,f=this.props;f.expected[1]=e,f.expected[2]=e,f.read(b);var g=f.get(1,1),h=f.get(2,1);1===g&&1===h||console.log("WARN defined scale UV in sub-geometry");for(var i,j=-1;b.ptr<d;)i=this.bufferFactory(),i.read(b),!i.isIndex&&i.numVertices>-1&&(j>-1&&i.numVertices!==j&&console.log("Warn buffers in geom has differents num vertices",j,i.numVertices),j=i.numVertices),this.buffers.push(i);-1===j&&console.log("Error, Can't resolve geom buffers sizes");for(var k=0,l=this.buffers.length;l>k;k++)i=this.buffers[k],-1!==i.numVertices||i.isIndex||i.solveSize(j);this.extras.read(b)},write:function(a,b){var c=b.skipBlockSize();this.writeProps(a,b);for(var d=0,e=this.buffers.length;e>d;d++){var f=this.buffers[d];f.write(b)}b.writeBlockSize(c),this.extras.write(b)},writeProps:function(a,b){var c=a.header.geoNrType,d=this.props;d.expected[1]=c,d.expected[2]=c,d.set(1,1),d.set(2,1),d.write(b)}};var j=function(a){return 2===a?c.AWD_FIELD_UINT16:a},k=function(){this.data=null,this.numVertices=-1,this.type=0,this.components=0,this.ftype=c.T_FLOAT,this.isIndex=!1};k.HEAD_SIZE=6,k.prototype={allocate:function(a,b){var c=o(b);void 0===c&&console.log(b),this.data=new c(a)},solveSize:function(a){this.numVertices=a,this.components=this.data.length/a},read:function(a){var b=a.U8(),d=a.U8(),e=a.U32(),f=a.ptr+e;d=j(d),d!==c.AWD_FIELD_UINT8&&d!==c.AWD_FIELD_UINT16&&d!==c.AWD_FIELD_FLOAT32&&d!==c.AWD_FIELD_FLOAT64&&console.log("WARN unexpected stream data type ",d,b,e);var g=p(b);this.isIndex=b===c.INDEX,this.type=b,this.components=g,this.ftype=d;var h=l(d),i=e/h;-1!==g&&(this.numVertices=i/g),this.allocate(i,d);for(var k=m(d,a),n=this.data,o=0;a.ptr<f;)n[o++]=k.call(a)},write:function(a){a.U8(this.type),a.U8(this.ftype);for(var b=a.skipBlockSize(),c=n(this.ftype,a),d=this.data,e=0,f=d.length;f>e;e++)c.call(a,d[e]);a.writeBlockSize(b)}};var l=function(a){switch(a){case c.AWD_FIELD_UINT8:return 1;case c.AWD_FIELD_UINT16:return 2;case c.AWD_FIELD_FLOAT32:return 4;case c.AWD_FIELD_FLOAT64:return 8}throw new Error("WARN getTypeSize - unexpected stream data type "+a)},m=function(a,b){switch(a){case c.AWD_FIELD_UINT8:return b.U8;case c.AWD_FIELD_UINT16:return b.U16;case c.AWD_FIELD_FLOAT32:return b.F32;case c.AWD_FIELD_FLOAT64:return b.F64}throw new Error("WARN getReadFunc - unexpected stream data type "+a)},n=function(a,b){switch(a){case c.AWD_FIELD_UINT8:return b.U8;case c.AWD_FIELD_UINT16:return b.U16;case c.AWD_FIELD_FLOAT32:return b.F32;case c.AWD_FIELD_FLOAT64:return b.F64}throw new Error("WARN getWriteFunc - unexpected stream data type "+a)},o=function(a){switch(a){case c.AWD_FIELD_UINT8:return Uint8Array;case c.AWD_FIELD_UINT16:return Uint16Array;case c.AWD_FIELD_FLOAT32:return Float32Array;case c.AWD_FIELD_FLOAT64:return Float64Array}throw new Error("WARN getArray - unexpected stream data type "+a)},p=function(a){switch(a){case c.POSITION:case c.INDEX:case c.NORMAL:case c.TANGENT:case c.BINORMAL:return 3;case c.UVS:return 2;case c.JOIN_WGT:case c.JOIN_IDX:return-1;default:return-1}};h.SubGeom=i,h.VertexBuffer=k,h.getTypeSize=l,h.getReadFunc=m,h.getWriteFunc=n,h.getArray=o,h.fixC4D_Type=j,b.exports=h}()},{BaseElement:15,consts:21,"types/awdString":23,"types/properties":25,"types/userAttr":26}],5:[function(a,b,c){!function(){var c=a("types/properties"),d=a("types/awdString"),e=a("consts"),f=a("types/userAttr"),g=a("BaseElement"),h=g.createStruct(e.MATERIAL,null,{init:function(){this.name="",this.model=e.MODEL_MATERIAL,this.extras=new f},read:function(a){this.name=d.read(a),this.mattype=a.U8(),this.numMethods=a.U8();var b=this.awd.header.propsNrType;this.props=new c({1:e.AWD_FIELD_UINT32,2:e.AWD_FIELD_BADDR,3:e.AWD_FIELD_BADDR,4:e.AWD_FIELD_UINT8,5:e.AWD_FIELD_BOOL,6:e.AWD_FIELD_BOOL,7:e.AWD_FIELD_BOOL,8:e.AWD_FIELD_BOOL,9:e.AWD_FIELD_UINT8,10:b,11:e.AWD_FIELD_BOOL,12:b,13:e.AWD_FIELD_BOOL,15:b,16:e.AWD_FIELD_UINT32,17:e.AWD_FIELD_BADDR,18:b,19:b,20:e.AWD_FIELD_UINT32,21:e.AWD_FIELD_BADDR,22:e.AWD_FIELD_BADDR}),this.props.read(a),this.extras.read(a)},write:void 0,toString:function(){}});b.exports=h}()},{BaseElement:15,consts:21,"types/awdString":23,"types/properties":25,"types/userAttr":26}],6:[function(a,b,c){!function(){var c=a("types/awdString"),d=a("std/Container"),e=a("consts"),f=a("BaseElement"),g=f.createStruct(e.MESH,null,{init:function(){this.model=e.MODEL_MESH,this.pData={},d.super(this),this.geometry=null,this.materials=[]},read:function(a){var b=a.U32();this.matrix.read(this.awd,a),this.name=c.read(a);for(var d=a.U32(),f=a.U16(),g=0;f>g;g++){var h=a.U32(),i=this.awd.getAssetByID(h,[e.MODEL_MATERIAL]);if(!i[0]&&h>0)throw new Error("Could not find Material Nr "+g+" (ID = "+h+" ) for this Mesh");h>0&&this.materials.push(i[1])}this.pivot.parsePivot(this.awd,a),this.extras.read(a);var j=this.awd.getAssetByID(d,[e.MODEL_GEOMETRY]);if(j[0]&&(this.geometry=j[1]),j=this.awd.getAssetByID(b,[e.MODEL_CONTAINER,e.MODEL_MESH,e.MODEL_LIGHT,e.MODEL_ENTITY,e.MODEL_SEGMENT_SET]),j[0])void 0!==j[1].addChild&&j[1].addChild(this),this.parent=j[1];else if(b>0)throw new Error("Could not find a parent for this Mesh "+b)},write:void 0,getDependencies:function(){for(var a=[],b=this.materials.length,c=0;b>c;c++){var d=this.materials[c];a.push(d)}return this.parent&&a.push(this.parent),this.geometry&&a.push(this.geometry),a},toString:function(){return"[Mesh "+this.pData.name+"]"}});d.extend(g.prototype),b.exports=g}()},{BaseElement:15,consts:21,"std/Container":3,"types/awdString":23}],7:[function(a,b,c){!function(){var c=a("consts"),d=a("types/properties"),e=a("BaseElement"),f="unknown",g=e.createStruct(c.METADATA,null,{init:function(){this.timeStamp=0,this.encoderName=f,this.encoderVersion=f,this.generatorName=f,this.generatorVersion=f},read:function(a){var b=new d({1:c.AWD_FIELD_UINT32,2:c.AWD_FIELD_STRING,3:c.AWD_FIELD_STRING,4:c.AWD_FIELD_STRING,5:c.AWD_FIELD_STRING});b.read(a),this.timeStamp=b.get(1,0),this.encoderName=b.get(2,f),this.encoderVersion=b.get(3,f),this.generatorName=b.get(4,f),this.generatorVersion=b.get(5,f)},write:void 0,toString:function(){return"Metadata : TimeStamp         = "+this.timeStamp+" EncoderName       = "+this.encoderName+" EncoderVersion    = "+this.encoderVersion+" GeneratorName     = "+this.generatorName+" GeneratorVersion  = "+this.generatorVersion}});b.exports=g}()},{BaseElement:15,consts:21,"types/properties":25}],8:[function(a,b,c){!function(){var c=a("types/properties"),d=a("types/awdString"),e=a("consts"),f=a("BaseElement"),g=f.createStruct(e.PRIMITIVE,null,{init:function(){this.name="",this.model=e.MODEL_GEOMETRY},read:function(a){this.name=d.read(a),this.type=a.U8();var b=this._createProps();b.read(a);var c;switch(this.type){case 1:c=this.makePlane(b);break;case 2:c=this.makeCube(b);break;case 3:c=this.makeSphere(b);break;case 4:c=this.makeCylinder(b);break;case 5:c=this.makeCone(b);break;case 6:c=this.makeCapsule(b);break;case 7:c=this.makeTorus(b);break;default:throw new Error("unknown primitive type "+this.type)}this.geom=c},write:void 0,_createProps:function(){var a=this.awd.header.geoNrType;return new c({101:a,102:a,103:a,110:a,111:a,301:e.UINT16,302:e.UINT16,303:e.UINT16,701:e.BOOL,702:e.BOOL,703:e.BOOL,704:e.BOOL})},toString:function(){},makePlane:function(a){var b={_tId:1,type:"plane",width:100,height:100,segmentsW:1,segmentsH:1,yUp:!0,doubleSided:!1};return a&&this.setupPlane(b,a),b},makeCube:function(a){var b={_tId:2,type:"cube",width:100,height:100,depth:100,segmentsW:1,segmentsH:1,segmentsD:1,tile6:!0};return a&&this.setupCube(b,a),b},makeSphere:function(a){var b={_tId:3,type:"sphere",radius:100,segmentsW:16,segmentsH:12,yUp:!0};return a&&this.setupSphere(b,a),b},makeCylinder:function(a){var b={_tId:4,type:"cylinder",topRadius:50,bottomRadius:50,height:100,segmentsW:16,segmentsH:1,topClosed:!0,bottomClosed:!0,surfaceClosed:!0,yUp:!0};return a&&this.setupCylinder(b,a),b},makeCone:function(a){var b={_tId:5,type:"cone",radius:50,height:100,segmentsW:16,segmentsH:1,closed:!0,yUp:!0};return a&&this.setupCone(b,a),b},makeCapsule:function(a){var b={_tId:6,type:"capsule",radius:50,height:100,segmentsW:16,segmentsH:15,yUp:!0};return a&&this.setupCapsule(b,a),b},makeTorus:function(a){var b={_tId:7,type:"torus",radius:50,tubeRadius:50,segmentsR:16,segmentsT:8,yUp:!0};return a&&this.setupTorus(b,a),b},setupPlane:function(a,b){a.width=b.get(101,100),a.height=b.get(102,100),a.segmentsW=b.get(301,1),a.segmentsH=b.get(302,1),a.yUp=b.get(701,!0),a.doubleSided=b.get(702,!1)},setupCube:function(a,b){a.width=b.get(101,100),a.height=b.get(102,100),a.depth=b.get(103,100),a.segmentsW=b.get(301,1),a.segmentsH=b.get(302,1),a.segmentsD=b.get(303,1),a.tile6=b.get(701,!0)},setupSphere:function(a,b){a.radius=b.get(101,100),a.segmentsW=b.get(301,16),a.segmentsH=b.get(302,12),a.yUp=b.get(701,!0)},setupCylinder:function(a,b){a.topRadius=b.get(101,50),a.bottomRadius=b.get(102,50),a.height=b.get(103,100),a.segmentsW=b.get(301,16),a.segmentsH=b.get(302,1),a.topClosed=b.get(701,!0),a.bottomClosed=b.get(702,!0),a.yUp=b.get(703,!0)},setupCone:function(a,b){a.radius=b.get(101,50),a.height=b.get(102,100),a.segmentsW=b.get(301,16),a.segmentsH=b.get(302,1),a.closed=b.get(701,!0),a.yUp=b.get(702,!0)},setupCapsule:function(a,b){a.radius=b.get(101,50),a.height=b.get(102,100),a.segmentsW=b.get(301,16),a.segmentsH=b.get(302,15),a.yUp=b.get(701,!0)},setupTorus:function(a,b){a.radius=b.get(101,50),a.tubeRadius=b.get(102,50),a.segmentsR=b.get(301,16),a.segmentsT=b.get(302,8),a.yUp=b.get(701,!0)},setupPropsPlane:function(a,b){b.set(101,a.width),b.set(102,a.height),b.set(301,a.segmentsW),b.set(302,a.segmentsH),b.set(701,a.yUp),b.set(702,a.doubleSided)},setupPropsCube:function(a,b){b.set(101,a.width),b.set(102,a.height),b.set(103,a.depth),b.set(301,a.segmentsW),b.set(302,a.segmentsH),b.set(303,a.segmentsD),b.set(701,a.tile6)},setupPropsSphere:function(a,b){b.set(101,a.radius),b.set(301,a.segmentsW),b.set(302,a.segmentsH),b.set(701,a.yUp)},setupPropsCylinder:function(a,b){b.set(101,a.topRadius),b.set(102,a.bottomRadius),b.set(103,a.height),b.set(301,a.segmentsW),b.set(302,a.segmentsH),b.set(701,a.topClosed),b.set(702,a.bottomClosed),b.set(703,a.yUp)},setupPropsCone:function(a,b){b.set(101,a.radius),b.set(102,a.height),b.set(301,a.segmentsW),b.set(302,a.segmentsH),b.set(701,a.closed),b.set(702,a.yUp)},setupPropsCapsule:function(a,b){b.set(101,a.radius),b.set(102,a.height),b.set(301,a.segmentsW),b.set(302,a.segmentsH),b.set(701,a.yUp)},setupPropsTorus:function(a,b){b.set(101,a.radius),b.set(102,a.tubeRadius),b.set(301,a.segmentsR),b.set(302,a.segmentsT),b.set(701,a.yUp)}});b.exports=g}()},{BaseElement:15,consts:21,"types/awdString":23,"types/properties":25}],9:[function(a,b,c){!function(){function c(){this.id=0,this.parentId=-1,this.name="",this.bindPose=new h,this.props=new d({}),this.extras=new g}var d=a("types/properties"),e=a("types/awdString"),f=a("consts"),g=a("types/userAttr"),h=a("../../src/types/matrix"),i=a("BaseElement"),j=i.createStruct(f.SKELETON,null,{init:function(){this.name="",this.model=f.MODEL_SKELETON,this.extras=new g,this.props=new d({}),this.joints=[],this.jointsByIds={}},read:function(a){this.name=e.read(a);var b=a.U16();this.props.read(a),this.joints=[];for(var d=0;b>d;d++){var f=new c;f.read(this.awd,a),this.jointsByIds[f.id]=f,this.joints.push(f)}this.extras.read(a)},write:void 0,toString:function(){return"[Skeleton"+this.name+"]"}});c.prototype={read:function(a,b){this.id=b.U16(),this.parentId=b.U16(),this.name=e.read(b),this.bindPose.read(a,b),this.props.read(b),this.extras.read(b)},write:void 0},b.exports=j}()},{"../../src/types/matrix":24,BaseElement:15,consts:21,"types/awdString":23,"types/properties":25,"types/userAttr":26}],10:[function(a,b,c){!function(){function c(){this.pose=null,this.duration=16}var d=a("types/properties"),e=a("types/awdString"),f=a("consts"),g=a("types/userAttr"),h=a("BaseElement"),i=h.createStruct(f.SKELETON_ANIMATION,null,{init:function(){this.name="",this.model=f.MODEL_ANIMATION_STATE,this.extras=new g,this.props=new d({}),this.frames=[]},read:function(a){this.name=e.read(a);var b=a.U16();this.props.read(a),this.frames=[];for(var d=0;b>d;d++){var f=new c;f.read(this.awd,a),this.frames.push(f)}this.extras.read(a)},write:void 0,getDependencies:function(){for(var a=[],b=this.frames.length,c=0;b>c;c++){var d=this.frames[c];a.push(d.pose)}return a},toString:function(){return"[SkeletonAnimation"+this.name+"]"}});c.prototype={read:function(a,b){var c=b.U32();this.duration=b.U16();var d=a.getAssetByID(c,[f.MODEL_SKELETON_POSE]);if(!d[0])throw new Error("SkeletonAnimation frame cannot find Pose reference");this.pose=d[1]},write:void 0},b.exports=i}()},{BaseElement:15,consts:21,"types/awdString":23,"types/properties":25,"types/userAttr":26}],11:[function(a,b,c){!function(){function c(){this.hasTransform=!1,this.transform=new h}var d=a("types/properties"),e=a("types/awdString"),f=a("consts"),g=a("types/userAttr"),h=a("../../src/types/matrix"),i=a("BaseElement"),j=i.createStruct(f.SKELETON_POSE,null,{init:function(){this.name="",this.model=f.MODEL_SKELETON_POSE,this.extras=new g,this.props=new d({}),this.transforms=[]},read:function(a){this.name=e.read(a);var b=a.U16();this.props.read(a),this.transforms=[];for(var d=0;b>d;d++){var f=new c;f.read(this.awd,a),this.transforms.push(f)}this.extras.read(a)},write:void 0,toString:function(){return"[SkeletonPose"+this.name+"]"}});c.prototype={read:function(a,b){this.hasTransform=0!==b.U8(),this.transform.read(a,b)},write:void 0},b.exports=j}()},{"../../src/types/matrix":24,BaseElement:15,consts:21,"types/awdString":23,"types/properties":25,"types/userAttr":26}],12:[function(a,b,c){!function(){var c=a("types/properties"),d=a("types/awdString"),e=a("consts"),f=a("types/userAttr"),g=a("BaseElement"),h=g.createStruct(e.TEXTURE,null,{init:function(){this.name="",this.textype=0,this.url=null,this.data=null,this.extras=new f,this.model=e.MODEL_TEXTURE},read:function(a){this.name=d.read(a),this.textype=a.U8();var b=a.U32();0===this.textype?this.url=a.readUTFBytes(b):(this.data=new ArrayBuffer(b),a.readBytes(this.data,b)),(new c).read(a),this.extras.read(a)},write:void 0,toString:function(){}});b.exports=h}()},{BaseElement:15,consts:21,"types/awdString":23,"types/properties":25,"types/userAttr":26}],13:[function(a,b,c){var d=a("../../src/extension"),e=a("../../src/DefaultElement"),f=a("./Metadata"),g=a("./Container"),h=a("./Mesh"),i=a("./Texture"),j=a("./Material"),k=a("./Skeleton"),l=a("./SkeletonPose"),m=a("./SkeletonAnimation"),n=a("./AnimationSet"),o=a("./Animator"),p=a("./Geometry"),q=[e,f,g,h,i,j,k,l,m,n,o,p],r={};r.getExtension=function(){var a=new d(null);return a.addStructs(q),a},b.exports=r},{"../../src/DefaultElement":16,"../../src/extension":22,"./AnimationSet":1,"./Animator":2,"./Container":3,"./Geometry":4,"./Material":5,"./Mesh":6,"./Metadata":7,"./Skeleton":9,"./SkeletonAnimation":10,"./SkeletonPose":11,"./Texture":12}],14:[function(a,b,c){String.prototype.codePointAt||!function(){"use strict";var a=function(){try{var a={},b=Object.defineProperty,c=b(a,a,a)&&b}catch(a){}return c}(),b=function(a){if(null==this)throw TypeError();var b=String(this),c=b.length,d=a?Number(a):0;if(d!=d&&(d=0),!(0>d||d>=c)){var e,f=b.charCodeAt(d);return f>=55296&&56319>=f&&c>d+1&&(e=b.charCodeAt(d+1),e>=56320&&57343>=e)?1024*(f-55296)+e-56320+65536:f}};a?a(String.prototype,"codePointAt",{value:b,configurable:!0,writable:!0}):String.prototype.codePointAt=b}()},{}],15:[function(a,b,c){!function(){var c=a("./consts"),d=a("./chunk"),e={_setup:function(a,b){this.awd=a,this.chunk=b,this.id=b.id},init:function(){this.injectDeps=!1,this.model=c.MODEL_GENERIC},getDependencies:function(){return this.deps?this.deps:null},prepareAndAdd:void 0,prepareChunk:function(){null===this.chunk&&(this.chunk=new d),this.chunk.type=this.type,this.chunk.ns=this.ns}},f={};f.createStruct=function(a,b,c){var d=function(){this.type=a,this.nsUri=b,this.ns=0,this.injectDeps=!0,this.init(),this.chunk=null,this.id=-1};d.TYPE=a;var f;for(f in e)d.prototype[f]=e[f];for(f in c)d.prototype[f]=c[f];return d},b.exports=f}()},{"./chunk":20,"./consts":21}],16:[function(a,b,c){var d=a("./consts"),e=a("./BaseElement"),f=e.createStruct(d.GENERIC,-1,{read:function(a){this.buf=new ArrayBuffer(this.chunk.size),a.readBytes(this.buf,this.chunk.size),this.setDeps()},write:function(a){a.writeBytes(this.buf,this.chunk.size)},setDeps:function(){for(var a,b=this.awd._elements,c=[],d=0,e=b.length;e>d;d++)a=b[d],c.push(a);this.deps=c},prepareAndAdd:void 0,prepareChunk:function(){}});b.exports=f},{"./BaseElement":15,"./consts":21}],17:[function(a,b,c){!function(){var c=a("./types/awdString"),d=a("./consts"),e=a("./BaseElement"),f=e.createStruct(d.NAMESPACE,null,{init:function(){this.uri="",this.nsId=0},read:function(a){this.nsId=a.U8(),this.uri=c.read(a)},write:void 0});b.exports=f}()},{"./BaseElement":15,"./consts":21,"./types/awdString":23}],18:[function(a,b,c){!function(){var a=function(a,b,c){this.buffer=a,this.ptr=0,this.littleEndien=!0,b=b||0,c=c||a.byteLength,this.view=new DataView(a,b,c),this.length=this.view.byteLength};a.prototype={setPosition:function(a){this.ptr=a},setLittleEndian:function(a){this.littleEndien=a},bytesAvailable:function(){return this.length-this.ptr},I8:function(){return this.view.getInt8(this.ptr++)},U8:function(){return this.view.getUint8(this.ptr++)},I16:function(){var a=this.view.getInt16(this.ptr,this.littleEndien);return this.ptr+=2,a},U16:function(){var a=this.view.getUint16(this.ptr,this.littleEndien);return this.ptr+=2,a},I32:function(){var a=this.view.getInt32(this.ptr,this.littleEndien);return this.ptr+=4,a},U32:function(){var a=this.view.getUint32(this.ptr,this.littleEndien);return this.ptr+=4,a},F32:function(){var a=this.view.getFloat32(this.ptr,this.littleEndien);return this.ptr+=4,a},F64:function(){var a=this.view.getFloat64(this.ptr,this.littleEndien);return this.ptr+=8,a},readBytes:function(a,b){void 0===b&&(b=a.byteLength);var c=new Int8Array(a),d=new Int8Array(this.buffer,this.ptr,b);c.set(d),this.ptr+=b},subArray:function(a){var b=new Int8Array(this.buffer,this.ptr,a);return this.ptr+=a,b},readUTFBytes:function(a){for(var b,c,d,e=this.ptr+a,f=[],g=0;this.ptr<e;)b=this.U8(),0!==b&&(128>b?f[g++]=String.fromCharCode(b):b>191&&224>b?(c=this.U8(),f[g++]=String.fromCharCode((31&b)<<6|63&c)):(c=this.U8(),d=this.U8(),f[g++]=String.fromCharCode((15&b)<<12|(63&c)<<6|63&d)));return f.join("")}},b.exports=a}()},{}],19:[function(a,b,c){b.exports={}},{"string.prototype.codepointat":14}],20:[function(a,b,c){!function(){var a=function(){this.id=0,this.ns=0,this.type=0,this.flags=0,this.size=0,this.data=null};a.prototype={read:function(a){this.id=a.U32(),this.ns=a.U8(),this.type=a.U8(),this.flags=a.U8(),this.size=a.U32()},write:void 0},b.exports=a}()},{}],21:[function(a,b,c){!function(){var a={UNCOMPRESSED:0,DEFLATE:1,LZMA:2,AWD_FIELD_INT8:1,AWD_FIELD_INT16:2,AWD_FIELD_INT32:3,AWD_FIELD_UINT8:4,AWD_FIELD_UINT16:5,AWD_FIELD_UINT32:6,AWD_FIELD_FLOAT32:7,AWD_FIELD_FLOAT64:8,AWD_FIELD_BOOL:21,AWD_FIELD_COLOR:22,AWD_FIELD_BADDR:23,AWD_FIELD_STRING:31,AWD_FIELD_BYTEARRAY:32,AWD_FIELD_VECTOR2x1:41,AWD_FIELD_VECTOR3x1:42,AWD_FIELD_VECTOR4x1:43,AWD_FIELD_MTX3x2:44,AWD_FIELD_MTX3x3:45,AWD_FIELD_MTX4x3:46,AWD_FIELD_MTX4x4:47,INT8:1,INT16:2,INT32:3,UINT8:4,UINT16:5,UINT32:6,FLOAT32:7,FLOAT64:8,AWDSTRING:31,AWDBYTEARRAY:32,MAGIC:4282180,GENERIC:0,GEOMETRY:1,PRIMITIVE:11,CONTAINER:22,MESH:23,MATERIAL:81,TEXTURE:82,SKELETON:101,SKELETON_POSE:102,SKELETON_ANIMATION:103,ANIMATION_SET:113,ANIMATOR:122,NAMESPACE:254,METADATA:255,MODEL_ENTITY:2,MODEL_SKYBOX:4,MODEL_CAMERA:8,MODEL_SEGMENT_SET:16,MODEL_MESH:32,MODEL_GEOMETRY:64,MODEL_SKELETON:128,MODEL_SKELETON_POSE:256,MODEL_CONTAINER:512,MODEL_TEXTURE:1024,MODEL_TEXTURE_PROJECTOR:2048,MODEL_MATERIAL:4096,MODEL_ANIMATION_SET:8192,MODEL_ANIMATION_STATE:16384,MODEL_ANIMATION_NODE:32768,MODEL_ANIMATOR:65536,MODEL_STATE_TRANSITION:1<<17,MODEL_LIGHT:1<<18,MODEL_LIGHT_PICKER:1<<19,MODEL_SHADOW_MAP_METHOD:1<<20,MODEL_EFFECTS_METHOD:1<<21,MODEL_GENERIC:-1,POSITION:1,INDEX:2,UVS:3,NORMAL:4,TANGENT:5,JOIN_IDX:6,JOIN_WGT:7,SUVS:8,COLOR:11,BINORMAL:12,DEFAULT_NS:0};b.exports=a}()},{}],22:[function(a,b,c){var d=a("./DefaultElement"),e=a("./Namespace"),f=function(a){this.nsUri=a,this.structs=[],this.nsId=0};f.prototype={addStruct:function(a){this.structs.push(a)},addStructs:function(a){for(var b=0,c=a.length;c>b;b++)this.addStruct(a[b])},create:function(a){for(var b,c=this.structs,e=0,f=c.length;f>e;e++)if(b=c[e],b.TYPE===a)return new b;return new d},createNamespace:function(){var a=new e;return a.uri=this.nsUri,a}},b.exports=f},{"./DefaultElement":16,"./Namespace":17}],23:[function(a,b,c){b.exports={read:function(a){var b=a.U16();return a.readUTFBytes(b)},write:function(a,b){b.U16(a.length),b.writeUTFBytes(a)},getUTFBytesLength:function(a){for(var b=0,c=0,d=a.length;d>c;c++){var e,f=a[c].codePointAt(0);128>f?e=1:2048>f?e=2:65536>f?e=3:2097152>f&&(e=4),b+=e}return b}}},{}],24:[function(a,b,c){!function(){var a=function(){this.data=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};a.prototype={read:function(a,b){this.parseMatrix43RawData(a,b,this.data)},write:void 0,parseMatrix43RawData:function(a,b,c){var d=c,e=a.header.accuracyMatrix?b.F64:b.F32;return d[0]=e.call(b),d[1]=e.call(b),d[2]=e.call(b),d[3]=0,d[4]=e.call(b),d[5]=e.call(b),d[6]=e.call(b),d[7]=0,d[8]=e.call(b),d[9]=e.call(b),d[10]=e.call(b),d[11]=0,d[12]=e.call(b),d[13]=e.call(b),d[14]=e.call(b),d[15]=1,isNaN(d[0])&&(d[0]=1,d[1]=0,d[2]=0,d[4]=0,d[5]=1,d[6]=0,d[8]=0,d[9]=0,d[10]=1,d[12]=0,d[13]=0,d[14]=0),d},writeMatrix43RawData:void 0},b.exports=a}()},{}],25:[function(a,b,c){!function(){var c=a("../consts"),d=(a("./awdString"),a("../bufferWriter")),e=a("../bufferReader"),f=function(a){this.expected=a,this.vars={}};f.prototype={clone:function(){var a=new d(64);this.write(a);var b=new f(this.expected);return b.read(new e(a.buffer)),b},read:function(a){var b=this.expected,c=a.U32(),d=a.ptr+c;if(b)for(;a.ptr<d;){var e,f=a.U16(),g=a.U32();this.expected.hasOwnProperty(f)?(e=b[f],this.set(f,this.parseAttrValue(e,g,a))):a.ptr+=g}a.ptr!==d&&(console.log("Warn Properties don't read entire data ",a.ptr,d,c),a.ptr=d)},write:void 0,set:function(a,b){this.vars[a]=b},get:function(a,b){return this.vars.hasOwnProperty(a)?this.vars[a]:b},writeAttrValue:void 0,parseAttrValue:function(a,b,d){var e,f;switch(a){case c.AWD_FIELD_INT8:e=1,f=d.I8;break;case c.AWD_FIELD_INT16:e=2,f=d.I16;break;case c.AWD_FIELD_INT32:e=4,f=d.I32;break;case c.AWD_FIELD_BOOL:case c.AWD_FIELD_UINT8:e=1,f=d.U8;break;case c.AWD_FIELD_UINT16:e=2,f=d.U16;break;case c.AWD_FIELD_UINT32:case c.AWD_FIELD_BADDR:e=4,f=d.U32;break;case c.AWD_FIELD_FLOAT32:e=4,f=d.F32;break;case c.AWD_FIELD_FLOAT64:e=8,f=d.F64;break;case c.AWD_FIELD_STRING:var g=d.U16();g===b&&console.log("WARN may be Prefab bug / String property bug!!"),d.ptr-=2;var h=d.readUTFBytes(b);return h;case c.AWD_FIELD_VECTOR2x1:case c.AWD_FIELD_VECTOR3x1:case c.AWD_FIELD_VECTOR4x1:case c.AWD_FIELD_MTX3x2:case c.AWD_FIELD_MTX3x3:case c.AWD_FIELD_MTX4x3:case c.AWD_FIELD_MTX4x4:e=8,f=d.F64}if(b>e){var i,j,k;for(i=[],j=0,k=b/e;k>j;)i.push(f.call(d)),j++;return i}return f.call(d)}},b.exports=f}()},{"../bufferReader":18,"../bufferWriter":19,"../consts":21,"./awdString":23}],26:[function(a,b,c){!function(){var c=a("../consts"),d=a("./awdString"),e=a("../bufferWriter"),f=a("../bufferReader"),g=function(){this.attributes={},this._list=[]};g.prototype={clone:function(){var a=new e(64);this.write(a);var b=new g;return b.read(new f(a.buffer)),b},addAttribute:function(a,b,c,d){var e={name:a,value:b,type:c,ns:d};this.attributes[a]=e,this._list.push(e)},read:function(a){var b,e=a.U32();if(e>0){b={};for(var f=a.ptr+e;a.ptr<f;){var g,h=a.U8(),i=d.read(a),j=a.U8(),k=a.U32();switch(j){case c.AWDSTRING:g=a.readUTFBytes(k);break;case c.INT8:g=a.I8();break;case c.INT16:g=a.I16();break;case c.INT32:g=a.I32();break;case c.BOOL:case c.UINT8:g=a.U8();break;case c.UINT16:g=a.U16();break;case c.UINT32:case c.BADDR:g=a.U32();break;case c.FLOAT32:g=a.F32();break;case c.FLOAT64:g=a.F64();break;default:g="unimplemented attribute type "+j+"ns : "+h,a.ptr+=k}this.addAttribute(i,g,j,h),b[i]=g}}return b},write:void 0},b.exports=g}()},{"../bufferReader":18,"../bufferWriter":19,"../consts":21,"./awdString":23}],27:[function(a,b,c){!function(){var c=a("../consts"),d=a("./properties"),e=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0};e.prototype={parsePivot:function(a,b){var e=a.header.matrixNrType,f=new d({1:e,2:e,3:e,4:c.UINT8});f.read(b),this.x=f.get(1,0),this.y=f.get(2,0),this.z=f.get(3,0)},writePivot:void 0},b.exports=e}()},{"../consts":21,"./properties":25}],awdlib_std:[function(a,b,c){b.exports={Container:a("./Container"),Geometry:a("./Geometry"),Material:a("./Material"),Mesh:a("./Mesh"),Metadata:a("./Metadata"),Primitive:a("./Primitive"),Texture:a("./Texture"),ext:a("./ext")}},{"./Container":3,"./Geometry":4,"./Material":5,"./Mesh":6,"./Metadata":7,"./Primitive":8,"./Texture":12,"./ext":13}]},{},[])("awdlib_std")})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],172:[function(a,b,c){"use strict";var d,e=a("es5-ext/object/assign"),f=a("es5-ext/object/normalize-options"),g=a("es5-ext/object/is-callable"),h=a("es5-ext/string/#/contains");d=b.exports=function(a,b){var c,d,g,i,j;return arguments.length<2||"string"!=typeof a?(i=b,b=a,a=null):i=arguments[2],null==a?(c=g=!0,d=!1):(c=h.call(a,"c"),d=h.call(a,"e"),g=h.call(a,"w")),j={value:b,configurable:c,enumerable:d,writable:g},i?e(f(i),j):j},d.gs=function(a,b,c){var d,i,j,k;return"string"!=typeof a?(j=c,c=b,b=a,a=null):j=arguments[3],null==b?b=void 0:g(b)?null==c?c=void 0:g(c)||(j=c,c=void 0):(j=b,b=c=void 0),null==a?(d=!0,i=!1):(d=h.call(a,"c"),i=h.call(a,"e")),k={get:b,set:c,configurable:d,enumerable:i},j?e(f(j),k):k}},{"es5-ext/object/assign":173,"es5-ext/object/is-callable":176,"es5-ext/object/normalize-options":180,"es5-ext/string/#/contains":183}],173:[function(a,b,c){"use strict";b.exports=a("./is-implemented")()?Object.assign:a("./shim")},{"./is-implemented":174,"./shim":175}],174:[function(a,b,c){"use strict";b.exports=function(){var a,b=Object.assign;return"function"==typeof b&&(a={foo:"raz"},b(a,{bar:"dwa"},{trzy:"trzy"}),a.foo+a.bar+a.trzy==="razdwatrzy")}},{}],175:[function(a,b,c){"use strict";var d=a("../keys"),e=a("../valid-value"),f=Math.max;b.exports=function(a,b){var c,g,h,i=f(arguments.length,2);for(a=Object(e(a)),h=function(d){try{a[d]=b[d]}catch(a){c||(c=a)}},g=1;g<i;++g)b=arguments[g],d(b).forEach(h);if(void 0!==c)throw c;return a}},{"../keys":177,"../valid-value":182}],176:[function(a,b,c){"use strict";b.exports=function(a){return"function"==typeof a}},{}],177:[function(a,b,c){"use strict";b.exports=a("./is-implemented")()?Object.keys:a("./shim")},{"./is-implemented":178,"./shim":179}],178:[function(a,b,c){"use strict";b.exports=function(){try{return Object.keys("primitive"),!0}catch(a){return!1}}},{}],179:[function(a,b,c){"use strict";var d=Object.keys;b.exports=function(a){return d(null==a?a:Object(a))}},{}],180:[function(a,b,c){"use strict";var d=Array.prototype.forEach,e=Object.create,f=function(a,b){var c;for(c in a)b[c]=a[c]};b.exports=function(a){var b=e(null);return d.call(arguments,function(a){null!=a&&f(Object(a),b)}),b}},{}],181:[function(a,b,c){"use strict";b.exports=function(a){if("function"!=typeof a)throw new TypeError(a+" is not a function");return a}},{}],182:[function(a,b,c){"use strict";b.exports=function(a){if(null==a)throw new TypeError("Cannot use null or undefined");return a}},{}],183:[function(a,b,c){"use strict";b.exports=a("./is-implemented")()?String.prototype.contains:a("./shim")},{"./is-implemented":184,"./shim":185}],184:[function(a,b,c){"use strict";var d="razdwatrzy";b.exports=function(){return"function"==typeof d.contains&&(d.contains("dwa")===!0&&d.contains("foo")===!1);
}},{}],185:[function(a,b,c){"use strict";var d=String.prototype.indexOf;b.exports=function(a){return d.call(this,a,arguments[1])>-1}},{}],186:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k=a("d"),l=a("es5-ext/object/valid-callable"),m=Function.prototype.apply,n=Function.prototype.call,o=Object.create,p=Object.defineProperty,q=Object.defineProperties,r=Object.prototype.hasOwnProperty,s={configurable:!0,enumerable:!1,writable:!0};d=function(a,b){var c;return l(b),r.call(this,"__ee__")?c=this.__ee__:(c=s.value=o(null),p(this,"__ee__",s),s.value=null),c[a]?"object"==typeof c[a]?c[a].push(b):c[a]=[c[a],b]:c[a]=b,this},e=function(a,b){var c,e;return l(b),e=this,d.call(this,a,c=function(){f.call(e,a,c),m.call(b,this,arguments)}),c.__eeOnceListener__=b,this},f=function(a,b){var c,d,e,f;if(l(b),!r.call(this,"__ee__"))return this;if(c=this.__ee__,!c[a])return this;if(d=c[a],"object"==typeof d)for(f=0;e=d[f];++f)e!==b&&e.__eeOnceListener__!==b||(2===d.length?c[a]=d[f?0:1]:d.splice(f,1));else d!==b&&d.__eeOnceListener__!==b||delete c[a];return this},g=function(a){var b,c,d,e,f;if(r.call(this,"__ee__")&&(e=this.__ee__[a]))if("object"==typeof e){for(c=arguments.length,f=new Array(c-1),b=1;b<c;++b)f[b-1]=arguments[b];for(e=e.slice(),b=0;d=e[b];++b)m.call(d,this,f)}else switch(arguments.length){case 1:n.call(e,this);break;case 2:n.call(e,this,arguments[1]);break;case 3:n.call(e,this,arguments[1],arguments[2]);break;default:for(c=arguments.length,f=new Array(c-1),b=1;b<c;++b)f[b-1]=arguments[b];m.call(e,this,f)}},h={on:d,once:e,off:f,emit:g},i={on:k(d),once:k(e),off:k(f),emit:k(g)},j=q({},i),b.exports=c=function(a){return null==a?o(j):q(Object(a),i)},c.methods=h},{d:172,"es5-ext/object/valid-callable":181}],187:[function(a,b,c){function d(a){function b(){for(var a=0;a<m.length;a++)m[a].resonance.value=p,m[a].dampening.value=q}var c=a.createGain();c.channelCountMode="explicit",c.channelCount=2;var d=a.createGain(),h=a.createChannelMerger(2),i=a.createChannelSplitter(2),j=a.createBiquadFilter();j.type="highpass",j.frequency.value=200;var k=a.createGain(),l=a.createGain();c.connect(l),c.connect(k),k.connect(i),h.connect(j),j.connect(d),l.connect(d);for(var m=[],n=[],o=[],p=.8,q=3e3,r=0;r<f.length;r++){var s=a.createBiquadFilter();s.type="allpass",s.frequency.value=f[r],n.push(s),n[r-1]&&n[r-1].connect(s)}for(var t=0;t<f.length;t++){var u=a.createBiquadFilter();u.type="allpass",u.frequency.value=f[t],o.push(u),o[t-1]&&o[t-1].connect(u)}n[n.length-1].connect(h,0,0),o[o.length-1].connect(h,0,1);for(var v=0;v<e.length;v++){var w=g(a);w.delayTime.value=e[v],v<e.length/2?(i.connect(w,0),w.connect(n[0])):(i.connect(w,1),w.connect(o[0])),m.push(w)}return Object.defineProperties(c,{roomSize:{get:function(){return p},set:function(a){p=a,b()}},dampening:{get:function(){return q},set:function(a){q=a,b()}}}),b(),c.connect=d.connect.bind(d),c.wet=k.gain,c.dry=l.gain,c.combFilters=m,c}var e=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],f=[225,556,441,341],g=a("./lib/lowpass-comb-filter");b.exports=d},{"./lib/lowpass-comb-filter":188}],188:[function(a,b,c){function d(a){var b=a.createDelay(1),c=this.output=a.createBiquadFilter();c.Q.value=-3.0102999566398125,c.type="lowpass",b.dampening=c.frequency;var d=a.createGain();return b.resonance=d.gain,b.connect(c),c.connect(d),d.connect(b),b.dampening.value=3e3,b.delayTime.value=.1,b.resonance.value=.5,b}b.exports=d},{}],189:[function(a,b,c){function d(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}b.exports=d},{}],190:[function(a,b,c){function d(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a}b.exports=d},{}],191:[function(a,b,c){function d(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a}b.exports=d},{}],192:[function(a,b,c){c.glMatrix=a("./gl-matrix/common.js"),c.mat2=a("./gl-matrix/mat2.js"),c.mat2d=a("./gl-matrix/mat2d.js"),c.mat3=a("./gl-matrix/mat3.js"),c.mat4=a("./gl-matrix/mat4.js"),c.quat=a("./gl-matrix/quat.js"),c.vec2=a("./gl-matrix/vec2.js"),c.vec3=a("./gl-matrix/vec3.js"),c.vec4=a("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":193,"./gl-matrix/mat2.js":194,"./gl-matrix/mat2d.js":195,"./gl-matrix/mat3.js":196,"./gl-matrix/mat4.js":197,"./gl-matrix/quat.js":198,"./gl-matrix/vec2.js":199,"./gl-matrix/vec3.js":200,"./gl-matrix/vec4.js":201}],193:[function(a,b,c){var d={};d.EPSILON=1e-6,d.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,d.RANDOM=Math.random,d.setMatrixArrayType=function(a){GLMAT_ARRAY_TYPE=a};var e=Math.PI/180;d.toRadian=function(a){return a*e},b.exports=d},{}],194:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},e.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},e.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+f*i,a[1]=e*h+g*i,a[2]=d*j+f*k,a[3]=e*j+g*k,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+f*h,a[1]=e*i+g*h,a[2]=d*-h+f*i,a[3]=e*-h+g*i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*h,a[2]=f*i,a[3]=g*i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a},e.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},e.LDU=function(a,b,c,d){return a[2]=d[2]/d[0],c[0]=d[0],c[1]=d[1],c[3]=d[3]-a[2]*c[1],[a,b,c]},b.exports=e},{"./common.js":193}],195:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},e.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+f*k,a[1]=e*j+g*k,a[2]=d*l+f*m,a[3]=e*l+g*m,a[4]=d*n+f*o+h,a[5]=e*n+g*o+i,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+f*j,a[1]=e*k+g*j,a[2]=d*-j+f*k,a[3]=e*-j+g*k,a[4]=h,a[5]=i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d*j,a[1]=e*j,a[2]=f*k,a[3]=g*k,a[4]=h,a[5]=i,a},e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=d*j+f*k+h,a[5]=e*j+g*k+i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a[4]=0,a[5]=0,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a[4]=0,a[5]=0,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=b[0],a[5]=b[1],a},e.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},b.exports=e},{"./common.js":193}],196:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},e.clone=function(a){var b=new d.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},e.mul=e.multiply,e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},e.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},e.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},b.exports=e},{"./common.js":193}],197:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},e.mul=e.multiply,e.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},e.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.rotate=function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<d.EPSILON?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(c),g=Math.cos(c),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},e.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},e.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},e.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotation=function(a,b,c){var e,f,g,h=c[0],i=c[1],j=c[2],k=Math.sqrt(h*h+i*i+j*j);return Math.abs(k)<d.EPSILON?null:(k=1/k,h*=k,i*=k,j*=k,e=Math.sin(b),f=Math.cos(b),g=1-f,a[0]=h*h*g+f,a[1]=i*h*g+j*e,a[2]=j*h*g-i*e,a[3]=0,a[4]=h*i*g-j*e,a[5]=i*i*g+f,a[6]=j*i*g+h*e,a[7]=0,a[8]=h*j*g+i*e,a[9]=i*j*g-h*e,a[10]=j*j*g+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},e.fromXRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromYRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromZRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(m+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(m+p))*x,a[11]=0,a[12]=c[0]+y-(a[0]*y+a[4]*z+a[8]*A),a[13]=c[1]+z-(a[1]*y+a[5]*z+a[9]*A),a[14]=c[2]+A-(a[2]*y+a[6]*z+a[10]*A),a[15]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},e.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},e.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},e.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},e.lookAt=function(a,b,c,f){var g,h,i,j,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=f[0],u=f[1],v=f[2],w=c[0],x=c[1],y=c[2];return Math.abs(q-w)<d.EPSILON&&Math.abs(r-x)<d.EPSILON&&Math.abs(s-y)<d.EPSILON?e.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,g=u*o-v*n,h=v*m-t*o,i=t*n-u*m,p=Math.sqrt(g*g+h*h+i*i),p?(p=1/p,g*=p,h*=p,i*=p):(g=0,h=0,i=0),j=n*i-o*h,k=o*g-m*i,l=m*h-n*g,p=Math.sqrt(j*j+k*k+l*l),p?(p=1/p,j*=p,k*=p,l*=p):(j=0,k=0,l=0),a[0]=g,a[1]=j,a[2]=m,a[3]=0,a[4]=h,a[5]=k,a[6]=n,a[7]=0,a[8]=i,a[9]=l,a[10]=o,a[11]=0,a[12]=-(g*q+h*r+i*s),a[13]=-(j*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},b.exports=e},{"./common.js":193}],198:[function(a,b,c){var d=a("./common.js"),e=a("./mat3.js"),f=a("./vec3.js"),g=a("./vec4.js"),h={};h.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.rotationTo=function(){var a=f.create(),b=f.fromValues(1,0,0),c=f.fromValues(0,1,0);return function(d,e,g){var i=f.dot(e,g);return i<-.999999?(f.cross(a,b,e),f.length(a)<1e-6&&f.cross(a,c,e),f.normalize(a,a),h.setAxisAngle(d,a,Math.PI),d):i>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(f.cross(a,e,g),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+i,h.normalize(d,d))}}(),h.setAxes=function(){var a=e.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],h.normalize(b,h.fromMat3(b,a))}}(),h.clone=g.clone,h.fromValues=g.fromValues,h.copy=g.copy,h.set=g.set,h.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.setAxisAngle=function(a,b,c){c*=.5;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},h.add=g.add,h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},h.mul=h.multiply,h.scale=g.scale,h.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},h.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},h.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},h.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},h.dot=g.dot,h.lerp=g.lerp,h.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,f<0&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},h.sqlerp=function(){var a=h.create(),b=h.create();return function(c,d,e,f,g,i){return h.slerp(a,d,g,i),h.slerp(b,e,f,i),h.slerp(c,a,b,2*i*(1-i)),c}}(),h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},h.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},h.length=g.length,h.len=h.length,h.squaredLength=g.squaredLength,h.sqrLen=h.squaredLength,h.normalize=g.normalize,h.fromMat3=function(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a},h.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},b.exports=h},{"./common.js":193,"./mat3.js":196,"./vec3.js":200,"./vec4.js":201}],199:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},e.fromValues=function(a,b){var c=new d.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},e.set=function(a,b,c){return a[0]=b,a[1]=c,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},e.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},e.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},e.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;h<i;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),e.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},b.exports=e},{"./common.js":193}],200:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},e.fromValues=function(a,b,c){var e=new d.ARRAY_TYPE(3);return e[0]=a,e[1]=b,e[2]=c,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},e.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},e.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},e.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a},e.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,m=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*m,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*m,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*m,a},e.random=function(a,b){b=b||1;
var c=2*d.RANDOM()*Math.PI,e=2*d.RANDOM()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.rotateX=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateY=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateZ=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;h<i;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),e.angle=function(a,b){var c=e.fromValues(a[0],a[1],a[2]),d=e.fromValues(b[0],b[1],b[2]);e.normalize(c,c),e.normalize(d,d);var f=e.dot(c,d);return f>1?0:Math.acos(f)},e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},b.exports=e},{"./common.js":193}],201:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,e){var f=new d.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=e,f},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.random=function(a,b){return b=b||1,a[0]=d.RANDOM(),a[1]=d.RANDOM(),a[2]=d.RANDOM(),a[3]=d.RANDOM(),e.normalize(a,a),e.scale(a,a,b),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a[3]=b[3],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;h<i;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},b.exports=e},{"./common.js":193}],202:[function(a,b,c){function d(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a}b.exports=d},{}],203:[function(a,b,c){function d(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a}b.exports=d},{}],204:[function(a,b,c){function d(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a}b.exports=d},{}],205:[function(a,b,c){b.exports=function(a){"string"==typeof a&&(a=[a]);for(var b=[].slice.call(arguments,1),c=[],d=0;d<a.length-1;d++)c.push(a[d],b[d]||"");return c.push(a[d]),c.join("")}},{}],206:[function(a,b,c){(function(a){var c="undefined"!=typeof b&&b.exports&&"undefined"!=typeof a?a:this||window;(c._gsQueue||(c._gsQueue=[])).push(function(){"use strict";c._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(a,b,c){var d=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},e=function(a,b,c){var d,e,f=a.cycle;for(d in f)e=f[d],a[d]="function"==typeof e?e(c,b[c]):e[c%e.length];delete a.cycle},f=function(a,b,d){c.call(this,a,b,d),this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._dirty=!0,this.render=f.prototype.render},g=1e-10,h=c._internals,i=h.isSelector,j=h.isArray,k=f.prototype=c.to({},.1,{}),l=[];f.version="1.19.1",k.constructor=f,k.kill()._gc=!1,f.killTweensOf=f.killDelayedCallsTo=c.killTweensOf,f.getTweensOf=c.getTweensOf,f.lagSmoothing=c.lagSmoothing,f.ticker=c.ticker,f.render=c.render,k.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),c.prototype.invalidate.call(this)},k.updateTo=function(a,b){var d,e=this.ratio,f=this.vars.immediateRender||a.immediateRender;b&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(d in a)this.vars[d]=a[d];if(this._initted||f)if(b)this._initted=!1,f&&this.render(0,!0,!0);else if(this._gc&&this._enabled(!0,!1),this._notifyPluginsOfEnabled&&this._firstPT&&c._onPluginEvent("_onDisable",this),this._time/this._duration>.998){var g=this._totalTime;this.render(0,!0,!1),this._initted=!1,this.render(g,!0,!1)}else if(this._initted=!1,this._init(),this._time>0||f)for(var h,i=1/(1-e),j=this._firstPT;j;)h=j.s+j.c,j.c*=i,j.s=h-j.c,j=j._next;return this},k.render=function(a,b,c){this._initted||0===this._duration&&this.vars.repeat&&this.invalidate();var d,e,f,i,j,k,l,m,n=this._dirty?this.totalDuration():this._totalDuration,o=this._time,p=this._totalTime,q=this._cycle,r=this._duration,s=this._rawPrevTime;if(a>=n-1e-7&&a>=0?(this._totalTime=n,this._cycle=this._repeat,this._yoyo&&0!==(1&this._cycle)?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=r,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(d=!0,e="onComplete",c=c||this._timeline.autoRemoveChildren),0===r&&(this._initted||!this.vars.lazy||c)&&(this._startTime===this._timeline._duration&&(a=0),(s<0||a<=0&&a>=-1e-7||s===g&&"isPause"!==this.data)&&s!==a&&(c=!0,s>g&&(e="onReverseComplete")),this._rawPrevTime=m=!b||a||s===a?a:g)):a<1e-7?(this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==p||0===r&&s>0)&&(e="onReverseComplete",d=this._reversed),a<0&&(this._active=!1,0===r&&(this._initted||!this.vars.lazy||c)&&(s>=0&&(c=!0),this._rawPrevTime=m=!b||a||s===a?a:g)),this._initted||(c=!0)):(this._totalTime=this._time=a,0!==this._repeat&&(i=r+this._repeatDelay,this._cycle=this._totalTime/i>>0,0!==this._cycle&&this._cycle===this._totalTime/i&&p<=a&&this._cycle--,this._time=this._totalTime-this._cycle*i,this._yoyo&&0!==(1&this._cycle)&&(this._time=r-this._time),this._time>r?this._time=r:this._time<0&&(this._time=0)),this._easeType?(j=this._time/r,k=this._easeType,l=this._easePower,(1===k||3===k&&j>=.5)&&(j=1-j),3===k&&(j*=2),1===l?j*=j:2===l?j*=j*j:3===l?j*=j*j*j:4===l&&(j*=j*j*j*j),1===k?this.ratio=1-j:2===k?this.ratio=j:this._time/r<.5?this.ratio=j/2:this.ratio=1-j/2):this.ratio=this._ease.getRatio(this._time/r)),o===this._time&&!c&&q===this._cycle)return void(p!==this._totalTime&&this._onUpdate&&(b||this._callback("onUpdate")));if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!c&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=o,this._totalTime=p,this._rawPrevTime=s,this._cycle=q,h.lazyTweens.push(this),void(this._lazy=[a,b]);this._time&&!d?this.ratio=this._ease.getRatio(this._time/r):d&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==o&&a>=0&&(this._active=!0),0===p&&(2===this._initted&&a>0&&this._init(),this._startAt&&(a>=0?this._startAt.render(a,b,c):e||(e="_dummyGS")),this.vars.onStart&&(0===this._totalTime&&0!==r||b||this._callback("onStart"))),f=this._firstPT;f;)f.f?f.t[f.p](f.c*this.ratio+f.s):f.t[f.p]=f.c*this.ratio+f.s,f=f._next;this._onUpdate&&(a<0&&this._startAt&&this._startTime&&this._startAt.render(a,b,c),b||(this._totalTime!==p||e)&&this._callback("onUpdate")),this._cycle!==q&&(b||this._gc||this.vars.onRepeat&&this._callback("onRepeat")),e&&(this._gc&&!c||(a<0&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(a,b,c),d&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[e]&&this._callback(e),0===r&&this._rawPrevTime===g&&m!==g&&(this._rawPrevTime=0)))},f.to=function(a,b,c){return new f(a,b,c)},f.from=function(a,b,c){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,new f(a,b,c)},f.fromTo=function(a,b,c,d){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,new f(a,b,d)},f.staggerTo=f.allTo=function(a,b,g,h,k,m,n){h=h||0;var o,p,q,r,s=0,t=[],u=function(){g.onComplete&&g.onComplete.apply(g.onCompleteScope||this,arguments),k.apply(n||g.callbackScope||this,m||l)},v=g.cycle,w=g.startAt&&g.startAt.cycle;for(j(a)||("string"==typeof a&&(a=c.selector(a)||a),i(a)&&(a=d(a))),a=a||[],h<0&&(a=d(a),a.reverse(),h*=-1),o=a.length-1,q=0;q<=o;q++){p={};for(r in g)p[r]=g[r];if(v&&(e(p,a,q),null!=p.duration&&(b=p.duration,delete p.duration)),w){w=p.startAt={};for(r in g.startAt)w[r]=g.startAt[r];e(p.startAt,a,q)}p.delay=s+(p.delay||0),q===o&&k&&(p.onComplete=u),t[q]=new f(a[q],b,p),s+=h}return t},f.staggerFrom=f.allFrom=function(a,b,c,d,e,g,h){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,f.staggerTo(a,b,c,d,e,g,h)},f.staggerFromTo=f.allFromTo=function(a,b,c,d,e,g,h,i){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,f.staggerTo(a,b,d,e,g,h,i)},f.delayedCall=function(a,b,c,d,e){return new f(b,0,{delay:a,onComplete:b,onCompleteParams:c,callbackScope:d,onReverseComplete:b,onReverseCompleteParams:c,immediateRender:!1,useFrames:e,overwrite:0})},f.set=function(a,b){return new f(a,0,b)},f.isTweening=function(a){return c.getTweensOf(a,!0).length>0};var m=function(a,b){for(var d=[],e=0,f=a._first;f;)f instanceof c?d[e++]=f:(b&&(d[e++]=f),d=d.concat(m(f,b)),e=d.length),f=f._next;return d},n=f.getAllTweens=function(b){return m(a._rootTimeline,b).concat(m(a._rootFramesTimeline,b))};f.killAll=function(a,c,d,e){null==c&&(c=!0),null==d&&(d=!0);var f,g,h,i=n(0!=e),j=i.length,k=c&&d&&e;for(h=0;h<j;h++)g=i[h],(k||g instanceof b||(f=g.target===g.vars.onComplete)&&d||c&&!f)&&(a?g.totalTime(g._reversed?0:g.totalDuration()):g._enabled(!1,!1))},f.killChildTweensOf=function(a,b){if(null!=a){var e,g,k,l,m,n=h.tweenLookup;if("string"==typeof a&&(a=c.selector(a)||a),i(a)&&(a=d(a)),j(a))for(l=a.length;--l>-1;)f.killChildTweensOf(a[l],b);else{e=[];for(k in n)for(g=n[k].target.parentNode;g;)g===a&&(e=e.concat(n[k].tweens)),g=g.parentNode;for(m=e.length,l=0;l<m;l++)b&&e[l].totalTime(e[l].totalDuration()),e[l]._enabled(!1,!1)}}};var o=function(a,c,d,e){c=c!==!1,d=d!==!1,e=e!==!1;for(var f,g,h=n(e),i=c&&d&&e,j=h.length;--j>-1;)g=h[j],(i||g instanceof b||(f=g.target===g.vars.onComplete)&&d||c&&!f)&&g.paused(a)};return f.pauseAll=function(a,b,c){o(!0,a,b,c)},f.resumeAll=function(a,b,c){o(!1,a,b,c)},f.globalTimeScale=function(b){var d=a._rootTimeline,e=c.ticker.time;return arguments.length?(b=b||g,d._startTime=e-(e-d._startTime)*d._timeScale/b,d=a._rootFramesTimeline,e=c.ticker.frame,d._startTime=e-(e-d._startTime)*d._timeScale/b,d._timeScale=a._rootTimeline._timeScale=b,b):d._timeScale},k.progress=function(a,b){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-a:a)+this._cycle*(this._duration+this._repeatDelay),b):this._time/this.duration()},k.totalProgress=function(a,b){return arguments.length?this.totalTime(this.totalDuration()*a,b):this._totalTime/this.totalDuration()},k.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),a>this._duration&&(a=this._duration),this._yoyo&&0!==(1&this._cycle)?a=this._duration-a+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(a+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(a,b)):this._time},k.duration=function(b){return arguments.length?a.prototype.duration.call(this,b):this._duration},k.totalDuration=function(a){return arguments.length?this._repeat===-1?this:this.duration((a-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},k.repeat=function(a){return arguments.length?(this._repeat=a,this._uncache(!0)):this._repeat},k.repeatDelay=function(a){return arguments.length?(this._repeatDelay=a,this._uncache(!0)):this._repeatDelay},k.yoyo=function(a){return arguments.length?(this._yoyo=a,this):this._yoyo},f},!0),c._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(a,b,d){var e=function(a){b.call(this,a),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var c,d,e=this.vars;for(d in e)c=e[d],j(c)&&c.join("").indexOf("{self}")!==-1&&(e[d]=this._swapSelfInParams(c));j(e.tweens)&&this.add(e.tweens,0,e.align,e.stagger)},f=1e-10,g=d._internals,h=e._internals={},i=g.isSelector,j=g.isArray,k=g.lazyTweens,l=g.lazyRender,m=c._gsDefine.globals,n=function(a){var b,c={};for(b in a)c[b]=a[b];return c},o=function(a,b,c){var d,e,f=a.cycle;for(d in f)e=f[d],a[d]="function"==typeof e?e(c,b[c]):e[c%e.length];delete a.cycle},p=h.pauseCallback=function(){},q=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},r=e.prototype=new b;return e.version="1.19.1",r.constructor=e,r.kill()._gc=r._forcingPlayhead=r._hasPause=!1,r.to=function(a,b,c,e){var f=c.repeat&&m.TweenMax||d;return b?this.add(new f(a,b,c),e):this.set(a,c,e)},r.from=function(a,b,c,e){return this.add((c.repeat&&m.TweenMax||d).from(a,b,c),e)},r.fromTo=function(a,b,c,e,f){var g=e.repeat&&m.TweenMax||d;return b?this.add(g.fromTo(a,b,c,e),f):this.set(a,e,f)},r.staggerTo=function(a,b,c,f,g,h,j,k){var l,m,p=new e({onComplete:h,onCompleteParams:j,callbackScope:k,smoothChildTiming:this.smoothChildTiming}),r=c.cycle;for("string"==typeof a&&(a=d.selector(a)||a),a=a||[],i(a)&&(a=q(a)),f=f||0,f<0&&(a=q(a),a.reverse(),f*=-1),m=0;m<a.length;m++)l=n(c),l.startAt&&(l.startAt=n(l.startAt),l.startAt.cycle&&o(l.startAt,a,m)),r&&(o(l,a,m),null!=l.duration&&(b=l.duration,delete l.duration)),p.to(a[m],b,l,m*f);return this.add(p,g)},r.staggerFrom=function(a,b,c,d,e,f,g,h){return c.immediateRender=0!=c.immediateRender,c.runBackwards=!0,this.staggerTo(a,b,c,d,e,f,g,h)},r.staggerFromTo=function(a,b,c,d,e,f,g,h,i){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,this.staggerTo(a,b,d,e,f,g,h,i)},r.call=function(a,b,c,e){return this.add(d.delayedCall(0,a,b,c),e)},r.set=function(a,b,c){return c=this._parseTimeOrLabel(c,0,!0),null==b.immediateRender&&(b.immediateRender=c===this._time&&!this._paused),this.add(new d(a,0,b),c)},e.exportRoot=function(a,b){a=a||{},null==a.smoothChildTiming&&(a.smoothChildTiming=!0);var c,f,g=new e(a),h=g._timeline;for(null==b&&(b=!0),h._remove(g,!0),g._startTime=0,g._rawPrevTime=g._time=g._totalTime=h._time,c=h._first;c;)f=c._next,b&&c instanceof d&&c.target===c.vars.onComplete||g.add(c,c._startTime-c._delay),c=f;return h.add(g,0),g},r.add=function(c,f,g,h){var i,k,l,m,n,o;if("number"!=typeof f&&(f=this._parseTimeOrLabel(f,0,!0,c)),!(c instanceof a)){if(c instanceof Array||c&&c.push&&j(c)){for(g=g||"normal",h=h||0,i=f,k=c.length,l=0;l<k;l++)j(m=c[l])&&(m=new e({tweens:m})),this.add(m,i),"string"!=typeof m&&"function"!=typeof m&&("sequence"===g?i=m._startTime+m.totalDuration()/m._timeScale:"start"===g&&(m._startTime-=m.delay())),i+=h;return this._uncache(!0)}if("string"==typeof c)return this.addLabel(c,f);if("function"!=typeof c)throw"Cannot add "+c+" into the timeline; it is not a tween, timeline, function, or string.";c=d.delayedCall(0,c)}if(b.prototype.add.call(this,c,f),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(n=this,o=n.rawTime()>c._startTime;n._timeline;)o&&n._timeline.smoothChildTiming?n.totalTime(n._totalTime,!0):n._gc&&n._enabled(!0,!1),n=n._timeline;return this},r.remove=function(b){if(b instanceof a){this._remove(b,!1);var c=b._timeline=b.vars.useFrames?a._rootFramesTimeline:a._rootTimeline;return b._startTime=(b._paused?b._pauseTime:c._time)-(b._reversed?b.totalDuration()-b._totalTime:b._totalTime)/b._timeScale,this}if(b instanceof Array||b&&b.push&&j(b)){for(var d=b.length;--d>-1;)this.remove(b[d]);return this}return"string"==typeof b?this.removeLabel(b):this.kill(null,b)},r._remove=function(a,c){b.prototype._remove.call(this,a,c);var d=this._last;return d?this._time>this.duration()&&(this._time=this._duration,this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},r.append=function(a,b){return this.add(a,this._parseTimeOrLabel(null,b,!0,a))},r.insert=r.insertMultiple=function(a,b,c,d){return this.add(a,b||0,c,d)},r.appendMultiple=function(a,b,c,d){return this.add(a,this._parseTimeOrLabel(null,b,!0,a),c,d)},r.addLabel=function(a,b){return this._labels[a]=this._parseTimeOrLabel(b),this},r.addPause=function(a,b,c,e){var f=d.delayedCall(0,p,c,e||this);return f.vars.onComplete=f.vars.onReverseComplete=b,f.data="isPause",this._hasPause=!0,this.add(f,a)},r.removeLabel=function(a){return delete this._labels[a],this},r.getLabelTime=function(a){return null!=this._labels[a]?this._labels[a]:-1},r._parseTimeOrLabel=function(b,c,d,e){var f;if(e instanceof a&&e.timeline===this)this.remove(e);else if(e&&(e instanceof Array||e.push&&j(e)))for(f=e.length;--f>-1;)e[f]instanceof a&&e[f].timeline===this&&this.remove(e[f]);if("string"==typeof c)return this._parseTimeOrLabel(c,d&&"number"==typeof b&&null==this._labels[c]?b-this.duration():0,d);if(c=c||0,"string"!=typeof b||!isNaN(b)&&null==this._labels[b])null==b&&(b=this.duration());else{if(f=b.indexOf("="),f===-1)return null==this._labels[b]?d?this._labels[b]=this.duration()+c:c:this._labels[b]+c;c=parseInt(b.charAt(f-1)+"1",10)*Number(b.substr(f+1)),b=f>1?this._parseTimeOrLabel(b.substr(0,f-1),0,d):this.duration()}return Number(b)+c},r.seek=function(a,b){return this.totalTime("number"==typeof a?a:this._parseTimeOrLabel(a),b!==!1)},r.stop=function(){return this.paused(!0)},r.gotoAndPlay=function(a,b){return this.play(a,b)},r.gotoAndStop=function(a,b){return this.pause(a,b)},r.render=function(a,b,c){this._gc&&this._enabled(!0,!1);var d,e,g,h,i,j,m,n=this._dirty?this.totalDuration():this._totalDuration,o=this._time,p=this._startTime,q=this._timeScale,r=this._paused;if(a>=n-1e-7&&a>=0)this._totalTime=this._time=n,this._reversed||this._hasPausedChild()||(e=!0,h="onComplete",i=!!this._timeline.autoRemoveChildren,0===this._duration&&(a<=0&&a>=-1e-7||this._rawPrevTime<0||this._rawPrevTime===f)&&this._rawPrevTime!==a&&this._first&&(i=!0,this._rawPrevTime>f&&(h="onReverseComplete"))),this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:f,a=n+1e-4;else if(a<1e-7)if(this._totalTime=this._time=0,(0!==o||0===this._duration&&this._rawPrevTime!==f&&(this._rawPrevTime>0||a<0&&this._rawPrevTime>=0))&&(h="onReverseComplete",e=this._reversed),a<0)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(i=e=!0,h="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(i=!0),this._rawPrevTime=a;else{if(this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:f,0===a&&e)for(d=this._first;d&&0===d._startTime;)d._duration||(e=!1),d=d._next;a=0,this._initted||(i=!0)}else{if(this._hasPause&&!this._forcingPlayhead&&!b){if(a>=o)for(d=this._first;d&&d._startTime<=a&&!j;)d._duration||"isPause"!==d.data||d.ratio||0===d._startTime&&0===this._rawPrevTime||(j=d),d=d._next;else for(d=this._last;d&&d._startTime>=a&&!j;)d._duration||"isPause"===d.data&&d._rawPrevTime>0&&(j=d),d=d._prev;j&&(this._time=a=j._startTime,this._totalTime=a+this._cycle*(this._totalDuration+this._repeatDelay))}this._totalTime=this._time=this._rawPrevTime=a}if(this._time!==o&&this._first||c||i||j){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==o&&a>0&&(this._active=!0),0===o&&this.vars.onStart&&(0===this._time&&this._duration||b||this._callback("onStart")),m=this._time,m>=o)for(d=this._first;d&&(g=d._next,m===this._time&&(!this._paused||r));)(d._active||d._startTime<=m&&!d._paused&&!d._gc)&&(j===d&&this.pause(),d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=g;else for(d=this._last;d&&(g=d._prev,m===this._time&&(!this._paused||r));){if(d._active||d._startTime<=o&&!d._paused&&!d._gc){if(j===d){for(j=d._prev;j&&j.endTime()>this._time;)j.render(j._reversed?j.totalDuration()-(a-j._startTime)*j._timeScale:(a-j._startTime)*j._timeScale,b,c),j=j._prev;j=null,this.pause()}d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)}d=g}this._onUpdate&&(b||(k.length&&l(),this._callback("onUpdate"))),h&&(this._gc||p!==this._startTime&&q===this._timeScale||(0===this._time||n>=this.totalDuration())&&(e&&(k.length&&l(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[h]&&this._callback(h)))}},r._hasPausedChild=function(){for(var a=this._first;a;){if(a._paused||a instanceof e&&a._hasPausedChild())return!0;a=a._next}return!1},r.getChildren=function(a,b,c,e){e=e||-9999999999;for(var f=[],g=this._first,h=0;g;)g._startTime<e||(g instanceof d?b!==!1&&(f[h++]=g):(c!==!1&&(f[h++]=g),a!==!1&&(f=f.concat(g.getChildren(!0,b,c)),h=f.length))),g=g._next;return f},r.getTweensOf=function(a,b){var c,e,f=this._gc,g=[],h=0;for(f&&this._enabled(!0,!0),c=d.getTweensOf(a),e=c.length;--e>-1;)(c[e].timeline===this||b&&this._contains(c[e]))&&(g[h++]=c[e]);return f&&this._enabled(!1,!0),g},r.recent=function(){return this._recent},r._contains=function(a){for(var b=a.timeline;b;){if(b===this)return!0;b=b.timeline}return!1},r.shiftChildren=function(a,b,c){c=c||0;for(var d,e=this._first,f=this._labels;e;)e._startTime>=c&&(e._startTime+=a),e=e._next;if(b)for(d in f)f[d]>=c&&(f[d]+=a);return this._uncache(!0)},r._kill=function(a,b){if(!a&&!b)return this._enabled(!1,!1);for(var c=b?this.getTweensOf(b):this.getChildren(!0,!0,!1),d=c.length,e=!1;--d>-1;)c[d]._kill(a,b)&&(e=!0);return e},r.clear=function(a){var b=this.getChildren(!1,!0,!0),c=b.length;for(this._time=this._totalTime=0;--c>-1;)b[c]._enabled(!1,!1);return a!==!1&&(this._labels={}),this._uncache(!0)},r.invalidate=function(){for(var b=this._first;b;)b.invalidate(),b=b._next;return a.prototype.invalidate.call(this)},r._enabled=function(a,c){if(a===this._gc)for(var d=this._first;d;)d._enabled(a,!0),d=d._next;return b.prototype._enabled.call(this,a,c)},r.totalTime=function(b,c,d){this._forcingPlayhead=!0;var e=a.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,e},r.duration=function(a){return arguments.length?(0!==this.duration()&&0!==a&&this.timeScale(this._duration/a),this):(this._dirty&&this.totalDuration(),this._duration)},r.totalDuration=function(a){if(!arguments.length){if(this._dirty){for(var b,c,d=0,e=this._last,f=999999999999;e;)b=e._prev,e._dirty&&e.totalDuration(),e._startTime>f&&this._sortChildren&&!e._paused?this.add(e,e._startTime-e._delay):f=e._startTime,e._startTime<0&&!e._paused&&(d-=e._startTime,this._timeline.smoothChildTiming&&(this._startTime+=e._startTime/this._timeScale),this.shiftChildren(-e._startTime,!1,-9999999999),f=0),c=e._startTime+e._totalDuration/e._timeScale,c>d&&(d=c),e=b;this._duration=this._totalDuration=d,this._dirty=!1}return this._totalDuration}return a&&this.totalDuration()?this.timeScale(this._totalDuration/a):this},r.paused=function(b){if(!b)for(var c=this._first,d=this._time;c;)c._startTime===d&&"isPause"===c.data&&(c._rawPrevTime=0),c=c._next;return a.prototype.paused.apply(this,arguments)},r.usesFrames=function(){for(var b=this._timeline;b._timeline;)b=b._timeline;return b===a._rootFramesTimeline},r.rawTime=function(a){return a&&(this._paused||this._repeat&&this.time()>0&&this.totalProgress()<1)?this._totalTime%(this._duration+this._repeatDelay):this._paused?this._totalTime:(this._timeline.rawTime(a)-this._startTime)*this._timeScale},e},!0),c._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(a,b,d){var e=function(b){a.call(this,b),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._dirty=!0},f=1e-10,g=b._internals,h=g.lazyTweens,i=g.lazyRender,j=c._gsDefine.globals,k=new d(null,null,1,0),l=e.prototype=new a;return l.constructor=e,l.kill()._gc=!1,e.version="1.19.1",l.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),a.prototype.invalidate.call(this)},l.addCallback=function(a,c,d,e){return this.add(b.delayedCall(0,a,d,e),c)},l.removeCallback=function(a,b){if(a)if(null==b)this._kill(null,a);else for(var c=this.getTweensOf(a,!1),d=c.length,e=this._parseTimeOrLabel(b);--d>-1;)c[d]._startTime===e&&c[d]._enabled(!1,!1);return this},l.removePause=function(b){return this.removeCallback(a._internals.pauseCallback,b)},l.tweenTo=function(a,c){c=c||{};var d,e,f,g={ease:k,useFrames:this.usesFrames(),immediateRender:!1},h=c.repeat&&j.TweenMax||b;for(e in c)g[e]=c[e];return g.time=this._parseTimeOrLabel(a),d=Math.abs(Number(g.time)-this._time)/this._timeScale||.001,f=new h(this,d,g),g.onStart=function(){f.target.paused(!0),f.vars.time!==f.target.time()&&d===f.duration()&&f.duration(Math.abs(f.vars.time-f.target.time())/f.target._timeScale),c.onStart&&c.onStart.apply(c.onStartScope||c.callbackScope||f,c.onStartParams||[])},f},l.tweenFromTo=function(a,b,c){c=c||{},a=this._parseTimeOrLabel(a),c.startAt={onComplete:this.seek,onCompleteParams:[a],callbackScope:this},c.immediateRender=c.immediateRender!==!1;var d=this.tweenTo(b,c);return d.duration(Math.abs(d.vars.time-a)/this._timeScale||.001)},l.render=function(a,b,c){this._gc&&this._enabled(!0,!1);var d,e,g,j,k,l,m,n,o=this._dirty?this.totalDuration():this._totalDuration,p=this._duration,q=this._time,r=this._totalTime,s=this._startTime,t=this._timeScale,u=this._rawPrevTime,v=this._paused,w=this._cycle;if(a>=o-1e-7&&a>=0)this._locked||(this._totalTime=o,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(e=!0,j="onComplete",k=!!this._timeline.autoRemoveChildren,0===this._duration&&(a<=0&&a>=-1e-7||u<0||u===f)&&u!==a&&this._first&&(k=!0,u>f&&(j="onReverseComplete"))),this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:f,this._yoyo&&0!==(1&this._cycle)?this._time=a=0:(this._time=p,a=p+1e-4);else if(a<1e-7)if(this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==q||0===p&&u!==f&&(u>0||a<0&&u>=0)&&!this._locked)&&(j="onReverseComplete",e=this._reversed),a<0)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(k=e=!0,j="onReverseComplete"):u>=0&&this._first&&(k=!0),this._rawPrevTime=a;else{if(this._rawPrevTime=p||!b||a||this._rawPrevTime===a?a:f,0===a&&e)for(d=this._first;d&&0===d._startTime;)d._duration||(e=!1),d=d._next;a=0,this._initted||(k=!0)}else if(0===p&&u<0&&(k=!0),this._time=this._rawPrevTime=a,this._locked||(this._totalTime=a,0!==this._repeat&&(l=p+this._repeatDelay,this._cycle=this._totalTime/l>>0,0!==this._cycle&&this._cycle===this._totalTime/l&&r<=a&&this._cycle--,this._time=this._totalTime-this._cycle*l,this._yoyo&&0!==(1&this._cycle)&&(this._time=p-this._time),this._time>p?(this._time=p,a=p+1e-4):this._time<0?this._time=a=0:a=this._time)),this._hasPause&&!this._forcingPlayhead&&!b&&a<p){if(a=this._time,a>=q||this._repeat&&w!==this._cycle)for(d=this._first;d&&d._startTime<=a&&!m;)d._duration||"isPause"!==d.data||d.ratio||0===d._startTime&&0===this._rawPrevTime||(m=d),d=d._next;else for(d=this._last;d&&d._startTime>=a&&!m;)d._duration||"isPause"===d.data&&d._rawPrevTime>0&&(m=d),d=d._prev;m&&(this._time=a=m._startTime,this._totalTime=a+this._cycle*(this._totalDuration+this._repeatDelay))}if(this._cycle!==w&&!this._locked){var x=this._yoyo&&0!==(1&w),y=x===(this._yoyo&&0!==(1&this._cycle)),z=this._totalTime,A=this._cycle,B=this._rawPrevTime,C=this._time;if(this._totalTime=w*p,this._cycle<w?x=!x:this._totalTime+=p,this._time=q,this._rawPrevTime=0===p?u-1e-4:u,this._cycle=w,this._locked=!0,q=x?0:p,this.render(q,b,0===p),b||this._gc||this.vars.onRepeat&&(this._cycle=A,this._locked=!1,this._callback("onRepeat")),q!==this._time)return;if(y&&(this._cycle=w,this._locked=!0,q=x?p+1e-4:-1e-4,this.render(q,!0,!1)),this._locked=!1,this._paused&&!v)return;this._time=C,this._totalTime=z,this._cycle=A,this._rawPrevTime=B}if(!(this._time!==q&&this._first||c||k||m))return void(r!==this._totalTime&&this._onUpdate&&(b||this._callback("onUpdate")));if(this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==r&&a>0&&(this._active=!0),0===r&&this.vars.onStart&&(0===this._totalTime&&this._totalDuration||b||this._callback("onStart")),n=this._time,n>=q)for(d=this._first;d&&(g=d._next,n===this._time&&(!this._paused||v));)(d._active||d._startTime<=this._time&&!d._paused&&!d._gc)&&(m===d&&this.pause(),d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=g;else for(d=this._last;d&&(g=d._prev,n===this._time&&(!this._paused||v));){if(d._active||d._startTime<=q&&!d._paused&&!d._gc){
if(m===d){for(m=d._prev;m&&m.endTime()>this._time;)m.render(m._reversed?m.totalDuration()-(a-m._startTime)*m._timeScale:(a-m._startTime)*m._timeScale,b,c),m=m._prev;m=null,this.pause()}d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)}d=g}this._onUpdate&&(b||(h.length&&i(),this._callback("onUpdate"))),j&&(this._locked||this._gc||s!==this._startTime&&t===this._timeScale||(0===this._time||o>=this.totalDuration())&&(e&&(h.length&&i(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[j]&&this._callback(j)))},l.getActive=function(a,b,c){null==a&&(a=!0),null==b&&(b=!0),null==c&&(c=!1);var d,e,f=[],g=this.getChildren(a,b,c),h=0,i=g.length;for(d=0;d<i;d++)e=g[d],e.isActive()&&(f[h++]=e);return f},l.getLabelAfter=function(a){a||0!==a&&(a=this._time);var b,c=this.getLabelsArray(),d=c.length;for(b=0;b<d;b++)if(c[b].time>a)return c[b].name;return null},l.getLabelBefore=function(a){null==a&&(a=this._time);for(var b=this.getLabelsArray(),c=b.length;--c>-1;)if(b[c].time<a)return b[c].name;return null},l.getLabelsArray=function(){var a,b=[],c=0;for(a in this._labels)b[c++]={time:this._labels[a],name:a};return b.sort(function(a,b){return a.time-b.time}),b},l.invalidate=function(){return this._locked=!1,a.prototype.invalidate.call(this)},l.progress=function(a,b){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-a:a)+this._cycle*(this._duration+this._repeatDelay),b):this._time/this.duration()},l.totalProgress=function(a,b){return arguments.length?this.totalTime(this.totalDuration()*a,b):this._totalTime/this.totalDuration()},l.totalDuration=function(b){return arguments.length?this._repeat!==-1&&b?this.timeScale(this.totalDuration()/b):this:(this._dirty&&(a.prototype.totalDuration.call(this),this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},l.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),a>this._duration&&(a=this._duration),this._yoyo&&0!==(1&this._cycle)?a=this._duration-a+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(a+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(a,b)):this._time},l.repeat=function(a){return arguments.length?(this._repeat=a,this._uncache(!0)):this._repeat},l.repeatDelay=function(a){return arguments.length?(this._repeatDelay=a,this._uncache(!0)):this._repeatDelay},l.yoyo=function(a){return arguments.length?(this._yoyo=a,this):this._yoyo},l.currentLabel=function(a){return arguments.length?this.seek(a,!0):this.getLabelBefore(this._time+1e-8)},e},!0),function(){var a=180/Math.PI,b=[],d=[],e=[],f={},g=c._gsDefine.globals,h=function(a,b,c,d){c===d&&(c=d-(d-b)/1e6),a===b&&(b=a+(c-a)/1e6),this.a=a,this.b=b,this.c=c,this.d=d,this.da=d-a,this.ca=c-a,this.ba=b-a},i=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",j=function(a,b,c,d){var e={a:a},f={},g={},h={c:d},i=(a+b)/2,j=(b+c)/2,k=(c+d)/2,l=(i+j)/2,m=(j+k)/2,n=(m-l)/8;return e.b=i+(a-i)/4,f.b=l+n,e.c=f.a=(e.b+f.b)/2,f.c=g.a=(l+m)/2,g.b=m-n,h.b=k+(d-k)/4,g.c=h.a=(g.b+h.b)/2,[e,f,g,h]},k=function(a,c,f,g,h){var i,k,l,m,n,o,p,q,r,s,t,u,v,w=a.length-1,x=0,y=a[0].a;for(i=0;i<w;i++)n=a[x],k=n.a,l=n.d,m=a[x+1].d,h?(t=b[i],u=d[i],v=(u+t)*c*.25/(g?.5:e[i]||.5),o=l-(l-k)*(g?.5*c:0!==t?v/t:0),p=l+(m-l)*(g?.5*c:0!==u?v/u:0),q=l-(o+((p-o)*(3*t/(t+u)+.5)/4||0))):(o=l-(l-k)*c*.5,p=l+(m-l)*c*.5,q=l-(o+p)/2),o+=q,p+=q,n.c=r=o,0!==i?n.b=y:n.b=y=n.a+.6*(n.c-n.a),n.da=l-k,n.ca=r-k,n.ba=y-k,f?(s=j(k,y,r,l),a.splice(x,1,s[0],s[1],s[2],s[3]),x+=4):x++,y=p;n=a[x],n.b=y,n.c=y+.4*(n.d-y),n.da=n.d-n.a,n.ca=n.c-n.a,n.ba=y-n.a,f&&(s=j(n.a,y,n.c,n.d),a.splice(x,1,s[0],s[1],s[2],s[3]))},l=function(a,c,e,f){var g,i,j,k,l,m,n=[];if(f)for(a=[f].concat(a),i=a.length;--i>-1;)"string"==typeof(m=a[i][c])&&"="===m.charAt(1)&&(a[i][c]=f[c]+Number(m.charAt(0)+m.substr(2)));if(g=a.length-2,g<0)return n[0]=new h(a[0][c],0,0,a[g<-1?0:1][c]),n;for(i=0;i<g;i++)j=a[i][c],k=a[i+1][c],n[i]=new h(j,0,0,k),e&&(l=a[i+2][c],b[i]=(b[i]||0)+(k-j)*(k-j),d[i]=(d[i]||0)+(l-k)*(l-k));return n[i]=new h(a[i][c],0,0,a[i+1][c]),n},m=function(a,c,g,h,j,m){var n,o,p,q,r,s,t,u,v={},w=[],x=m||a[0];j="string"==typeof j?","+j+",":i,null==c&&(c=1);for(o in a[0])w.push(o);if(a.length>1){for(u=a[a.length-1],t=!0,n=w.length;--n>-1;)if(o=w[n],Math.abs(x[o]-u[o])>.05){t=!1;break}t&&(a=a.concat(),m&&a.unshift(m),a.push(a[1]),m=a[a.length-3])}for(b.length=d.length=e.length=0,n=w.length;--n>-1;)o=w[n],f[o]=j.indexOf(","+o+",")!==-1,v[o]=l(a,o,f[o],m);for(n=b.length;--n>-1;)b[n]=Math.sqrt(b[n]),d[n]=Math.sqrt(d[n]);if(!h){for(n=w.length;--n>-1;)if(f[o])for(p=v[w[n]],s=p.length-1,q=0;q<s;q++)r=p[q+1].da/d[q]+p[q].da/b[q]||0,e[q]=(e[q]||0)+r*r;for(n=e.length;--n>-1;)e[n]=Math.sqrt(e[n])}for(n=w.length,q=g?4:1;--n>-1;)o=w[n],p=v[o],k(p,c,g,h,f[o]),t&&(p.splice(0,q),p.splice(p.length-q,q));return v},n=function(a,b,c){b=b||"soft";var d,e,f,g,i,j,k,l,m,n,o,p={},q="cubic"===b?3:2,r="soft"===b,s=[];if(r&&c&&(a=[c].concat(a)),null==a||a.length<q+1)throw"invalid Bezier data";for(m in a[0])s.push(m);for(j=s.length;--j>-1;){for(m=s[j],p[m]=i=[],n=0,l=a.length,k=0;k<l;k++)d=null==c?a[k][m]:"string"==typeof(o=a[k][m])&&"="===o.charAt(1)?c[m]+Number(o.charAt(0)+o.substr(2)):Number(o),r&&k>1&&k<l-1&&(i[n++]=(d+i[n-2])/2),i[n++]=d;for(l=n-q+1,n=0,k=0;k<l;k+=q)d=i[k],e=i[k+1],f=i[k+2],g=2===q?0:i[k+3],i[n++]=o=3===q?new h(d,e,f,g):new h(d,(2*e+d)/3,(2*e+f)/3,f);i.length=n}return p},o=function(a,b,c){for(var d,e,f,g,h,i,j,k,l,m,n,o=1/c,p=a.length;--p>-1;)for(m=a[p],f=m.a,g=m.d-f,h=m.c-f,i=m.b-f,d=e=0,k=1;k<=c;k++)j=o*k,l=1-j,d=e-(e=(j*j*g+3*l*(j*h+l*i))*j),n=p*c+k-1,b[n]=(b[n]||0)+d*d},p=function(a,b){b=b>>0||6;var c,d,e,f,g=[],h=[],i=0,j=0,k=b-1,l=[],m=[];for(c in a)o(a[c],g,b);for(e=g.length,d=0;d<e;d++)i+=Math.sqrt(g[d]),f=d%b,m[f]=i,f===k&&(j+=i,f=d/b>>0,l[f]=m,h[f]=j,i=0,m=[]);return{length:j,lengths:h,segments:l}},q=c._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.7",API:2,global:!0,init:function(a,b,c){this._target=a,b instanceof Array&&(b={values:b}),this._func={},this._mod={},this._props=[],this._timeRes=null==b.timeResolution?6:parseInt(b.timeResolution,10);var d,e,f,g,h,i=b.values||[],j={},k=i[0],l=b.autoRotate||c.vars.orientToBezier;this._autoRotate=l?l instanceof Array?l:[["x","y","rotation",l===!0?0:Number(l)||0]]:null;for(d in k)this._props.push(d);for(f=this._props.length;--f>-1;)d=this._props[f],this._overwriteProps.push(d),e=this._func[d]="function"==typeof a[d],j[d]=e?a[d.indexOf("set")||"function"!=typeof a["get"+d.substr(3)]?d:"get"+d.substr(3)]():parseFloat(a[d]),h||j[d]!==i[0][d]&&(h=j);if(this._beziers="cubic"!==b.type&&"quadratic"!==b.type&&"soft"!==b.type?m(i,isNaN(b.curviness)?1:b.curviness,!1,"thruBasic"===b.type,b.correlate,h):n(i,b.type,j),this._segCount=this._beziers[d].length,this._timeRes){var o=p(this._beziers,this._timeRes);this._length=o.length,this._lengths=o.lengths,this._segments=o.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(l=this._autoRotate)for(this._initialRotations=[],l[0]instanceof Array||(this._autoRotate=l=[l]),f=l.length;--f>-1;){for(g=0;g<3;g++)d=l[f][g],this._func[d]="function"==typeof a[d]&&a[d.indexOf("set")||"function"!=typeof a["get"+d.substr(3)]?d:"get"+d.substr(3)];d=l[f][2],this._initialRotations[f]=(this._func[d]?this._func[d].call(this._target):this._target[d])||0,this._overwriteProps.push(d)}return this._startRatio=c.vars.runBackwards?1:0,!0},set:function(b){var c,d,e,f,g,h,i,j,k,l,m=this._segCount,n=this._func,o=this._target,p=b!==this._startRatio;if(this._timeRes){if(k=this._lengths,l=this._curSeg,b*=this._length,e=this._li,b>this._l2&&e<m-1){for(j=m-1;e<j&&(this._l2=k[++e])<=b;);this._l1=k[e-1],this._li=e,this._curSeg=l=this._segments[e],this._s2=l[this._s1=this._si=0]}else if(b<this._l1&&e>0){for(;e>0&&(this._l1=k[--e])>=b;);0===e&&b<this._l1?this._l1=0:e++,this._l2=k[e],this._li=e,this._curSeg=l=this._segments[e],this._s1=l[(this._si=l.length-1)-1]||0,this._s2=l[this._si]}if(c=e,b-=this._l1,e=this._si,b>this._s2&&e<l.length-1){for(j=l.length-1;e<j&&(this._s2=l[++e])<=b;);this._s1=l[e-1],this._si=e}else if(b<this._s1&&e>0){for(;e>0&&(this._s1=l[--e])>=b;);0===e&&b<this._s1?this._s1=0:e++,this._s2=l[e],this._si=e}h=(e+(b-this._s1)/(this._s2-this._s1))*this._prec||0}else c=b<0?0:b>=1?m-1:m*b>>0,h=(b-c*(1/m))*m;for(d=1-h,e=this._props.length;--e>-1;)f=this._props[e],g=this._beziers[f][c],i=(h*h*g.da+3*d*(h*g.ca+d*g.ba))*h+g.a,this._mod[f]&&(i=this._mod[f](i,o)),n[f]?o[f](i):o[f]=i;if(this._autoRotate){var q,r,s,t,u,v,w,x=this._autoRotate;for(e=x.length;--e>-1;)f=x[e][2],v=x[e][3]||0,w=x[e][4]===!0?1:a,g=this._beziers[x[e][0]],q=this._beziers[x[e][1]],g&&q&&(g=g[c],q=q[c],r=g.a+(g.b-g.a)*h,t=g.b+(g.c-g.b)*h,r+=(t-r)*h,t+=(g.c+(g.d-g.c)*h-t)*h,s=q.a+(q.b-q.a)*h,u=q.b+(q.c-q.b)*h,s+=(u-s)*h,u+=(q.c+(q.d-q.c)*h-u)*h,i=p?Math.atan2(u-s,t-r)*w+v:this._initialRotations[e],this._mod[f]&&(i=this._mod[f](i,o)),n[f]?o[f](i):o[f]=i)}}}),r=q.prototype;q.bezierThrough=m,q.cubicToQuadratic=j,q._autoCSS=!0,q.quadraticToCubic=function(a,b,c){return new h(a,(2*b+a)/3,(2*b+c)/3,c)},q._cssRegister=function(){var a=g.CSSPlugin;if(a){var b=a._internals,c=b._parseToProxy,d=b._setPluginRatio,e=b.CSSPropTween;b._registerComplexSpecialProp("bezier",{parser:function(a,b,f,g,h,i){b instanceof Array&&(b={values:b}),i=new q;var j,k,l,m=b.values,n=m.length-1,o=[],p={};if(n<0)return h;for(j=0;j<=n;j++)l=c(a,m[j],g,h,i,n!==j),o[j]=l.end;for(k in b)p[k]=b[k];return p.values=o,h=new e(a,"bezier",0,0,l.pt,2),h.data=l,h.plugin=i,h.setRatio=d,0===p.autoRotate&&(p.autoRotate=!0),!p.autoRotate||p.autoRotate instanceof Array||(j=p.autoRotate===!0?0:Number(p.autoRotate),p.autoRotate=null!=l.end.left?[["left","top","rotation",j,!1]]:null!=l.end.x&&[["x","y","rotation",j,!1]]),p.autoRotate&&(g._transform||g._enableTransforms(!1),l.autoRotate=g._target._gsTransform,l.proxy.rotation=l.autoRotate.rotation||0,g._overwriteProps.push("rotation")),i._onInitTween(l.proxy,p,g._tween),h}})}},r._mod=function(a){for(var b,c=this._overwriteProps,d=c.length;--d>-1;)b=a[c[d]],b&&"function"==typeof b&&(this._mod[c[d]]=b)},r._kill=function(a){var b,c,d=this._props;for(b in this._beziers)if(b in a)for(delete this._beziers[b],delete this._func[b],c=d.length;--c>-1;)d[c]===b&&d.splice(c,1);if(d=this._autoRotate)for(c=d.length;--c>-1;)a[d[c][2]]&&d.splice(c,1);return this._super._kill.call(this,a)}}(),c._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(a,b){var d,e,f,g,h=function(){a.call(this,"css"),this._overwriteProps.length=0,this.setRatio=h.prototype.setRatio},i=c._gsDefine.globals,j={},k=h.prototype=new a("css");k.constructor=h,h.version="1.19.1",h.API=2,h.defaultTransformPerspective=0,h.defaultSkewType="compensated",h.defaultSmoothOrigin=!0,k="px",h.suffixMap={top:k,right:k,bottom:k,left:k,width:k,height:k,fontSize:k,padding:k,margin:k,perspective:k,lineHeight:""};var l,m,n,o,p,q,r,s,t=/(?:\-|\.|\b)(\d|\.|e\-)+/g,u=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,v=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,w=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,x=/(?:\d|\-|\+|=|#|\.)*/g,y=/opacity *= *([^)]*)/i,z=/opacity:([^;]*)/i,A=/alpha\(opacity *=.+?\)/i,B=/^(rgb|hsl)/,C=/([A-Z])/g,D=/-([a-z])/gi,E=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,F=function(a,b){return b.toUpperCase()},G=/(?:Left|Right|Width)/i,H=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,I=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,J=/,(?=[^\)]*(?:\(|$))/gi,K=/[\s,\(]/i,L=Math.PI/180,M=180/Math.PI,N={},O={style:{}},P=c.document||{createElement:function(){return O}},Q=function(a,b){return P.createElementNS?P.createElementNS(b||"http://www.w3.org/1999/xhtml",a):P.createElement(a)},R=Q("div"),S=Q("img"),T=h._internals={_specialProps:j},U=(c.navigator||{}).userAgent||"",V=function(){var a=U.indexOf("Android"),b=Q("a");return n=U.indexOf("Safari")!==-1&&U.indexOf("Chrome")===-1&&(a===-1||parseFloat(U.substr(a+8,2))>3),p=n&&parseFloat(U.substr(U.indexOf("Version/")+8,2))<6,o=U.indexOf("Firefox")!==-1,(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(U)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(U))&&(q=parseFloat(RegExp.$1)),!!b&&(b.style.cssText="top:1px;opacity:.55;",/^0.55/.test(b.style.opacity))}(),W=function(a){return y.test("string"==typeof a?a:(a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100:1},X=function(a){c.console&&console.log(a)},Y="",Z="",$=function(a,b){b=b||R;var c,d,e=b.style;if(void 0!==e[a])return a;for(a=a.charAt(0).toUpperCase()+a.substr(1),c=["O","Moz","ms","Ms","Webkit"],d=5;--d>-1&&void 0===e[c[d]+a];);return d>=0?(Z=3===d?"ms":c[d],Y="-"+Z.toLowerCase()+"-",Z+a):null},_=P.defaultView?P.defaultView.getComputedStyle:function(){},aa=h.getStyle=function(a,b,c,d,e){var f;return V||"opacity"!==b?(!d&&a.style[b]?f=a.style[b]:(c=c||_(a))?f=c[b]||c.getPropertyValue(b)||c.getPropertyValue(b.replace(C,"-$1").toLowerCase()):a.currentStyle&&(f=a.currentStyle[b]),null==e||f&&"none"!==f&&"auto"!==f&&"auto auto"!==f?f:e):W(a)},ba=T.convertToPixels=function(a,c,d,e,f){if("px"===e||!e)return d;if("auto"===e||!d)return 0;var g,i,j,k=G.test(c),l=a,m=R.style,n=d<0,o=1===d;if(n&&(d=-d),o&&(d*=100),"%"===e&&c.indexOf("border")!==-1)g=d/100*(k?a.clientWidth:a.clientHeight);else{if(m.cssText="border:0 solid red;position:"+aa(a,"position")+";line-height:0;","%"!==e&&l.appendChild&&"v"!==e.charAt(0)&&"rem"!==e)m[k?"borderLeftWidth":"borderTopWidth"]=d+e;else{if(l=a.parentNode||P.body,i=l._gsCache,j=b.ticker.frame,i&&k&&i.time===j)return i.width*d/100;m[k?"width":"height"]=d+e}l.appendChild(R),g=parseFloat(R[k?"offsetWidth":"offsetHeight"]),l.removeChild(R),k&&"%"===e&&h.cacheWidths!==!1&&(i=l._gsCache=l._gsCache||{},i.time=j,i.width=g/d*100),0!==g||f||(g=ba(a,c,d,e,!0))}return o&&(g/=100),n?-g:g},ca=T.calculateOffset=function(a,b,c){if("absolute"!==aa(a,"position",c))return 0;var d="left"===b?"Left":"Top",e=aa(a,"margin"+d,c);return a["offset"+d]-(ba(a,b,parseFloat(e),e.replace(x,""))||0)},da=function(a,b){var c,d,e,f={};if(b=b||_(a,null))if(c=b.length)for(;--c>-1;)e=b[c],e.indexOf("-transform")!==-1&&Ea!==e||(f[e.replace(D,F)]=b.getPropertyValue(e));else for(c in b)c.indexOf("Transform")!==-1&&Da!==c||(f[c]=b[c]);else if(b=a.currentStyle||a.style)for(c in b)"string"==typeof c&&void 0===f[c]&&(f[c.replace(D,F)]=b[c]);return V||(f.opacity=W(a)),d=Sa(a,b,!1),f.rotation=d.rotation,f.skewX=d.skewX,f.scaleX=d.scaleX,f.scaleY=d.scaleY,f.x=d.x,f.y=d.y,Ga&&(f.z=d.z,f.rotationX=d.rotationX,f.rotationY=d.rotationY,f.scaleZ=d.scaleZ),f.filters&&delete f.filters,f},ea=function(a,b,c,d,e){var f,g,h,i={},j=a.style;for(g in c)"cssText"!==g&&"length"!==g&&isNaN(g)&&(b[g]!==(f=c[g])||e&&e[g])&&g.indexOf("Origin")===-1&&("number"!=typeof f&&"string"!=typeof f||(i[g]="auto"!==f||"left"!==g&&"top"!==g?""!==f&&"auto"!==f&&"none"!==f||"string"!=typeof b[g]||""===b[g].replace(w,"")?f:0:ca(a,g),void 0!==j[g]&&(h=new ta(j,g,j[g],h))));if(d)for(g in d)"className"!==g&&(i[g]=d[g]);return{difs:i,firstMPT:h}},fa={width:["Left","Right"],height:["Top","Bottom"]},ga=["marginLeft","marginRight","marginTop","marginBottom"],ha=function(a,b,c){if("svg"===(a.nodeName+"").toLowerCase())return(c||_(a))[b]||0;if(a.getCTM&&Pa(a))return a.getBBox()[b]||0;var d=parseFloat("width"===b?a.offsetWidth:a.offsetHeight),e=fa[b],f=e.length;for(c=c||_(a,null);--f>-1;)d-=parseFloat(aa(a,"padding"+e[f],c,!0))||0,d-=parseFloat(aa(a,"border"+e[f]+"Width",c,!0))||0;return d},ia=function(a,b){if("contain"===a||"auto"===a||"auto auto"===a)return a+" ";null!=a&&""!==a||(a="0 0");var c,d=a.split(" "),e=a.indexOf("left")!==-1?"0%":a.indexOf("right")!==-1?"100%":d[0],f=a.indexOf("top")!==-1?"0%":a.indexOf("bottom")!==-1?"100%":d[1];if(d.length>3&&!b){for(d=a.split(", ").join(",").split(","),a=[],c=0;c<d.length;c++)a.push(ia(d[c]));return a.join(",")}return null==f?f="center"===e?"50%":"0":"center"===f&&(f="50%"),("center"===e||isNaN(parseFloat(e))&&(e+"").indexOf("=")===-1)&&(e="50%"),a=e+" "+f+(d.length>2?" "+d[2]:""),b&&(b.oxp=e.indexOf("%")!==-1,b.oyp=f.indexOf("%")!==-1,b.oxr="="===e.charAt(1),b.oyr="="===f.charAt(1),b.ox=parseFloat(e.replace(w,"")),b.oy=parseFloat(f.replace(w,"")),b.v=a),b||a},ja=function(a,b){return"function"==typeof a&&(a=a(s,r)),"string"==typeof a&&"="===a.charAt(1)?parseInt(a.charAt(0)+"1",10)*parseFloat(a.substr(2)):parseFloat(a)-parseFloat(b)||0},ka=function(a,b){return"function"==typeof a&&(a=a(s,r)),null==a?b:"string"==typeof a&&"="===a.charAt(1)?parseInt(a.charAt(0)+"1",10)*parseFloat(a.substr(2))+b:parseFloat(a)||0},la=function(a,b,c,d){var e,f,g,h,i,j=1e-6;return"function"==typeof a&&(a=a(s,r)),null==a?h=b:"number"==typeof a?h=a:(e=360,f=a.split("_"),i="="===a.charAt(1),g=(i?parseInt(a.charAt(0)+"1",10)*parseFloat(f[0].substr(2)):parseFloat(f[0]))*(a.indexOf("rad")===-1?1:M)-(i?0:b),f.length&&(d&&(d[c]=b+g),a.indexOf("short")!==-1&&(g%=e,g!==g%(e/2)&&(g=g<0?g+e:g-e)),a.indexOf("_cw")!==-1&&g<0?g=(g+9999999999*e)%e-(g/e|0)*e:a.indexOf("ccw")!==-1&&g>0&&(g=(g-9999999999*e)%e-(g/e|0)*e)),h=b+g),h<j&&h>-j&&(h=0),h},ma={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},na=function(a,b,c){return a=a<0?a+1:a>1?a-1:a,255*(6*a<1?b+(c-b)*a*6:a<.5?c:3*a<2?b+(c-b)*(2/3-a)*6:b)+.5|0},oa=h.parseColor=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;if(a)if("number"==typeof a)c=[a>>16,a>>8&255,255&a];else{if(","===a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),ma[a])c=ma[a];else if("#"===a.charAt(0))4===a.length&&(d=a.charAt(1),e=a.charAt(2),f=a.charAt(3),a="#"+d+d+e+e+f+f),a=parseInt(a.substr(1),16),c=[a>>16,a>>8&255,255&a];else if("hsl"===a.substr(0,3))if(c=m=a.match(t),b){if(a.indexOf("=")!==-1)return a.match(u)}else g=Number(c[0])%360/360,h=Number(c[1])/100,i=Number(c[2])/100,e=i<=.5?i*(h+1):i+h-i*h,d=2*i-e,c.length>3&&(c[3]=Number(a[3])),c[0]=na(g+1/3,d,e),c[1]=na(g,d,e),c[2]=na(g-1/3,d,e);else c=a.match(t)||ma.transparent;c[0]=Number(c[0]),c[1]=Number(c[1]),c[2]=Number(c[2]),c.length>3&&(c[3]=Number(c[3]))}else c=ma.black;return b&&!m&&(d=c[0]/255,e=c[1]/255,f=c[2]/255,j=Math.max(d,e,f),k=Math.min(d,e,f),i=(j+k)/2,j===k?g=h=0:(l=j-k,h=i>.5?l/(2-j-k):l/(j+k),g=j===d?(e-f)/l+(e<f?6:0):j===e?(f-d)/l+2:(d-e)/l+4,g*=60),c[0]=g+.5|0,c[1]=100*h+.5|0,c[2]=100*i+.5|0),c},pa=function(a,b){var c,d,e,f=a.match(qa)||[],g=0,h=f.length?"":a;for(c=0;c<f.length;c++)d=f[c],e=a.substr(g,a.indexOf(d,g)-g),g+=e.length+d.length,d=oa(d,b),3===d.length&&d.push(1),h+=e+(b?"hsla("+d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:"rgba("+d.join(","))+")";return h+a.substr(g)},qa="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(k in ma)qa+="|"+k+"\\b";qa=new RegExp(qa+")","gi"),h.colorStringFilter=function(a){var b,c=a[0]+a[1];qa.test(c)&&(b=c.indexOf("hsl(")!==-1||c.indexOf("hsla(")!==-1,a[0]=pa(a[0],b),a[1]=pa(a[1],b)),qa.lastIndex=0},b.defaultStringFilter||(b.defaultStringFilter=h.colorStringFilter);var ra=function(a,b,c,d){if(null==a)return function(a){return a};var e,f=b?(a.match(qa)||[""])[0]:"",g=a.split(f).join("").match(v)||[],h=a.substr(0,a.indexOf(g[0])),i=")"===a.charAt(a.length-1)?")":"",j=a.indexOf(" ")!==-1?" ":",",k=g.length,l=k>0?g[0].replace(t,""):"";return k?e=b?function(a){var b,m,n,o;if("number"==typeof a)a+=l;else if(d&&J.test(a)){for(o=a.replace(J,"|").split("|"),n=0;n<o.length;n++)o[n]=e(o[n]);return o.join(",")}if(b=(a.match(qa)||[f])[0],m=a.split(b).join("").match(v)||[],n=m.length,k>n--)for(;++n<k;)m[n]=c?m[(n-1)/2|0]:g[n];return h+m.join(j)+j+b+i+(a.indexOf("inset")!==-1?" inset":"")}:function(a){var b,f,m;if("number"==typeof a)a+=l;else if(d&&J.test(a)){for(f=a.replace(J,"|").split("|"),m=0;m<f.length;m++)f[m]=e(f[m]);return f.join(",")}if(b=a.match(v)||[],m=b.length,k>m--)for(;++m<k;)b[m]=c?b[(m-1)/2|0]:g[m];return h+b.join(j)+i}:function(a){return a}},sa=function(a){return a=a.split(","),function(b,c,d,e,f,g,h){var i,j=(c+"").split(" ");for(h={},i=0;i<4;i++)h[a[i]]=j[i]=j[i]||j[(i-1)/2>>0];return e.parse(b,h,f,g)}},ta=(T._setPluginRatio=function(a){this.plugin.setRatio(a);for(var b,c,d,e,f,g=this.data,h=g.proxy,i=g.firstMPT,j=1e-6;i;)b=h[i.v],i.r?b=Math.round(b):b<j&&b>-j&&(b=0),i.t[i.p]=b,i=i._next;if(g.autoRotate&&(g.autoRotate.rotation=g.mod?g.mod(h.rotation,this.t):h.rotation),1===a||0===a)for(i=g.firstMPT,f=1===a?"e":"b";i;){if(c=i.t,c.type){if(1===c.type){for(e=c.xs0+c.s+c.xs1,d=1;d<c.l;d++)e+=c["xn"+d]+c["xs"+(d+1)];c[f]=e}}else c[f]=c.s+c.xs0;i=i._next}},function(a,b,c,d,e){this.t=a,this.p=b,this.v=c,this.r=e,d&&(d._prev=this,this._next=d)}),ua=(T._parseToProxy=function(a,b,c,d,e,f){var g,h,i,j,k,l=d,m={},n={},o=c._transform,p=N;for(c._transform=null,N=b,d=k=c.parse(a,b,d,e),N=p,f&&(c._transform=o,l&&(l._prev=null,l._prev&&(l._prev._next=null)));d&&d!==l;){if(d.type<=1&&(h=d.p,n[h]=d.s+d.c,m[h]=d.s,f||(j=new ta(d,"s",h,j,d.r),d.c=0),1===d.type))for(g=d.l;--g>0;)i="xn"+g,h=d.p+"_"+i,n[h]=d.data[i],m[h]=d[i],f||(j=new ta(d,i,h,j,d.rxp[i]));d=d._next}return{proxy:m,end:n,firstMPT:j,pt:k}},T.CSSPropTween=function(a,b,c,e,f,h,i,j,k,l,m){this.t=a,this.p=b,this.s=c,this.c=e,this.n=i||b,a instanceof ua||g.push(this.n),this.r=j,this.type=h||0,k&&(this.pr=k,d=!0),this.b=void 0===l?c:l,this.e=void 0===m?c+e:m,f&&(this._next=f,f._prev=this)}),va=function(a,b,c,d,e,f){var g=new ua(a,b,c,d-c,e,-1,f);return g.b=c,g.e=g.xs0=d,g},wa=h.parseComplex=function(a,b,c,d,e,f,g,i,j,k){c=c||f||"","function"==typeof d&&(d=d(s,r)),g=new ua(a,b,0,0,g,k?2:1,null,!1,i,c,d),d+="",e&&qa.test(d+c)&&(d=[c,d],h.colorStringFilter(d),c=d[0],d=d[1]);var m,n,o,p,q,v,w,x,y,z,A,B,C,D=c.split(", ").join(",").split(" "),E=d.split(", ").join(",").split(" "),F=D.length,G=l!==!1;for(d.indexOf(",")===-1&&c.indexOf(",")===-1||(D=D.join(" ").replace(J,", ").split(" "),E=E.join(" ").replace(J,", ").split(" "),F=D.length),F!==E.length&&(D=(f||"").split(" "),F=D.length),g.plugin=j,g.setRatio=k,qa.lastIndex=0,m=0;m<F;m++)if(p=D[m],q=E[m],x=parseFloat(p),x||0===x)g.appendXtra("",x,ja(q,x),q.replace(u,""),G&&q.indexOf("px")!==-1,!0);else if(e&&qa.test(p))B=q.indexOf(")")+1,B=")"+(B?q.substr(B):""),C=q.indexOf("hsl")!==-1&&V,p=oa(p,C),q=oa(q,C),y=p.length+q.length>6,y&&!V&&0===q[3]?(g["xs"+g.l]+=g.l?" transparent":"transparent",g.e=g.e.split(E[m]).join("transparent")):(V||(y=!1),C?g.appendXtra(y?"hsla(":"hsl(",p[0],ja(q[0],p[0]),",",!1,!0).appendXtra("",p[1],ja(q[1],p[1]),"%,",!1).appendXtra("",p[2],ja(q[2],p[2]),y?"%,":"%"+B,!1):g.appendXtra(y?"rgba(":"rgb(",p[0],q[0]-p[0],",",!0,!0).appendXtra("",p[1],q[1]-p[1],",",!0).appendXtra("",p[2],q[2]-p[2],y?",":B,!0),y&&(p=p.length<4?1:p[3],g.appendXtra("",p,(q.length<4?1:q[3])-p,B,!1))),qa.lastIndex=0;else if(v=p.match(t)){if(w=q.match(u),!w||w.length!==v.length)return g;for(o=0,n=0;n<v.length;n++)A=v[n],z=p.indexOf(A,o),g.appendXtra(p.substr(o,z-o),Number(A),ja(w[n],A),"",G&&"px"===p.substr(z+A.length,2),0===n),o=z+A.length;g["xs"+g.l]+=p.substr(o)}else g["xs"+g.l]+=g.l||g["xs"+g.l]?" "+q:q;if(d.indexOf("=")!==-1&&g.data){for(B=g.xs0+g.data.s,m=1;m<g.l;m++)B+=g["xs"+m]+g.data["xn"+m];g.e=B+g["xs"+m]}return g.l||(g.type=-1,g.xs0=g.e),g.xfirst||g},xa=9;for(k=ua.prototype,k.l=k.pr=0;--xa>0;)k["xn"+xa]=0,k["xs"+xa]="";k.xs0="",k._next=k._prev=k.xfirst=k.data=k.plugin=k.setRatio=k.rxp=null,k.appendXtra=function(a,b,c,d,e,f){var g=this,h=g.l;return g["xs"+h]+=f&&(h||g["xs"+h])?" "+a:a||"",c||0===h||g.plugin?(g.l++,g.type=g.setRatio?2:1,g["xs"+g.l]=d||"",h>0?(g.data["xn"+h]=b+c,g.rxp["xn"+h]=e,g["xn"+h]=b,g.plugin||(g.xfirst=new ua(g,"xn"+h,b,c,g.xfirst||g,0,g.n,e,g.pr),g.xfirst.xs0=0),g):(g.data={s:b+c},g.rxp={},g.s=b,g.c=c,g.r=e,g)):(g["xs"+h]+=b+(d||""),g)};var ya=function(a,b){b=b||{},this.p=b.prefix?$(a)||a:a,j[a]=j[this.p]=this,this.format=b.formatter||ra(b.defaultValue,b.color,b.collapsible,b.multi),b.parser&&(this.parse=b.parser),this.clrs=b.color,this.multi=b.multi,this.keyword=b.keyword,this.dflt=b.defaultValue,this.pr=b.priority||0},za=T._registerComplexSpecialProp=function(a,b,c){"object"!=typeof b&&(b={parser:c});var d,e,f=a.split(","),g=b.defaultValue;for(c=c||[g],d=0;d<f.length;d++)b.prefix=0===d&&b.prefix,b.defaultValue=c[d]||g,e=new ya(f[d],b)},Aa=T._registerPluginProp=function(a){if(!j[a]){var b=a.charAt(0).toUpperCase()+a.substr(1)+"Plugin";za(a,{parser:function(a,c,d,e,f,g,h){var k=i.com.greensock.plugins[b];return k?(k._cssRegister(),j[d].parse(a,c,d,e,f,g,h)):(X("Error: "+b+" js file not loaded."),f)}})}};k=ya.prototype,k.parseComplex=function(a,b,c,d,e,f){var g,h,i,j,k,l,m=this.keyword;if(this.multi&&(J.test(c)||J.test(b)?(h=b.replace(J,"|").split("|"),i=c.replace(J,"|").split("|")):m&&(h=[b],i=[c])),i){for(j=i.length>h.length?i.length:h.length,g=0;g<j;g++)b=h[g]=h[g]||this.dflt,c=i[g]=i[g]||this.dflt,m&&(k=b.indexOf(m),l=c.indexOf(m),k!==l&&(l===-1?h[g]=h[g].split(m).join(""):k===-1&&(h[g]+=" "+m)));b=h.join(", "),c=i.join(", ")}return wa(a,this.p,b,c,this.clrs,this.dflt,d,this.pr,e,f)},k.parse=function(a,b,c,d,e,g,h){return this.parseComplex(a.style,this.format(aa(a,this.p,f,!1,this.dflt)),this.format(b),e,g)},h.registerSpecialProp=function(a,b,c){za(a,{parser:function(a,d,e,f,g,h,i){var j=new ua(a,e,0,0,g,2,e,!1,c);return j.plugin=h,j.setRatio=b(a,d,f._tween,e),j},priority:c})},h.useSVGTransformAttr=!0;var Ba,Ca="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),Da=$("transform"),Ea=Y+"transform",Fa=$("transformOrigin"),Ga=null!==$("perspective"),Ha=T.Transform=function(){this.perspective=parseFloat(h.defaultTransformPerspective)||0,this.force3D=!(h.defaultForce3D===!1||!Ga)&&(h.defaultForce3D||"auto")},Ia=c.SVGElement,Ja=function(a,b,c){var d,e=P.createElementNS("http://www.w3.org/2000/svg",a),f=/([a-z])([A-Z])/g;for(d in c)e.setAttributeNS(null,d.replace(f,"$1-$2").toLowerCase(),c[d]);return b.appendChild(e),e},Ka=P.documentElement||{},La=function(){var a,b,d,e=q||/Android/i.test(U)&&!c.chrome;return P.createElementNS&&!e&&(a=Ja("svg",Ka),b=Ja("rect",a,{width:100,height:50,x:100}),d=b.getBoundingClientRect().width,b.style[Fa]="50% 50%",b.style[Da]="scaleX(0.5)",e=d===b.getBoundingClientRect().width&&!(o&&Ga),Ka.removeChild(a)),e}(),Ma=function(a,b,c,d,e,f){var g,i,j,k,l,m,n,o,p,q,r,s,t,u,v=a._gsTransform,w=Ra(a,!0);v&&(t=v.xOrigin,u=v.yOrigin),(!d||(g=d.split(" ")).length<2)&&(n=a.getBBox(),0===n.x&&0===n.y&&n.width+n.height===0&&(n={x:parseFloat(a.hasAttribute("x")?a.getAttribute("x"):a.hasAttribute("cx")?a.getAttribute("cx"):0)||0,y:parseFloat(a.hasAttribute("y")?a.getAttribute("y"):a.hasAttribute("cy")?a.getAttribute("cy"):0)||0,width:0,height:0}),b=ia(b).split(" "),g=[(b[0].indexOf("%")!==-1?parseFloat(b[0])/100*n.width:parseFloat(b[0]))+n.x,(b[1].indexOf("%")!==-1?parseFloat(b[1])/100*n.height:parseFloat(b[1]))+n.y]),c.xOrigin=k=parseFloat(g[0]),c.yOrigin=l=parseFloat(g[1]),d&&w!==Qa&&(m=w[0],n=w[1],o=w[2],p=w[3],q=w[4],r=w[5],s=m*p-n*o,s&&(i=k*(p/s)+l*(-o/s)+(o*r-p*q)/s,j=k*(-n/s)+l*(m/s)-(m*r-n*q)/s,k=c.xOrigin=g[0]=i,l=c.yOrigin=g[1]=j)),v&&(f&&(c.xOffset=v.xOffset,c.yOffset=v.yOffset,v=c),e||e!==!1&&h.defaultSmoothOrigin!==!1?(i=k-t,j=l-u,v.xOffset+=i*w[0]+j*w[2]-i,v.yOffset+=i*w[1]+j*w[3]-j):v.xOffset=v.yOffset=0),f||a.setAttribute("data-svg-origin",g.join(" "))},Na=function(a){var b,c=Q("svg",this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),d=this.parentNode,e=this.nextSibling,f=this.style.cssText;if(Ka.appendChild(c),c.appendChild(this),this.style.display="block",a)try{b=this.getBBox(),this._originalGetBBox=this.getBBox,this.getBBox=Na}catch(a){}else this._originalGetBBox&&(b=this._originalGetBBox());return e?d.insertBefore(this,e):d.appendChild(this),Ka.removeChild(c),this.style.cssText=f,b},Oa=function(a){try{return a.getBBox()}catch(b){return Na.call(a,!0)}},Pa=function(a){return!(!(Ia&&a.getCTM&&Oa(a))||a.parentNode&&!a.ownerSVGElement)},Qa=[1,0,0,1,0,0],Ra=function(a,b){var c,d,e,f,g,h,i=a._gsTransform||new Ha,j=1e5,k=a.style;if(Da?d=aa(a,Ea,null,!0):a.currentStyle&&(d=a.currentStyle.filter.match(H),d=d&&4===d.length?[d[0].substr(4),Number(d[2].substr(4)),Number(d[1].substr(4)),d[3].substr(4),i.x||0,i.y||0].join(","):""),c=!d||"none"===d||"matrix(1, 0, 0, 1, 0, 0)"===d,c&&Da&&((h="none"===_(a).display)||!a.parentNode)&&(h&&(f=k.display,k.display="block"),a.parentNode||(g=1,Ka.appendChild(a)),d=aa(a,Ea,null,!0),c=!d||"none"===d||"matrix(1, 0, 0, 1, 0, 0)"===d,f?k.display=f:h&&Wa(k,"display"),g&&Ka.removeChild(a)),(i.svg||a.getCTM&&Pa(a))&&(c&&(k[Da]+"").indexOf("matrix")!==-1&&(d=k[Da],c=0),e=a.getAttribute("transform"),c&&e&&(e.indexOf("matrix")!==-1?(d=e,c=0):e.indexOf("translate")!==-1&&(d="matrix(1,0,0,1,"+e.match(/(?:\-|\b)[\d\-\.e]+\b/gi).join(",")+")",c=0))),c)return Qa;for(e=(d||"").match(t)||[],xa=e.length;--xa>-1;)f=Number(e[xa]),e[xa]=(g=f-(f|=0))?(g*j+(g<0?-.5:.5)|0)/j+f:f;return b&&e.length>6?[e[0],e[1],e[4],e[5],e[12],e[13]]:e},Sa=T.getTransform=function(a,c,d,e){if(a._gsTransform&&d&&!e)return a._gsTransform;var f,g,i,j,k,l,m=d?a._gsTransform||new Ha:new Ha,n=m.scaleX<0,o=2e-5,p=1e5,q=Ga?parseFloat(aa(a,Fa,c,!1,"0 0 0").split(" ")[2])||m.zOrigin||0:0,r=parseFloat(h.defaultTransformPerspective)||0;if(m.svg=!(!a.getCTM||!Pa(a)),m.svg&&(Ma(a,aa(a,Fa,c,!1,"50% 50%")+"",m,a.getAttribute("data-svg-origin")),Ba=h.useSVGTransformAttr||La),f=Ra(a),f!==Qa){if(16===f.length){var s,t,u,v,w,x=f[0],y=f[1],z=f[2],A=f[3],B=f[4],C=f[5],D=f[6],E=f[7],F=f[8],G=f[9],H=f[10],I=f[12],J=f[13],K=f[14],L=f[11],N=Math.atan2(D,H);m.zOrigin&&(K=-m.zOrigin,I=F*K-f[12],J=G*K-f[13],K=H*K+m.zOrigin-f[14]),m.rotationX=N*M,N&&(v=Math.cos(-N),w=Math.sin(-N),s=B*v+F*w,t=C*v+G*w,u=D*v+H*w,F=B*-w+F*v,G=C*-w+G*v,H=D*-w+H*v,L=E*-w+L*v,B=s,C=t,D=u),N=Math.atan2(-z,H),m.rotationY=N*M,N&&(v=Math.cos(-N),w=Math.sin(-N),s=x*v-F*w,t=y*v-G*w,u=z*v-H*w,G=y*w+G*v,H=z*w+H*v,L=A*w+L*v,x=s,y=t,z=u),N=Math.atan2(y,x),m.rotation=N*M,N&&(v=Math.cos(-N),w=Math.sin(-N),x=x*v+B*w,t=y*v+C*w,C=y*-w+C*v,D=z*-w+D*v,y=t),m.rotationX&&Math.abs(m.rotationX)+Math.abs(m.rotation)>359.9&&(m.rotationX=m.rotation=0,m.rotationY=180-m.rotationY),m.scaleX=(Math.sqrt(x*x+y*y)*p+.5|0)/p,m.scaleY=(Math.sqrt(C*C+G*G)*p+.5|0)/p,m.scaleZ=(Math.sqrt(D*D+H*H)*p+.5|0)/p,m.rotationX||m.rotationY?m.skewX=0:(m.skewX=B||C?Math.atan2(B,C)*M+m.rotation:m.skewX||0,Math.abs(m.skewX)>90&&Math.abs(m.skewX)<270&&(n?(m.scaleX*=-1,m.skewX+=m.rotation<=0?180:-180,m.rotation+=m.rotation<=0?180:-180):(m.scaleY*=-1,m.skewX+=m.skewX<=0?180:-180))),m.perspective=L?1/(L<0?-L:L):0,m.x=I,m.y=J,m.z=K,m.svg&&(m.x-=m.xOrigin-(m.xOrigin*x-m.yOrigin*B),m.y-=m.yOrigin-(m.yOrigin*y-m.xOrigin*C))}else if(!Ga||e||!f.length||m.x!==f[4]||m.y!==f[5]||!m.rotationX&&!m.rotationY){var O=f.length>=6,P=O?f[0]:1,Q=f[1]||0,R=f[2]||0,S=O?f[3]:1;m.x=f[4]||0,m.y=f[5]||0,i=Math.sqrt(P*P+Q*Q),j=Math.sqrt(S*S+R*R),k=P||Q?Math.atan2(Q,P)*M:m.rotation||0,l=R||S?Math.atan2(R,S)*M+k:m.skewX||0,Math.abs(l)>90&&Math.abs(l)<270&&(n?(i*=-1,l+=k<=0?180:-180,k+=k<=0?180:-180):(j*=-1,l+=l<=0?180:-180)),m.scaleX=i,m.scaleY=j,m.rotation=k,m.skewX=l,Ga&&(m.rotationX=m.rotationY=m.z=0,m.perspective=r,m.scaleZ=1),m.svg&&(m.x-=m.xOrigin-(m.xOrigin*P+m.yOrigin*R),m.y-=m.yOrigin-(m.xOrigin*Q+m.yOrigin*S))}m.zOrigin=q;for(g in m)m[g]<o&&m[g]>-o&&(m[g]=0)}return d&&(a._gsTransform=m,m.svg&&(Ba&&a.style[Da]?b.delayedCall(.001,function(){Wa(a.style,Da)}):!Ba&&a.getAttribute("transform")&&b.delayedCall(.001,function(){a.removeAttribute("transform")}))),m},Ta=function(a){var b,c,d=this.data,e=-d.rotation*L,f=e+d.skewX*L,g=1e5,h=(Math.cos(e)*d.scaleX*g|0)/g,i=(Math.sin(e)*d.scaleX*g|0)/g,j=(Math.sin(f)*-d.scaleY*g|0)/g,k=(Math.cos(f)*d.scaleY*g|0)/g,l=this.t.style,m=this.t.currentStyle;
if(m){c=i,i=-j,j=-c,b=m.filter,l.filter="";var n,o,p=this.t.offsetWidth,r=this.t.offsetHeight,s="absolute"!==m.position,t="progid:DXImageTransform.Microsoft.Matrix(M11="+h+", M12="+i+", M21="+j+", M22="+k,u=d.x+p*d.xPercent/100,v=d.y+r*d.yPercent/100;if(null!=d.ox&&(n=(d.oxp?p*d.ox*.01:d.ox)-p/2,o=(d.oyp?r*d.oy*.01:d.oy)-r/2,u+=n-(n*h+o*i),v+=o-(n*j+o*k)),s?(n=p/2,o=r/2,t+=", Dx="+(n-(n*h+o*i)+u)+", Dy="+(o-(n*j+o*k)+v)+")"):t+=", sizingMethod='auto expand')",b.indexOf("DXImageTransform.Microsoft.Matrix(")!==-1?l.filter=b.replace(I,t):l.filter=t+" "+b,0!==a&&1!==a||1===h&&0===i&&0===j&&1===k&&(s&&t.indexOf("Dx=0, Dy=0")===-1||y.test(b)&&100!==parseFloat(RegExp.$1)||b.indexOf(b.indexOf("Alpha"))===-1&&l.removeAttribute("filter")),!s){var w,z,A,B=q<8?1:-1;for(n=d.ieOffsetX||0,o=d.ieOffsetY||0,d.ieOffsetX=Math.round((p-((h<0?-h:h)*p+(i<0?-i:i)*r))/2+u),d.ieOffsetY=Math.round((r-((k<0?-k:k)*r+(j<0?-j:j)*p))/2+v),xa=0;xa<4;xa++)z=ga[xa],w=m[z],c=w.indexOf("px")!==-1?parseFloat(w):ba(this.t,z,parseFloat(w),w.replace(x,""))||0,A=c!==d[z]?xa<2?-d.ieOffsetX:-d.ieOffsetY:xa<2?n-d.ieOffsetX:o-d.ieOffsetY,l[z]=(d[z]=Math.round(c-A*(0===xa||2===xa?1:B)))+"px"}}},Ua=T.set3DTransformRatio=T.setTransformRatio=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,p,q,r,s,t,u,v,w,x,y,z=this.data,A=this.t.style,B=z.rotation,C=z.rotationX,D=z.rotationY,E=z.scaleX,F=z.scaleY,G=z.scaleZ,H=z.x,I=z.y,J=z.z,K=z.svg,M=z.perspective,N=z.force3D,O=z.skewY,P=z.skewX;if(O&&(P+=O,B+=O),((1===a||0===a)&&"auto"===N&&(this.tween._totalTime===this.tween._totalDuration||!this.tween._totalTime)||!N)&&!J&&!M&&!D&&!C&&1===G||Ba&&K||!Ga)return void(B||P||K?(B*=L,x=P*L,y=1e5,c=Math.cos(B)*E,f=Math.sin(B)*E,d=Math.sin(B-x)*-F,g=Math.cos(B-x)*F,x&&"simple"===z.skewType&&(b=Math.tan(x-O*L),b=Math.sqrt(1+b*b),d*=b,g*=b,O&&(b=Math.tan(O*L),b=Math.sqrt(1+b*b),c*=b,f*=b)),K&&(H+=z.xOrigin-(z.xOrigin*c+z.yOrigin*d)+z.xOffset,I+=z.yOrigin-(z.xOrigin*f+z.yOrigin*g)+z.yOffset,Ba&&(z.xPercent||z.yPercent)&&(q=this.t.getBBox(),H+=.01*z.xPercent*q.width,I+=.01*z.yPercent*q.height),q=1e-6,H<q&&H>-q&&(H=0),I<q&&I>-q&&(I=0)),u=(c*y|0)/y+","+(f*y|0)/y+","+(d*y|0)/y+","+(g*y|0)/y+","+H+","+I+")",K&&Ba?this.t.setAttribute("transform","matrix("+u):A[Da]=(z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) matrix(":"matrix(")+u):A[Da]=(z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) matrix(":"matrix(")+E+",0,0,"+F+","+H+","+I+")");if(o&&(q=1e-4,E<q&&E>-q&&(E=G=2e-5),F<q&&F>-q&&(F=G=2e-5),!M||z.z||z.rotationX||z.rotationY||(M=0)),B||P)B*=L,r=c=Math.cos(B),s=f=Math.sin(B),P&&(B-=P*L,r=Math.cos(B),s=Math.sin(B),"simple"===z.skewType&&(b=Math.tan((P-O)*L),b=Math.sqrt(1+b*b),r*=b,s*=b,z.skewY&&(b=Math.tan(O*L),b=Math.sqrt(1+b*b),c*=b,f*=b))),d=-s,g=r;else{if(!(D||C||1!==G||M||K))return void(A[Da]=(z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) translate3d(":"translate3d(")+H+"px,"+I+"px,"+J+"px)"+(1!==E||1!==F?" scale("+E+","+F+")":""));c=g=1,d=f=0}k=1,e=h=i=j=l=m=0,n=M?-1/M:0,p=z.zOrigin,q=1e-6,v=",",w="0",B=D*L,B&&(r=Math.cos(B),s=Math.sin(B),i=-s,l=n*-s,e=c*s,h=f*s,k=r,n*=r,c*=r,f*=r),B=C*L,B&&(r=Math.cos(B),s=Math.sin(B),b=d*r+e*s,t=g*r+h*s,j=k*s,m=n*s,e=d*-s+e*r,h=g*-s+h*r,k*=r,n*=r,d=b,g=t),1!==G&&(e*=G,h*=G,k*=G,n*=G),1!==F&&(d*=F,g*=F,j*=F,m*=F),1!==E&&(c*=E,f*=E,i*=E,l*=E),(p||K)&&(p&&(H+=e*-p,I+=h*-p,J+=k*-p+p),K&&(H+=z.xOrigin-(z.xOrigin*c+z.yOrigin*d)+z.xOffset,I+=z.yOrigin-(z.xOrigin*f+z.yOrigin*g)+z.yOffset),H<q&&H>-q&&(H=w),I<q&&I>-q&&(I=w),J<q&&J>-q&&(J=0)),u=z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) matrix3d(":"matrix3d(",u+=(c<q&&c>-q?w:c)+v+(f<q&&f>-q?w:f)+v+(i<q&&i>-q?w:i),u+=v+(l<q&&l>-q?w:l)+v+(d<q&&d>-q?w:d)+v+(g<q&&g>-q?w:g),C||D||1!==G?(u+=v+(j<q&&j>-q?w:j)+v+(m<q&&m>-q?w:m)+v+(e<q&&e>-q?w:e),u+=v+(h<q&&h>-q?w:h)+v+(k<q&&k>-q?w:k)+v+(n<q&&n>-q?w:n)+v):u+=",0,0,0,0,1,0,",u+=H+v+I+v+J+v+(M?1+-J/M:1)+")",A[Da]=u};k=Ha.prototype,k.x=k.y=k.z=k.skewX=k.skewY=k.rotation=k.rotationX=k.rotationY=k.zOrigin=k.xPercent=k.yPercent=k.xOffset=k.yOffset=0,k.scaleX=k.scaleY=k.scaleZ=1,za("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(a,b,c,d,e,g,i){if(d._lastParsedTransform===i)return e;d._lastParsedTransform=i;var j,k=i.scale&&"function"==typeof i.scale?i.scale:0;"function"==typeof i[c]&&(j=i[c],i[c]=b),k&&(i.scale=k(s,a));var l,m,n,o,p,q,t,u,v,w=a._gsTransform,x=a.style,y=1e-6,z=Ca.length,A=i,B={},C="transformOrigin",D=Sa(a,f,!0,A.parseTransform),E=A.transform&&("function"==typeof A.transform?A.transform(s,r):A.transform);if(d._transform=D,E&&"string"==typeof E&&Da)m=R.style,m[Da]=E,m.display="block",m.position="absolute",P.body.appendChild(R),l=Sa(R,null,!1),D.svg&&(q=D.xOrigin,t=D.yOrigin,l.x-=D.xOffset,l.y-=D.yOffset,(A.transformOrigin||A.svgOrigin)&&(E={},Ma(a,ia(A.transformOrigin),E,A.svgOrigin,A.smoothOrigin,!0),q=E.xOrigin,t=E.yOrigin,l.x-=E.xOffset-D.xOffset,l.y-=E.yOffset-D.yOffset),(q||t)&&(u=Ra(R,!0),l.x-=q-(q*u[0]+t*u[2]),l.y-=t-(q*u[1]+t*u[3]))),P.body.removeChild(R),l.perspective||(l.perspective=D.perspective),null!=A.xPercent&&(l.xPercent=ka(A.xPercent,D.xPercent)),null!=A.yPercent&&(l.yPercent=ka(A.yPercent,D.yPercent));else if("object"==typeof A){if(l={scaleX:ka(null!=A.scaleX?A.scaleX:A.scale,D.scaleX),scaleY:ka(null!=A.scaleY?A.scaleY:A.scale,D.scaleY),scaleZ:ka(A.scaleZ,D.scaleZ),x:ka(A.x,D.x),y:ka(A.y,D.y),z:ka(A.z,D.z),xPercent:ka(A.xPercent,D.xPercent),yPercent:ka(A.yPercent,D.yPercent),perspective:ka(A.transformPerspective,D.perspective)},p=A.directionalRotation,null!=p)if("object"==typeof p)for(m in p)A[m]=p[m];else A.rotation=p;"string"==typeof A.x&&A.x.indexOf("%")!==-1&&(l.x=0,l.xPercent=ka(A.x,D.xPercent)),"string"==typeof A.y&&A.y.indexOf("%")!==-1&&(l.y=0,l.yPercent=ka(A.y,D.yPercent)),l.rotation=la("rotation"in A?A.rotation:"shortRotation"in A?A.shortRotation+"_short":"rotationZ"in A?A.rotationZ:D.rotation,D.rotation,"rotation",B),Ga&&(l.rotationX=la("rotationX"in A?A.rotationX:"shortRotationX"in A?A.shortRotationX+"_short":D.rotationX||0,D.rotationX,"rotationX",B),l.rotationY=la("rotationY"in A?A.rotationY:"shortRotationY"in A?A.shortRotationY+"_short":D.rotationY||0,D.rotationY,"rotationY",B)),l.skewX=la(A.skewX,D.skewX),l.skewY=la(A.skewY,D.skewY)}for(Ga&&null!=A.force3D&&(D.force3D=A.force3D,o=!0),D.skewType=A.skewType||D.skewType||h.defaultSkewType,n=D.force3D||D.z||D.rotationX||D.rotationY||l.z||l.rotationX||l.rotationY||l.perspective,n||null==A.scale||(l.scaleZ=1);--z>-1;)v=Ca[z],E=l[v]-D[v],(E>y||E<-y||null!=A[v]||null!=N[v])&&(o=!0,e=new ua(D,v,D[v],E,e),v in B&&(e.e=B[v]),e.xs0=0,e.plugin=g,d._overwriteProps.push(e.n));return E=A.transformOrigin,D.svg&&(E||A.svgOrigin)&&(q=D.xOffset,t=D.yOffset,Ma(a,ia(E),l,A.svgOrigin,A.smoothOrigin),e=va(D,"xOrigin",(w?D:l).xOrigin,l.xOrigin,e,C),e=va(D,"yOrigin",(w?D:l).yOrigin,l.yOrigin,e,C),q===D.xOffset&&t===D.yOffset||(e=va(D,"xOffset",w?q:D.xOffset,D.xOffset,e,C),e=va(D,"yOffset",w?t:D.yOffset,D.yOffset,e,C)),E="0px 0px"),(E||Ga&&n&&D.zOrigin)&&(Da?(o=!0,v=Fa,E=(E||aa(a,v,f,!1,"50% 50%"))+"",e=new ua(x,v,0,0,e,-1,C),e.b=x[v],e.plugin=g,Ga?(m=D.zOrigin,E=E.split(" "),D.zOrigin=(E.length>2&&(0===m||"0px"!==E[2])?parseFloat(E[2]):m)||0,e.xs0=e.e=E[0]+" "+(E[1]||"50%")+" 0px",e=new ua(D,"zOrigin",0,0,e,-1,e.n),e.b=m,e.xs0=e.e=D.zOrigin):e.xs0=e.e=E):ia(E+"",D)),o&&(d._transformType=D.svg&&Ba||!n&&3!==this._transformType?2:3),j&&(i[c]=j),k&&(i.scale=k),e},prefix:!0}),za("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),za("borderRadius",{defaultValue:"0px",parser:function(a,b,c,d,g,h){b=this.format(b);var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],z=a.style;for(q=parseFloat(a.offsetWidth),r=parseFloat(a.offsetHeight),i=b.split(" "),j=0;j<y.length;j++)this.p.indexOf("border")&&(y[j]=$(y[j])),m=l=aa(a,y[j],f,!1,"0px"),m.indexOf(" ")!==-1&&(l=m.split(" "),m=l[0],l=l[1]),n=k=i[j],o=parseFloat(m),t=m.substr((o+"").length),u="="===n.charAt(1),u?(p=parseInt(n.charAt(0)+"1",10),n=n.substr(2),p*=parseFloat(n),s=n.substr((p+"").length-(p<0?1:0))||""):(p=parseFloat(n),s=n.substr((p+"").length)),""===s&&(s=e[c]||t),s!==t&&(v=ba(a,"borderLeft",o,t),w=ba(a,"borderTop",o,t),"%"===s?(m=v/q*100+"%",l=w/r*100+"%"):"em"===s?(x=ba(a,"borderLeft",1,"em"),m=v/x+"em",l=w/x+"em"):(m=v+"px",l=w+"px"),u&&(n=parseFloat(m)+p+s,k=parseFloat(l)+p+s)),g=wa(z,y[j],m+" "+l,n+" "+k,!1,"0px",g);return g},prefix:!0,formatter:ra("0px 0px 0px 0px",!1,!0)}),za("borderBottomLeftRadius,borderBottomRightRadius,borderTopLeftRadius,borderTopRightRadius",{defaultValue:"0px",parser:function(a,b,c,d,e,g){return wa(a.style,c,this.format(aa(a,c,f,!1,"0px 0px")),this.format(b),!1,"0px",e)},prefix:!0,formatter:ra("0px 0px",!1,!0)}),za("backgroundPosition",{defaultValue:"0 0",parser:function(a,b,c,d,e,g){var h,i,j,k,l,m,n="background-position",o=f||_(a,null),p=this.format((o?q?o.getPropertyValue(n+"-x")+" "+o.getPropertyValue(n+"-y"):o.getPropertyValue(n):a.currentStyle.backgroundPositionX+" "+a.currentStyle.backgroundPositionY)||"0 0"),r=this.format(b);if(p.indexOf("%")!==-1!=(r.indexOf("%")!==-1)&&r.split(",").length<2&&(m=aa(a,"backgroundImage").replace(E,""),m&&"none"!==m)){for(h=p.split(" "),i=r.split(" "),S.setAttribute("src",m),j=2;--j>-1;)p=h[j],k=p.indexOf("%")!==-1,k!==(i[j].indexOf("%")!==-1)&&(l=0===j?a.offsetWidth-S.width:a.offsetHeight-S.height,h[j]=k?parseFloat(p)/100*l+"px":parseFloat(p)/l*100+"%");p=h.join(" ")}return this.parseComplex(a.style,p,r,e,g)},formatter:ia}),za("backgroundSize",{defaultValue:"0 0",formatter:function(a){return a+="",ia(a.indexOf(" ")===-1?a+" "+a:a)}}),za("perspective",{defaultValue:"0px",prefix:!0}),za("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),za("transformStyle",{prefix:!0}),za("backfaceVisibility",{prefix:!0}),za("userSelect",{prefix:!0}),za("margin",{parser:sa("marginTop,marginRight,marginBottom,marginLeft")}),za("padding",{parser:sa("paddingTop,paddingRight,paddingBottom,paddingLeft")}),za("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(a,b,c,d,e,g){var h,i,j;return q<9?(i=a.currentStyle,j=q<8?" ":",",h="rect("+i.clipTop+j+i.clipRight+j+i.clipBottom+j+i.clipLeft+")",b=this.format(b).split(",").join(j)):(h=this.format(aa(a,this.p,f,!1,this.dflt)),b=this.format(b)),this.parseComplex(a.style,h,b,e,g)}}),za("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),za("autoRound,strictUnits",{parser:function(a,b,c,d,e){return e}}),za("border",{defaultValue:"0px solid #000",parser:function(a,b,c,d,e,g){var h=aa(a,"borderTopWidth",f,!1,"0px"),i=this.format(b).split(" "),j=i[0].replace(x,"");return"px"!==j&&(h=parseFloat(h)/ba(a,"borderTopWidth",1,j)+j),this.parseComplex(a.style,this.format(h+" "+aa(a,"borderTopStyle",f,!1,"solid")+" "+aa(a,"borderTopColor",f,!1,"#000")),i.join(" "),e,g)},color:!0,formatter:function(a){var b=a.split(" ");return b[0]+" "+(b[1]||"solid")+" "+(a.match(qa)||["#000"])[0]}}),za("borderWidth",{parser:sa("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),za("float,cssFloat,styleFloat",{parser:function(a,b,c,d,e,f){var g=a.style,h="cssFloat"in g?"cssFloat":"styleFloat";return new ua(g,h,0,0,e,-1,c,!1,0,g[h],b)}});var Va=function(a){var b,c=this.t,d=c.filter||aa(this.data,"filter")||"",e=this.s+this.c*a|0;100===e&&(d.indexOf("atrix(")===-1&&d.indexOf("radient(")===-1&&d.indexOf("oader(")===-1?(c.removeAttribute("filter"),b=!aa(this.data,"filter")):(c.filter=d.replace(A,""),b=!0)),b||(this.xn1&&(c.filter=d=d||"alpha(opacity="+e+")"),d.indexOf("pacity")===-1?0===e&&this.xn1||(c.filter=d+" alpha(opacity="+e+")"):c.filter=d.replace(y,"opacity="+e))};za("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(a,b,c,d,e,g){var h=parseFloat(aa(a,"opacity",f,!1,"1")),i=a.style,j="autoAlpha"===c;return"string"==typeof b&&"="===b.charAt(1)&&(b=("-"===b.charAt(0)?-1:1)*parseFloat(b.substr(2))+h),j&&1===h&&"hidden"===aa(a,"visibility",f)&&0!==b&&(h=0),V?e=new ua(i,"opacity",h,b-h,e):(e=new ua(i,"opacity",100*h,100*(b-h),e),e.xn1=j?1:0,i.zoom=1,e.type=2,e.b="alpha(opacity="+e.s+")",e.e="alpha(opacity="+(e.s+e.c)+")",e.data=a,e.plugin=g,e.setRatio=Va),j&&(e=new ua(i,"visibility",0,0,e,-1,null,!1,0,0!==h?"inherit":"hidden",0===b?"hidden":"inherit"),e.xs0="inherit",d._overwriteProps.push(e.n),d._overwriteProps.push(c)),e}});var Wa=function(a,b){b&&(a.removeProperty?("ms"!==b.substr(0,2)&&"webkit"!==b.substr(0,6)||(b="-"+b),a.removeProperty(b.replace(C,"-$1").toLowerCase())):a.removeAttribute(b))},Xa=function(a){if(this.t._gsClassPT=this,1===a||0===a){this.t.setAttribute("class",0===a?this.b:this.e);for(var b=this.data,c=this.t.style;b;)b.v?c[b.p]=b.v:Wa(c,b.p),b=b._next;1===a&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};za("className",{parser:function(a,b,c,e,g,h,i){var j,k,l,m,n,o=a.getAttribute("class")||"",p=a.style.cssText;if(g=e._classNamePT=new ua(a,c,0,0,g,2),g.setRatio=Xa,g.pr=-11,d=!0,g.b=o,k=da(a,f),l=a._gsClassPT){for(m={},n=l.data;n;)m[n.p]=1,n=n._next;l.setRatio(1)}return a._gsClassPT=g,g.e="="!==b.charAt(1)?b:o.replace(new RegExp("(?:\\s|^)"+b.substr(2)+"(?![\\w-])"),"")+("+"===b.charAt(0)?" "+b.substr(2):""),a.setAttribute("class",g.e),j=ea(a,k,da(a),i,m),a.setAttribute("class",o),g.data=j.firstMPT,a.style.cssText=p,g=g.xfirst=e.parse(a,j.difs,g,h)}});var Ya=function(a){if((1===a||0===a)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var b,c,d,e,f,g=this.t.style,h=j.transform.parse;if("all"===this.e)g.cssText="",e=!0;else for(b=this.e.split(" ").join("").split(","),d=b.length;--d>-1;)c=b[d],j[c]&&(j[c].parse===h?e=!0:c="transformOrigin"===c?Fa:j[c].p),Wa(g,c);e&&(Wa(g,Da),f=this.t._gsTransform,f&&(f.svg&&(this.t.removeAttribute("data-svg-origin"),this.t.removeAttribute("transform")),delete this.t._gsTransform))}};for(za("clearProps",{parser:function(a,b,c,e,f){return f=new ua(a,c,0,0,f,2),f.setRatio=Ya,f.e=b,f.pr=-10,f.data=e._tween,d=!0,f}}),k="bezier,throwProps,physicsProps,physics2D".split(","),xa=k.length;xa--;)Aa(k[xa]);k=h.prototype,k._firstPT=k._lastParsedTransform=k._transform=null,k._onInitTween=function(a,b,c,i){if(!a.nodeType)return!1;this._target=r=a,this._tween=c,this._vars=b,s=i,l=b.autoRound,d=!1,e=b.suffixMap||h.suffixMap,f=_(a,""),g=this._overwriteProps;var k,o,q,t,u,v,w,x,y,A=a.style;if(m&&""===A.zIndex&&(k=aa(a,"zIndex",f),"auto"!==k&&""!==k||this._addLazySet(A,"zIndex",0)),"string"==typeof b&&(t=A.cssText,k=da(a,f),A.cssText=t+";"+b,k=ea(a,k,da(a)).difs,!V&&z.test(b)&&(k.opacity=parseFloat(RegExp.$1)),b=k,A.cssText=t),b.className?this._firstPT=o=j.className.parse(a,b.className,"className",this,null,null,b):this._firstPT=o=this.parse(a,b,null),this._transformType){for(y=3===this._transformType,Da?n&&(m=!0,""===A.zIndex&&(w=aa(a,"zIndex",f),"auto"!==w&&""!==w||this._addLazySet(A,"zIndex",0)),p&&this._addLazySet(A,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(y?"visible":"hidden"))):A.zoom=1,q=o;q&&q._next;)q=q._next;x=new ua(a,"transform",0,0,null,2),this._linkCSSP(x,null,q),x.setRatio=Da?Ua:Ta,x.data=this._transform||Sa(a,f,!0),x.tween=c,x.pr=-1,g.pop()}if(d){for(;o;){for(v=o._next,q=t;q&&q.pr>o.pr;)q=q._next;(o._prev=q?q._prev:u)?o._prev._next=o:t=o,(o._next=q)?q._prev=o:u=o,o=v}this._firstPT=t}return!0},k.parse=function(a,b,c,d){var g,h,i,k,m,n,o,p,q,t,u=a.style;for(g in b)n=b[g],"function"==typeof n&&(n=n(s,r)),h=j[g],h?c=h.parse(a,n,g,this,c,d,b):(m=aa(a,g,f)+"",q="string"==typeof n,"color"===g||"fill"===g||"stroke"===g||g.indexOf("Color")!==-1||q&&B.test(n)?(q||(n=oa(n),n=(n.length>3?"rgba(":"rgb(")+n.join(",")+")"),c=wa(u,g,m,n,!0,"transparent",c,0,d)):q&&K.test(n)?c=wa(u,g,m,n,!0,null,c,0,d):(i=parseFloat(m),o=i||0===i?m.substr((i+"").length):"",""!==m&&"auto"!==m||("width"===g||"height"===g?(i=ha(a,g,f),o="px"):"left"===g||"top"===g?(i=ca(a,g,f),o="px"):(i="opacity"!==g?0:1,o="")),t=q&&"="===n.charAt(1),t?(k=parseInt(n.charAt(0)+"1",10),n=n.substr(2),k*=parseFloat(n),p=n.replace(x,"")):(k=parseFloat(n),p=q?n.replace(x,""):""),""===p&&(p=g in e?e[g]:o),n=k||0===k?(t?k+i:k)+p:b[g],o!==p&&""!==p&&(k||0===k)&&i&&(i=ba(a,g,i,o),"%"===p?(i/=ba(a,g,100,"%")/100,b.strictUnits!==!0&&(m=i+"%")):"em"===p||"rem"===p||"vw"===p||"vh"===p?i/=ba(a,g,1,p):"px"!==p&&(k=ba(a,g,k,p),p="px"),t&&(k||0===k)&&(n=k+i+p)),t&&(k+=i),!i&&0!==i||!k&&0!==k?void 0!==u[g]&&(n||n+""!="NaN"&&null!=n)?(c=new ua(u,g,k||i||0,0,c,-1,g,!1,0,m,n),c.xs0="none"!==n||"display"!==g&&g.indexOf("Style")===-1?n:m):X("invalid "+g+" tween value: "+b[g]):(c=new ua(u,g,i,k-i,c,0,g,l!==!1&&("px"===p||"zIndex"===g),0,m,n),c.xs0=p))),d&&c&&!c.plugin&&(c.plugin=d);return c},k.setRatio=function(a){var b,c,d,e=this._firstPT,f=1e-6;if(1!==a||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(a||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;e;){if(b=e.c*a+e.s,e.r?b=Math.round(b):b<f&&b>-f&&(b=0),e.type)if(1===e.type)if(d=e.l,2===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2;else if(3===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3;else if(4===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3+e.xn3+e.xs4;else if(5===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3+e.xn3+e.xs4+e.xn4+e.xs5;else{for(c=e.xs0+b+e.xs1,d=1;d<e.l;d++)c+=e["xn"+d]+e["xs"+(d+1)];e.t[e.p]=c}else e.type===-1?e.t[e.p]=e.xs0:e.setRatio&&e.setRatio(a);else e.t[e.p]=b+e.xs0;e=e._next}else for(;e;)2!==e.type?e.t[e.p]=e.b:e.setRatio(a),e=e._next;else for(;e;){if(2!==e.type)if(e.r&&e.type!==-1)if(b=Math.round(e.s+e.c),e.type){if(1===e.type){for(d=e.l,c=e.xs0+b+e.xs1,d=1;d<e.l;d++)c+=e["xn"+d]+e["xs"+(d+1)];e.t[e.p]=c}}else e.t[e.p]=b+e.xs0;else e.t[e.p]=e.e;else e.setRatio(a);e=e._next}},k._enableTransforms=function(a){this._transform=this._transform||Sa(this._target,f,!0),this._transformType=this._transform.svg&&Ba||!a&&3!==this._transformType?2:3};var Za=function(a){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};k._addLazySet=function(a,b,c){var d=this._firstPT=new ua(a,b,0,0,this._firstPT,2);d.e=c,d.setRatio=Za,d.data=this},k._linkCSSP=function(a,b,c,d){return a&&(b&&(b._prev=a),a._next&&(a._next._prev=a._prev),a._prev?a._prev._next=a._next:this._firstPT===a&&(this._firstPT=a._next,d=!0),c?c._next=a:d||null!==this._firstPT||(this._firstPT=a),a._next=b,a._prev=c),a},k._mod=function(a){for(var b=this._firstPT;b;)"function"==typeof a[b.p]&&a[b.p]===Math.round&&(b.r=1),b=b._next},k._kill=function(b){var c,d,e,f=b;if(b.autoAlpha||b.alpha){f={};for(d in b)f[d]=b[d];f.opacity=1,f.autoAlpha&&(f.visibility=1)}for(b.className&&(c=this._classNamePT)&&(e=c.xfirst,e&&e._prev?this._linkCSSP(e._prev,c._next,e._prev._prev):e===this._firstPT&&(this._firstPT=c._next),c._next&&this._linkCSSP(c._next,c._next._next,e._prev),this._classNamePT=null),c=this._firstPT;c;)c.plugin&&c.plugin!==d&&c.plugin._kill&&(c.plugin._kill(b),d=c.plugin),c=c._next;return a.prototype._kill.call(this,f)};var $a=function(a,b,c){var d,e,f,g;if(a.slice)for(e=a.length;--e>-1;)$a(a[e],b,c);else for(d=a.childNodes,e=d.length;--e>-1;)f=d[e],g=f.type,f.style&&(b.push(da(f)),c&&c.push(f)),1!==g&&9!==g&&11!==g||!f.childNodes.length||$a(f,b,c)};return h.cascadeTo=function(a,c,d){var e,f,g,h,i=b.to(a,c,d),j=[i],k=[],l=[],m=[],n=b._internals.reservedProps;for(a=i._targets||i.target,$a(a,k,m),i.render(c,!0,!0),$a(a,l),i.render(0,!0,!0),i._enabled(!0),e=m.length;--e>-1;)if(f=ea(m[e],k[e],l[e]),f.firstMPT){f=f.difs;for(g in d)n[g]&&(f[g]=d[g]);h={};for(g in f)h[g]=k[e][g];j.push(b.fromTo(m[e],c,h,f))}return j},a.activate([h]),h},!0),function(){var a=c._gsDefine.plugin({propName:"roundProps",version:"1.6.0",priority:-1,API:2,init:function(a,b,c){return this._tween=c,!0}}),b=function(a){for(;a;)a.f||a.blob||(a.m=Math.round),a=a._next},d=a.prototype;d._onInitAllProps=function(){for(var a,c,d,e=this._tween,f=e.vars.roundProps.join?e.vars.roundProps:e.vars.roundProps.split(","),g=f.length,h={},i=e._propLookup.roundProps;--g>-1;)h[f[g]]=Math.round;for(g=f.length;--g>-1;)for(a=f[g],c=e._firstPT;c;)d=c._next,c.pg?c.t._mod(h):c.n===a&&(2===c.f&&c.t?b(c.t._firstPT):(this._add(c.t,a,c.s,c.c),d&&(d._prev=c._prev),c._prev?c._prev._next=d:e._firstPT===c&&(e._firstPT=d),c._next=c._prev=null,e._propLookup[a]=i)),c=d;return!1},d._add=function(a,b,c,d){this._addTween(a,b,c,c+d,b,Math.round),this._overwriteProps.push(b)}}(),function(){c._gsDefine.plugin({propName:"attr",API:2,version:"0.6.0",init:function(a,b,c,d){var e,f;if("function"!=typeof a.setAttribute)return!1;for(e in b)f=b[e],"function"==typeof f&&(f=f(d,a)),this._addTween(a,"setAttribute",a.getAttribute(e)+"",f+"",e,!1,e),this._overwriteProps.push(e);return!0}})}(),c._gsDefine.plugin({propName:"directionalRotation",version:"0.3.0",API:2,init:function(a,b,c,d){"object"!=typeof b&&(b={rotation:b}),this.finals={};var e,f,g,h,i,j,k=b.useRadians===!0?2*Math.PI:360,l=1e-6;for(e in b)"useRadians"!==e&&(h=b[e],"function"==typeof h&&(h=h(d,a)),j=(h+"").split("_"),f=j[0],g=parseFloat("function"!=typeof a[e]?a[e]:a[e.indexOf("set")||"function"!=typeof a["get"+e.substr(3)]?e:"get"+e.substr(3)]()),h=this.finals[e]="string"==typeof f&&"="===f.charAt(1)?g+parseInt(f.charAt(0)+"1",10)*Number(f.substr(2)):Number(f)||0,i=h-g,j.length&&(f=j.join("_"),f.indexOf("short")!==-1&&(i%=k,i!==i%(k/2)&&(i=i<0?i+k:i-k)),f.indexOf("_cw")!==-1&&i<0?i=(i+9999999999*k)%k-(i/k|0)*k:f.indexOf("ccw")!==-1&&i>0&&(i=(i-9999999999*k)%k-(i/k|0)*k)),(i>l||i<-l)&&(this._addTween(a,e,g,g+i,e),this._overwriteProps.push(e)));return!0},set:function(a){var b;if(1!==a)this._super.setRatio.call(this,a);else for(b=this._firstPT;b;)b.f?b.t[b.p](this.finals[b.p]):b.t[b.p]=this.finals[b.p],b=b._next}})._autoCSS=!0,c._gsDefine("easing.Back",["easing.Ease"],function(a){var b,d,e,f=c.GreenSockGlobals||c,g=f.com.greensock,h=2*Math.PI,i=Math.PI/2,j=g._class,k=function(b,c){var d=j("easing."+b,function(){},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,d},l=a.register||function(){},m=function(a,b,c,d,e){var f=j("easing."+a,{easeOut:new b,easeIn:new c,easeInOut:new d},!0);return l(f,a),f},n=function(a,b,c){this.t=a,this.v=b,c&&(this.next=c,c.prev=this,this.c=c.v-b,this.gap=c.t-a)},o=function(b,c){var d=j("easing."+b,function(a){this._p1=a||0===a?a:1.70158,this._p2=1.525*this._p1},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,e.config=function(a){return new d(a)},d},p=m("Back",o("BackOut",function(a){return(a-=1)*a*((this._p1+1)*a+this._p1)+1}),o("BackIn",function(a){return a*a*((this._p1+1)*a-this._p1)}),o("BackInOut",function(a){return(a*=2)<1?.5*a*a*((this._p2+1)*a-this._p2):.5*((a-=2)*a*((this._p2+1)*a+this._p2)+2)})),q=j("easing.SlowMo",function(a,b,c){b=b||0===b?b:.7,null==a?a=.7:a>1&&(a=1),this._p=1!==a?b:0,this._p1=(1-a)/2,this._p2=a,this._p3=this._p1+this._p2,this._calcEnd=c===!0},!0),r=q.prototype=new a;return r.constructor=q,r.getRatio=function(a){var b=a+(.5-a)*this._p;return a<this._p1?this._calcEnd?1-(a=1-a/this._p1)*a:b-(a=1-a/this._p1)*a*a*a*b:a>this._p3?this._calcEnd?1-(a=(a-this._p3)/this._p1)*a:b+(a-b)*(a=(a-this._p3)/this._p1)*a*a*a:this._calcEnd?1:b},q.ease=new q(.7,.7),r.config=q.config=function(a,b,c){return new q(a,b,c)},b=j("easing.SteppedEase",function(a){a=a||1,this._p1=1/a,this._p2=a+1},!0),r=b.prototype=new a,r.constructor=b,r.getRatio=function(a){return a<0?a=0:a>=1&&(a=.999999999),(this._p2*a>>0)*this._p1},r.config=b.config=function(a){return new b(a)},d=j("easing.RoughEase",function(b){b=b||{};for(var c,d,e,f,g,h,i=b.taper||"none",j=[],k=0,l=0|(b.points||20),m=l,o=b.randomize!==!1,p=b.clamp===!0,q=b.template instanceof a?b.template:null,r="number"==typeof b.strength?.4*b.strength:.4;--m>-1;)c=o?Math.random():1/l*m,d=q?q.getRatio(c):c,"none"===i?e=r:"out"===i?(f=1-c,e=f*f*r):"in"===i?e=c*c*r:c<.5?(f=2*c,e=f*f*.5*r):(f=2*(1-c),e=f*f*.5*r),o?d+=Math.random()*e-.5*e:m%2?d+=.5*e:d-=.5*e,p&&(d>1?d=1:d<0&&(d=0)),j[k++]={x:c,y:d};for(j.sort(function(a,b){return a.x-b.x}),h=new n(1,1,null),m=l;--m>-1;)g=j[m],h=new n(g.x,g.y,h);this._prev=new n(0,0,0!==h.t?h:h.next)},!0),r=d.prototype=new a,r.constructor=d,r.getRatio=function(a){var b=this._prev;if(a>b.t){for(;b.next&&a>=b.t;)b=b.next;b=b.prev}else for(;b.prev&&a<=b.t;)b=b.prev;return this._prev=b,b.v+(a-b.t)/b.gap*b.c},r.config=function(a){return new d(a)},d.ease=new d,m("Bounce",k("BounceOut",function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}),k("BounceIn",function(a){return(a=1-a)<1/2.75?1-7.5625*a*a:a<2/2.75?1-(7.5625*(a-=1.5/2.75)*a+.75):a<2.5/2.75?1-(7.5625*(a-=2.25/2.75)*a+.9375):1-(7.5625*(a-=2.625/2.75)*a+.984375)}),k("BounceInOut",function(a){var b=a<.5;return a=b?1-2*a:2*a-1,a<1/2.75?a*=7.5625*a:a=a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375,b?.5*(1-a):.5*a+.5})),m("Circ",k("CircOut",function(a){return Math.sqrt(1-(a-=1)*a)}),k("CircIn",function(a){return-(Math.sqrt(1-a*a)-1)}),k("CircInOut",function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)})),e=function(b,c,d){var e=j("easing."+b,function(a,b){this._p1=a>=1?a:1,this._p2=(b||d)/(a<1?a:1),this._p3=this._p2/h*(Math.asin(1/this._p1)||0),this._p2=h/this._p2},!0),f=e.prototype=new a;return f.constructor=e,f.getRatio=c,f.config=function(a,b){return new e(a,b)},e},m("Elastic",e("ElasticOut",function(a){return this._p1*Math.pow(2,-10*a)*Math.sin((a-this._p3)*this._p2)+1},.3),e("ElasticIn",function(a){return-(this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*this._p2))},.3),e("ElasticInOut",function(a){return(a*=2)<1?-.5*(this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*this._p2)):this._p1*Math.pow(2,-10*(a-=1))*Math.sin((a-this._p3)*this._p2)*.5+1},.45)),m("Expo",k("ExpoOut",function(a){return 1-Math.pow(2,-10*a)}),k("ExpoIn",function(a){return Math.pow(2,10*(a-1))-.001}),k("ExpoInOut",function(a){return(a*=2)<1?.5*Math.pow(2,10*(a-1)):.5*(2-Math.pow(2,-10*(a-1)))})),m("Sine",k("SineOut",function(a){return Math.sin(a*i)}),k("SineIn",function(a){return-Math.cos(a*i)+1}),k("SineInOut",function(a){return-.5*(Math.cos(Math.PI*a)-1)})),j("easing.EaseLookup",{find:function(b){return a.map[b]}},!0),l(f.SlowMo,"SlowMo","ease,"),l(d,"RoughEase","ease,"),l(b,"SteppedEase","ease,"),p},!0)}),c._gsDefine&&c._gsQueue.pop()(),function(a,c){"use strict";var d={},e=a.document,f=a.GreenSockGlobals=a.GreenSockGlobals||a;if(!f.TweenLite){var g,h,i,j,k,l=function(a){var b,c=a.split("."),d=f;for(b=0;b<c.length;b++)d[c[b]]=d=d[c[b]]||{};return d},m=l("com.greensock"),n=1e-10,o=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},p=function(){},q=function(){var a=Object.prototype.toString,b=a.call([]);return function(c){return null!=c&&(c instanceof Array||"object"==typeof c&&!!c.push&&a.call(c)===b)}}(),r={},s=function(e,g,h,i){this.sc=r[e]?r[e].sc:[],r[e]=this,this.gsClass=null,this.func=h;var j=[];this.check=function(k){for(var m,n,o,p,q,t=g.length,u=t;--t>-1;)(m=r[g[t]]||new s(g[t],[])).gsClass?(j[t]=m.gsClass,u--):k&&m.sc.push(this);if(0===u&&h){if(n=("com.greensock."+e).split("."),o=n.pop(),p=l(n.join("."))[o]=this.gsClass=h.apply(h,j),i)if(f[o]=d[o]=p,q="undefined"!=typeof b&&b.exports,!q&&"function"==typeof define&&define.amd)define((a.GreenSockAMDPath?a.GreenSockAMDPath+"/":"")+e.split(".").pop(),[],function(){return p});else if(q)if(e===c){b.exports=d[c]=p;for(t in d)p[t]=d[t]}else d[c]&&(d[c][o]=p);for(t=0;t<this.sc.length;t++)this.sc[t].check()}},this.check(!0)},t=a._gsDefine=function(a,b,c,d){return new s(a,b,c,d)},u=m._class=function(a,b,c){return b=b||function(){},t(a,[],function(){return b},c),b};t.globals=f;var v=[0,0,1,1],w=u("easing.Ease",function(a,b,c,d){this._func=a,this._type=c||0,this._power=d||0,this._params=b?v.concat(b):v},!0),x=w.map={},y=w.register=function(a,b,c,d){for(var e,f,g,h,i=b.split(","),j=i.length,k=(c||"easeIn,easeOut,easeInOut").split(",");--j>-1;)for(f=i[j],e=d?u("easing."+f,null,!0):m.easing[f]||{},g=k.length;--g>-1;)h=k[g],x[f+"."+h]=x[h+f]=e[h]=a.getRatio?a:a[h]||new a};for(i=w.prototype,i._calcEnd=!1,i.getRatio=function(a){if(this._func)return this._params[0]=a,this._func.apply(null,this._params);var b=this._type,c=this._power,d=1===b?1-a:2===b?a:a<.5?2*a:2*(1-a);return 1===c?d*=d:2===c?d*=d*d:3===c?d*=d*d*d:4===c&&(d*=d*d*d*d),1===b?1-d:2===b?d:a<.5?d/2:1-d/2},g=["Linear","Quad","Cubic","Quart","Quint,Strong"],h=g.length;--h>-1;)i=g[h]+",Power"+h,y(new w(null,null,1,h),i,"easeOut",!0),y(new w(null,null,2,h),i,"easeIn"+(0===h?",easeNone":"")),y(new w(null,null,3,h),i,"easeInOut");x.linear=m.easing.Linear.easeIn,x.swing=m.easing.Quad.easeInOut;var z=u("events.EventDispatcher",function(a){this._listeners={},this._eventTarget=a||this});i=z.prototype,i.addEventListener=function(a,b,c,d,e){e=e||0;var f,g,h=this._listeners[a],i=0;for(this!==j||k||j.wake(),null==h&&(this._listeners[a]=h=[]),g=h.length;--g>-1;)f=h[g],f.c===b&&f.s===c?h.splice(g,1):0===i&&f.pr<e&&(i=g+1);h.splice(i,0,{c:b,s:c,up:d,pr:e})},i.removeEventListener=function(a,b){var c,d=this._listeners[a];if(d)for(c=d.length;--c>-1;)if(d[c].c===b)return void d.splice(c,1)},i.dispatchEvent=function(a){var b,c,d,e=this._listeners[a];if(e)for(b=e.length,b>1&&(e=e.slice(0)),c=this._eventTarget;--b>-1;)d=e[b],d&&(d.up?d.c.call(d.s||c,{type:a,target:c}):d.c.call(d.s||c))};var A=a.requestAnimationFrame,B=a.cancelAnimationFrame,C=Date.now||function(){return(new Date).getTime()},D=C();for(g=["ms","moz","webkit","o"],h=g.length;--h>-1&&!A;)A=a[g[h]+"RequestAnimationFrame"],B=a[g[h]+"CancelAnimationFrame"]||a[g[h]+"CancelRequestAnimationFrame"];u("Ticker",function(a,b){var c,d,f,g,h,i=this,l=C(),m=!(b===!1||!A)&&"auto",o=500,q=33,r="tick",s=function(a){var b,e,j=C()-D;j>o&&(l+=j-q),D+=j,i.time=(D-l)/1e3,b=i.time-h,(!c||b>0||a===!0)&&(i.frame++,h+=b+(b>=g?.004:g-b),e=!0),a!==!0&&(f=d(s)),e&&i.dispatchEvent(r)};z.call(i),i.time=i.frame=0,i.tick=function(){s(!0)},i.lagSmoothing=function(a,b){o=a||1/n,q=Math.min(b,o,0)},i.sleep=function(){null!=f&&(m&&B?B(f):clearTimeout(f),d=p,f=null,i===j&&(k=!1))},i.wake=function(a){null!==f?i.sleep():a?l+=-D+(D=C()):i.frame>10&&(D=C()-o+5),d=0===c?p:m&&A?A:function(a){return setTimeout(a,1e3*(h-i.time)+1|0)},i===j&&(k=!0),s(2)},i.fps=function(a){return arguments.length?(c=a,g=1/(c||60),h=this.time+g,void i.wake()):c},i.useRAF=function(a){return arguments.length?(i.sleep(),m=a,void i.fps(c)):m},i.fps(a),setTimeout(function(){"auto"===m&&i.frame<5&&"hidden"!==e.visibilityState&&i.useRAF(!1)},1500)}),i=m.Ticker.prototype=new m.events.EventDispatcher,i.constructor=m.Ticker;var E=u("core.Animation",function(a,b){if(this.vars=b=b||{},this._duration=this._totalDuration=a||0,this._delay=Number(b.delay)||0,this._timeScale=1,this._active=b.immediateRender===!0,this.data=b.data,this._reversed=b.reversed===!0,X){k||j.wake();var c=this.vars.useFrames?W:X;c.add(this,c._time),this.vars.paused&&this.paused(!0)}});j=E.ticker=new m.Ticker,i=E.prototype,i._dirty=i._gc=i._initted=i._paused=!1,i._totalTime=i._time=0,i._rawPrevTime=-1,i._next=i._last=i._onUpdate=i._timeline=i.timeline=null,i._paused=!1;var F=function(){k&&C()-D>2e3&&j.wake(),setTimeout(F,2e3)};F(),i.play=function(a,b){return null!=a&&this.seek(a,b),this.reversed(!1).paused(!1)},i.pause=function(a,b){return null!=a&&this.seek(a,b),this.paused(!0)},i.resume=function(a,b){return null!=a&&this.seek(a,b),this.paused(!1)},i.seek=function(a,b){return this.totalTime(Number(a),b!==!1)},i.restart=function(a,b){return this.reversed(!1).paused(!1).totalTime(a?-this._delay:0,b!==!1,!0)},i.reverse=function(a,b){return null!=a&&this.seek(a||this.totalDuration(),b),this.reversed(!0).paused(!1)},i.render=function(a,b,c){},i.invalidate=function(){return this._time=this._totalTime=0,
this._initted=this._gc=!1,this._rawPrevTime=-1,!this._gc&&this.timeline||this._enabled(!0),this},i.isActive=function(){var a,b=this._timeline,c=this._startTime;return!b||!this._gc&&!this._paused&&b.isActive()&&(a=b.rawTime(!0))>=c&&a<c+this.totalDuration()/this._timeScale},i._enabled=function(a,b){return k||j.wake(),this._gc=!a,this._active=this.isActive(),b!==!0&&(a&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!a&&this.timeline&&this._timeline._remove(this,!0)),!1},i._kill=function(a,b){return this._enabled(!1,!1)},i.kill=function(a,b){return this._kill(a,b),this},i._uncache=function(a){for(var b=a?this:this.timeline;b;)b._dirty=!0,b=b.timeline;return this},i._swapSelfInParams=function(a){for(var b=a.length,c=a.concat();--b>-1;)"{self}"===a[b]&&(c[b]=this);return c},i._callback=function(a){var b=this.vars,c=b[a],d=b[a+"Params"],e=b[a+"Scope"]||b.callbackScope||this,f=d?d.length:0;switch(f){case 0:c.call(e);break;case 1:c.call(e,d[0]);break;case 2:c.call(e,d[0],d[1]);break;default:c.apply(e,d)}},i.eventCallback=function(a,b,c,d){if("on"===(a||"").substr(0,2)){var e=this.vars;if(1===arguments.length)return e[a];null==b?delete e[a]:(e[a]=b,e[a+"Params"]=q(c)&&c.join("").indexOf("{self}")!==-1?this._swapSelfInParams(c):c,e[a+"Scope"]=d),"onUpdate"===a&&(this._onUpdate=b)}return this},i.delay=function(a){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+a-this._delay),this._delay=a,this):this._delay},i.duration=function(a){return arguments.length?(this._duration=this._totalDuration=a,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==a&&this.totalTime(this._totalTime*(a/this._duration),!0),this):(this._dirty=!1,this._duration)},i.totalDuration=function(a){return this._dirty=!1,arguments.length?this.duration(a):this._totalDuration},i.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(a>this._duration?this._duration:a,b)):this._time},i.totalTime=function(a,b,c){if(k||j.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(a<0&&!c&&(a+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var d=this._totalDuration,e=this._timeline;if(a>d&&!c&&(a=d),this._startTime=(this._paused?this._pauseTime:e._time)-(this._reversed?d-a:a)/this._timeScale,e._dirty||this._uncache(!1),e._timeline)for(;e._timeline;)e._timeline._time!==(e._startTime+e._totalTime)/e._timeScale&&e.totalTime(e._totalTime,!0),e=e._timeline}this._gc&&this._enabled(!0,!1),this._totalTime===a&&0!==this._duration||(K.length&&Z(),this.render(a,b,!1),K.length&&Z())}return this},i.progress=i.totalProgress=function(a,b){var c=this.duration();return arguments.length?this.totalTime(c*a,b):c?this._time/c:this.ratio},i.startTime=function(a){return arguments.length?(a!==this._startTime&&(this._startTime=a,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,a-this._delay)),this):this._startTime},i.endTime=function(a){return this._startTime+(0!=a?this.totalDuration():this.duration())/this._timeScale},i.timeScale=function(a){if(!arguments.length)return this._timeScale;if(a=a||n,this._timeline&&this._timeline.smoothChildTiming){var b=this._pauseTime,c=b||0===b?b:this._timeline.totalTime();this._startTime=c-(c-this._startTime)*this._timeScale/a}return this._timeScale=a,this._uncache(!1)},i.reversed=function(a){return arguments.length?(a!=this._reversed&&(this._reversed=a,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},i.paused=function(a){if(!arguments.length)return this._paused;var b,c,d=this._timeline;return a!=this._paused&&d&&(k||a||j.wake(),b=d.rawTime(),c=b-this._pauseTime,!a&&d.smoothChildTiming&&(this._startTime+=c,this._uncache(!1)),this._pauseTime=a?b:null,this._paused=a,this._active=this.isActive(),!a&&0!==c&&this._initted&&this.duration()&&(b=d.smoothChildTiming?this._totalTime:(b-this._startTime)/this._timeScale,this.render(b,b===this._totalTime,!0))),this._gc&&!a&&this._enabled(!0,!1),this};var G=u("core.SimpleTimeline",function(a){E.call(this,0,a),this.autoRemoveChildren=this.smoothChildTiming=!0});i=G.prototype=new E,i.constructor=G,i.kill()._gc=!1,i._first=i._last=i._recent=null,i._sortChildren=!1,i.add=i.insert=function(a,b,c,d){var e,f;if(a._startTime=Number(b||0)+a._delay,a._paused&&this!==a._timeline&&(a._pauseTime=a._startTime+(this.rawTime()-a._startTime)/a._timeScale),a.timeline&&a.timeline._remove(a,!0),a.timeline=a._timeline=this,a._gc&&a._enabled(!0,!0),e=this._last,this._sortChildren)for(f=a._startTime;e&&e._startTime>f;)e=e._prev;return e?(a._next=e._next,e._next=a):(a._next=this._first,this._first=a),a._next?a._next._prev=a:this._last=a,a._prev=e,this._recent=a,this._timeline&&this._uncache(!0),this},i._remove=function(a,b){return a.timeline===this&&(b||a._enabled(!1,!0),a._prev?a._prev._next=a._next:this._first===a&&(this._first=a._next),a._next?a._next._prev=a._prev:this._last===a&&(this._last=a._prev),a._next=a._prev=a.timeline=null,a===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},i.render=function(a,b,c){var d,e=this._first;for(this._totalTime=this._time=this._rawPrevTime=a;e;)d=e._next,(e._active||a>=e._startTime&&!e._paused)&&(e._reversed?e.render((e._dirty?e.totalDuration():e._totalDuration)-(a-e._startTime)*e._timeScale,b,c):e.render((a-e._startTime)*e._timeScale,b,c)),e=d},i.rawTime=function(){return k||j.wake(),this._totalTime};var H=u("TweenLite",function(b,c,d){if(E.call(this,c,d),this.render=H.prototype.render,null==b)throw"Cannot tween a null target.";this.target=b="string"!=typeof b?b:H.selector(b)||b;var e,f,g,h=b.jquery||b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType),i=this.vars.overwrite;if(this._overwrite=i=null==i?V[H.defaultOverwrite]:"number"==typeof i?i>>0:V[i],(h||b instanceof Array||b.push&&q(b))&&"number"!=typeof b[0])for(this._targets=g=o(b),this._propLookup=[],this._siblings=[],e=0;e<g.length;e++)f=g[e],f?"string"!=typeof f?f.length&&f!==a&&f[0]&&(f[0]===a||f[0].nodeType&&f[0].style&&!f.nodeType)?(g.splice(e--,1),this._targets=g=g.concat(o(f))):(this._siblings[e]=$(f,this,!1),1===i&&this._siblings[e].length>1&&aa(f,this,null,1,this._siblings[e])):(f=g[e--]=H.selector(f),"string"==typeof f&&g.splice(e+1,1)):g.splice(e--,1);else this._propLookup={},this._siblings=$(b,this,!1),1===i&&this._siblings.length>1&&aa(b,this,null,1,this._siblings);(this.vars.immediateRender||0===c&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-n,this.render(Math.min(0,-this._delay)))},!0),I=function(b){return b&&b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType)},J=function(a,b){var c,d={};for(c in a)U[c]||c in b&&"transform"!==c&&"x"!==c&&"y"!==c&&"width"!==c&&"height"!==c&&"className"!==c&&"border"!==c||!(!R[c]||R[c]&&R[c]._autoCSS)||(d[c]=a[c],delete a[c]);a.css=d};i=H.prototype=new E,i.constructor=H,i.kill()._gc=!1,i.ratio=0,i._firstPT=i._targets=i._overwrittenProps=i._startAt=null,i._notifyPluginsOfEnabled=i._lazy=!1,H.version="1.19.1",H.defaultEase=i._ease=new w(null,null,1,1),H.defaultOverwrite="auto",H.ticker=j,H.autoSleep=120,H.lagSmoothing=function(a,b){j.lagSmoothing(a,b)},H.selector=a.$||a.jQuery||function(b){var c=a.$||a.jQuery;return c?(H.selector=c,c(b)):"undefined"==typeof e?b:e.querySelectorAll?e.querySelectorAll(b):e.getElementById("#"===b.charAt(0)?b.substr(1):b)};var K=[],L={},M=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,N=function(a){for(var b,c=this._firstPT,d=1e-6;c;)b=c.blob?1===a?this.end:a?this.join(""):this.start:c.c*a+c.s,c.m?b=c.m(b,this._target||c.t):b<d&&b>-d&&!c.blob&&(b=0),c.f?c.fp?c.t[c.p](c.fp,b):c.t[c.p](b):c.t[c.p]=b,c=c._next},O=function(a,b,c,d){var e,f,g,h,i,j,k,l=[],m=0,n="",o=0;for(l.start=a,l.end=b,a=l[0]=a+"",b=l[1]=b+"",c&&(c(l),a=l[0],b=l[1]),l.length=0,e=a.match(M)||[],f=b.match(M)||[],d&&(d._next=null,d.blob=1,l._firstPT=l._applyPT=d),i=f.length,h=0;h<i;h++)k=f[h],j=b.substr(m,b.indexOf(k,m)-m),n+=j||!h?j:",",m+=j.length,o?o=(o+1)%5:"rgba("===j.substr(-5)&&(o=1),k===e[h]||e.length<=h?n+=k:(n&&(l.push(n),n=""),g=parseFloat(e[h]),l.push(g),l._firstPT={_next:l._firstPT,t:l,p:l.length-1,s:g,c:("="===k.charAt(1)?parseInt(k.charAt(0)+"1",10)*parseFloat(k.substr(2)):parseFloat(k)-g)||0,f:0,m:o&&o<4?Math.round:0}),m+=k.length;return n+=b.substr(m),n&&l.push(n),l.setRatio=N,l},P=function(a,b,c,d,e,f,g,h,i){"function"==typeof d&&(d=d(i||0,a));var j,k=typeof a[b],l="function"!==k?"":b.indexOf("set")||"function"!=typeof a["get"+b.substr(3)]?b:"get"+b.substr(3),m="get"!==c?c:l?g?a[l](g):a[l]():a[b],n="string"==typeof d&&"="===d.charAt(1),o={t:a,p:b,s:m,f:"function"===k,pg:0,n:e||b,m:f?"function"==typeof f?f:Math.round:0,pr:0,c:n?parseInt(d.charAt(0)+"1",10)*parseFloat(d.substr(2)):parseFloat(d)-m||0};if(("number"!=typeof m||"number"!=typeof d&&!n)&&(g||isNaN(m)||!n&&isNaN(d)||"boolean"==typeof m||"boolean"==typeof d?(o.fp=g,j=O(m,n?o.s+o.c:d,h||H.defaultStringFilter,o),o={t:j,p:"setRatio",s:0,c:1,f:2,pg:0,n:e||b,pr:0,m:0}):(o.s=parseFloat(m),n||(o.c=parseFloat(d)-o.s||0))),o.c)return(o._next=this._firstPT)&&(o._next._prev=o),this._firstPT=o,o},Q=H._internals={isArray:q,isSelector:I,lazyTweens:K,blobDif:O},R=H._plugins={},S=Q.tweenLookup={},T=0,U=Q.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1,id:1},V={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,true:1,false:0},W=E._rootFramesTimeline=new G,X=E._rootTimeline=new G,Y=30,Z=Q.lazyRender=function(){var a,b=K.length;for(L={};--b>-1;)a=K[b],a&&a._lazy!==!1&&(a.render(a._lazy[0],a._lazy[1],!0),a._lazy=!1);K.length=0};X._startTime=j.time,W._startTime=j.frame,X._active=W._active=!0,setTimeout(Z,1),E._updateRoot=H.render=function(){var a,b,c;if(K.length&&Z(),X.render((j.time-X._startTime)*X._timeScale,!1,!1),W.render((j.frame-W._startTime)*W._timeScale,!1,!1),K.length&&Z(),j.frame>=Y){Y=j.frame+(parseInt(H.autoSleep,10)||120);for(c in S){for(b=S[c].tweens,a=b.length;--a>-1;)b[a]._gc&&b.splice(a,1);0===b.length&&delete S[c]}if(c=X._first,(!c||c._paused)&&H.autoSleep&&!W._first&&1===j._listeners.tick.length){for(;c&&c._paused;)c=c._next;c||j.sleep()}}},j.addEventListener("tick",E._updateRoot);var $=function(a,b,c){var d,e,f=a._gsTweenID;if(S[f||(a._gsTweenID=f="t"+T++)]||(S[f]={target:a,tweens:[]}),b&&(d=S[f].tweens,d[e=d.length]=b,c))for(;--e>-1;)d[e]===b&&d.splice(e,1);return S[f].tweens},_=function(a,b,c,d){var e,f,g=a.vars.onOverwrite;return g&&(e=g(a,b,c,d)),g=H.onOverwrite,g&&(f=g(a,b,c,d)),e!==!1&&f!==!1},aa=function(a,b,c,d,e){var f,g,h,i;if(1===d||d>=4){for(i=e.length,f=0;f<i;f++)if((h=e[f])!==b)h._gc||h._kill(null,a,b)&&(g=!0);else if(5===d)break;return g}var j,k=b._startTime+n,l=[],m=0,o=0===b._duration;for(f=e.length;--f>-1;)(h=e[f])===b||h._gc||h._paused||(h._timeline!==b._timeline?(j=j||ba(b,0,o),0===ba(h,j,o)&&(l[m++]=h)):h._startTime<=k&&h._startTime+h.totalDuration()/h._timeScale>k&&((o||!h._initted)&&k-h._startTime<=2e-10||(l[m++]=h)));for(f=m;--f>-1;)if(h=l[f],2===d&&h._kill(c,a,b)&&(g=!0),2!==d||!h._firstPT&&h._initted){if(2!==d&&!_(h,b))continue;h._enabled(!1,!1)&&(g=!0)}return g},ba=function(a,b,c){for(var d=a._timeline,e=d._timeScale,f=a._startTime;d._timeline;){if(f+=d._startTime,e*=d._timeScale,d._paused)return-100;d=d._timeline}return f/=e,f>b?f-b:c&&f===b||!a._initted&&f-b<2*n?n:(f+=a.totalDuration()/a._timeScale/e)>b+n?0:f-b-n};i._init=function(){var a,b,c,d,e,f,g=this.vars,h=this._overwrittenProps,i=this._duration,j=!!g.immediateRender,k=g.ease;if(g.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),e={};for(d in g.startAt)e[d]=g.startAt[d];if(e.overwrite=!1,e.immediateRender=!0,e.lazy=j&&g.lazy!==!1,e.startAt=e.delay=null,this._startAt=H.to(this.target,0,e),j)if(this._time>0)this._startAt=null;else if(0!==i)return}else if(g.runBackwards&&0!==i)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(j=!1),c={};for(d in g)U[d]&&"autoCSS"!==d||(c[d]=g[d]);if(c.overwrite=0,c.data="isFromStart",c.lazy=j&&g.lazy!==!1,c.immediateRender=j,this._startAt=H.to(this.target,0,c),j){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=k=k?k instanceof w?k:"function"==typeof k?new w(k,g.easeParams):x[k]||H.defaultEase:H.defaultEase,g.easeParams instanceof Array&&k.config&&(this._ease=k.config.apply(k,g.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(f=this._targets.length,a=0;a<f;a++)this._initProps(this._targets[a],this._propLookup[a]={},this._siblings[a],h?h[a]:null,a)&&(b=!0);else b=this._initProps(this.target,this._propLookup,this._siblings,h,0);if(b&&H._onPluginEvent("_onInitAllProps",this),h&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),g.runBackwards)for(c=this._firstPT;c;)c.s+=c.c,c.c=-c.c,c=c._next;this._onUpdate=g.onUpdate,this._initted=!0},i._initProps=function(b,c,d,e,f){var g,h,i,j,k,l;if(null==b)return!1;L[b._gsTweenID]&&Z(),this.vars.css||b.style&&b!==a&&b.nodeType&&R.css&&this.vars.autoCSS!==!1&&J(this.vars,b);for(g in this.vars)if(l=this.vars[g],U[g])l&&(l instanceof Array||l.push&&q(l))&&l.join("").indexOf("{self}")!==-1&&(this.vars[g]=l=this._swapSelfInParams(l,this));else if(R[g]&&(j=new R[g])._onInitTween(b,this.vars[g],this,f)){for(this._firstPT=k={_next:this._firstPT,t:j,p:"setRatio",s:0,c:1,f:1,n:g,pg:1,pr:j._priority,m:0},h=j._overwriteProps.length;--h>-1;)c[j._overwriteProps[h]]=this._firstPT;(j._priority||j._onInitAllProps)&&(i=!0),(j._onDisable||j._onEnable)&&(this._notifyPluginsOfEnabled=!0),k._next&&(k._next._prev=k)}else c[g]=P.call(this,b,g,"get",l,g,0,null,this.vars.stringFilter,f);return e&&this._kill(e,b)?this._initProps(b,c,d,e,f):this._overwrite>1&&this._firstPT&&d.length>1&&aa(b,this,c,this._overwrite,d)?(this._kill(c,b),this._initProps(b,c,d,e,f)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(L[b._gsTweenID]=!0),i)},i.render=function(a,b,c){var d,e,f,g,h=this._time,i=this._duration,j=this._rawPrevTime;if(a>=i-1e-7&&a>=0)this._totalTime=this._time=i,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(d=!0,e="onComplete",c=c||this._timeline.autoRemoveChildren),0===i&&(this._initted||!this.vars.lazy||c)&&(this._startTime===this._timeline._duration&&(a=0),(j<0||a<=0&&a>=-1e-7||j===n&&"isPause"!==this.data)&&j!==a&&(c=!0,j>n&&(e="onReverseComplete")),this._rawPrevTime=g=!b||a||j===a?a:n);else if(a<1e-7)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==h||0===i&&j>0)&&(e="onReverseComplete",d=this._reversed),a<0&&(this._active=!1,0===i&&(this._initted||!this.vars.lazy||c)&&(j>=0&&(j!==n||"isPause"!==this.data)&&(c=!0),this._rawPrevTime=g=!b||a||j===a?a:n)),this._initted||(c=!0);else if(this._totalTime=this._time=a,this._easeType){var k=a/i,l=this._easeType,m=this._easePower;(1===l||3===l&&k>=.5)&&(k=1-k),3===l&&(k*=2),1===m?k*=k:2===m?k*=k*k:3===m?k*=k*k*k:4===m&&(k*=k*k*k*k),1===l?this.ratio=1-k:2===l?this.ratio=k:a/i<.5?this.ratio=k/2:this.ratio=1-k/2}else this.ratio=this._ease.getRatio(a/i);if(this._time!==h||c){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!c&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=h,this._rawPrevTime=j,K.push(this),void(this._lazy=[a,b]);this._time&&!d?this.ratio=this._ease.getRatio(this._time/i):d&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==h&&a>=0&&(this._active=!0),0===h&&(this._startAt&&(a>=0?this._startAt.render(a,b,c):e||(e="_dummyGS")),this.vars.onStart&&(0===this._time&&0!==i||b||this._callback("onStart"))),f=this._firstPT;f;)f.f?f.t[f.p](f.c*this.ratio+f.s):f.t[f.p]=f.c*this.ratio+f.s,f=f._next;this._onUpdate&&(a<0&&this._startAt&&a!==-1e-4&&this._startAt.render(a,b,c),b||(this._time!==h||d||c)&&this._callback("onUpdate")),e&&(this._gc&&!c||(a<0&&this._startAt&&!this._onUpdate&&a!==-1e-4&&this._startAt.render(a,b,c),d&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[e]&&this._callback(e),0===i&&this._rawPrevTime===n&&g!==n&&(this._rawPrevTime=0)))}},i._kill=function(a,b,c){if("all"===a&&(a=null),null==a&&(null==b||b===this.target))return this._lazy=!1,this._enabled(!1,!1);b="string"!=typeof b?b||this._targets||this.target:H.selector(b)||b;var d,e,f,g,h,i,j,k,l,m=c&&this._time&&c._startTime===this._startTime&&this._timeline===c._timeline;if((q(b)||I(b))&&"number"!=typeof b[0])for(d=b.length;--d>-1;)this._kill(a,b[d],c)&&(i=!0);else{if(this._targets){for(d=this._targets.length;--d>-1;)if(b===this._targets[d]){h=this._propLookup[d]||{},this._overwrittenProps=this._overwrittenProps||[],e=this._overwrittenProps[d]=a?this._overwrittenProps[d]||{}:"all";break}}else{if(b!==this.target)return!1;h=this._propLookup,e=this._overwrittenProps=a?this._overwrittenProps||{}:"all"}if(h){if(j=a||h,k=a!==e&&"all"!==e&&a!==h&&("object"!=typeof a||!a._tempKill),c&&(H.onOverwrite||this.vars.onOverwrite)){for(f in j)h[f]&&(l||(l=[]),l.push(f));if((l||!a)&&!_(this,c,b,l))return!1}for(f in j)(g=h[f])&&(m&&(g.f?g.t[g.p](g.s):g.t[g.p]=g.s,i=!0),g.pg&&g.t._kill(j)&&(i=!0),g.pg&&0!==g.t._overwriteProps.length||(g._prev?g._prev._next=g._next:g===this._firstPT&&(this._firstPT=g._next),g._next&&(g._next._prev=g._prev),g._next=g._prev=null),delete h[f]),k&&(e[f]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return i},i.invalidate=function(){return this._notifyPluginsOfEnabled&&H._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],E.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-n,this.render(Math.min(0,-this._delay))),this},i._enabled=function(a,b){if(k||j.wake(),a&&this._gc){var c,d=this._targets;if(d)for(c=d.length;--c>-1;)this._siblings[c]=$(d[c],this,!0);else this._siblings=$(this.target,this,!0)}return E.prototype._enabled.call(this,a,b),!(!this._notifyPluginsOfEnabled||!this._firstPT)&&H._onPluginEvent(a?"_onEnable":"_onDisable",this)},H.to=function(a,b,c){return new H(a,b,c)},H.from=function(a,b,c){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,new H(a,b,c)},H.fromTo=function(a,b,c,d){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,new H(a,b,d)},H.delayedCall=function(a,b,c,d,e){return new H(b,0,{delay:a,onComplete:b,onCompleteParams:c,callbackScope:d,onReverseComplete:b,onReverseCompleteParams:c,immediateRender:!1,lazy:!1,useFrames:e,overwrite:0})},H.set=function(a,b){return new H(a,0,b)},H.getTweensOf=function(a,b){if(null==a)return[];a="string"!=typeof a?a:H.selector(a)||a;var c,d,e,f;if((q(a)||I(a))&&"number"!=typeof a[0]){for(c=a.length,d=[];--c>-1;)d=d.concat(H.getTweensOf(a[c],b));for(c=d.length;--c>-1;)for(f=d[c],e=c;--e>-1;)f===d[e]&&d.splice(c,1)}else for(d=$(a).concat(),c=d.length;--c>-1;)(d[c]._gc||b&&!d[c].isActive())&&d.splice(c,1);return d},H.killTweensOf=H.killDelayedCallsTo=function(a,b,c){"object"==typeof b&&(c=b,b=!1);for(var d=H.getTweensOf(a,b),e=d.length;--e>-1;)d[e]._kill(c,a)};var ca=u("plugins.TweenPlugin",function(a,b){this._overwriteProps=(a||"").split(","),this._propName=this._overwriteProps[0],this._priority=b||0,this._super=ca.prototype},!0);if(i=ca.prototype,ca.version="1.19.0",ca.API=2,i._firstPT=null,i._addTween=P,i.setRatio=N,i._kill=function(a){var b,c=this._overwriteProps,d=this._firstPT;if(null!=a[this._propName])this._overwriteProps=[];else for(b=c.length;--b>-1;)null!=a[c[b]]&&c.splice(b,1);for(;d;)null!=a[d.n]&&(d._next&&(d._next._prev=d._prev),d._prev?(d._prev._next=d._next,d._prev=null):this._firstPT===d&&(this._firstPT=d._next)),d=d._next;return!1},i._mod=i._roundProps=function(a){for(var b,c=this._firstPT;c;)b=a[this._propName]||null!=c.n&&a[c.n.split(this._propName+"_").join("")],b&&"function"==typeof b&&(2===c.f?c.t._applyPT.m=b:c.m=b),c=c._next},H._onPluginEvent=function(a,b){var c,d,e,f,g,h=b._firstPT;if("_onInitAllProps"===a){for(;h;){for(g=h._next,d=e;d&&d.pr>h.pr;)d=d._next;(h._prev=d?d._prev:f)?h._prev._next=h:e=h,(h._next=d)?d._prev=h:f=h,h=g}h=b._firstPT=e}for(;h;)h.pg&&"function"==typeof h.t[a]&&h.t[a]()&&(c=!0),h=h._next;return c},ca.activate=function(a){for(var b=a.length;--b>-1;)a[b].API===ca.API&&(R[(new a[b])._propName]=a[b]);return!0},t.plugin=function(a){if(!(a&&a.propName&&a.init&&a.API))throw"illegal plugin definition.";var b,c=a.propName,d=a.priority||0,e=a.overwriteProps,f={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_mod",mod:"_mod",initAll:"_onInitAllProps"},g=u("plugins."+c.charAt(0).toUpperCase()+c.substr(1)+"Plugin",function(){ca.call(this,c,d),this._overwriteProps=e||[]},a.global===!0),h=g.prototype=new ca(c);h.constructor=g,g.API=a.API;for(b in f)"function"==typeof a[b]&&(h[f[b]]=a[b]);return g.version=a.version,ca.activate([g]),g},g=a._gsQueue){for(h=0;h<g.length;h++)g[h]();for(i in r)r[i].func||a.console.log("GSAP encountered missing dependency: "+i)}k=!1}}("undefined"!=typeof b&&b.exports&&"undefined"!=typeof a?a:this||window,"TweenMax")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],207:[function(a,b,c){function d(a){e.call(this),this.lens=a,this._view=f.create(),this._viewProj=f.create()}var e=a("nanogl-node"),f=a("gl-matrix/src/gl-matrix/mat4"),g=a("./perspective-lens"),h=a("./ortho-lens"),i=f.create(),j=Object.create(e.prototype);j.modelViewMatrix=function(a,b){f.multiply(a,b,this._view)},j.modelViewProjectionMatrix=function(a,b){f.multiply(a,this._viewProj,b)},j.getMVP=function(a){return f.multiply(i,this._viewProj,a),i},j.unproject=function(a,b){f.invert(IMVP,this._proj),vec3.transformMat4(a,b,IMVP)},j.updateViewProjectionMatrix=function(a,b){this.lens.aspect=a/b,f.multiply(this._viewProj,this.lens.getProjection(),this._view)},j._computeWorldMatrix=function(a){e.prototype._computeWorldMatrix.call(this,a),f.invert(this._view,this._wmatrix)},d.makePerspectiveCamera=function(){return new d(new g)},d.makeOrthoCamera=function(){return new d(new h)},j.constructor=d,d.prototype=j,b.exports=d},{"./ortho-lens":208,"./perspective-lens":209,"gl-matrix/src/gl-matrix/mat4":197,"nanogl-node":214}],208:[function(a,b,c){function d(){this._near=.01,this._far=10,this._xMin=-1,this._xMax=1,this._yMin=-1,this._yMax=1,this._proj=e.create(),this._valid=!1}var e=a("gl-matrix/src/gl-matrix/mat4");d.prototype={getProjection:function(){return this._valid||this._updateProjection(),this._proj},setBound:function(a,b,c,d){this._xMin=a,this._xMax=b,this._yMin=c,this._yMax=d,this._invalidate()},set near(a){this._near!==a&&(this._near=a,this._invalidate())},get near(){return this._near},set far(a){this._far!==a&&(this._far=a,this._invalidate())},get far(){return this._far},set aspect(a){this._aspect!==a&&(this._aspect=a)},get aspect(){return this._aspect},_updateProjection:function(){e.ortho(this._proj,this._xMin,this._xMax,this._yMin,this._yMax,this._near,this._far),this._valid=!0},_invalidate:function(){this._valid=!1}},b.exports=d},{"gl-matrix/src/gl-matrix/mat4":197}],209:[function(a,b,c){function d(){this._near=.01,this._far=10,this._fov=Math.PI/3,this._vfov=0,this._hfov=0,this._aspect=1,this._fovMode=0,this._proj=e.create(),this._valid=!1}var e=a("gl-matrix/src/gl-matrix/mat4"),f=1,g=2,h=3;d.prototype={getProjection:function(){return this._valid||this._updateProjection(),this._proj},set fov(a){this.setVerticalFov(a)},get fov(){return this._fov},set near(a){this._near!==a&&(this._near=a,this._invalidate())},get near(){return this._near},set far(a){this._far!==a&&(this._far=a,this._invalidate())},get far(){return this._far},set aspect(a){this._aspect!==a&&(this._aspect=a,this._invalidate())},get aspect(){return this._aspect},setHorizontalFov:function(a){this._fov=a,this._fovMode=g,this._invalidate()},setVerticalFov:function(a){this._fov=a,this._fovMode=f,this._invalidate()},getHorizontalFov:function(){return this.getProjection(),this._hfov},getVerticalFov:function(){return this.getProjection(),this._vfov},setAutoFov:function(a){this._fov=a,this._fovMode=h,this._invalidate()},_updateProjection:function(){var a=this._fovMode,b=this._aspect;a===f||a===h&&b>1?(this._vfov=this._fov,this._hfov=2*Math.atan(Math.tan(this._fov/2)*b)):(this._hfov=this._fov,this._vfov=2*Math.atan(Math.tan(this._fov/2)/b)),e.perspective(this._proj,this._vfov,b,this._near,this._far),this._valid=!0},_invalidate:function(){this._valid=!1}},b.exports=d},{"gl-matrix/src/gl-matrix/mat4":197}],210:[function(a,b,c){function d(a,b){var c=new k(a,b);if(1&c.attachment.flags){var d=c.attachment;c.attachment=new e(c,c.attachment.flags|l),d.dispose()}return c}function e(a,b){this.fbo=a,this.flags=b,this.buffer=null,this._depthTexExt=null;var c=a.gl;this.flags&l&&(this._depthTexExt=c.getExtension("WEBGL_depth_texture")||c.getExtension("WEBKIT_WEBGL_depth_texture")||c.getExtension("MOZ_WEBGL_depth_texture"),null===this._depthTexExt&&(this.flags=this.flags&~l))}function f(a,b){switch(b){case 1:return 33189;case 2:return 36168;case 3:return 34041;default:throw new Error("unknown attachment type "+b)}}function g(a,b){switch(b){case 1:return 6402;case 3:return 34041;default:throw new Error("unknown texture type "+b)}}function h(a,b){switch(b){case 1:return 5125;case 3:return 34042;default:throw new Error("unknown texture type "+b)}}function i(a,b){switch(b){case 1:return 36096;case 2:return 36128;case 3:return 33306;default:throw new Error("unknown attachment type "+b)}}var j=a("nanogl/texture"),k=a("nanogl/fbo"),l=128;e.prototype={_init:function(){var a=this.fbo.gl,b=3&this.flags,c=null;if(this.flags&l){if(c=new j(a,g(a,b)),c.fromData(this.fbo.width,this.fbo.height,null,h(a,b)),a.getError()===a.INVALID_VALUE)return this.flags=this.flags&~l,c.dispose(),void this._allocate();a.framebufferTexture2D(a.FRAMEBUFFER,i(a,b),a.TEXTURE_2D,c.id,0)}else b&&(c=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,c),a.framebufferRenderbuffer(a.FRAMEBUFFER,i(a,b),a.RENDERBUFFER,c));this.buffer=c},isDepthTexture:function(){return 0!==(this.flags&l)},_allocate:function(){var a=this.fbo.gl;this.flags&l?this.buffer.fromData(this.fbo.width,this.fbo.height,null,h(a,3&this.flags)):3&this.flags&&(a.bindRenderbuffer(a.RENDERBUFFER,this.buffer),a.renderbufferStorage(a.RENDERBUFFER,f(a,3&this.flags),this.fbo.width,this.fbo.height),a.bindRenderbuffer(a.RENDERBUFFER,null))},dispose:function(){this.buffer&&(this.flags&l?this.buffer.dispose():this.fbo.gl.deleteRenderbuffer(this.buffer)),this.buffer=null,this._depthTexExt=null},clearBits:function(){return(1&this.flags?256:0)|(2&this.flags?1024:0)}},b.exports={create:d}},{"nanogl/fbo":211,"nanogl/texture":212}],211:[function(a,b,c){function d(a,b){this.gl=a,this.width=0,this.height=0,this.fbo=null,b=b||i;var c=b.depth|b.stencil<<1,d=b.type||a.UNSIGNED_BYTE;this.types=Array.isArray(d)?d:[d],this.color=new h(a,b.format),this.attachment=new e(this,c)}function e(a,b){this.fbo=a,this.flags=b,this.buffer=null}function f(a,b){switch(b){case 1:return 33189;case 2:return 36168;case 3:return 34041;default:throw new Error("unknown attachment type "+b)}}function g(a,b){switch(b){case 1:return 36096;case 2:return 36128;case 3:return 33306;default:throw new Error("unknown attachment type "+b)}}var h=a("./texture");d.prototype={resize:function(a,b){this.width===a&&this.height===b||(this.width=0|a,this.height=0|b,null===this.fbo&&this._init(),this._allocate())},bindColor:function(a,b){var c=this.gl;c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,this.color.id),c.uniform1i(a,b)},bind:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.fbo),a.viewport(0,0,this.width,this.height)},clear:function(){var a=this.gl,b=a.COLOR_BUFFER_BIT|this.attachment.clearBits();a.clear(b)},isValid:function(){var a=this.gl;return a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE},getActualType:function(){return this.color.type},dispose:function(){var a=this.gl;a.deleteFramebuffer(this.fbo),this.color.dispose(),this.attachment.dispose(),this.valid=!1,this.fbo=null,this.gl=null},_init:function(){var a=this.gl;this.fbo=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,this.fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.color.id,0),this.attachment._init()},_allocate:function(){var a=this.gl;this.attachment._allocate(),a.bindFramebuffer(a.FRAMEBUFFER,this.fbo);var b=0,c=this.types[b];do this.color.fromData(this.width,this.height,null,c),a.getError();while(!(this.valid=this.isValid())&&(c=this.types[++b]));a.bindFramebuffer(a.FRAMEBUFFER,null)}},e.prototype={_init:function(){var a=this.fbo.gl,b=3&this.flags,c=null;0!==b&&(c=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,c),a.framebufferRenderbuffer(a.FRAMEBUFFER,g(a,b),a.RENDERBUFFER,c)),this.buffer=c},_allocate:function(){var a=this.fbo.gl,b=3&this.flags;0!==b&&(a.bindRenderbuffer(a.RENDERBUFFER,this.buffer),a.renderbufferStorage(a.RENDERBUFFER,f(a,b),this.fbo.width,this.fbo.height),a.bindRenderbuffer(a.RENDERBUFFER,null))},dispose:function(){this.buffer&&this.fbo.gl.deleteRenderbuffer(this.buffer),this.buffer=null},clearBits:function(){return(1&this.flags?256:0)|(2&this.flags?1024:0)}};var i={};b.exports=d},{"./texture":212}],212:[function(a,b,c){function d(a,b,c){return 9728|+a|+b<<8|+(b&&c)<<1}function e(a,b){this._uid=f++,this.gl=a,this.id=this.gl.createTexture(),this.width=0,this.height=0,this.format=b||a.RGB,this.type=a.UNSIGNED_BYTE,a.bindTexture(g,this.id),this.setFilter(!0)}var f=0,g=3553;e.prototype={fromImage:function(a){var b=this.gl;this.width=a.width,this.height=a.height,b.bindTexture(g,this.id),b.texImage2D(g,0,this.format,this.format,this.type,a)},fromData:function(a,b,c,d){var e=this.gl;this.width=a,this.height=b,c=c||null,this.type=d||e.UNSIGNED_BYTE,e.bindTexture(g,this.id),e.texImage2D(g,0,this.format,a,b,0,this.format,this.type,c)},bind:function(a){var b=this.gl;void 0!==a&&b.activeTexture(b.TEXTURE0+(0|a)),b.bindTexture(g,this.id)},dispose:function(){this.gl.deleteTexture(this.id),this.id=null,this.gl=null},setFilter:function(a,b,c){var e=this.gl,f=d(!!a,!!b,!!c);e.texParameteri(g,e.TEXTURE_MAG_FILTER,d(!!a,!1,!1)),e.texParameteri(g,e.TEXTURE_MIN_FILTER,f)},repeat:function(){this.wrap(this.gl.REPEAT)},clamp:function(){this.wrap(this.gl.CLAMP_TO_EDGE)},mirror:function(){this.wrap(this.gl.MIRRORED_REPEAT)},wrap:function(a){var b=this.gl;b.texParameteri(g,b.TEXTURE_WRAP_S,a),b.texParameteri(g,b.TEXTURE_WRAP_T,a)}},b.exports=e},{}],213:[function(a,b,c){function d(a,b,c,d){b[0]=a[12],b[1]=a[13],b[2]=a[14],d[0]=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d[1]=Math.sqrt(a[4]*a[4]+a[5]*a[5]+a[6]*a[6]),d[2]=Math.sqrt(a[8]*a[8]+a[9]*a[9]+a[10]*a[10]),g[0]=a[0]/d[0],g[1]=a[1]/d[0],g[2]=a[2]/d[0],g[3]=a[4]/d[1],g[4]=a[5]/d[1],g[5]=a[6]/d[1],g[6]=a[8]/d[2],g[7]=a[9]/d[2],g[8]=a[10]/d[2],f.fromMat3(c,g)}var e=a("gl-matrix/src/gl-matrix/mat3"),f=a("gl-matrix/src/gl-matrix/quat"),g=e.create();b.exports={decomposeMat4:d}},{"gl-matrix/src/gl-matrix/mat3":196,"gl-matrix/src/gl-matrix/quat":198}],214:[function(a,b,c){function d(){this.position=h.create(),this.rotation=i.create(),this.scale=h.fromValues(1,1,1),this._matrix=f.create(),this._wmatrix=f.create(),this._wposition=new Float32Array(this._wmatrix.buffer,48,3),
this._parent=null,this._children=[],this._invalidM=!0,this._invalidW=!0}var e=a("./math"),f=a("gl-matrix/src/gl-matrix/mat4"),g=a("gl-matrix/src/gl-matrix/mat3"),h=a("gl-matrix/src/gl-matrix/vec3"),i=a("gl-matrix/src/gl-matrix/quat"),j=g.create(),k=new Float32Array(j.buffer,0,3),l=new Float32Array(j.buffer,12,3),m=new Float32Array(j.buffer,24,3);VUP=h.fromValues(0,1,0),d.prototype={rotateX:function(a){i.rotateX(this.rotation,this.rotation,a),this.invalidate()},rotateY:function(a){i.rotateY(this.rotation,this.rotation,a),this.invalidate()},rotateZ:function(a){i.rotateZ(this.rotation,this.rotation,a),this.invalidate()},set x(a){this.position[0]=a,this.invalidate()},set y(a){this.position[1]=a,this.invalidate()},set z(a){this.position[2]=a,this.invalidate()},get x(){return this.position[0]},get y(){return this.position[1]},get z(){return this.position[2]},setScale:function(a){this.scale[0]=this.scale[1]=this.scale[2]=a,this.invalidate()},lookAt:function(a){h.subtract(m,this.position,a),h.normalize(m,m),h.cross(k,VUP,m),h.normalize(k,k),h.cross(l,m,k),i.fromMat3(this.rotation,j),this.invalidate()},setMatrix:function(a){f.copy(this._matrix,a),e.decomposeMat4(a,this.position,this.rotation,this.scale),this._invalidM=!1,this._invalidW=!0},add:function(a){this._children.indexOf(a)===-1&&(null!==a._parent&&a._parent.remove(a),this._children.push(a),a._parent=this)},remove:function(a){var b=this._children.indexOf(a);b>-1&&(this._children.splice(b,1),a._parent=null)},invalidate:function(){this._invalidM=!0,this._invalidW=!0},updateMatrix:function(){this._invalidM&&(f.fromRotationTranslationScale(this._matrix,this.rotation,this.position,this.scale),this._invalidM=!1)},updateWorldMatrix:function(a){a=!!a,this.updateMatrix();var b=this._hasInvalidWorldMatrix(a);b&&this._computeWorldMatrix(a);for(var c=0;c<this._children.length;c++){var d=this._children[c];d._invalidW=d._invalidW||b,d.updateWorldMatrix(!0)}},_computeWorldMatrix:function(a){var b=this._parent;null!==b?(!a&&b._hasInvalidWorldMatrix(!1)&&(b.updateMatrix(),b._computeWorldMatrix(!1)),f.multiply(this._wmatrix,b._wmatrix,this._matrix)):f.copy(this._wmatrix,this._matrix),this._invalidW=!1},_hasInvalidWorldMatrix:function(a){return this._invalidW||!a&&null!==this._parent&&this._parent._hasInvalidWorldMatrix(!1)}},b.exports=d},{"./math":213,"gl-matrix/src/gl-matrix/mat3":196,"gl-matrix/src/gl-matrix/mat4":197,"gl-matrix/src/gl-matrix/quat":198,"gl-matrix/src/gl-matrix/vec3":200}],215:[function(a,b,c){function d(a){this.ibl=null,this.prg=null,this.inputs=new i,this.depthFormat=new h("depthFormat",["D_RGB","D_DEPTH"]),this.inputs.add(this.depthFormat),this.config=new e,this._prgcache=g.getCache(a),this._uid="stddepth",this._precision="highp",this._vertSrc=f(["#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n#endif\n\nvoid main(void){\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n\n  #if depthFormat( D_RGB )\n    fragZW=gl_Position.zw;\n  #endif\n}\n"]),this._fragSrc=f(["#define GLSLIFY 1\n#pragma SLOT pf\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n\n  vec3 encodeDepthRGB(float depth){\n    vec4 c = vec4(1.0,255.0,65025.0,16581375.0)*depth;\n    c=fract(c);\n    c.xyz-=c.yzw*(1.0/255.0);\n    return c.xyz;\n  }\n#endif\n\nvoid main(void){\n\n  #if depthFormat( D_RGB )\n    gl_FragColor.xyz = encodeDepthRGB( ( fragZW.x / fragZW.y ) * 0.5 + 0.5 );\n    gl_FragColor.w=0.0;\n  #endif\n\n  #if depthFormat( D_DEPTH )\n    gl_FragColor = vec4( 0.0 );\n  #endif\n\n}\n"])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("./lib/program-cache"),h=(a("./lib/input"),a("./lib/flag"),a("./lib/enum")),i=a("./lib/chunks-tree"),j=a("gl-matrix").mat4.create();d.prototype={setLightSetup:function(a){this.inputs.remove(this.depthFormat),this.depthFormat=a.depthFormat.createProxy(),this.inputs.add(this.depthFormat)},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),b.modelViewProjectionMatrix(j,a._wmatrix),c.uMVP(j)},_isDirty:function(){return null===this.prg||this.inputs._isDirty},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"./lib/chunks-tree":228,"./lib/enum":229,"./lib/flag":230,"./lib/input":231,"./lib/program-cache":237,"gl-matrix":192,glslify:205,"nanogl-state/config":244,"nanogl/program":253}],216:[function(a,b,c){b.exports=function(a){var b="";return b+="// --------- SPEC\n{\n\n  vec3 H = normalize( uLDirDirections["+a.index+"] + viewDir );\n  float NoH = sdot( H,worldNormal );\n  float sContib = specularMul * pow( NoH, roughness );\n  // -------- DIFFUSE\n  float dContrib = (1.0/3.141592) * sdot( uLDirDirections["+a.index+"] ,worldNormal );\n\n  ",a.shadowIndex>-1&&(b+="\n  {\n    vec3 fragCoord = calcShadowPosition( uShadowTexelBiasVector["+a.shadowIndex+"], uShadowMatrices["+a.shadowIndex+"] , worldNormal, uShadowMapSize["+a.shadowIndex+"].y );\n    float shOccl = calcLightOcclusions(tShadowMap"+a.shadowIndex+",fragCoord,uShadowMapSize["+a.shadowIndex+"]);\n    dContrib *= shOccl;\n    sContib  *= shOccl;\n    \n    #if iblShadowing\n      float sDamp = uLDirColors["+a.index+"].a;\n      specularColor *= mix( sDamp, 1.0, shOccl );\n    #endif\n  }\n  "),b+="\n\n  diffuseCoef   += dContrib * uLDirColors["+a.index+"].rgb;\n  LS_SPECULAR   += sContib  * uLDirColors["+a.index+"].rgb;\n\n}"}},{}],217:[function(a,b,c){arguments[4][41][0].apply(c,arguments)},{dup:41}],218:[function(a,b,c){arguments[4][42][0].apply(c,arguments)},{dup:42}],219:[function(a,b,c){arguments[4][43][0].apply(c,arguments)},{dup:43}],220:[function(a,b,c){b.exports=function(a){var b="";return b+="\n// post light setup\n#if iblShadowing\n  specularColor += lSpecularColor;\n#endif"}},{}],221:[function(a,b,c){b.exports=function(a){var b="";return b+="\nhighp float roughness = -10.0 / log2( gloss()*0.968+0.03 );\nroughness *= roughness;\nfloat specularMul = roughness * (0.125/3.141592) + 0.5/3.141592;\n\n#if iblShadowing\n  vec3 lSpecularColor = vec3(0.0);\n  #define LS_SPECULAR lSpecularColor\n#else\n  #define LS_SPECULAR specularColor \n#endif\n"}},{}],222:[function(a,b,c){arguments[4][46][0].apply(c,arguments)},{dup:46}],223:[function(a,b,c){arguments[4][47][0].apply(c,arguments)},{dup:47}],224:[function(a,b,c){arguments[4][48][0].apply(c,arguments)},{dup:48}],225:[function(a,b,c){function d(a,b){this.env=a,this.sh=b,this._expoInput=new e("iblExpo",2,e.ALL)}var e=a("./lib/input");a("./lib/flag");d.prototype={getChunks:function(){return[this._expoInput.createProxy()]},setupProgram:function(a){a.tEnv&&a.tEnv(this.env),a.uSHCoeffs&&a.uSHCoeffs(this.sh)}},d.convert=function(a,b){void 0===b&&(b=1);var c=Math.sqrt(Math.PI),d=1/(2*c),e=Math.sqrt(3)/(3*c),f=Math.sqrt(15)/(8*c),g=Math.sqrt(5)/(16*c),h=.5*f,i=new Float32Array(28);return i[0]=b*(e*a[6]),i[1]=b*(-e*a[3]),i[2]=b*(-e*a[9]),i[3]=b*(d*a[0]-g*a[18]),i[4]=b*(e*a[7]),i[5]=b*(-e*a[4]),i[6]=b*(-e*a[10]),i[7]=b*(d*a[1]-g*a[19]),i[8]=b*(e*a[8]),i[9]=b*(-e*a[5]),i[10]=b*(-e*a[11]),i[11]=b*(d*a[2]-g*a[20]),i[12]=b*(f*a[12]),i[13]=b*(-f*a[15]),i[14]=b*(3*g*a[18]),i[15]=b*(-f*a[21]),i[16]=b*(f*a[13]),i[17]=b*(-f*a[16]),i[18]=b*(3*g*a[19]),i[19]=b*(-f*a[22]),i[20]=b*(f*a[14]),i[21]=b*(-f*a[17]),i[22]=b*(3*g*a[20]),i[23]=b*(-f*a[23]),i[24]=b*(h*a[24]),i[25]=b*(h*a[25]),i[26]=b*(h*a[26]),i[27]=1*b,i},b.exports=d},{"./lib/flag":230,"./lib/input":231}],226:[function(a,b,c){function d(){this.min=new Float32Array(3),this.max=new Float32Array(3),this.center=new Float32Array(3),this.radius=new Float32Array(3)}d.prototype={fromMinMax:function(a,b){this.min.set(a),this.max.set(b),this._updateSphere()},addMinMax:function(a,b){for(var c=0;c<3;c++)this.min[c]=Math.min(a[c],a[c]),this.max[c]=Math.max(b[c],b[c]);this._updateSphere()},addBounds:function(a){this.addMinMax(a.min,a.max)},_updateSphere:function(){this.center[0]=.5*(this.min[0]+this.max[0]),this.center[1]=.5*(this.min[1]+this.max[1]),this.center[2]=.5*(this.min[2]+this.max[2]),this.radius[0]=this.max[0]-this.center[0],this.radius[1]=this.max[1]-this.center[1],this.radius[2]=this.max[2]-this.center[2]}},b.exports=d},{}],227:[function(a,b,c){function d(a,b){this.list=null,this.children=[],this.parent=null,this._hasCode=!!a,this._hasSetup=!!b,this._invalid=!0,this._proxies=[]}function e(a){d.call(this,a._hasCode,a._hasSetup),this._ref=a}d.prototype={genCode:function(a){return""},getHash:function(){return""},setup:function(a){},add:function(a){if(!(this.children.indexOf(a)>-1)){this.children.push(a),a.setList(this.list),a.parent=this;for(var b=0;b<this._proxies.length;b++)this._proxies[b].add(a.createProxy());return this.invalidate(),a}},remove:function(a){var b=this.children.indexOf(a);b>-1&&(this.children.splice(b,1),a.parent=null,a.removeProxies()),this.invalidate()},setList:function(a){this.list=a,this.invalidate();for(var b=0;b<this.children.length;b++)this.children[b].setList(a)},traverse:function(a,b,c){if(c.indexOf(this)===-1){for(var d=0;d<this.children.length;d++)this.children[d].traverse(a,b,c);this._hasSetup&&a.push(this),this._hasCode&&b.push(this),c.push(this)}},invalidate:function(){this.list&&(this.list._isDirty=!0);for(var a=0;a<this._proxies.length;a++)this._proxies[a].invalidate()},createProxy:function(){var a=new e(this);return this._proxies.push(a),a},releaseProxy:function(a){var b=this._proxies.indexOf(a);b>-1&&this._proxies.splice(b,1)},removeProxies:function(){for(var a=0;a<this._proxies.length;a++){var b=this._proxies[a];null!==b.parent&&b.parent.remove(b)}}},e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.genCode=function(a){this._ref.genCode(a)},e.prototype.getHash=function(){return this._ref.getHash()},e.prototype.setup=function(a){this._ref.setup(a)},e.prototype.release=function(){this._ref.releaseProxy(this),this._ref=null},d.Proxy=e,b.exports=d},{}],228:[function(a,b,c){function d(){this.slots=[],this.slotsMap={}}function e(a){this.material=a,this._setups=[],this._codes=[],this._flat=[],this._root=new f,this._root.list=this,this._isDirty=!0}var f=a("./chunk");d.prototype={getSlot:function(a){var b=this.slotsMap[a];return void 0===b&&(b={key:a,code:""},this.slotsMap[a]=b,this.slots.push(b)),b},add:function(a,b){this.getSlot(a).code+=b+"\n"}},e.prototype={add:function(a){return this._root.add(a)},remove:function(a){return this._root.remove(a)},addChunks:function(a){for(var b=0;b<a.length;b++)this._root.add(a[b])},compile:function(){this._flatten()},_flatten:function(){var a=this._setups,b=this._codes,c=this._flat;a.length=0,b.length=0,c.length=0,this._root.traverse(a,b,c),this._isDirty=!1},getHash:function(){for(var a=this._codes,b="",c=0;c<a.length;c++)b+=a[c].getHash();return b},getCode:function(){for(var a=this._codes,b=new d,c=0;c<a.length;c++)a[c].genCode(b);return b}},b.exports=e},{"./chunk":227}],229:[function(a,b,c){function d(a,b){e.call(this,!0,!1),this.name=a,this.values=b,this._val=b[0]}var e=a("./chunk");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.set=function(a){if(this._val!==a){if(null!==a&&this.values.indexOf(a)===-1)throw new Error("invalide Enum value :"+a);this._val=a,this.invalidate()}},d.prototype.genCode=function(a){for(var b="",c=0;c<this.values.length;c++)b+="#define "+this.values[c]+" "+(c+1)+"\n";b+="#define VAL_"+this.name+" "+this._val+"\n",b+="#define "+this.name+"(k) VAL_"+this.name+" == k\n",a.add("pf",b),a.add("pv",b)},d.prototype.getHash=function(){return this.values.indexOf(this._val)+"/"+this.name},b.exports=d},{"./chunk":227}],230:[function(a,b,c){function d(a,b){e.call(this,!0,!1),this.name=a,this._val=!!b}var e=a("./chunk");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.enable=function(){this.set(!0)},d.prototype.disable=function(){this.set(!1)},d.prototype.set=function(a){a=!!a,this._val!==a&&(this._val=a,this.invalidate())},d.prototype.genCode=function(a){var b;b="#define "+this.name+" "+~~this._val+"\n",a.add("pf",b),a.add("pv",b)},d.prototype.getHash=function(){return this.name+"-"+~~this._val},b.exports=d},{"./chunk":227}],231:[function(a,b,c){function d(a,b){var c=a.length;if(c===b)return a;if(c>b)return a.substr(0,b);for(var d=a[c-1];a.length<b;)a+=d;return a}function e(a){return a.toPrecision(8)}function f(a,b,c){0!==(b&o)&&a.add("f",c),0!==(b&p)&&a.add("v",c)}function g(a,b,c){0!==(b&o)&&a.add("pf",c),0!==(b&p)&&a.add("pv",c)}function h(a,b,c){m.call(this,!0,!1),this.name=a,this.size=b,this.param=null,this.comps=d("rgba",b),this.shader=c||o}function i(a,b){m.call(this,!0,!0),this._input=null,this.name=a,this.texCoords=b,this._tex=null,this.size=4,this._linkAttrib=b instanceof k,this._linkAttrib?(this.add(b),this.uvsToken=this.texCoords.token):this.uvsToken=this.texCoords,this.token="VAL_"+this.name+this.uvsToken}function j(a,b){m.call(this,!0,!0),this._input=null,this.name=a,this.size=b,this._value=new Float32Array(b),this.token=this.name}function k(a,b){m.call(this,!0,!1),this._input=null,this.name=a,this.size=b,this.token="v_"+this.name}function l(a){m.call(this,!0,!1),this._input=null,this.name="CONST_"+(0|2147483647*Math.random()).toString(16),Array.isArray(a)?this.size=a.length:this.size=1,this.value=a,this.token="VAR_"+this.name}var m=a("./chunk"),n=[null,"float","vec2","vec3","vec4"],o=1,p=2;h.prototype=Object.create(m.prototype),h.prototype.constructor=h,h.prototype.attach=function(a,b){this.param&&this.remove(this.param),a._input=this,this.param=a,this.add(a),void 0===b&&(b="rgba"),this.comps=d(b,this.size)},h.prototype.detach=function(){this.param&&(this.param._input=null,this.remove(this.param)),this.param=null},h.prototype.attachSampler=function(a,b,c){var d=new i(a,b);return this.attach(d,c),d},h.prototype.attachUniform=function(a,b,c){var d=new j(a,b||this.size);return this.attach(d,c),d},h.prototype.attachAttribute=function(a,b,c){var d=new k(a,b||this.size);return this.attach(d,c),d},h.prototype.attachConstant=function(a,b){var c=new l(a);return this.attach(c,b),c},h.prototype.getHash=function(){var a=this.size+"-"+this.comps+"-"+this.name;return a},h.prototype.genCode=function(a){if(this.genAvailable(a),null!==this.param){var b="#define "+this.name+"(k) "+this.param.token;this.param.size>1&&(b+="."+this.comps),g(a,this.shader,b)}},h.prototype.genAvailable=function(a){var b=null===this.param?"0":"1",c="#define HAS_"+this.name+" "+b+"\n";a.add("pv",c),a.add("pf",c)},i.prototype=Object.create(m.prototype),i.prototype.constructor=i,i.prototype.set=function(a){this._tex=a},i.prototype.genCode=function(a){var b,c=this.name;b="uniform sampler2D "+c+";\n",g(a,this._input.shader,b),b="vec4 "+this.token+" = texture2D( "+c+", "+this.uvsToken+");\n",f(a,this._input.shader,b)},i.prototype.setup=function(a){a[this.name](this._tex)},i.prototype.getHash=function(){return(this._linkAttrib?"":this.texCoords)+"-"+this.name},j.prototype=Object.create(m.prototype),j.prototype.constructor=j,j.prototype.set=function(){for(var a=0;a<arguments.length;a++)this._value[a]=arguments[a];this._invalid=!0},j.prototype.genCode=function(a){var b;b="uniform "+n[this.size]+" "+this.token+";\n",g(a,this._input.shader,b)},j.prototype.setup=function(a){a[this.name](this._value),this._invalid=!1},j.prototype.getHash=function(){return this.size+"-"+this.name},k.prototype=Object.create(m.prototype),k.prototype.constructor=k,k.prototype.genCode=function(a){var b;b="varying "+n[this.size]+" "+this.token+";\n",a.add("pf",b),b="attribute "+n[this.size]+" "+this.name+";\n",b+="varying   "+n[this.size]+" "+this.token+";\n",a.add("pv",b),b=this.token+" = "+this.name+";\n",a.add("v",b)},k.prototype.getHash=function(){return this.size+"-"+this.name},l.prototype=Object.create(m.prototype),l.prototype.constructor=l,l.prototype.genCode=function(a){var b;b="#define "+this.token+" "+n[this.size]+"("+this._stringifyValue()+")\n",g(a,this._input.shader,b)},l.prototype._stringifyValue=function(){return 1===this.size?this.value.toString():this.value.map(e).join(",")},l.prototype.getHash=function(){return this._stringifyValue()+"-"+this.size+"-"},h.Sampler=i,h.Uniform=j,h.Attribute=k,h.Constant=l,h.FRAGMENT=o,h.VERTEX=p,h.ALL=p|o,b.exports=h},{"./chunk":227}],232:[function(a,b,c){function d(a){e.call(this,a),this._type=e.TYPE_DIR,this._shadowmapNearOffset=0}var e=a("./light"),f=a("nanogl-camera"),g=new Float32Array(4);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.projectionFromBounds=function(a){var b=this.boundsInLocalSpace(a);this._camera.lens.near=-b[5]-this._shadowmapNearOffset,this._camera.lens.far=-b[2],this._camera.lens.setBound(b[0],b[3],b[1],b[4])},d.prototype.getTexelBiasVector=function(){var a=this._camera.lens;return g[3]=Math.max(a._xMax-a._xMin,a._yMax-a._yMin),g},d.prototype._createCamera=function(){return f.makeOrthoCamera()},b.exports=d},{"./light":234,"nanogl-camera":207}],233:[function(a,b,c){function d(){this._lights=[],this._models=[],this._modelsMap={},this.depthFormat=new e("depthFormat",["D_RGB","D_DEPTH"]),this.bounds=new f,this.stdModel=new g,this._registerModel("std",this.stdModel)}var e=a("../enum"),f=a("../bounds"),g=a("./standard-model");d.prototype={add:function(a){if(this._lights.indexOf(a)===-1){this._lights.push(a);for(var b=0;b<this._models.length;b++)this._models[b].add(a)}},remove:function(a){var b=this._lights.indexOf(a);if(b>-1)for(this._lights.splice(b,1),b=0;b<this._models.length;b++)this._models[b].remove(a)},update:function(){for(i=0;i<this._models.length;i++)this._models[i].update()},getChunks:function(a){a="std";var b=this._modelsMap[a].getChunks();return b.unshift(this.depthFormat.createProxy()),b},_registerModel:function(a,b){if(void 0===this._modelsMap[a]){this._modelsMap[a]=b,this._models.push(b),b._setup=this;for(var c=0;c<this._lights.length;c++)b.add(this._lights[c])}}},b.exports=d},{"../bounds":226,"../enum":229,"./standard-model":236}],234:[function(a,b,c){function d(a){e.call(this),this.gl=a,this._type=0,this._color=new Float32Array([1,1,1]),this._wdir=new Float32Array(this._wmatrix.buffer,32,3),this._castShadows=!1,this._fbo=null,this._camera=null,this._shadowmapSize=512,this.iblShadowing=.5}var e=a("nanogl-node"),f=a("nanogl-depth-texture/fbo"),g=a("gl-matrix/src/gl-matrix/mat4"),h=a("gl-matrix/src/gl-matrix/vec3"),i=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),j=g.create(),k=new Float32Array(6),l=h.create();d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.getShadowProjection=function(a){return this.projectionFromBounds(a),this._camera.updateViewProjectionMatrix(1,1),g.multiply(j,i,this._camera._viewProj),j},d.prototype.castShadows=function(a){this._castShadows!==a&&(this._castShadows=a,a?this._initShadowMapping():this._releaseShadowMapping())},d.prototype.hasDepthShadowmap=function(){return this._castShadows&&this._fbo.attachment.isDepthTexture()},d.prototype.getShadowmap=function(){if(this._castShadows){var a=this._fbo.attachment;return a.isDepthTexture()?a.buffer:this._fbo.color}return null},d.prototype._initShadowMapping=function(a){var b=this._shadowmapSize;this._fbo=f.create(this.gl,{depth:!0,format:this.gl.RGB}),this._fbo.resize(b,b),this._fbo.color.setFilter(!1,!1,!1),this._camera=this._createCamera(),this.add(this._camera)},d.prototype._releaseShadowMapping=function(a){this._fbo.dispose(),this._fbo=null,this.remove(this._camera),this._camera=null},d.prototype._createCamera=function(){},d.prototype.prepareShadowmap=function(){var a=this._shadowmapSize;this._fbo.resize(a,a),this._fbo.bind()},d.prototype.boundsInLocalSpace=function(a){k[0]=k[1]=k[2]=Number.MAX_VALUE,k[3]=k[4]=k[5]=-Number.MAX_VALUE;for(var b=0;8>b;b++)l[0]=1&b?a.max[0]:a.min[0],l[1]=2&b?a.max[1]:a.min[1],l[2]=4&b?a.max[2]:a.min[2],h.transformMat4(l,l,this._camera._view),k[0]=Math.min(k[0],l[0]),k[1]=Math.min(k[1],l[1]),k[2]=Math.min(k[2],l[2]),k[3]=Math.max(k[3],l[0]),k[4]=Math.max(k[4],l[1]),k[5]=Math.max(k[5],l[2]);return k},d.TYPE_DIR=1,d.TYPE_SPOT=2,d.TYPE_POINT=4,b.exports=d},{"gl-matrix/src/gl-matrix/mat4":197,"gl-matrix/src/gl-matrix/vec3":200,"nanogl-depth-texture/fbo":210,"nanogl-node":214}],235:[function(a,b,c){function d(a){e.call(this,a),this._type=e.TYPE_POINT,this._falloffData=new Float32Array(3),this._radius=0,this._falloffCurve=0,this.radius=50,this.falloffCurve=2}var e=a("./light");a("nanogl-camera"),new Float32Array(4);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.castShadows=function(a){},Object.defineProperty(d.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a,this._updateFalloffData()}}),Object.defineProperty(d.prototype,"falloffCurve",{get:function(){return this._falloffCurve},set:function(a){this._falloffCurve=a,this._updateFalloffData()}}),d.prototype._updateFalloffData=function(){this._falloffData[0]=-this._falloffCurve,this._falloffData[1]=-1+this._falloffCurve,this._falloffData[2]=1/this._radius},b.exports=d},{"./light":234,"nanogl-camera":207}],236:[function(a,b,c){function d(){this._datas={},this._dataList=[],this._setup=null;var a;this.preLightsChunk=new e,this.postLightsChunk=new f,this.shadowChunk=new g(this),this.shadowFilter=new n("shadowFilter",["PCFNONE","PCF4x1","PCF4x4","PCF2x2"]),this.iblShadowing=new o("iblShadowing",!1),a=new j,this._datas[l.TYPE_DIR]=a,this._dataList.push(a),a=new i,this._datas[l.TYPE_SPOT]=a,this._dataList.push(a),a=new k,this._datas[l.TYPE_POINT]=a,this._dataList.push(a)}function e(){m.call(this,!0,!1)}function f(){m.call(this,!0,!1)}function g(a){m.call(this,!0,!0),this.lightModel=a,this.shadowCount=0,this.genCount=0,this._matrices=new Float32Array(16*y),this._texelBiasVector=new Float32Array(4*y),this._shadowmapSizes=new Float32Array(2*y),this._umatrices=null,this._utexelBiasVector=null,this._ushadowmapSizes=null}function h(){m.call(this,!0,!0),this.type=0,this.lights=[],this.shadowIndices=[],this.preCodeTemplate=null}function i(){h.call(this),this.type=l.TYPE_SPOT,this._directions=null,this._colors=null,this._positions=null,this._spot=null,this._falloff=null,this.preCodeTemplate=q}function j(){h.call(this),this.type=l.TYPE_DIR,this._directions=null,this._colors=null,this.preCodeTemplate=p}function k(){h.call(this),this.type=l.TYPE_POINT,this._colors=null,this._positions=null,this._falloff=null,this.preCodeTemplate=r}var l=a("./light"),m=a("../chunk"),n=a("../enum"),o=a("../flag"),p=a("../../glsl/templates/standard/directional-lights-pre"),q=a("../../glsl/templates/standard/spot-lights-pre"),r=a("../../glsl/templates/standard/point-lights-pre"),s=a("../../glsl/templates/standard/directional-light"),t=a("../../glsl/templates/standard/spot-light"),u=a("../../glsl/templates/standard/point-light"),v=a("../../glsl/templates/standard/shadow-maps-pre"),w=a("../../glsl/templates/standard/pre-light-setup"),x=a("../../glsl/templates/standard/post-light-setup");d.prototype={add:function(a){var b=this._datas[a._type];b.addLight(a)},remove:function(a){var b=this._datas[a._type];b.removeLight(a)},update:function(){this.shadowChunk.shadowCount=0;for(var a=0;a<this._dataList.length;a++)this._dataList[a].update(this);this.shadowChunk.check()},getChunks:function(){var a=[];a.push(this.iblShadowing.createProxy()),a.push(this.shadowFilter.createProxy()),a.push(this.shadowChunk.createProxy()),a.push(this.preLightsChunk.createProxy());for(var b=0;b<this._dataList.length;b++)a.push(this._dataList[b].createProxy());return a.push(this.postLightsChunk.createProxy()),a}},e.prototype=Object.create(m.prototype),e.prototype.constructor=e,e.prototype.genCode=function(a){code=w(this),a.add("lightsf",code)},e.prototype.getHash=function(){return"0"},f.prototype=Object.create(m.prototype),f.prototype.constructor=f,f.prototype.genCode=function(a){code=x(this),a.add("lightsf",code)},f.prototype.getHash=function(){return"0"};var y=4;g.prototype=Object.create(m.prototype),g.prototype.constructor=g;var z=Math.PI/4;g.prototype.genCode=function(a){this.shadowCount>0&&a.add("pf",v(this))},g.prototype.addLight=function(a){var b=this.shadowCount;this.shadowCount++,this._matrices.set(a.getShadowProjection(this.lightModel._setup.bounds),16*b),this._texelBiasVector.set(a.getTexelBiasVector(),4*b);var c=a._shadowmapSize;if(this._shadowmapSizes[2*b+0]=c,this._shadowmapSizes[2*b+1]=1/c,0===b){var d=a.hasDepthShadowmap();this.lightModel._setup.depthFormat.set(d?"D_DEPTH":"D_RGB")}return b},g.prototype.getHash=function(){return this.shadowCount},g.prototype.check=function(){this.genCount!==this.shadowCount&&(this.genCount=this.shadowCount,this._umatrices=new Float32Array(this._matrices.buffer,0,16*this.shadowCount),this._utexelBiasVector=new Float32Array(this._texelBiasVector.buffer,0,4*this.shadowCount),this._ushadowmapSizes=new Float32Array(this._shadowmapSizes.buffer,0,2*this.shadowCount),this.invalidate()),this._invalid=!0},g.prototype.setup=function(a){this.shadowCount>0&&(a.uShadowMatrices(this._umatrices),a.uShadowTexelBiasVector(this._utexelBiasVector),a.uShadowMapSize(this._ushadowmapSizes),void 0!==a.uShadowKernelRotation&&a.uShadowKernelRotation(.5*Math.cos(z),.5*Math.sin(z)),this._invalid=!1)},h.prototype=Object.create(m.prototype),h.prototype.constructor=h,h.prototype.addLight=function(a){this.lights.indexOf(a)===-1&&(this.lights.push(a),this.shadowIndices.push(-1),this.invalidate())},h.prototype.removeLight=function(a){var b=this.lights.indexOf(a);b>-1&&(this.lights.splice(b,1),this.shadowIndices.splice(b,1),this.invalidate())},h.prototype.genCode=function(a){var b=this.preCodeTemplate({count:this.lights.length});a.add("pf",b),b="";for(var c=0;c<this.lights.length;c++)b+=this.genCodePerLights(this.lights[c],c,this.shadowIndices[c]);a.add("lightsf",b)},h.prototype.genCodePerLights=function(a,b,c){},h.prototype.getHash=function(){for(var a=this.type+""+this.lights.length,b=0;b<this.lights.length;b++)this.lights[b]._castShadows&&(a+=b);return a},h.prototype.setup=function(a){for(var b=0;b<this.shadowIndices.length;b++){var c=this.shadowIndices[b];if(c>-1){var d=this.lights[b].getShadowmap();a["tShadowMap"+c](d)}}},i.prototype=Object.create(h.prototype),i.prototype.constructor=i,i.prototype.genCodePerLights=function(a,b,c){var d={index:b,shadowIndex:c};return t(d)},i.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a),this._positions=new Float32Array(3*a),this._spot=new Float32Array(2*a),this._falloff=new Float32Array(3*a))},i.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._positions.set(d._wposition,3*c),this._spot.set(d._spotData,2*c),this._falloff.set(d._falloffData,3*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},i.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLSpotDirections(this._directions),a.uLSpotColors(this._colors),a.uLSpotPositions(this._positions),a.uLSpotSpot(this._spot),a.uLSpotFalloff(this._falloff),this._invalid=!1)},j.prototype=Object.create(h.prototype),j.prototype.constructor=j,j.prototype.genCodePerLights=function(a,b,c){var d={index:b,shadowIndex:c};return s(d)},j.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a))},j.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},j.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLDirDirections(this._directions),a.uLDirColors(this._colors),this._invalid=!1)},k.prototype=Object.create(h.prototype),k.prototype.constructor=k,k.prototype.genCodePerLights=function(a,b,c){var d={index:b,shadowIndex:c};return u(d)},k.prototype.allocate=function(a){null!==this._colors&&this._colors.length/3===a||(this._colors=new Float32Array(3*a),this._positions=new Float32Array(3*a),this._falloff=new Float32Array(3*a))},k.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._colors.set(d._color,3*c),this._positions.set(d._wposition,3*c),this._falloff.set(d._falloffData,3*c),d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},k.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLPointColors(this._colors),a.uLPointPositions(this._positions),a.uLPointFalloff(this._falloff),this._invalid=!1)},b.exports=d},{"../../glsl/templates/standard/directional-light":216,"../../glsl/templates/standard/directional-lights-pre":217,"../../glsl/templates/standard/point-light":218,"../../glsl/templates/standard/point-lights-pre":219,"../../glsl/templates/standard/post-light-setup":220,"../../glsl/templates/standard/pre-light-setup":221,"../../glsl/templates/standard/shadow-maps-pre":222,"../../glsl/templates/standard/spot-light":223,"../../glsl/templates/standard/spot-lights-pre":224,"../chunk":227,"../enum":229,"../flag":230,"./light":234}],237:[function(a,b,c){function d(a){this.gl=a,this._cache={}}var e=a("./program"),f="#pragma SLOT",g=/^\s*#pragma SLOT\s\w+\s*$/gm;d.prototype={compile:function(a){var b=a.inputs;b.compile(),hash=b.getHash(),hash+=a._uid+a._precision;var c=this._cache[hash];if(void 0!==c)return c.usage++,c;var d=b.getCode(),f=this.processSlots(a._vertSrc,d),g=this.processSlots(a._fragSrc,d),h="precision "+a._precision+" float;\n",i=new e(this.gl,f,g,h);return i._usage++,this._cache[hash]=i,i},release:function(a){},_addProgram:function(a,b){this._cache[b]=a},processSlots:function(a,b){for(var c=0;c<b.slots.length;c++){var d=b.slots[c].code,e=b.slots[c].key;a=a.replace(f+" "+e,d)}return g.lastIndex=0,a=a.replace(g,"")}},d.getCache=function(a){return void 0===a._prgcache&&(a._prgcache=new d(a)),a._prgcache},b.exports=d},{"./program":238}],238:[function(a,b,c){function d(a,b,c,d){e.call(this,a,b,c,d),this._usage=0,this._currentMaterial=null}var e=a("nanogl/program");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setupInputs=function(a){for(var b=a.inputs._setups,c=!0,d=0;d<b.length;d++)(b[d]._invalid||c)&&b[d].setup(this);this._currentMaterial=a},b.exports=d},{"nanogl/program":253}],239:[function(a,b,c){function d(a){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iAlbedo=this.inputs.add(new h("albedo",3)),this.iSpecular=this.inputs.add(new h("specular",3)),this.iGloss=this.inputs.add(new h("gloss",1)),this.iNormal=this.inputs.add(new h("normal",3)),this.iOcclusion=this.inputs.add(new h("occlusion",1)),this.iCavity=this.inputs.add(new h("cavity",1)),this.iCavityStrength=this.inputs.add(new h("cavityStrength",2)),this.iEmissive=this.inputs.add(new h("emissive",1)),this.iEmissiveScale=this.inputs.add(new h("emissiveScale",1)),this.iFresnel=this.inputs.add(new h("fresnel",3)),this.conserveEnergy=this.inputs.add(new i("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new i("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new i("glossNearest",!1)),this.tonemap=this.inputs.add(new i("tonemap",!0)),this.config=new e,this._prgcache=g.getCache(a),this._uid="std",this._precision="highp",this._vertSrc=f(['#define GLSLIFY 1\n#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nattribute vec3 aTangent;\nattribute vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\nvarying mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  varying mediump vec3 vWorldTangent;\n  varying mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n    #if HAS_iblExpo\n      vIrradiance = iblExpo().x * pow( vIrradiance, vec3( iblExpo().y ) );\n    #endif\n  #endif\n\n  vTexCoord = aTexCoord;\n}']),
this._fragSrc=f(['#define GLSLIFY 1\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\nuniform vec3 uCameraPosition;\n\nvarying vec2 vTexCoord;\nvarying vec3 vWorldPosition;\n\nvarying mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  varying mediump vec3 vWorldTangent;\n  varying mediump vec3 vWorldBitangent;\n#endif\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  varying vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  \n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n// INCLUDES\n// =========\n\nvec2 octwrapDecode( vec3 v ) {\n  // Project the sphere onto the octahedron, and then onto the xy plan\n  vec2 p = v.xy / dot(  abs( v ) , vec3(1.0) );\n  p = vec2( p.x+p.y-1.0, p.x-p.y );\n\n  if( v.z < 0.0 )\n    p.x *= -1.0;\n\n  // p.x *= sign( v.z );\n  return p;\n}\n\nvec3 decodeRGBE( vec4 hdr ){\n  return hdr.rgb * exp2( (hdr.a*255.0)-128.0 );\n  // return hdr.rgb * pow( 2.0, (hdr.a*255.0)-128.0 );\n}\n\nconst vec2 _IBL_UVM_2281831123 = vec2(\n  0.25*(254.0/256.0),\n  0.125*0.5*(254.0/256.0)\n);\n\nvec3 SpecularIBL( sampler2D tEnv, vec3 skyDir, float roughness)\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  float r7   = 7.0*roughness;\n  float frac = fract(r7);\n\n  uvA = uvA * _IBL_UVM_2281831123 + vec2(\n      0.5,\n      0.125*0.5 + 0.125 * ( r7 - frac )\n    );\n\n  #if glossNearest\n\n    return decodeRGBE( texture2D(tEnv,uvA) );\n\n  #else\n\n    vec2 uvB=uvA+vec2(0.0,0.125);\n    return  mix(\n      decodeRGBE( texture2D(tEnv,uvA) ),\n      decodeRGBE( texture2D(tEnv,uvB) ),\n      frac\n    );\n\n  #endif\n\n}\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 sss,float ggg )\n{\n  float dot = ggg*ggg * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*sss + dot*fresnel();\n  #else\n    return( 1.0 - dot )*sss + dot;\n  #endif\n}\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n// ------------------------------\n//\nvec3 toneMap(vec3 c){\n  vec3 sqrtc = sqrt( c );\n  return(sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n}\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef=SampleSH(worldNormal, uSHCoeffs );\n    #if HAS_iblExpo\n      diffuseCoef = iblExpo().x * pow( diffuseCoef, vec3( iblExpo().y ) );\n    #endif\n  #endif\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n  #if HAS_iblExpo\n    specularColor = iblExpo().x * pow( specularColor, vec3( iblExpo().y ) );\n  #endif\n\n  #pragma SLOT lightsf\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n  #if HAS_cavity\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  #if tonemap\n    gl_FragColor.xyz = toneMap( diffuseCoef*albedoSq + specularColor );\n  #else\n    gl_FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n  #endif\n\n  gl_FragColor.a = 1.0;\n\n}'])}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("glslify"),g=a("./lib/program-cache"),h=a("./lib/input"),i=a("./lib/flag"),j=a("./lib/chunks-tree"),k=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a,this.inputs.addChunks(a.getChunks())},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.uWorldMatrix(a._wmatrix),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"./lib/chunks-tree":228,"./lib/flag":230,"./lib/input":231,"./lib/program-cache":237,"gl-matrix":192,glslify:205,"nanogl-state/config":244,"nanogl/program":253}],240:[function(a,b,c){function d(a,b,c){this.gl=a,this.usage=c||a.STATIC_DRAW,this.buffer=a.createBuffer(),this.attribs=[],this.stride=0,this.byteLength=0,this.length=0,b&&this.data(b)}var e=a("./bufferutils"),f=34962;d.prototype={bind:function(){this.gl.bindBuffer(f,this.buffer)},attrib:function(a,b,c,d){return this.attribs.push({name:a,type:0|c,size:0|b,normalize:!!d,offset:this.stride}),this.stride+=e.getComponentSize(c)*b,this._computeLength(),this},data:function(a){var b=this.gl;b.bindBuffer(f,this.buffer),b.bufferData(f,a,this.usage),b.bindBuffer(f,null),this.byteLength=void 0===a.byteLength?a:a.byteLength,this._computeLength()},subData:function(a,b){var c=this.gl;c.bindBuffer(f,this.buffer),c.bufferSubData(f,b,a),c.bindBuffer(f,null)},attribPointer:function(a){var b=this.gl;b.bindBuffer(f,this.buffer);for(var c=0;c<this.attribs.length;c++){var d=this.attribs[c];if(void 0!==a[d.name]){var e=a[d.name]();b.enableVertexAttribArray(e),b.vertexAttribPointer(e,d.size,d.type,d.normalize,this.stride,d.offset)}}},draw:function(a,b,c){b=void 0===b?this.length:b,this.gl.drawArrays(a,c,0|b)},dispose:function(){this.gl.deleteBuffer(this.buffer),this.buffer=null,this.gl=null},_computeLength:function(){this.stride>0&&(this.length=this.byteLength/this.stride)}},e.Drawable(d.prototype),b.exports=d},{"./bufferutils":241}],241:[function(a,b,c){b.exports={getComponentSize:function(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:return 0}},Drawable:function(a){a.drawPoints=function(a,b){this.draw(0,a,b)},a.drawLines=function(a,b){this.draw(1,a,b)},a.drawLineLoop=function(a,b){this.draw(2,a,b)},a.drawLineStrip=function(a,b){this.draw(3,a,b)},a.drawTriangles=function(a,b){this.draw(4,a,b)},a.drawTriangleStrip=function(a,b){this.draw(5,a,b)},a.drawTriangleFan=function(a,b){this.draw(6,a,b)}}}},{}],242:[function(a,b,c){function d(a,b,c,d,g){b=void 0===b?-1:b,c=void 0===c?-1:c,d=void 0===d?2:d,g=void 0===g?2:g,e.call(this,a);var h=f;h[0]=h[4]=b,h[1]=h[9]=c,h[8]=h[12]=b+d,h[5]=h[13]=c+g,this.data(h),this.attrib("aPosition",2,a.FLOAT),this.attrib("aTexCoord",2,a.FLOAT)}var e=a("nanogl/arraybuffer"),f=new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,1,1,1]);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.render=function(){this.drawTriangleStrip()},b.exports=d},{"nanogl/arraybuffer":240}],243:[function(a,b,c){var d=a("raf"),e=a("right-now"),f=function(){};b.exports=function(a){var b=void 0!==a.pixelRatio?a.pixelRatio:0,c=void 0===a.hdpi||a.hdpi,g=function(a){var d=this.getContextOptions();this.gl=a.getContext("webgl",d)||a.getContext("experimental-webgl",d)||a.getContext("webgl"),this.canvas=a,this.width=0,this.height=0,this.canvasWidth=0,this.canvasHeight=0,this.pixelRatio=b,this.hdpi=c,this.frame=this._frame.bind(this),this.previousTime=e(),this._rafId=0,this._playing=!1,this.init()},h=g.prototype;return h.getContextOptions=a.getContextOptions||function(){},h.render=a.render||f,h.resize=a.resize||f,h.init=a.init||f,h.dispose=function(){this.stop()},h.play=function(){this._playing||(this._playing=!0,this.frame(),this.previousTime=e(),this._requestFrame())},h.stop=function(){d.cancel(this._rafId),this._playing=!1,this._rafId=0},h.updateSize=function(){var a=1;this.pixelRatio>0?a=this.pixelRatio:this.hdpi&&(a=window.devicePixelRatio),this.canvas.width=a*this.canvasWidth,this.canvas.height=a*this.canvasHeight,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.resize()},h._checkSize=function(){var a=getComputedStyle(this.canvas),b=parseInt(a.getPropertyValue("width")),c=parseInt(a.getPropertyValue("height"));return!isNaN(b)&&!isNaN(c)&&0!==b&&0!==c&&(b===this.canvasWidth&&c===this.canvasHeight||(this.canvasWidth=b,this.canvasHeight=c,this.updateSize()),!0)},h._requestFrame=function(){d.cancel(this._rafId),this._rafId=d(this.frame)},h._frame=function(){if(this._playing){var a=e(),b=(a-this.previousTime)/1e3;this.previousTime=a,(b>.2||b<1/180)&&(b=1/60),this._checkSize()&&this.render(b),this._playing&&this._requestFrame()}},g}},{raf:260,"right-now":261}],244:[function(a,b,c){!function(){function a(a){return a|(4096&a)>>>2|(2048&a)>>>2|(524288&a)>>>3|(1048576&a)>>>3|(2097152&a)>>>3}function c(a){return 0|Math.round(65535*a)}function d(a){return a/65535}function e(a){var b=(31744&a)>>10,c=1023&a;return(a>>15?-1:1)*(b?31===b?c?NaN:1/0:Math.pow(2,b-15)*(1+c/1024):6103515625e-14*(c/1024))}function f(a){h[0]=a;var b=i[0],c=b>>31<<5,d=b>>23&255;return d=d-112&112-d>>4>>27,c=(c|d)<<10,c|=b>>13&1023}function g(){this._dat=new Uint16Array(51),this._set=0}var h=new Float32Array(1),i=new Uint32Array(h.buffer),j=[1,512,1024,1024,2048,4096,4096,4,8192,2,16384,32768,256,65536,65536,65536,262144,131072,131072,131072,524288,524288,524288,2097152,1048576,1048576,1048576,128,4194304,4194304,4194304,4194304,8,16,8388608,8388608,32,64,16777216,33554432,67108864,67108864,67108864,67108864,134217728,134217728,134217728,134217728,268435456,268435456,536870912],k=935847839,l=new Uint16Array([0,32774,0,1,0,0,0,0,513,0,1029,2305,0,519,0,65535,65535,7680,7680,7680,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,15,1,0,0,0,0,0,0,0,0,c(0),c(1),f(1)]),m=function(a,b){return a.getParameter(b)};g.DAT_MASKS=j,g.encodeHalf=function(a){return f(a)},g.decodeHalf=function(a){return e(a)},g.prototype={toDefault:function(){this._dat.set(l),this._set=0|k},clone:function(){var a=new g;return a._dat.set(this._dat),a._set=this._set,a},patch:function(b,c){for(var d,e=this._dat,f=this._set,g=b._dat,h=b._set,i=c._dat,k=0,l=0;51>l;l++)d=j[l],0!==(f&d)&&((0===(h&d)||e[l]!==g[l])&&(k|=d),g[l]=e[l]);i.set(g),b._set|=f,c._set=a(k)},setupGL:function(a){var b,c=this._set,f=this._dat;if(0!==(1&c)&&(f[0]?a.enable(3042):a.disable(3042)),b=2560&c,0!==b&&(2560===b?a.blendEquationSeparate(f[1],f[4]):a.blendEquation(f[1])),b=5120&c,0!==b&&(5120===b?a.blendFuncSeparate(f[3],f[2],f[6],f[5]):a.blendFunc(f[3],f[2])),0!==(4&c)&&(f[7]?a.enable(2929):a.disable(2929)),0!==(8192&c)&&a.depthFunc(f[8]),0!==(2&c)&&(f[9]?a.enable(2884):a.disable(2884)),0!==(16384&c)&&a.cullFace(f[10]),0!==(32768&c)&&a.frontFace(f[11]),0!==(536870912&c)&&a.lineWidth(e(f[50])),0!==(256&c)&&(f[12]?a.enable(2960):a.disable(2960)),b=589824&c,0!==b&&(589824===b?(a.stencilFuncSeparate(1028,f[13],f[14],f[15]),a.stencilFuncSeparate(1029,f[20],f[21],f[22])):a.stencilFunc(f[13],f[14],f[15])),b=1179648&c,0!==b&&(1179648===b?(a.stencilOpSeparate(1028,f[17],f[18],f[19]),a.stencilOpSeparate(1029,f[24],f[25],f[26])):a.stencilOp(f[17],f[18],f[19])),b=2359296&c,0!==b&&(2359296===b?(a.stencilMaskSeparate(1028,f[16]),a.stencilMaskSeparate(1029,f[23])):a.stencilMask(f[16])),0!==(16777216&c)){var g=f[38];a.colorMask(1===(1&g),2===(2&g),4===(4&g),8===(8&g))}0!==(33554432&c)&&a.depthMask(1===f[39]),0!==(67108864&c)&&a.blendColor(e(f[40]),e(f[41]),e(f[42]),e(f[43])),0!==(128&c)&&(f[27]?a.enable(3089):a.disable(3089)),0!==(4194304&c)&&a.scissor(f[28],f[29],f[30],f[31]),0!==(134217728&c)&&a.viewport(f[44],f[45],f[46],f[47]),0!==(16&c)&&(f[33]?a.enable(32823):a.disable(32823)),0!==(8388608&c)&&a.polygonOffset(e(f[34]),e(f[35])),0!==(268435456&c)&&a.depthRange(d(f[48]),d(f[49]))},fromGL:function(a){this._set=0;var b=m(a,3042),c=m(a,2884),d=m(a,2929),e=m(a,3024),f=m(a,32823),g=m(a,3089),h=m(a,2960),i=m(a,32969),j=m(a,32968),k=m(a,32971),l=m(a,32970),n=m(a,32777),o=m(a,34877),p=m(a,2962),q=m(a,2967),r=m(a,2963),s=m(a,2968),t=m(a,2964),u=m(a,2965),v=m(a,2966),w=m(a,34816),x=m(a,36003),y=m(a,36004),z=m(a,36005),A=m(a,34817),B=m(a,34818),C=m(a,34819),D=m(a,32824),E=m(a,10752),F=m(a,3088),G=m(a,3107),H=m(a,2930),I=m(a,32773),J=m(a,2978),K=m(a,2928),L=m(a,2849);this.enableBlend(b),i!==k||j!==l?this.blendFuncSeparate(i,j,k,l):this.blendFunc(i,j),n!==o?this.blendEquationSeparate(n,o):this.blendEquation(n),this.enableStencil(h),p!==w||q!==x||r!==y?this.stencilFuncSeparate(p,q,r,w,x,y):this.stencilFunc(p,q,r),t!==A||u!==B||v!==C?this.stencilOpSeparate(t,u,v,A,B,C):this.stencilOp(t,u,v),s!==z?this.stencilMaskSeparate(s,z):this.stencilMask(s),this.depthFunc(a.getParameter(2932)),this.enableDepthTest(d),this.cullFace(a.getParameter(2885)),this.enableCullface(c),this.frontFace(a.getParameter(2886)),this.enablePolygonOffset(f),this.polygonOffset(D,E),this.enableScissor(g),this.scissor(F[0],F[1],F[2],F[3]),this.enableDither(e),this.colorMask(G[0],G[1],G[2],G[3]),this.depthMask(H),this.blendColor(I[0],I[1],I[2],I[3]),this.viewport(J[0],J[1],J[2],J[3]),this.depthRange(K[0],K[1]),this.lineWidth(L)},enableBlend:function(a){return void 0===a&&(a=!0),this._dat[0]=0|a,this._set|=1,this},blendFunc:function(a,b){return this._dat[3]=a,this._dat[2]=b,this._set=-4097&this._set|1024,this},blendFuncSeparate:function(a,b,c,d){return this._dat[3]=a,this._dat[2]=b,this._dat[6]=c,this._dat[5]=d,this._set|=5120,this},blendEquation:function(a){return this._dat[1]=a,this._set=-2049&this._set|512,this},blendEquationSeparate:function(a,b){return this._dat[1]=a,this._dat[4]=b,this._set|=2560,this},blendColor:function(a,b,c,d){return this._dat[40]=f(a),this._dat[41]=f(b),this._dat[42]=f(c),this._dat[43]=f(d),this._set|=67108864,this},depthFunc:function(a){return this._dat[8]=a,this._set|=8192,this},enableDepthTest:function(a){return void 0===a&&(a=!0),this._dat[7]=0|a,this._set|=4,this},depthRange:function(a,b){return this._dat[48]=c(a),this._dat[49]=c(b),this._set|=268435456,this},lineWidth:function(a){return this._dat[50]=f(a),this._set|=536870912,this},cullFace:function(a){return this._dat[10]=a,this._set|=16384,this},enableCullface:function(a){return void 0===a&&(a=!0),this._dat[9]=0|a,this._set|=2,this},polygonOffset:function(a,b){return this._dat[34]=f(a),this._dat[35]=f(b),this._set|=8388608,this},enablePolygonOffset:function(a){return void 0===a&&(a=!0),this._dat[33]=0|a,this._set|=16,this},enableScissor:function(a){return void 0===a&&(a=!0),this._dat[27]=0|a,this._set|=128,this},scissor:function(a,b,c,d){return this._dat[28]=a,this._dat[29]=b,this._dat[30]=c,this._dat[31]=d,this._set|=4194304,this},viewport:function(a,b,c,d){return this._dat[44]=a,this._dat[45]=b,this._dat[46]=c,this._dat[47]=d,this._set|=134217728,this},enableDither:function(a){return void 0===a&&(a=!0),this._dat[32]=0|a,this._set|=8,this},depthMask:function(a){return this._dat[39]=0|a,this._set|=33554432,this},colorMask:function(a,b,c,d){var e=0|a|(0|b)<<1|(0|c)<<2|(0|d)<<3;return this._dat[38]=e,this._set|=16777216,this},frontFace:function(a){return this._dat[11]=a,this._set|=32768,this},enableStencil:function(a){return void 0===a&&(a=!0),this._dat[12]=0|a,this._set|=256,this},stencilFunc:function(a,b,c){return this._dat[13]=a,this._dat[14]=b,this._dat[15]=c,this._set=-524289&this._set|65536,this},stencilOp:function(a,b,c){return this._dat[17]=a,this._dat[18]=b,this._dat[19]=c,this._set=-1048577&this._set|131072,this},stencilMask:function(a){return this._dat[16]=a,this._set=-2097153&this._set|262144,this},stencilFuncSeparate:function(a,b,c,d,e,f){var g=this._dat;return g[13]=a,g[14]=b,g[15]=c,g[20]=d,g[21]=e,g[22]=f,this._set|=589824,this},stencilOpSeparate:function(a,b,c,d,e,f){var g=this._dat;return g[17]=a,g[18]=b,g[19]=c,g[24]=d,g[25]=e,g[26]=f,this._set|=1179648,this},stencilMaskSeparate:function(a,b){return this._dat[16]=a,this._dat[23]=b,this._set|=2359296,this}},b.exports=g}()},{}],245:[function(a,b,c){!function(){function c(){this._stack=new Uint32Array(816),this._sets=new Uint32Array(16),this._tmpDat=new Uint32Array(51),this._size=16,this._ptr=0,this._headPos=0,this._wcfg=new d}var d=a("./config"),e=d.DAT_MASKS;c.prototype={initFromGL:function(a){this._ptr=0,this._wcfg.fromGL(a),this._sets[0]=0,this._stack.set(this._wcfg._dat)},push:function(a){var b,c,d,f,g,h,i,j=this._ptr,k=this._sets[j++],l=a._set;for(j==this._size&&this._grow(),k|=l,this._sets[j]=k,this._ptr=j,b=51*j,c=this._stack,d=a._dat,f=this._tmpDat,g=0;51>g;g++)h=e[g],i=0!==(l&h)?d[g]:c[b+g-51],f[g]=i;c.set(f,b)},pop:function(){var a=--this._ptr;this._headPos>a&&(this._sets[a]|=this._sets[a+1],this._headPos=a)},flush:function(){for(;this._ptr>0;)this.pop()},commit:function(a){var b=this._ptr;this.copyConfig(b,a),this._headPos=b,this._sets[b-1]|=this._sets[b],this._sets[b]=0},patch:function(a,b){this.copyConfig(this._ptr,this._wcfg),this._wcfg.patch(a,b)},copyConfig:function(a,b){var c=new Uint32Array(this._stack.buffer,204*a,51);b._dat.set(c),b._set=this._sets[a]},_grow:function(){var a=this._size<<1,b=new Uint32Array(51*a),c=new Uint32Array(a);b.set(this._stack,0),c.set(this._sets,0),this._stack=b,this._sets=c,this._size=a}},b.exports=c}()},{"./config":244}],246:[function(a,b,c){function d(a){this.gl=a,this.cfgStack=new g,this.cfgStack.initFromGL(a),this._validCfg=!1}function e(a){f.call(this),this.state=a}var f=a("./config"),g=a("./stack"),h=new f;d.prototype={push:function(a){this.cfgStack.push(a),this._validCfg=!1},pop:function(){this.cfgStack.pop(),this._validCfg=!1},apply:function(){this._validCfg||(this.cfgStack.commit(h),h.setupGL(this.gl),this._validCfg=!0)},now:function(a){this.push(a),this.apply(),this.pop()},config:function(){return new e(this)}},e.prototype=Object.create(f.prototype),e.prototype.constructor=e,e.prototype.apply=function(){this.state.now(this)},d.config=function(){return new f},b.exports=d},{"./config":244,"./stack":245}],247:[function(a,b,c){function d(){if("undefined"!=typeof g&&g.defer)return g.defer();var a={resolve:null,reject:null};return a.promise=new g(function(b,c){a.resolve=b,a.reject=c}.bind(a)),Object.freeze(a),a}function e(a){var b=h[a._uid];b&&(b.img.onload=b.img.onerror=null,b.img.src="",b.defer.reject(a)),delete h[a._uid]}function f(a){return a.fromImage(h[a._uid].img),e(a),a}var g=a("when/es6-shim/Promise.browserify-es6"),h={},i={};i.load=function(a,b){e(a);var c=d(),g=new Image;return g.onload=function(){c.resolve(a)},g.onerror=function(){c.reject(a),e(a)},g.crossOrigin="anonymous",g.src=b,h[a._uid]={texture:a,img:g,defer:c},c.promise.then(f),c.promise},i.release=function(a){e(a)},b.exports=i},{"when/es6-shim/Promise.browserify-es6":262}],248:[function(a,b,c){function d(a){this.gl=a,this._ext=a.getExtension("OES_vertex_array_object"),this._ext?this._impl=new e(this):this._impl=new f(this)}function e(a){this._vao=a,this._handle=null}function f(a){this._vao=a}d.prototype={dispose:function(){this._impl.dispose(),this._impl=null,this._ext=null},setup:function(a,b,c){a.ready||a._grabParameters(),this._impl.setup(a,b,c)},bind:function(){this._impl.bind()},unbind:function(){this._impl.unbind()}},e.prototype={dispose:function(){this.release(),this._vao=null},setup:function(a,b,c){this.release();var d=this._vao._ext;this._handle=d.createVertexArrayOES(),d.bindVertexArrayOES(this._handle);for(var e=0;e<b.length;e++)b[e].attribPointer(a);void 0!==c&&c.bind(),d.bindVertexArrayOES(null)},bind:function(){var a=this._vao._ext;a.bindVertexArrayOES(this._handle)},unbind:function(){var a=this._vao._ext;a.bindVertexArrayOES(null)},release:function(){var a=this._vao._ext;this._handle&&(a.deleteVertexArrayOES(this._handle),this._handle=null)}},f.prototype={dispose:function(){this._vao=null,this.prg=null,this.buffers=null,this.indices=null},setup:function(a,b,c){this.prg=a,this.buffers=b,this.indices=c},bind:function(){for(var a=0;a<this.buffers.length;a++)this.buffers[a].attribPointer(this.prg);void 0!==this.indices&&this.indices.bind()},unbind:function(){}},b.exports=d},{}],249:[function(a,b,c){arguments[4][240][0].apply(c,arguments)},{"./bufferutils":250,dup:240}],250:[function(a,b,c){arguments[4][241][0].apply(c,arguments)},{dup:241}],251:[function(a,b,c){arguments[4][211][0].apply(c,arguments)},{"./texture":254,dup:211}],252:[function(a,b,c){function d(a,b,c,d){this.gl=a,this.buffer=a.createBuffer(),this.usage=d||a.STATIC_DRAW,this.type=0,this.typeSize=0,this.size=0,this.setType(b||a.UNSIGNED_SHORT),c&&this.data(c)}var e=a("./bufferutils"),f=34963;d.prototype={bind:function(){this.gl.bindBuffer(f,this.buffer)},setType:function(a){this.type=a,this.typeSize=e.getComponentSize(a)},data:function(a){var b=this.gl;b.bindBuffer(f,this.buffer),b.bufferData(f,a,this.usage),b.bindBuffer(f,null),this.size=void 0===a.byteLength?a:a.byteLength},subData:function(a,b){var c=this.gl;c.bindBuffer(f,this.buffer),c.bufferSubData(f,b,a),c.bindBuffer(f,null)},dispose:function(){this.gl.deleteBuffer(this.buffer),this.buffer=null,this.gl=null},draw:function(a,b,c){b=void 0===b?this.size/this.typeSize:b,this.gl.drawElements(a,b,this.type,0|c)}},e.Drawable(d.prototype),b.exports=d},{"./bufferutils":250}],253:[function(a,b,c){function d(a,b,c,d){this.gl=a,this.program=a.createProgram(),this.vShader=a.createShader(a.VERTEX_SHADER),this.fShader=a.createShader(a.FRAGMENT_SHADER),this.dyns=[],this.ready=!1,a.attachShader(this.program,this.vShader),a.attachShader(this.program,this.fShader),this._uid=0|o++,this._cuid=0|o++,void 0!==b&&void 0!==c&&this.compile(b,c,d)}function e(a){console.warn(a)}function f(a,b){return p[String(b+1).length]+(b+1)+": "+a}function g(a){return a.split("\n").map(f).join("\n")}function h(a,b,c){return a.shaderSource(b,c),a.compileShader(b),!(d.debug&&!a.getShaderParameter(b,a.COMPILE_STATUS))||(e(a.getShaderInfoLog(b)),e(g(c)),!1)}function i(a){return a=String(a),"uniform"+q[a]}function j(a,b,c,d){switch(a){case c.FLOAT_MAT2:case c.FLOAT_MAT3:case c.FLOAT_MAT4:return l(a,b,c,d);case c.SAMPLER_2D:case c.SAMPLER_CUBE:return m(a,b,c,d);default:return k(a,b,c,d)}}function k(a,b,c,d){var e=i(a);return function(){return 1===arguments.length&&void 0!==arguments[0].length?c[e+"v"](b,arguments[0]):arguments.length>0&&c[e].apply(c,Array.prototype.concat.apply(b,arguments)),b}}function l(a,b,c,d){var e=i(a);return function(){if(arguments.length>0&&void 0!==arguments[0].length){var a=arguments.length>1&&!!arguments[1];c[e+"v"](b,a,arguments[0])}return b}}function m(a,b,c,d){var e=d.texIndex++;return function(){return 1===arguments.length&&(void 0!==arguments[0].bind?(arguments[0].bind(e),c.uniform1i(b,e)):c.uniform1i(b,arguments[0])),b}}function n(a){return function(){return a}}var o=0;d.debug=!0,d.prototype={use:function(){this.ready||this._grabParameters(),this.gl.useProgram(this.program)},compile:function(a,b,c){this.ready=!1,c=(c||"")+"\n";var f=this.gl;if(!h(f,this.fShader,c+b)||!h(f,this.vShader,c+a))return!1;if(f.linkProgram(this.program),d.debug&&!f.getProgramParameter(this.program,f.LINK_STATUS))return e(f.getProgramInfoLog(this.program)),!1;for(;this.dyns.length>0;)delete this[this.dyns.pop()];return this._cuid=0|o++,!0},dispose:function(){null!==this.gl&&(this.gl.deleteProgram(this.program),this.gl.deleteShader(this.fShader),this.gl.deleteShader(this.vShader),this.gl=null)},_grabParameters:function(){for(var a=this.gl,b=this.program,c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS),d={texIndex:0},e=0;e<c;++e){var f=a.getActiveUniform(b,e);if(null!==f){var g=f.name,h=g.indexOf("[");h>=0&&(g=g.substring(0,h));var i=a.getUniformLocation(b,f.name);this[g]=j(f.type,i,a,d),this.dyns.push(g)}else a.getError()}for(var k=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES),l=0;l<k;++l){var m=a.getActiveAttrib(b,l).name,o=a.getAttribLocation(b,m);this[m]=n(o),this.dyns.push(m)}this.ready=!0}},d.prototype.bind=d.prototype.use;var p=["","   ","  "," ",""],q={};q[5126]="1f",q[35664]="2f",q[35665]="3f",q[35666]="4f",q[35670]=q[5124]=q[35678]=q[35680]="1i",q[35671]=q[35667]="2i",q[35672]=q[35668]="3i",q[35673]=q[35669]="4i",q[35674]="Matrix2f",q[35675]="Matrix3f",q[35676]="Matrix4f",b.exports=d},{}],254:[function(a,b,c){arguments[4][212][0].apply(c,arguments)},{dup:212}],255:[function(a,b,c){(function(a){(function(){var c,d,e;"undefined"!=typeof performance&&null!==performance&&performance.now?b.exports=function(){return performance.now()}:"undefined"!=typeof a&&null!==a&&a.hrtime?(b.exports=function(){return(c()-e)/1e6},d=a.hrtime,c=function(){var a;return a=d(),1e9*a[0]+a[1]},e=c()):Date.now?(b.exports=function(){return Date.now()-e},e=Date.now()):(b.exports=function(){return(new Date).getTime()-e},e=(new Date).getTime())}).call(this)}).call(this,a("_process"))},{_process:258}],256:[function(a,b,c){function d(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,m,n,o){for(var p=h,q=0;q<=g;q++)for(var r=0;r<=f;r++){var s=i[h]=[0,0,0];s[a]=(-d/2+r*d/f)*n,s[b]=(-e/2+q*e/g)*o,s[c]=m;var t=j[h]=[0,0,0];t[a]=0,t[b]=0,t[c]=m/Math.abs(m);var u=k[h]=[0,0];u[0]=r/f,u[1]=1-q/g,++h}for(var q=0;q<g;q++)for(var r=0;r<f;r++){var v=p+q*(f+1)+r;l.push([v,v+f+1,v+f+2]),l.push([v,v+f+2,v+1])}}void 0===a&&(a=1),void 0===b&&(b=a),void 0===c&&(c=a),void 0===d&&(d=1),void 0===e&&(e=d),void 0===f&&(f=d);var h=0,i=[],j=[],k=[],l=[];return g(0,1,2,a,b,d,e,c/2,1,-1),g(0,1,2,a,b,d,e,-c/2,-1,-1),g(2,1,0,c,b,f,e,-a/2,1,-1),g(2,1,0,c,b,f,e,a/2,-1,-1),g(0,2,1,a,c,d,f,b/2,1,1),g(0,2,1,a,c,d,f,-b/2,1,-1),{positions:i,normals:j,uvs:k,cells:l}}b.exports=d},{}],257:[function(a,b,c){function d(a,b){b=b||{},a="undefined"!=typeof a?a:1;for(var c="undefined"!=typeof b.segments?b.segments:32,d=2+c,o=2*d,p=[],q=[],r=[],s=[],t=0;t<=d;t++){for(var u=t/d,v=u*Math.PI,w=0;w<=o;w++){var x=w/o,y=x*Math.PI*2;e(l),g(l,l,-v),e(k),f(k,k,y),i(n,m,l),i(n,n,k),h(n,n,-a),q.push(n.slice()),j(n,n),r.push(n.slice()),s.push([x,1-u])}if(t>0)for(var z=q.length,A=z-2*(o+1);A+o+2<z;A++)p.push([A,A+1,A+o+1]),p.push([A+o+1,A+1,A+o+2])}return{cells:p,positions:q,normals:r,uvs:s}}var e=a("gl-mat4/identity"),f=a("gl-mat4/rotateY"),g=a("gl-mat4/rotateZ"),h=a("gl-vec3/scale"),i=a("gl-vec3/transformMat4"),j=a("gl-vec3/normalize"),k=e([]),l=e([]),m=[0,1,0],n=[0,0,0];b.exports=d},{"gl-mat4/identity":189,"gl-mat4/rotateY":190,"gl-mat4/rotateZ":191,"gl-vec3/normalize":202,"gl-vec3/scale":203,"gl-vec3/transformMat4":204}],258:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],259:[function(a,b,c){!function(a){function c(){}function d(a,b){return function(){a.apply(b,arguments)}}function e(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],k(a,this)}function f(a,b){for(;3===a._state;)a=a._value;return 0===a._state?void a._deferreds.push(b):(a._handled=!0,void e._immediateFn(function(){var c=1===a._state?b.onFulfilled:b.onRejected;if(null===c)return void(1===a._state?g:h)(b.promise,a._value);var d;try{d=c(a._value)}catch(a){return void h(b.promise,a)}g(b.promise,d)}))}function g(a,b){try{if(b===a)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"==typeof b||"function"==typeof b)){var c=b.then;if(b instanceof e)return a._state=3,a._value=b,void i(a);if("function"==typeof c)return void k(d(c,b),a)}a._state=1,a._value=b,i(a)}catch(b){h(a,b)}}function h(a,b){a._state=2,a._value=b,i(a)}function i(a){2===a._state&&0===a._deferreds.length&&e._immediateFn(function(){a._handled||e._unhandledRejectionFn(a._value)});for(var b=0,c=a._deferreds.length;b<c;b++)f(a,a._deferreds[b]);a._deferreds=null}function j(a,b,c){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.promise=c}function k(a,b){var c=!1;try{a(function(a){c||(c=!0,g(b,a))},function(a){c||(c=!0,h(b,a))})}catch(a){if(c)return;c=!0,h(b,a)}}var l=setTimeout;e.prototype.catch=function(a){return this.then(null,a)},e.prototype.then=function(a,b){var d=new this.constructor(c);return f(this,new j(a,b,d)),d},e.all=function(a){var b=Array.prototype.slice.call(a);return new e(function(a,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}b[f]=g,0===--e&&a(b)}catch(a){c(a)}}if(0===b.length)return a([]);for(var e=b.length,f=0;f<b.length;f++)d(f,b[f])})},e.resolve=function(a){return a&&"object"==typeof a&&a.constructor===e?a:new e(function(b){b(a)})},e.reject=function(a){return new e(function(b,c){c(a)})},e.race=function(a){return new e(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c)})},e._immediateFn="function"==typeof setImmediate&&function(a){setImmediate(a)}||function(a){l(a,0)},e._unhandledRejectionFn=function(a){
"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",a)},e._setImmediateFn=function(a){e._immediateFn=a},e._setUnhandledRejectionFn=function(a){e._unhandledRejectionFn=a},"undefined"!=typeof b&&b.exports?b.exports=e:a.Promise||(a.Promise=e)}(this)},{}],260:[function(a,b,c){(function(c){for(var d=a("performance-now"),e="undefined"==typeof window?c:window,f=["moz","webkit"],g="AnimationFrame",h=e["request"+g],i=e["cancel"+g]||e["cancelRequest"+g],j=0;!h&&j<f.length;j++)h=e[f[j]+"Request"+g],i=e[f[j]+"Cancel"+g]||e[f[j]+"CancelRequest"+g];if(!h||!i){var k=0,l=0,m=[],n=1e3/60;h=function(a){if(0===m.length){var b=d(),c=Math.max(0,n-(b-k));k=c+b,setTimeout(function(){var a=m.slice(0);m.length=0;for(var b=0;b<a.length;b++)if(!a[b].cancelled)try{a[b].callback(k)}catch(a){setTimeout(function(){throw a},0)}},Math.round(c))}return m.push({handle:++l,callback:a,cancelled:!1}),l},i=function(a){for(var b=0;b<m.length;b++)m[b].handle===a&&(m[b].cancelled=!0)}}b.exports=function(a){return h.call(e,a)},b.exports.cancel=function(){i.apply(e,arguments)},b.exports.polyfill=function(){e.requestAnimationFrame=h,e.cancelAnimationFrame=i}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"performance-now":255}],261:[function(a,b,c){(function(a){b.exports=a.performance&&a.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],262:[function(a,b,c){(function(c){var d=a("../lib/decorators/unhandledRejection"),e=d(a("../lib/Promise"));b.exports="undefined"!=typeof c?c.Promise=e:"undefined"!=typeof self?self.Promise=e:e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../lib/Promise":263,"../lib/decorators/unhandledRejection":274}],263:[function(a,b,c){!function(a){"use strict";a(function(a){var b=a("./makePromise"),c=a("./Scheduler"),d=a("./env").asap;return b({scheduler:new c(d)})})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"./Scheduler":264,"./env":276,"./makePromise":278}],264:[function(a,b,c){!function(a){"use strict";a(function(){function a(a){this._async=a,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var b=this;this.drain=function(){b._drain()}}return a.prototype.enqueue=function(a){this._queue[this._queueLen++]=a,this.run()},a.prototype.afterQueue=function(a){this._afterQueue[this._afterQueueLen++]=a,this.run()},a.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},a.prototype._drain=function(){for(var a=0;a<this._queueLen;++a)this._queue[a].run(),this._queue[a]=void 0;for(this._queueLen=0,this._running=!1,a=0;a<this._afterQueueLen;++a)this._afterQueue[a].run(),this._afterQueue[a]=void 0;this._afterQueueLen=0},a})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],265:[function(a,b,c){!function(a){"use strict";a(function(){function a(b){Error.call(this),this.message=b,this.name=a.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],266:[function(a,b,c){!function(a){"use strict";a(function(){function a(a,c){function d(b,d,f){var g=a._defer(),h=f.length,i=new Array(h);return e({f:b,thisArg:d,args:f,params:i,i:h-1,call:c},g._handler),g}function e(b,d){if(b.i<0)return c(b.f,b.thisArg,b.params,d);var e=a._handler(b.args[b.i]);e.fold(f,b,void 0,d)}function f(a,b,c){a.params[a.i]=b,a.i-=1,e(a,c)}return arguments.length<2&&(c=b),d}function b(a,b,c,d){try{d.resolve(a.apply(b,c))}catch(a){d.reject(a)}}return a.tryCatchResolve=b,a})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],267:[function(a,b,c){!function(a){"use strict";a(function(a){var b=a("../state"),c=a("../apply");return function(a){function d(b){function c(a){k=null,this.resolve(a)}function d(a){this.resolved||(k.push(a),0===--j&&this.reject(k))}for(var e,f,g=a._defer(),h=g._handler,i=b.length>>>0,j=i,k=[],l=0;l<i;++l)if(f=b[l],void 0!==f||l in b){if(e=a._handler(f),e.state()>0){h.become(e),a._visitRemaining(b,l,e);break}e.visit(h,c,d)}else--j;return 0===j&&h.reject(new RangeError("any(): array must not be empty")),g}function e(b,c){function d(a){this.resolved||(k.push(a),0===--n&&(l=null,this.resolve(k)))}function e(a){this.resolved||(l.push(a),0===--f&&(k=null,this.reject(l)))}var f,g,h,i=a._defer(),j=i._handler,k=[],l=[],m=b.length>>>0,n=0;for(h=0;h<m;++h)g=b[h],(void 0!==g||h in b)&&++n;for(c=Math.max(c,0),f=n-c+1,n=Math.min(c,n),c>n?j.reject(new RangeError("some(): array must contain at least "+c+" item(s), but had "+n)):0===n&&j.resolve(k),h=0;h<m;++h)g=b[h],(void 0!==g||h in b)&&a._handler(g).visit(j,d,e,j.notify);return i}function f(b,c){return a._traverse(c,b)}function g(b,c){var d=s.call(b);return a._traverse(c,d).then(function(a){return h(d,a)})}function h(b,c){for(var d=c.length,e=new Array(d),f=0,g=0;f<d;++f)c[f]&&(e[g++]=a._handler(b[f]).value);return e.length=g,e}function i(a){return p(a.map(j))}function j(c){var d=a._handler(c);return 0===d.state()?o(c).then(b.fulfilled,b.rejected):(d._unreport(),b.inspect(d))}function k(a,b){return arguments.length>2?q.call(a,m(b),arguments[2]):q.call(a,m(b))}function l(a,b){return arguments.length>2?r.call(a,m(b),arguments[2]):r.call(a,m(b))}function m(a){return function(b,c,d){return n(a,void 0,[b,c,d])}}var n=c(a),o=a.resolve,p=a.all,q=Array.prototype.reduce,r=Array.prototype.reduceRight,s=Array.prototype.slice;return a.any=d,a.some=e,a.settle=i,a.map=f,a.filter=g,a.reduce=k,a.reduceRight=l,a.prototype.spread=function(a){return this.then(p).then(function(b){return a.apply(this,b)})},a}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"../apply":266,"../state":279}],268:[function(a,b,c){!function(a){"use strict";a(function(){function a(){throw new TypeError("catch predicate must be a function")}function b(a,b){return c(b)?a instanceof b:b(a)}function c(a){return a===Error||null!=a&&a.prototype instanceof Error}function d(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function e(a){return a}return function(c){function f(a,c){return function(d){return b(d,c)?a.call(this,d):j(d)}}function g(a,b,c,e){var f=a.call(b);return d(f)?h(f,c,e):c(e)}function h(a,b,c){return i(a).then(function(){return b(c)})}var i=c.resolve,j=c.reject,k=c.prototype.catch;return c.prototype.done=function(a,b){this._handler.visit(this._handler.receiver,a,b)},c.prototype.catch=c.prototype.otherwise=function(b){return arguments.length<2?k.call(this,b):"function"!=typeof b?this.ensure(a):k.call(this,f(arguments[1],b))},c.prototype.finally=c.prototype.ensure=function(a){return"function"!=typeof a?this:this.then(function(b){return g(a,this,e,b)},function(b){return g(a,this,j,b)})},c.prototype.else=c.prototype.orElse=function(a){return this.then(void 0,function(){return a})},c.prototype.yield=function(a){return this.then(function(){return a})},c.prototype.tap=function(a){return this.then(a).yield(this)},c}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],269:[function(a,b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype.fold=function(b,c){var d=this._beget();return this._handler.fold(function(c,d,e){a._handler(c).fold(function(a,c,d){d.resolve(b.call(this,c,a))},d,this,e)},c,d._handler.receiver,d._handler),d},a}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],270:[function(a,b,c){!function(a){"use strict";a(function(a){var b=a("../state").inspect;return function(a){return a.prototype.inspect=function(){return b(a._handler(this))},a}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"../state":279}],271:[function(a,b,c){!function(a){"use strict";a(function(){return function(a){function b(a,b,d,e){return c(function(b){return[b,a(b)]},b,d,e)}function c(a,b,e,f){function g(f,g){return d(e(f)).then(function(){return c(a,b,e,g)})}return d(f).then(function(c){return d(b(c)).then(function(b){return b?c:d(a(c)).spread(g)})})}var d=a.resolve;return a.iterate=b,a.unfold=c,a}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],272:[function(a,b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype.progress=function(a){return this.then(void 0,void 0,a)},a}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],273:[function(a,b,c){!function(a){"use strict";a(function(a){function b(a,b,d,e){return c.setTimer(function(){a(d,e,b)},b)}var c=a("../env"),d=a("../TimeoutError");return function(a){function e(a,c,d){b(f,a,c,d)}function f(a,b){b.resolve(a)}function g(a,b,c){var e="undefined"==typeof a?new d("timed out after "+c+"ms"):a;b.reject(e)}return a.prototype.delay=function(a){var b=this._beget();return this._handler.fold(e,a,void 0,b._handler),b},a.prototype.timeout=function(a,d){var e=this._beget(),f=e._handler,h=b(g,a,d,e._handler);return this._handler.visit(f,function(a){c.clearTimer(h),this.resolve(a)},function(a){c.clearTimer(h),this.reject(a)},f.notify),e},a}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"../TimeoutError":265,"../env":276}],274:[function(a,b,c){!function(a){"use strict";a(function(a){function b(a){throw a}function c(){}var d=a("../env").setTimer,e=a("../format");return function(a){function f(a){a.handled||(n.push(a),k("Potentially unhandled rejection ["+a.id+"] "+e.formatError(a.value)))}function g(a){var b=n.indexOf(a);b>=0&&(n.splice(b,1),l("Handled previous rejection ["+a.id+"] "+e.formatObject(a.value)))}function h(a,b){m.push(a,b),null===o&&(o=d(i,0))}function i(){for(o=null;m.length>0;)m.shift()(m.shift())}var j,k=c,l=c;"undefined"!=typeof console&&(j=console,k="undefined"!=typeof j.error?function(a){j.error(a)}:function(a){j.log(a)},l="undefined"!=typeof j.info?function(a){j.info(a)}:function(a){j.log(a)}),a.onPotentiallyUnhandledRejection=function(a){h(f,a)},a.onPotentiallyUnhandledRejectionHandled=function(a){h(g,a)},a.onFatalRejection=function(a){h(b,a.value)};var m=[],n=[],o=null;return a}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"../env":276,"../format":277}],275:[function(a,b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype.with=a.prototype.withThis=function(a){var b=this._beget(),c=b._handler;return c.receiver=a,this._handler.chain(c,a),b},a}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],276:[function(a,b,c){(function(c){!function(a){"use strict";a(function(a){function b(){return"undefined"!=typeof c&&"[object process]"===Object.prototype.toString.call(c)}function d(){return"function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver}function e(a){function b(){var a=c;c=void 0,a()}var c,d=document.createTextNode(""),e=new a(b);e.observe(d,{characterData:!0});var f=0;return function(a){c=a,d.data=f^=1}}var f,g="undefined"!=typeof setTimeout&&setTimeout,h=function(a,b){return setTimeout(a,b)},i=function(a){return clearTimeout(a)},j=function(a){return g(a,0)};if(b())j=function(a){return c.nextTick(a)};else if(f=d())j=e(f);else if(!g){var k=a,l=k("vertx");h=function(a,b){return l.setTimer(b,a)},i=l.cancelTimer,j=l.runOnLoop||l.runOnContext}return{setTimer:h,clearTimer:i,asap:j}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})}).call(this,a("_process"))},{_process:258}],277:[function(a,b,c){!function(a){"use strict";a(function(){function a(a){var c="object"==typeof a&&null!==a&&(a.stack||a.message)?a.stack||a.message:b(a);return a instanceof Error?c:c+" (WARNING: non-Error used)"}function b(a){var b=String(a);return"[object Object]"===b&&"undefined"!=typeof JSON&&(b=c(a,b)),b}function c(a,b){try{return JSON.stringify(a)}catch(a){return b}}return{formatError:a,formatObject:b,tryStringify:c}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],278:[function(a,b,c){(function(a){!function(b){"use strict";b(function(){return function(b){function c(a,b){this._handler=a===u?b:d(a)}function d(a){function b(a){e.resolve(a)}function c(a){e.reject(a)}function d(a){e.notify(a)}var e=new w;try{a(b,c,d)}catch(a){c(a)}return e}function e(a){return J(a)?a:new c(u,new x(r(a)))}function f(a){return new c(u,new x(new A(a)))}function g(){return aa}function h(){return new c(u,new w)}function i(a,b){var c=new w(a.receiver,a.join().context);return new b(u,c)}function j(a){return l(T,null,a)}function k(a,b){return l(O,a,b)}function l(a,b,d){function e(c,e,g){g.resolved||m(d,f,c,a(b,e,c),g)}function f(a,b,c){k[a]=b,0===--j&&c.become(new z(k))}for(var g,h="function"==typeof b?e:f,i=new w,j=d.length>>>0,k=new Array(j),l=0;l<d.length&&!i.resolved;++l)g=d[l],void 0!==g||l in d?m(d,h,l,g,i):--j;return 0===j&&i.become(new z(k)),new c(u,i)}function m(a,b,c,d,e){if(K(d)){var f=s(d),g=f.state();0===g?f.fold(b,c,void 0,e):g>0?b(c,f.value,e):(e.become(f),n(a,c+1,f))}else b(c,d,e)}function n(a,b,c){for(var d=b;d<a.length;++d)o(r(a[d]),c)}function o(a,b){if(a!==b){var c=a.state();0===c?a.visit(a,void 0,a._unreport):c<0&&a._unreport()}}function p(a){return"object"!=typeof a||null===a?f(new TypeError("non-iterable passed to race()")):0===a.length?g():1===a.length?e(a[0]):q(a)}function q(a){var b,d,e,f=new w;for(b=0;b<a.length;++b)if(d=a[b],void 0!==d||b in a){if(e=r(d),0!==e.state()){f.become(e),n(a,b+1,e);break}e.visit(f,f.resolve,f.reject)}return new c(u,f)}function r(a){return J(a)?a._handler.join():K(a)?t(a):new z(a)}function s(a){return J(a)?a._handler.join():t(a)}function t(a){try{var b=a.then;return"function"==typeof b?new y(b,a):new z(a)}catch(a){return new A(a)}}function u(){}function v(){}function w(a,b){c.createContext(this,b),this.consumers=void 0,this.receiver=a,this.handler=void 0,this.resolved=!1}function x(a){this.handler=a}function y(a,b){w.call(this),W.enqueue(new G(a,b,this))}function z(a){c.createContext(this),this.value=a}function A(a){c.createContext(this),this.id=++$,this.value=a,this.handled=!1,this.reported=!1,this._report()}function B(a,b){this.rejection=a,this.context=b}function C(a){this.rejection=a}function D(){return new A(new TypeError("Promise cycle"))}function E(a,b){this.continuation=a,this.handler=b}function F(a,b){this.handler=b,this.value=a}function G(a,b,c){this._then=a,this.thenable=b,this.resolver=c}function H(a,b,c,d,e){try{a.call(b,c,d,e)}catch(a){d(a)}}function I(a,b,c,d){this.f=a,this.z=b,this.c=c,this.to=d,this.resolver=Z,this.receiver=this}function J(a){return a instanceof c}function K(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function L(a,b,d,e){return"function"!=typeof a?e.become(b):(c.enterContext(b),P(a,b.value,d,e),void c.exitContext())}function M(a,b,d,e,f){return"function"!=typeof a?f.become(d):(c.enterContext(d),Q(a,b,d.value,e,f),void c.exitContext())}function N(a,b,d,e,f){return"function"!=typeof a?f.notify(b):(c.enterContext(d),R(a,b,e,f),void c.exitContext())}function O(a,b,c){try{return a(b,c)}catch(a){return f(a)}}function P(a,b,c,d){try{d.become(r(a.call(c,b)))}catch(a){d.become(new A(a))}}function Q(a,b,c,d,e){try{a.call(d,b,c,e)}catch(a){e.become(new A(a))}}function R(a,b,c,d){try{d.notify(a.call(c,b))}catch(a){d.notify(a)}}function S(a,b){b.prototype=Y(a.prototype),b.prototype.constructor=b}function T(a,b){return b}function U(){}function V(){return"undefined"!=typeof a&&null!==a&&"function"==typeof a.emit?function(b,c){return"unhandledRejection"===b?a.emit(b,c.value,c):a.emit(b,c)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(a,b,c){var d=!1;try{var e=new c("unhandledRejection");d=e instanceof c}catch(a){}return d?function(a,d){var e=new c(a,{detail:{reason:d.value,key:d},bubbles:!1,cancelable:!0});return!b.dispatchEvent(e)}:a}(U,self,CustomEvent):U}var W=b.scheduler,X=V(),Y=Object.create||function(a){function b(){}return b.prototype=a,new b};c.resolve=e,c.reject=f,c.never=g,c._defer=h,c._handler=r,c.prototype.then=function(a,b,c){var d=this._handler,e=d.join().state();if("function"!=typeof a&&e>0||"function"!=typeof b&&e<0)return new this.constructor(u,d);var f=this._beget(),g=f._handler;return d.chain(g,d.receiver,a,b,c),f},c.prototype.catch=function(a){return this.then(void 0,a)},c.prototype._beget=function(){return i(this._handler,this.constructor)},c.all=j,c.race=p,c._traverse=k,c._visitRemaining=n,u.prototype.when=u.prototype.become=u.prototype.notify=u.prototype.fail=u.prototype._unreport=u.prototype._report=U,u.prototype._state=0,u.prototype.state=function(){return this._state},u.prototype.join=function(){for(var a=this;void 0!==a.handler;)a=a.handler;return a},u.prototype.chain=function(a,b,c,d,e){this.when({resolver:a,receiver:b,fulfilled:c,rejected:d,progress:e})},u.prototype.visit=function(a,b,c,d){this.chain(Z,a,b,c,d)},u.prototype.fold=function(a,b,c,d){this.when(new I(a,b,c,d))},S(u,v),v.prototype.become=function(a){a.fail()};var Z=new v;S(u,w),w.prototype._state=0,w.prototype.resolve=function(a){this.become(r(a))},w.prototype.reject=function(a){this.resolved||this.become(new A(a))},w.prototype.join=function(){if(!this.resolved)return this;for(var a=this;void 0!==a.handler;)if(a=a.handler,a===this)return this.handler=D();return a},w.prototype.run=function(){var a=this.consumers,b=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var c=0;c<a.length;++c)b.when(a[c])},w.prototype.become=function(a){this.resolved||(this.resolved=!0,this.handler=a,void 0!==this.consumers&&W.enqueue(this),void 0!==this.context&&a._report(this.context))},w.prototype.when=function(a){this.resolved?W.enqueue(new E(a,this.handler)):void 0===this.consumers?this.consumers=[a]:this.consumers.push(a)},w.prototype.notify=function(a){this.resolved||W.enqueue(new F(a,this))},w.prototype.fail=function(a){var b="undefined"==typeof a?this.context:a;this.resolved&&this.handler.join().fail(b)},w.prototype._report=function(a){this.resolved&&this.handler.join()._report(a)},w.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},S(u,x),x.prototype.when=function(a){W.enqueue(new E(a,this))},x.prototype._report=function(a){this.join()._report(a)},x.prototype._unreport=function(){this.join()._unreport()},S(w,y),S(u,z),z.prototype._state=1,z.prototype.fold=function(a,b,c,d){M(a,b,this,c,d)},z.prototype.when=function(a){L(a.fulfilled,this,a.receiver,a.resolver)};var $=0;S(u,A),A.prototype._state=-1,A.prototype.fold=function(a,b,c,d){d.become(this)},A.prototype.when=function(a){"function"==typeof a.rejected&&this._unreport(),L(a.rejected,this,a.receiver,a.resolver)},A.prototype._report=function(a){W.afterQueue(new B(this,a))},A.prototype._unreport=function(){this.handled||(this.handled=!0,W.afterQueue(new C(this)))},A.prototype.fail=function(a){this.reported=!0,X("unhandledRejection",this),c.onFatalRejection(this,void 0===a?this.context:a)},B.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,X("unhandledRejection",this.rejection)||c.onPotentiallyUnhandledRejection(this.rejection,this.context))},C.prototype.run=function(){this.rejection.reported&&(X("rejectionHandled",this.rejection)||c.onPotentiallyUnhandledRejectionHandled(this.rejection))},c.createContext=c.enterContext=c.exitContext=c.onPotentiallyUnhandledRejection=c.onPotentiallyUnhandledRejectionHandled=c.onFatalRejection=U;var _=new u,aa=new c(u,_);return E.prototype.run=function(){this.handler.join().when(this.continuation)},F.prototype.run=function(){var a=this.handler.consumers;if(void 0!==a)for(var b,c=0;c<a.length;++c)b=a[c],N(b.progress,this.value,this.handler,b.receiver,b.resolver)},G.prototype.run=function(){function a(a){d.resolve(a)}function b(a){d.reject(a)}function c(a){d.notify(a)}var d=this.resolver;H(this._then,this.thenable,a,b,c)},I.prototype.fulfilled=function(a){this.f.call(this.c,this.z,a,this.to)},I.prototype.rejected=function(a){this.to.reject(a)},I.prototype.progress=function(a){this.to.notify(a)},c}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})}).call(this,a("_process"))},{_process:258}],279:[function(a,b,c){!function(a){"use strict";a(function(){function a(){return{state:"pending"}}function b(a){return{state:"rejected",reason:a}}function c(a){return{state:"fulfilled",value:a}}function d(d){var e=d.state();return 0===e?a():e>0?c(d.value):b(d.value)}return{pending:a,fulfilled:c,rejected:b,inspect:d}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],280:[function(a,b,c){!function(a){"use strict";a(function(a){function b(a,b,c,d){var e=x.resolve(a);return arguments.length<2?e:e.then(b,c,d)}function c(a){return new x(a)}function d(a){return function(){for(var b=0,c=arguments.length,d=new Array(c);b<c;++b)d[b]=arguments[b];return y(a,this,d)}}function e(a){for(var b=0,c=arguments.length-1,d=new Array(c);b<c;++b)d[b]=arguments[b+1];return y(a,this,d)}function f(){return new g}function g(){function a(a){d._handler.resolve(a)}function b(a){d._handler.reject(a)}function c(a){d._handler.notify(a)}var d=x._defer();this.promise=d,this.resolve=a,this.reject=b,this.notify=c,this.resolver={resolve:a,reject:b,notify:c}}function h(a){return a&&"function"==typeof a.then}function i(){return x.all(arguments)}function j(a){return b(a,x.all)}function k(a){return b(a,x.settle)}function l(a,c){return b(a,function(a){return x.map(a,c)})}function m(a,c){return b(a,function(a){return x.filter(a,c)})}var n=a("./lib/decorators/timed"),o=a("./lib/decorators/array"),p=a("./lib/decorators/flow"),q=a("./lib/decorators/fold"),r=a("./lib/decorators/inspect"),s=a("./lib/decorators/iterate"),t=a("./lib/decorators/progress"),u=a("./lib/decorators/with"),v=a("./lib/decorators/unhandledRejection"),w=a("./lib/TimeoutError"),x=[o,p,q,s,t,r,u,n,v].reduce(function(a,b){return b(a)},a("./lib/Promise")),y=a("./lib/apply")(x);return b.promise=c,b.resolve=x.resolve,b.reject=x.reject,b.lift=d,b.try=e,b.attempt=e,b.iterate=x.iterate,b.unfold=x.unfold,b.join=i,b.all=j,b.settle=k,b.any=d(x.any),b.some=d(x.some),b.race=d(x.race),b.map=l,b.filter=m,b.reduce=d(x.reduce),b.reduceRight=d(x.reduceRight),b.isPromiseLike=h,b.Promise=x,b.defer=f,b.TimeoutError=w,b})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"./lib/Promise":263,"./lib/TimeoutError":265,"./lib/apply":266,"./lib/decorators/array":267,"./lib/decorators/flow":268,"./lib/decorators/fold":269,"./lib/decorators/inspect":270,"./lib/decorators/iterate":271,"./lib/decorators/progress":272,"./lib/decorators/timed":273,"./lib/decorators/unhandledRejection":274,"./lib/decorators/with":275}]},{},[55]);